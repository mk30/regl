(function e$$0(t,y,c){function m(e,k){if(!y[e]){if(!t[e]){var b="function"==typeof require&&require;if(!k&&b)return b(e,!0);if(f)return f(e,!0);b=Error("Cannot find module '"+e+"'");throw b.code="MODULE_NOT_FOUND",b;}b=y[e]={exports:{}};t[e][0].call(b.exports,function(b){var c=t[e][1][b];return m(c?c:b)},b,b.exports,e$$0,t,y,c)}return y[e].exports}for(var f="function"==typeof require&&require,l=0;l<c.length;l++)m(c[l]);return m})({1:[function(n,t,y){var c=n("../regl")(),m=c({frag:"\n  precision mediump float;\n  uniform sampler2D texture;\n  uniform vec2 screenShape;\n  uniform float time;\n\n  varying vec2 uv;\n\n  vec4 background () {\n    vec2 pos = 0.5 - gl_FragCoord.xy / screenShape;\n    float r = length(pos);\n    float theta = atan(pos.y, pos.x);\n    return vec4(\n      cos(pos.x * time) + sin(pos.y * pos.x * time),\n      cos(100.0 * r * cos(0.3 * time) + theta),\n      sin(time / r + pos.x * cos(10.0 * time + 3.0)),\n      1);\n  }\n\n  void main () {\n    vec4 color = texture2D(texture, uv);\n    float chromakey = step(0.15 + max(color.r, color.b), color.g);\n    gl_FragColor = mix(color, background(), chromakey);\n  }",
vert:"\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position;\n    gl_Position = vec4(1.0 - 2.0 * position, 0, 1);\n  }",attributes:{position:[-2,0,0,-2,2,2]},uniforms:{texture:c.prop("video"),screenShape:function(c){return[c.viewportWidth,c.viewportHeight]},time:c.context("time")},count:3});n("resl")({manifest:{video:{type:"video",src:"assets/doggie-chromakey.ogv",stream:!0}},onDone:function(f){var l=f.video;l.autoplay=!0;l.loop=!0;l.play();
var e=c.texture(l);c.frame(function(){m({video:e.subimage(l)})})}})},{"../regl":36,resl:35}],2:[function(n,t,y){function c(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}t.exports=function(m,f,l,e,k){m=l.maxAttributes;f=Array(m);for(l=0;l<m;++l)f[l]=new c;return{Record:c,scope:{},state:f}}},{}],3:[function(n,t,y){function c(b){return r[Object.prototype.toString.call(b)]|0}function m(b,c){for(var e=0;e<
c.length;++e)b[e]=c[e]}function f(b,c,e,k,f,l,h){for(var a=0,d=0;d<e;++d)for(var q=0;q<k;++q)b[a++]=c[f*d+l*q+h]}var l=n("./util/check"),e=n("./util/is-typed-array"),k=n("./util/is-ndarray"),b=n("./util/values"),p=n("./util/pool");y=n("./util/flatten");var F=y.flatten,Q=y.shape,r=n("./constants/arraytypes.json"),q=n("./constants/dtypes.json"),L=n("./constants/usage.json"),H=[];H[5120]=1;H[5122]=2;H[5124]=4;H[5121]=1;H[5123]=2;H[5125]=4;H[5126]=4;t.exports=function(r,n,A){function v(b){this.id=a++;
this.buffer=r.createBuffer();this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;A.profile&&(this.stats={size:0})}function M(b,a,d){b.byteLength=a.byteLength;r.bufferData(b.type,a,d)}function t(b,a,d,h,q,B){b.usage=d;if(Array.isArray(a)){if(b.dtype=h||5126,0<a.length)if(Array.isArray(a[0])){q=Q(a);for(var v=h=1;v<q.length;++v)h*=q[v];b.dimension=h;a=F(a,q,b.dtype);M(b,a,d);B?b.persistentData=a:p.freeType(a)}else"number"===typeof a[0]?(b.dimension=
q,q=p.allocType(b.dtype,a.length),m(q,a),M(b,q,d),B?b.persistentData=q:p.freeType(q)):e(a[0])?(b.dimension=a[0].length,b.dtype=h||c(a[0])||5126,a=F(a,[a.length,a[0].length],b.dtype),M(b,a,d),B?b.persistentData=a:p.freeType(a)):l.raise("invalid buffer data")}else if(e(a))b.dtype=h||c(a),b.dimension=q,M(b,a,d),B&&(b.persistentData=new Uint8Array(new Uint8Array(a.buffer)));else if(k(a)){q=a.shape;var r=a.stride,v=a.offset,n=0,z=0,J=0,A=0;1===q.length?(n=q[0],z=1,J=r[0],A=0):2===q.length?(n=q[0],z=q[1],
J=r[0],A=r[1]):l.raise("invalid shape");b.dtype=h||c(a.data)||5126;b.dimension=z;q=p.allocType(b.dtype,n*z);f(q,a.data,n,z,J,A,v);M(b,q,d);B?b.persistentData=q:p.freeType(q)}else l.raise("invalid buffer data")}function h(b){n.bufferCount--;var a=b.buffer;l(a,"buffer must not be deleted already");r.deleteBuffer(a);b.buffer=null;delete d[b.id]}var a=0,d={};v.prototype.bind=function(){r.bindBuffer(this.type,this.buffer)};v.prototype.destroy=function(){h(this)};var B=[];A.profile&&(n.getTotalBufferSize=
function(){var b=0;Object.keys(d).forEach(function(a){b+=d[a].stats.size});return b});return{create:function(b,a,B,M){function G(b){var a=35044,d=null,c=0,h=0,N=1;Array.isArray(b)||e(b)||k(b)?d=b:"number"===typeof b?c=b|0:b&&(l.type(b,"object","buffer arguments must be an object, a number or an array"),"data"in b&&(l(null===d||Array.isArray(d)||e(d)||k(d),"invalid data for buffer"),d=b.data),"usage"in b&&(l.parameter(b.usage,L,"invalid buffer usage"),a=L[b.usage]),"type"in b&&(l.parameter(b.type,
q,"invalid buffer type"),h=q[b.type]),"dimension"in b&&(l.type(b.dimension,"number","invalid dimension"),N=b.dimension|0),"length"in b&&(l.nni(c,"buffer length must be a nonnegative integer"),c=b.length|0));I.bind();d?t(I,d,a,h,N,M):(r.bufferData(I.type,c,a),I.dtype=h||5121,I.usage=a,I.dimension=N,I.byteLength=c);A.profile&&(I.stats.size=I.byteLength*H[I.dtype]);return G}function V(b,a){l(a+b.byteLength<=I.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+b.byteLength+
" starting from offset "+a+" to a buffer of size "+I.byteLength);r.bufferSubData(I.type,a,b)}n.bufferCount++;var I=new v(a);d[I.id]=I;B||G(b);G._reglType="buffer";G._buffer=I;G.subdata=function(b,a){var d=(a||0)|0,h;I.bind();if(Array.isArray(b)){if(0<b.length)if("number"===typeof b[0]){var q=p.allocType(I.dtype,b.length);m(q,b);V(q,d);p.freeType(q)}else Array.isArray(b[0])||e(b[0])?(h=Q(b),q=F(b,h,I.dtype),V(q,d),p.freeType(q)):l.raise("invalid buffer data")}else if(e(b))V(b,d);else if(k(b)){h=b.shape;
var N=b.stride,B=q=0,v=0,r=0;1===h.length?(q=h[0],B=1,v=N[0],r=0):2===h.length?(q=h[0],B=h[1],v=N[0],r=N[1]):l.raise("invalid shape");h=Array.isArray(b.data)?I.dtype:c(b.data);h=p.allocType(h,q*B);f(h,b.data,q,B,v,r,b.offset);V(h,d);p.freeType(h)}else l.raise("invalid data for buffer subdata");return G};A.profile&&(G.stats=I.stats);G.destroy=function(){h(I)};return G},createStream:function(b,a){var d=B.pop();d||(d=new v(b));d.bind();t(d,a,35040,0,1,!1);return d},destroyStream:function(b){B.push(b)},
clear:function(){b(d).forEach(h);B.forEach(h)},getBuffer:function(b){return b&&b._buffer instanceof v?b._buffer:null},restore:function(){b(d).forEach(function(b){b.buffer=r.createBuffer();r.bindBuffer(b.type,b.buffer);r.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:t}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/check":21,"./util/flatten":25,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/values":33}],
4:[function(n,t,y){t.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(n,t,y){t.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(n,t,y){t.exports={points:0,point:0,lines:1,
line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(n,t,y){t.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(n,t,y){function c(b){return Array.isArray(b)||Q(b)||r(b)}function m(b){return b.sort(function(b,a){return"viewport"===b?-1:"viewport"===a?1:b<a?-1:1})}function f(b,a,d,c){this.thisDep=b;this.contextDep=a;this.propDep=d;this.append=c}function l(b){return b&&!(b.thisDep||b.contextDep||b.propDep)}function e(b){return new f(!1,
!1,!1,b)}function k(b,a){var d=b.type;return 0===d?(d=b.data.length,new f(!0,1<=d,2<=d,a)):4===d?(d=b.data,new f(d.thisDep,d.contextDep,d.propDep,a)):new f(3===d,2===d,1===d,a)}var b=n("./util/check"),p=n("./util/codegen"),F=n("./util/loop"),Q=n("./util/is-typed-array"),r=n("./util/is-ndarray"),q=n("./util/is-array-like"),L=n("./dynamic"),H=n("./constants/primitives.json"),C=n("./constants/dtypes.json"),K=["x","y","z","w"],A="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),
v={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},M="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
U={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},h={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},a={frag:35632,vert:35633},d={cw:2304,ccw:2305},B=new f(!1,!1,!1,function(){});t.exports=function(r,n,Q,t,G,V,I,y,W,z,J,Da,la,pa,wa){function ba(b){return b.replace(".","_")}function S(b,a,g){var d=ba(b);Ha.push(b);
qa[d]=w[d]=!!g;Aa[d]=a}function O(b,a,g){var d=ba(b);Ha.push(b);Array.isArray(g)?(w[d]=g.slice(),qa[d]=g.slice()):w[d]=qa[d]=g;Ba[d]=a}function Ca(){var a=p(),g=a.link,d=a.global;a.id=Qa++;a.batchId="0";var c=g(Oa),e=a.shared={props:"a0"};Object.keys(Oa).forEach(function(b){e[b]=d.def(c,".",b)});b.optional(function(){a.CHECK=g(b);a.commandStr=b.guessCommand();a.command=g(a.commandStr);a.assert=function(b,a,E){b("if(!(",a,"))",this.CHECK,".commandRaise(",g(E),",",this.command,");")};Ia.invalidBlendCombinations=
M});var P=a.next={},h=a.current={};Object.keys(Ba).forEach(function(b){Array.isArray(w[b])&&(P[b]=d.def(e.next,".",b),h[b]=d.def(e.current,".",b))});var Ra=a.constants={};Object.keys(Ia).forEach(function(b){Ra[b]=d.def(JSON.stringify(Ia[b]))});a.invoke=function(b,E){switch(E.type){case 0:var d=["this",e.context,e.props,a.batchId];return b.def(g(E.data),".call(",d.slice(0,Math.max(E.data.length+1,4)),")");case 1:return b.def(e.props,E.data);case 2:return b.def(e.context,E.data);case 3:return b.def("this",
E.data);case 4:return E.data.append(a,b),E.data.ref}};a.attribCache={};var E={};a.scopeAttrib=function(b){b=n.id(b);if(b in E)return E[b];var a=z.scope[b];a||(a=z.scope[b]=new sa);return E[b]=g(a)};return a}function ta(b){var a=b["static"];b=b.dynamic;var g;if("profile"in a){var d=!!a.profile;g=e(function(b,a){return d});g.enable=d}else if("profile"in b){var c=b.profile;g=k(c,function(b,a){return b.invoke(a,c)})}return g}function xa(a,g){var d=a["static"],c=a.dynamic;if("framebuffer"in d){var w=d.framebuffer;
return w?(w=y.getFramebuffer(w),b.command(w,"invalid framebuffer object"),e(function(b,a){var g=b.link(w),d=b.shared;a.set(d.framebuffer,".next",g);d=d.context;a.set(d,".framebufferWidth",g+".width");a.set(d,".framebufferHeight",g+".height");return g})):e(function(b,a){var g=b.shared;a.set(g.framebuffer,".next","null");g=g.context;a.set(g,".framebufferWidth",g+".drawingBufferWidth");a.set(g,".framebufferHeight",g+".drawingBufferHeight");return"null"})}if("framebuffer"in c){var P=c.framebuffer;return k(P,
function(a,g){var d=a.invoke(g,P),D=a.shared,T=D.framebuffer,u=g.def(T,".getFramebuffer(",d,")");b.optional(function(){a.assert(g,"!"+d+"||"+u,"invalid framebuffer object")});g.set(T,".next",u);D=D.context;g.set(D,".framebufferWidth",u+"?"+u+".width:"+D+".drawingBufferWidth");g.set(D,".framebufferHeight",u+"?"+u+".height:"+D+".drawingBufferHeight");return u})}return null}function ca(a,g,d){function c(a){if(a in e){var E=e[a];b.commandType(E,"object","invalid "+a,d.commandStr);var u=!0,T=E.x|0,w=E.y|
0,h,q;"width"in E?(h=E.width|0,b.command(0<=h,"invalid "+a,d.commandStr)):u=!1;"height"in E?(q=E.height|0,b.command(0<=q,"invalid "+a,d.commandStr)):u=!1;return new f(!u&&g&&g.thisDep,!u&&g&&g.contextDep,!u&&g&&g.propDep,function(b,a){var g=b.shared.context,d=h;"width"in E||(d=a.def(g,".","framebufferWidth","-",T));var u=q;"height"in E||(u=a.def(g,".","framebufferHeight","-",w));return[T,w,d,u]})}if(a in P){var x=P[a],u=k(x,function(g,d){var E=g.invoke(d,x);b.optional(function(){g.assert(d,E+"&&typeof "+
E+'==="object"',"invalid "+a)});var T=g.shared.context,u=d.def(E,".x|0"),D=d.def(E,".y|0"),c=d.def('"width" in ',E,"?",E,".width|0:","(",T,".","framebufferWidth","-",u,")"),e=d.def('"height" in ',E,"?",E,".height|0:","(",T,".","framebufferHeight","-",D,")");b.optional(function(){g.assert(d,c+">=0&&"+e+">=0","invalid "+a)});return[u,D,c,e]});g&&(u.thisDep=u.thisDep||g.thisDep,u.contextDep=u.contextDep||g.contextDep,u.propDep=u.propDep||g.propDep);return u}return g?new f(g.thisDep,g.contextDep,g.propDep,
function(b,a){var g=b.shared.context;return[0,0,a.def(g,".","framebufferWidth"),a.def(g,".","framebufferHeight")]}):null}var e=a["static"],P=a.dynamic;if(a=c("viewport")){var w=a;a=new f(a.thisDep,a.contextDep,a.propDep,function(b,a){var g=w.append(b,a),d=b.shared.context;a.set(d,".viewportWidth",g[2]);a.set(d,".viewportHeight",g[3]);return g})}return{viewport:a,scissor_box:c("scissor.box")}}function ja(g){function d(g){if(g in c){var E=n.id(c[g]);b.optional(function(){J.shader(a[g],E,b.guessCommand())});
var u=e(function(){return E});u.id=E;return u}if(g in w){var T=w[g];return k(T,function(d,E){var u=d.invoke(E,T),D=E.def(d.shared.strings,".id(",u,")");b.optional(function(){E(d.shared.shader,".shader(",a[g],",",D,",",d.command,");")});return D})}return null}var c=g["static"],w=g.dynamic,h=d("frag"),P=d("vert"),q=null;l(h)&&l(P)?(q=J.program(P.id,h.id),g=e(function(b,a){return b.link(q)})):g=new f(h&&h.thisDep||P&&P.thisDep,h&&h.contextDep||P&&P.contextDep,h&&h.propDep||P&&P.propDep,function(a,g){var d=
a.shared.shader,T;T=h?h.append(a,g):g.def(d,".","frag");var u;u=P?P.append(a,g):g.def(d,".","vert");var D=d+".program("+u+","+T;b.optional(function(){D+=","+a.command});return g.def(D+")")});return{frag:h,vert:P,progVar:g,program:q}}function ma(a,g){function d(a,E){if(a in w){var u=w[a]|0;b.command(!E||0<=u,"invalid "+a,g.commandStr);return e(function(b,a){E&&(b.OFFSET=u);return u})}if(a in h){var T=h[a];return k(T,function(g,d){var u=g.invoke(d,T);E&&(g.OFFSET=u,b.optional(function(){g.assert(d,
u+">=0","invalid "+a)}));return u})}return E&&P?e(function(b,a){b.OFFSET="0";return 0}):null}var w=a["static"],h=a.dynamic,P=function(){if("elements"in w){var a=w.elements;c(a)?a=V.getElements(V.create(a,!0)):a&&(a=V.getElements(a),b.command(a,"invalid elements",g.commandStr));var d=e(function(b,g){if(a){var d=b.link(a);return b.ELEMENTS=d}return b.ELEMENTS=null});d.value=a;return d}if("elements"in h){var u=h.elements;return k(u,function(a,g){var d=a.shared,E=d.isBufferArgs,d=d.elements,D=a.invoke(g,
u),c=g.def("null"),E=g.def(E,"(",D,")"),e=a.cond(E).then(c,"=",d,".createStream(",D,");")["else"](c,"=",d,".getElements(",D,");");b.optional(function(){a.assert(e["else"],"!"+D+"||"+c,"invalid elements")});g.entry(e);g.exit(a.cond(E).then(d,".destroyStream(",c,");"));return a.ELEMENTS=c})}return null}(),q=d("offset",!0);return{elements:P,primitive:function(){if("primitive"in w){var a=w.primitive;b.commandParameter(a,H,"invalid primitve",g.commandStr);return e(function(b,g){return H[a]})}if("primitive"in
h){var d=h.primitive;return k(d,function(a,g){var u=a.constants.primTypes,D=a.invoke(g,d);b.optional(function(){a.assert(g,D+" in "+u,"invalid primitive, must be one of "+Object.keys(H))});return g.def(u,"[",D,"]")})}return P?l(P)?P.value?e(function(b,a){return a.def(b.ELEMENTS,".primType")}):e(function(){return 4}):new f(P.thisDep,P.contextDep,P.propDep,function(b,a){var g=b.ELEMENTS;return a.def(g,"?",g,".primType:",4)}):null}(),count:function(){if("count"in w){var a=w.count|0;b.command("number"===
typeof a&&0<=a,"invalid vertex count",g.commandStr);return e(function(){return a})}if("count"in h){var d=h.count;return k(d,function(a,g){var u=a.invoke(g,d);b.optional(function(){a.assert(g,"typeof "+u+'==="number"&&'+u+">=0&&"+u+"===("+u+"|0)","invalid vertex count")});return u})}if(P){if(l(P)){if(P)return q?new f(q.thisDep,q.contextDep,q.propDep,function(a,g){var d=g.def(a.ELEMENTS,".vertCount-",a.OFFSET);b.optional(function(){a.assert(g,d+">=0","invalid vertex offset/element buffer too small")});
return d}):e(function(b,a){return a.def(b.ELEMENTS,".vertCount")});var u=e(function(){return-1});b.optional(function(){u.MISSING=!0});return u}var T=new f(P.thisDep||q.thisDep,P.contextDep||q.contextDep,P.propDep||q.propDep,function(b,a){var g=b.ELEMENTS;return b.OFFSET?a.def(g,"?",g,".vertCount-",b.OFFSET,":-1"):a.def(g,"?",g,".vertCount:-1")});b.optional(function(){T.DYNAMIC=!0});return T}return null}(),instances:d("instances",!1),offset:q}}function na(a,g){var c=a["static"],w=a.dynamic,x={};Ha.forEach(function(a){function u(b,
g){if(a in c){var d=b(c[a]);x[f]=e(function(){return d})}else if(a in w){var D=w[a];x[f]=k(D,function(b,a){return g(b,a,b.invoke(a,D))})}}var f=ba(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return u(function(d){b.commandType(d,"boolean",a,g.commandStr);return d},function(g,d,u){b.optional(function(){g.assert(d,"typeof "+u+'==="boolean"',
"invalid flag "+a,g.commandStr)});return u});case "depth.func":return u(function(d){b.commandParameter(d,U,"invalid "+a,g.commandStr);return U[d]},function(g,d,u){var c=g.constants.compareFuncs;b.optional(function(){g.assert(d,u+" in "+c,"invalid "+a+", must be one of "+Object.keys(U))});return d.def(c,"[",u,"]")});case "depth.range":return u(function(a){b.command(q(a)&&2===a.length&&"number"===typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",g.commandStr);return a},function(a,
g,d){b.optional(function(){a.assert(g,a.shared.isArrayLike+"("+d+")&&"+d+".length===2&&typeof "+d+'[0]==="number"&&typeof '+d+'[1]==="number"&&'+d+"[0]<="+d+"[1]","depth range must be a 2d array")});var u=g.def("+",d,"[0]"),c=g.def("+",d,"[1]");return[u,c]});case "blend.func":return u(function(a){b.commandType(a,"object","blend.func",g.commandStr);var d="srcRGB"in a?a.srcRGB:a.src,u="srcAlpha"in a?a.srcAlpha:a.src,c="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;b.commandParameter(d,
v,f+".srcRGB",g.commandStr);b.commandParameter(u,v,f+".srcAlpha",g.commandStr);b.commandParameter(c,v,f+".dstRGB",g.commandStr);b.commandParameter(a,v,f+".dstAlpha",g.commandStr);b.command(-1===M.indexOf(d+", "+c),"unallowed blending combination (srcRGB, dstRGB) = ("+d+", "+c+")",g.commandStr);return[v[d],v[c],v[u],v[a]]},function(g,d,u){function c(e,w){var h=d.def('"',e,w,'" in ',u,"?",u,".",e,w,":",u,".",e);b.optional(function(){g.assert(d,h+" in "+D,"invalid "+a+"."+e+w+", must be one of "+Object.keys(v))});
return h}var D=g.constants.blendFuncs;b.optional(function(){g.assert(d,u+"&&typeof "+u+'==="object"',"invalid blend func, must be an object")});var e=c("src","RGB"),w=c("dst","RGB");b.optional(function(){g.assert(d,g.constants.invalidBlendCombinations+".indexOf("+e+'+", "+'+w+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var h=d.def(D,"[",e,"]"),q=d.def(D,"[",c("src","Alpha"),"]"),x=d.def(D,"[",w,"]"),f=d.def(D,"[",c("dst","Alpha"),"]");return[h,x,q,f]});case "blend.equation":return u(function(d){if("string"===
typeof d)return b.commandParameter(d,da,"invalid "+a,g.commandStr),[da[d],da[d]];if("object"===typeof d)return b.commandParameter(d.rgb,da,a+".rgb",g.commandStr),b.commandParameter(d.alpha,da,a+".alpha",g.commandStr),[da[d.rgb],da[d.alpha]];b.commandRaise("invalid blend.equation",g.commandStr)},function(g,d,u){var c=g.constants.blendEquations,D=d.def(),e=d.def(),w=g.cond("typeof ",u,'==="string"');b.optional(function(){function b(a,d,u){g.assert(a,u+" in "+c,"invalid "+d+", must be one of "+Object.keys(da))}
b(w.then,a,u);g.assert(w["else"],u+"&&typeof "+u+'==="object"',"invalid "+a);b(w["else"],a+".rgb",u+".rgb");b(w["else"],a+".alpha",u+".alpha")});w.then(D,"=",e,"=",c,"[",u,"];");w["else"](D,"=",c,"[",u,".rgb];",e,"=",c,"[",u,".alpha];");d(w);return[D,e]});case "blend.color":return u(function(a){b.command(q(a)&&4===a.length,"blend.color must be a 4d array",g.commandStr);return F(4,function(b){return+a[b]})},function(a,g,d){b.optional(function(){a.assert(g,a.shared.isArrayLike+"("+d+")&&"+d+".length===4",
"blend.color must be a 4d array")});return F(4,function(a){return g.def("+",d,"[",a,"]")})});case "stencil.mask":return u(function(a){b.commandType(a,"number",f,g.commandStr);return a|0},function(a,g,d){b.optional(function(){a.assert(g,"typeof "+d+'==="number"',"invalid stencil.mask")});return g.def(d,"|0")});case "stencil.func":return u(function(d){b.commandType(d,"object",f,g.commandStr);var u=d.cmp||"keep",c=d.ref||0;d="mask"in d?d.mask:-1;b.commandParameter(u,U,a+".cmp",g.commandStr);b.commandType(c,
"number",a+".ref",g.commandStr);b.commandType(d,"number",a+".mask",g.commandStr);return[U[u],c,d]},function(a,g,d){var u=a.constants.compareFuncs;b.optional(function(){function b(){a.assert(g,Array.prototype.join.call(arguments,""),"invalid stencil.func")}b(d+"&&typeof ",d,'==="object"');b('!("cmp" in ',d,")||(",d,".cmp in ",u,")")});var c=g.def('"cmp" in ',d,"?",u,"[",d,".cmp]",":",7680),D=g.def(d,".ref|0"),e=g.def('"mask" in ',d,"?",d,".mask|0:-1");return[c,D,e]});case "stencil.opFront":case "stencil.opBack":return u(function(d){b.commandType(d,
"object",f,g.commandStr);var u=d.fail||"keep",c=d.zfail||"keep";d=d.zpass||"keep";b.commandParameter(u,h,a+".fail",g.commandStr);b.commandParameter(c,h,a+".zfail",g.commandStr);b.commandParameter(d,h,a+".zpass",g.commandStr);return["stencil.opBack"===a?1029:1028,h[u],h[c],h[d]]},function(g,d,u){function c(e){b.optional(function(){g.assert(d,'!("'+e+'" in '+u+")||("+u+"."+e+" in "+D+")","invalid "+a+"."+e+", must be one of "+Object.keys(h))});return d.def('"',e,'" in ',u,"?",D,"[",u,".",e,"]:",7680)}
var D=g.constants.stencilOps;b.optional(function(){g.assert(d,u+"&&typeof "+u+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,c("fail"),c("zfail"),c("zpass")]});case "polygonOffset.offset":return u(function(a){b.commandType(a,"object",f,g.commandStr);var d=a.factor|0;a=a.units|0;b.commandType(d,"number",f+".factor",g.commandStr);b.commandType(a,"number",f+".units",g.commandStr);return[d,a]},function(g,d,u){b.optional(function(){g.assert(d,u+"&&typeof "+u+'==="object"',"invalid "+
a)});var c=d.def(u,".factor|0"),D=d.def(u,".units|0");return[c,D]});case "cull.face":return u(function(a){var d=0;"front"===a?d=1028:"back"===a&&(d=1029);b.command(!!d,f,g.commandStr);return d},function(a,g,d){b.optional(function(){a.assert(g,d+'==="front"||'+d+'==="back"',"invalid cull.face")});return g.def(d,'==="front"?',1028,":",1029)});case "lineWidth":return u(function(a){b.command("number"===typeof a&&a>=t.lineWidthDims[0]&&a<=t.lineWidthDims[1],"invalid line width, must positive number between "+
t.lineWidthDims[0]+" and "+t.lineWidthDims[1],g.commandStr);return a},function(a,g,d){b.optional(function(){a.assert(g,"typeof "+d+'==="number"&&'+d+">="+t.lineWidthDims[0]+"&&"+d+"<="+t.lineWidthDims[1],"invalid line width")});return d});case "frontFace":return u(function(a){b.commandParameter(a,d,f,g.commandStr);return d[a]},function(a,g,d){b.optional(function(){a.assert(g,d+'==="cw"||'+d+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return g.def(d+'==="cw"?2304:2305')});case "colorMask":return u(function(a){b.command(q(a)&&
4===a.length,"color.mask must be length 4 array",g.commandStr);return a.map(function(a){return!!a})},function(a,g,d){b.optional(function(){a.assert(g,a.shared.isArrayLike+"("+d+")&&"+d+".length===4","invalid color.mask")});return F(4,function(a){return"!!"+d+"["+a+"]"})});case "sample.coverage":return u(function(a){b.command("object"===typeof a&&a,f,g.commandStr);var d="value"in a?a.value:1;a=!!a.invert;b.command("number"===typeof d&&0<=d&&1>=d,"sample.coverage.value must be a number between 0 and 1",
g.commandStr);return[d,a]},function(a,g,d){b.optional(function(){a.assert(g,d+"&&typeof "+d+'==="object"',"invalid sample.coverage")});var u=g.def('"value" in ',d,"?+",d,".value:1"),c=g.def("!!",d,".invert");return[u,c]})}});return x}function oa(a,g){var d=a["static"],c=a.dynamic,w={};Object.keys(d).forEach(function(a){var u=d[a],c;if("number"===typeof u||"boolean"===typeof u)c=e(function(){return u});else if("function"===typeof u){var h=u._reglType;"texture2d"===h||"textureCube"===h?c=e(function(a){return a.link(u)}):
"framebuffer"===h||"framebufferCube"===h?(b.command(0<u.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',g.commandStr),c=e(function(a){return a.link(u.color[0])})):b.commandRaise('invalid data for uniform "'+a+'"',g.commandStr)}else q(u)?c=e(function(g){return g.global.def("[",F(u.length,function(d){b.command("number"===typeof u[d]||"boolean"===typeof u[d],"invalid uniform "+a,g.commandStr);return u[d]}),"]")}):b.commandRaise('invalid or missing data for uniform "'+
a+'"',g.commandStr);c.value=u;w[a]=c});Object.keys(c).forEach(function(a){var g=c[a];w[a]=k(g,function(a,b){return a.invoke(b,g)})});return w}function ra(a,d){var w=a["static"],h=a.dynamic,x={};Object.keys(w).forEach(function(a){var u=w[a],h=n.id(a),f=new sa;if(c(u))f.state=1,f.buffer=G.getBuffer(G.create(u,34962,!1,!0)),f.type=0;else{var k=G.getBuffer(u);if(k)f.state=1,f.buffer=k,f.type=0;else if(b.command("object"===typeof u&&u,"invalid data for attribute "+a,d.commandStr),u.constant){var T=u.constant;
f.buffer="null";f.state=2;"number"===typeof T?f.x=T:(b.command(q(T)&&0<T.length&&4>=T.length,"invalid constant for attribute "+a,d.commandStr),K.forEach(function(a,g){g<T.length&&(f[a]=T[g])}))}else{k=c(u.buffer)?G.getBuffer(G.create(u.buffer,34962,!1,!0)):G.getBuffer(u.buffer);b.command(!!k,'missing buffer for attribute "'+a+'"',d.commandStr);var l=u.offset|0;b.command(0<=l,'invalid offset for attribute "'+a+'"',d.commandStr);var B=u.stride|0;b.command(0<=B&&256>B,'invalid stride for attribute "'+
a+'", must be integer betweeen [0, 255]',d.commandStr);var r=u.size|0;b.command(!("size"in u)||0<r&&4>=r,'invalid size for attribute "'+a+'", must be 1,2,3,4',d.commandStr);var v=!!u.normalized,p=0;"type"in u&&(b.commandParameter(u.type,C,"invalid type for attribute "+a,d.commandStr),p=C[u.type]);var m=u.divisor|0;"divisor"in u&&(b.command(0===m||g,'cannot specify divisor for attribute "'+a+'", instancing not supported',d.commandStr),b.command(0<=m,'invalid divisor for attribute "'+a+'"',d.commandStr));
b.optional(function(){var g=d.commandStr,c="buffer offset divisor normalized type size stride".split(" ");Object.keys(u).forEach(function(d){b.command(0<=c.indexOf(d),'unknown parameter "'+d+'" for attribute pointer "'+a+'" (valid parameters are '+c+")",g)})});f.buffer=k;f.state=1;f.size=r;f.normalized=v;f.type=p||k.dtype;f.offset=l;f.stride=B;f.divisor=m}}x[a]=e(function(a,g){var b=a.attribCache;if(h in b)return b[h];var d={isStream:!1};Object.keys(f).forEach(function(a){d[a]=f[a]});f.buffer&&(d.buffer=
a.link(f.buffer),d.type=d.type||d.buffer+".dtype");return b[h]=d})});Object.keys(h).forEach(function(a){var g=h[a];x[a]=k(g,function(d,u){function c(a){u(f[a],"=",e,".",a,"|0;")}var e=d.invoke(u,g),D=d.shared,w=D.isBufferArgs,h=D.buffer;b.optional(function(){d.assert(u,e+"&&(typeof "+e+'==="object"||typeof '+e+'==="function")&&('+w+"("+e+")||"+h+".getBuffer("+e+")||"+h+".getBuffer("+e+".buffer)||"+w+"("+e+'.buffer)||("constant" in '+e+"&&(typeof "+e+'.constant==="number"||'+D.isArrayLike+"("+e+".constant))))",
'invalid dynamic attribute "'+a+'"')});var f={isStream:u.def(!1)},q=new sa;q.state=1;Object.keys(q).forEach(function(a){f[a]=u.def(""+q[a])});var x=f.buffer,k=f.type;u("if(",w,"(",e,")){",f.isStream,"=true;",x,"=",h,".createStream(",34962,",",e,");",k,"=",x,".dtype;","}else{",x,"=",h,".getBuffer(",e,");","if(",x,"){",k,"=",x,".dtype;",'}else if("constant" in ',e,"){",f.state,"=",2,";","if(typeof "+e+'.constant === "number"){',f[K[0]],"=",e,".constant;",K.slice(1).map(function(a){return f[a]}).join("="),
"=0;","}else{",K.map(function(a,g){return f[a]+"="+e+".constant.length>="+g+"?"+e+".constant["+g+"]:0;"}).join(""),"}}else{","if(",w,"(",e,".buffer)){",x,"=",h,".createStream(",34962,",",e,".buffer);","}else{",x,"=",h,".getBuffer(",e,".buffer);","}",k,'="type" in ',e,"?",D.glTypes,"[",e,".type]:",x,".dtype;",f.normalized,"=!!",e,".normalized;");c("size");c("offset");c("stride");c("divisor");u("}}");u.exit("if(",f.isStream,"){",h,".destroyStream(",x,");","}");return f})});return x}function ya(a){var g=
a["static"],d=a.dynamic,b={};Object.keys(g).forEach(function(a){var d=g[a];b[a]=e(function(a,g){return"number"===typeof d||"boolean"===typeof d?""+d:a.link(d)})});Object.keys(d).forEach(function(a){var g=d[a];b[a]=k(g,function(a,d){return a.invoke(d,g)})});return b}function Y(a,g,d,c,e){function w(a){var g=x[a];g&&(l[a]=g)}var h=a["static"],f=a.dynamic;b.optional(function(){function a(d){Object.keys(d).forEach(function(a){b.command(0<=g.indexOf(a),'unknown parameter "'+a+'"',e.commandStr)})}var g=
"framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(Ha);a(h);a(f)});var q=xa(a,e),x=ca(a,q,e),k=ma(a,e),l=na(a,e),B=ja(a,e);w("viewport");w(ba("scissor.box"));var r=0<Object.keys(l).length,q={framebuffer:q,draw:k,shader:B,state:l,dirty:r};q.profile=ta(a,e);q.uniforms=oa(d,e);q.attributes=ra(g,e);q.context=ya(c,e);return q}function Z(a,g,d){var b=a.shared.context,c=a.scope();Object.keys(d).forEach(function(e){g.save(b,"."+e);c(b,".",e,"=",d[e].append(a,g),";")});
g(c)}function ha(a,g,d,b){var c=a.shared,e=c.gl,w=c.framebuffer,h;x&&(h=g.def(c.extensions,".webgl_draw_buffers"));var f=a.constants,c=f.drawBuffer,f=f.backBuffer;a=d?d.append(a,g):g.def(w,".next");b||g("if(",a,"!==",w,".cur){");g("if(",a,"){",e,".bindFramebuffer(",36160,",",a,".framebuffer);");x&&g(h,".drawBuffersWEBGL(",c,"[",a,".colorAttachments.length]);");g("}else{",e,".bindFramebuffer(",36160,",null);");x&&g(h,".drawBuffersWEBGL(",f,");");g("}",w,".cur=",a,";");b||g("}")}function X(a,g,d){var b=
a.shared,c=b.gl,e=a.current,h=a.next,f=b.current,q=b.next,x=a.cond(f,".dirty");Ha.forEach(function(g){g=ba(g);if(!(g in d.state)){var b,D;if(g in h){b=h[g];D=e[g];var k=F(w[g].length,function(a){return x.def(b,"[",a,"]")});x(a.cond(k.map(function(a,g){return a+"!=="+D+"["+g+"]"}).join("||")).then(c,".",Ba[g],"(",k,");",k.map(function(a,g){return D+"["+g+"]="+a}).join(";"),";"))}else b=x.def(q,".",g),k=a.cond(b,"!==",f,".",g),x(k),g in Aa?k(a.cond(b).then(c,".enable(",Aa[g],");")["else"](c,".disable(",
Aa[g],");"),f,".",g,"=",b,";"):k(c,".",Ba[g],"(",b,");",f,".",g,"=",b,";")}});0===Object.keys(d.state).length&&x(f,".dirty=false;");g(x)}function R(a,g,d,b){var c=a.shared,e=a.current,w=c.current,h=c.gl;m(Object.keys(d)).forEach(function(c){var f=d[c];if(!b||b(f)){var x=f.append(a,g);if(Aa[c]){var k=Aa[c];l(f)?x?g(h,".enable(",k,");"):g(h,".disable(",k,");"):g(a.cond(x).then(h,".enable(",k,");")["else"](h,".disable(",k,");"));g(w,".",c,"=",x,";")}else if(q(x)){var B=e[c];g(h,".",Ba[c],"(",x,");",
x.map(function(a,g){return B+"["+g+"]="+a}).join(";"),";")}else g(h,".",Ba[c],"(",x,");",w,".",c,"=",x,";")}})}function aa(a,d){g&&(a.instancing=d.def(a.shared.extensions,".angle_instanced_arrays"))}function fa(a,g,d,b,c){function e(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function w(a){r=g.def();a(r,"=",e(),";");"string"===typeof c?a(x,".count+=",c,";"):a(x,".count++;");pa&&(b?(v=g.def(),a(v,"=",B,".getNumPendingQueries();")):a(B,".beginQuery(",x,");"))}function h(a){a(x,
".cpuTime+=",e(),"-",r,";");pa&&(b?a(B,".pushScopeStats(",v,",",B,".getNumPendingQueries(),",x,");"):a(B,".endQuery();"))}function f(a){var d=g.def(k,".profile");g(k,".profile=",a,";");g.exit(k,".profile=",d,";")}var q=a.shared,x=a.stats,k=q.current,B=q.timer;d=d.profile;var r,v;if(d){if(l(d)){d.enable?(w(g),h(g.exit),f("true")):f("false");return}d=d.append(a,g);f(d)}else d=g.def(k,".profile");q=a.block();w(q);g("if(",d,"){",q,"}");a=a.block();h(a);g.exit("if(",d,"){",a,"}")}function za(a,d,c,e,w){function h(a){switch(a){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function f(b,c,e){function w(){d("if(!",l,".buffer){",x,".enableVertexAttribArray(",k,");}");var b=e.type,h;h=e.size?d.def(e.size,"||",c):c;d("if(",l,".type!==",b,"||",l,".size!==",h,"||",v.map(function(a){return l+"."+a+"!=="+e[a]}).join("||"),"){",x,".bindBuffer(",34962,",",B,".buffer);",x,".vertexAttribPointer(",[k,h,b,e.normalized,e.stride,e.offset],");",l,".type=",b,";",l,".size=",h,";",v.map(function(a){return l+
"."+a+"="+e[a]+";"}).join(""),"}");g&&(b=e.divisor,d("if(",l,".divisor!==",b,"){",a.instancing,".vertexAttribDivisorANGLE(",[k,b],");",l,".divisor=",b,";}"))}function h(){d("if(",l,".buffer){",x,".disableVertexAttribArray(",k,");","}if(",K.map(function(a,g){return l+"."+a+"!=="+r[g]}).join("||"),"){",x,".vertexAttrib4f(",k,",",r,");",K.map(function(a,g){return l+"."+a+"="+r[g]+";"}).join(""),"}")}var x=q.gl,k=d.def(b,".location"),l=d.def(q.attributes,"[",k,"]");b=e.state;var B=e.buffer,r=[e.x,e.y,
e.z,e.w],v=["buffer","normalized","offset","stride"];1===b?w():2===b?h():(d("if(",b,"===",1,"){"),w(),d("}else{"),h(),d("}"))}var q=a.shared;e.forEach(function(g){var e=g.name,q=c.attributes[e],x;if(q){if(!w(q))return;x=q.append(a,d)}else{if(!w(B))return;var k=a.scopeAttrib(e);b.optional(function(){a.assert(d,k+".state","missing attribute "+e)});x={};Object.keys(new sa).forEach(function(a){x[a]=d.def(k,".",a)})}f(a.link(g),h(g.info.type),x)})}function ia(a,g,d,c,e){for(var w=a.shared,h=w.gl,f,x=0;x<
c.length;++x){var k=c[x],r=k.name,v=k.info.type,m=d.uniforms[r],k=a.link(k)+".location",p;if(m){if(!e(m))continue;if(l(m)){var z=m.value;b.command(null!==z&&"undefined"!==typeof z,'missing uniform "'+r+'"',a.commandStr);if(35678===v||35680===v)b.command("function"===typeof z&&(35678===v&&("texture2d"===z._reglType||"framebuffer"===z._reglType)||35680===v&&("textureCube"===z._reglType||"framebufferCube"===z._reglType)),"invalid texture for uniform "+r,a.commandStr),m=a.link(z._texture||z.color[0]._texture),
g(h,".uniform1i(",k,",",m+".bind());"),g.exit(m,".unbind();");else if(35674===v||35675===v||35676===v){b.optional(function(){b.command(q(z),"invalid matrix for uniform "+r,a.commandStr);b.command(35674===v&&4===z.length||35675===v&&9===z.length||35676===v&&16===z.length,"invalid length for matrix uniform "+r,a.commandStr)});var m=a.global.def("new Float32Array(["+Array.prototype.slice.call(z)+"])"),N=2;35675===v?N=3:35676===v&&(N=4);g(h,".uniformMatrix",N,"fv(",k,",false,",m,");")}else{switch(v){case 5126:b.commandType(z,
"number","uniform "+r,a.commandStr);f="1f";break;case 35664:b.command(q(z)&&2===z.length,"uniform "+r,a.commandStr);f="2f";break;case 35665:b.command(q(z)&&3===z.length,"uniform "+r,a.commandStr);f="3f";break;case 35666:b.command(q(z)&&4===z.length,"uniform "+r,a.commandStr);f="4f";break;case 35670:b.commandType(z,"boolean","uniform "+r,a.commandStr);f="1i";break;case 5124:b.commandType(z,"number","uniform "+r,a.commandStr);f="1i";break;case 35671:b.command(q(z)&&2===z.length,"uniform "+r,a.commandStr);
f="2i";break;case 35667:b.command(q(z)&&2===z.length,"uniform "+r,a.commandStr);f="2i";break;case 35672:b.command(q(z)&&3===z.length,"uniform "+r,a.commandStr);f="3i";break;case 35668:b.command(q(z)&&3===z.length,"uniform "+r,a.commandStr);f="3i";break;case 35673:b.command(q(z)&&4===z.length,"uniform "+r,a.commandStr);f="4i";break;case 35669:b.command(q(z)&&4===z.length,"uniform "+r,a.commandStr),f="4i"}g(h,".uniform",f,"(",k,",",q(z)?Array.prototype.slice.call(z):z,");")}continue}else p=m.append(a,
g)}else{if(!e(B))continue;p=g.def(w.uniforms,"[",n.id(r),"]")}35678===v?g("if(",p,"&&",p,'._reglType==="framebuffer"){',p,"=",p,".color[0];","}"):35680===v&&g("if(",p,"&&",p,'._reglType==="framebufferCube"){',p,"=",p,".color[0];","}");b.optional(function(){function d(b,c){a.assert(g,b,'bad data or missing for uniform "'+r+'".  '+c)}function b(a){d("typeof "+p+'==="'+a+'"',"invalid type, expected "+a)}function c(g,b){d(w.isArrayLike+"("+p+")&&"+p+".length==="+g,"invalid vector, should have length "+
g,a.commandStr)}function e(g){d("typeof "+p+'==="function"&&'+p+'._reglType==="texture'+(3553===g?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(v){case 5124:b("number");break;case 35667:c(2,"number");break;case 35668:c(3,"number");break;case 35669:c(4,"number");break;case 5126:b("number");break;case 35664:c(2,"number");break;case 35665:c(3,"number");break;case 35666:c(4,"number");break;case 35670:b("boolean");break;case 35671:c(2,"boolean");break;case 35672:c(3,"boolean");break;case 35673:c(4,
"boolean");break;case 35674:c(4,"number");break;case 35675:c(9,"number");break;case 35676:c(16,"number");break;case 35678:e(3553);break;case 35680:e(34067)}});m=1;switch(v){case 35678:case 35680:m=g.def(p,"._texture");g(h,".uniform1i(",k,",",m,".bind());");g.exit(m,".unbind();");continue;case 5124:case 35670:f="1i";break;case 35667:case 35671:f="2i";m=2;break;case 35668:case 35672:f="3i";m=3;break;case 35669:case 35673:f="4i";m=4;break;case 5126:f="1f";break;case 35664:f="2f";m=2;break;case 35665:f=
"3f";m=3;break;case 35666:f="4f";m=4;break;case 35674:f="Matrix2fv";break;case 35675:f="Matrix3fv";break;case 35676:f="Matrix4fv"}g(h,".uniform",f,"(",k,",");if("M"===f.charAt(0)){var k=Math.pow(v-35674+2,2),qa=a.global.def("new Float32Array(",k,")");g("false,(Array.isArray(",p,")||",p," instanceof Float32Array)?",p,":(",F(k,function(a){return qa+"["+a+"]="+p+"["+a+"]"}),",",qa,")")}else 1<m?g(F(m,function(a){return p+"["+a+"]"})):g(p);g(");")}}function ua(a,d,c,e){function w(g){var b=r[g];return b?
b.contextDep&&e.contextDynamic||b.propDep?b.append(a,c):b.append(a,d):d.def(q,".",g)}function h(){function a(){c(n,".drawElementsInstancedANGLE(",[z,m,N,B+"<<(("+N+"-5121)>>1)",p],");")}function g(){c(n,".drawArraysInstancedANGLE(",[z,B,m,p],");")}v?qa?a():(c("if(",v,"){"),a(),c("}else{"),g(),c("}")):g()}function f(){function a(){c(k+".drawElements("+[z,m,N,B+"<<(("+N+"-5121)>>1)"]+");")}function g(){c(k+".drawArrays("+[z,B,m]+");")}v?qa?a():(c("if(",v,"){"),a(),c("}else{"),g(),c("}")):g()}var x=
a.shared,k=x.gl,q=x.draw,r=e.draw,v=function(){var g=r.elements,b=d;if(g){if(g.contextDep&&e.contextDynamic||g.propDep)b=c;g=g.append(a,b)}else g=b.def(q,".","elements");g&&b("if("+g+")"+k+".bindBuffer(34963,"+g+".buffer.buffer);");return g}(),z=w("primitive"),B=w("offset"),m=function(){var g=r.count,w,h=d;if(g){if(g.contextDep&&e.contextDynamic||g.propDep)h=c;w=g.append(a,h);b.optional(function(){g.MISSING&&a.assert(d,"false","missing vertex count");g.DYNAMIC&&a.assert(h,w+">=0","missing vertex count")})}else w=
h.def(q,".","count"),b.optional(function(){a.assert(h,w+">=0","missing vertex count")});return w}();if("number"===typeof m){if(0===m)return}else c("if(",m,"){"),c.exit("}");var p,n;g&&(p=w("instances"),n=a.instancing);var N=v+".type",qa=r.elements&&l(r.elements);g&&("number"!==typeof p||0<=p)?"string"===typeof p?(c("if(",p,">0){"),h(),c("}else if(",p,"<0){"),f(),c("}")):h():f()}function Ea(a,d,c,e,w){var h=Ca();w=h.proc("body",w);b.optional(function(){h.commandStr=d.commandStr;h.command=h.link(d.commandStr)});
g&&(h.instancing=w.def(h.shared.extensions,".angle_instanced_arrays"));a(h,w,c,e);return h.compile().body}function Ga(a,g,d,b){aa(a,g);za(a,g,d,b.attributes,function(){return!0});ia(a,g,d,b.uniforms,function(){return!0});ua(a,g,g,d)}function Ja(a,g){var d=a.proc("draw",1);aa(a,d);Z(a,d,g.context);ha(a,d,g.framebuffer);X(a,d,g);R(a,d,g.state);fa(a,d,g,!1,!0);var b=g.shader.progVar.append(a,d);d(a.shared.gl,".useProgram(",b,".program);");if(g.shader.program)Ga(a,d,g,g.shader.program);else{var c=a.global.def("{}"),
e=d.def(b,".id"),h=d.def(c,"[",e,"]");d(a.cond(h).then(h,".call(this,a0);")["else"](h,"=",c,"[",e,"]=",a.link(function(d){return Ea(Ga,a,g,d,1)}),"(",b,");",h,".call(this,a0);"))}0<Object.keys(g.state).length&&d(a.shared.current,".dirty=true;")}function Fa(a,g,d,b){function c(){return!0}a.batchId="a1";aa(a,g);za(a,g,d,b.attributes,c);ia(a,g,d,b.uniforms,c);ua(a,g,g,d)}function Ka(a,g,d,b){function c(a){return a.contextDep&&h||a.propDep}function e(a){return!c(a)}aa(a,g);var h=d.contextDep,w=g.def(),
f=g.def();a.shared.props=f;a.batchId=w;var x=a.scope(),k=a.scope();g(x.entry,"for(",w,"=0;",w,"<","a1",";++",w,"){",f,"=","a0","[",w,"];",k,"}",x.exit);d.needsContext&&Z(a,k,d.context);d.needsFramebuffer&&ha(a,k,d.framebuffer);R(a,k,d.state,c);d.profile&&c(d.profile)&&fa(a,k,d,!1,!0);b?(za(a,x,d,b.attributes,e),za(a,k,d,b.attributes,c),ia(a,x,d,b.uniforms,e),ia(a,k,d,b.uniforms,c),ua(a,x,k,d)):(g=a.global.def("{}"),b=d.shader.progVar.append(a,k),f=k.def(b,".id"),x=k.def(g,"[",f,"]"),k(a.shared.gl,
".useProgram(",b,".program);","if(!",x,"){",x,"=",g,"[",f,"]=",a.link(function(g){return Ea(Fa,a,d,g,2)}),"(",b,");}",x,".call(this,a0[",w,"],",w,");"))}function La(a,g){function d(a){return a.contextDep&&c||a.propDep}var b=a.proc("batch",2);a.batchId="0";aa(a,b);var c=!1,e=!0;Object.keys(g.context).forEach(function(a){c=c||g.context[a].propDep});c||(Z(a,b,g.context),e=!1);var h=g.framebuffer,w=!1;h?(h.propDep?c=w=!0:h.contextDep&&c&&(w=!0),w||ha(a,b,h)):ha(a,b,null);g.state.viewport&&g.state.viewport.propDep&&
(c=!0);X(a,b,g);R(a,b,g.state,function(a){return!d(a)});g.profile&&d(g.profile)||fa(a,b,g,!1,"a1");g.contextDep=c;g.needsContext=e;g.needsFramebuffer=w;e=g.shader.progVar;if(e.contextDep&&c||e.propDep)Ka(a,b,g,null);else if(e=e.append(a,b),b(a.shared.gl,".useProgram(",e,".program);"),g.shader.program)Ka(a,b,g,g.shader.program);else{var h=a.global.def("{}"),w=b.def(e,".id"),f=b.def(h,"[",w,"]");b(a.cond(f).then(f,".call(this,a0,a1);")["else"](f,"=",h,"[",w,"]=",a.link(function(d){return Ea(Ka,a,g,
d,2)}),"(",e,");",f,".call(this,a0,a1);"))}0<Object.keys(g.state).length&&b(a.shared.current,".dirty=true;")}function Ma(a,g){function d(e){var h=g.shader[e];h&&b.set(c.shader,"."+e,h.append(a,b))}var b=a.proc("scope",3);a.batchId="a2";var c=a.shared,e=c.current;Z(a,b,g.context);g.framebuffer&&g.framebuffer.append(a,b);m(Object.keys(g.state)).forEach(function(d){var e=g.state[d].append(a,b);q(e)?e.forEach(function(g,c){b.set(a.next[d],"["+c+"]",g)}):b.set(c.next,"."+d,e)});fa(a,b,g,!0,!0);["elements",
"offset","count","instances","primitive"].forEach(function(d){var e=g.draw[d];e&&b.set(c.draw,"."+d,""+e.append(a,b))});Object.keys(g.uniforms).forEach(function(d){b.set(c.uniforms,"["+n.id(d)+"]",g.uniforms[d].append(a,b))});Object.keys(g.attributes).forEach(function(d){var c=g.attributes[d].append(a,b),e=a.scopeAttrib(d);Object.keys(new sa).forEach(function(a){b.set(e,"."+a,c[a])})});d("vert");d("frag");0<Object.keys(g.state).length&&(b(e,".dirty=true;"),b.exit(e,".dirty=true;"));b("a1(",a.shared.context,
",a0,",a.batchId,");")}function Pa(a){if("object"===typeof a&&!q(a)){for(var g=Object.keys(a),d=0;d<g.length;++d)if(L.isDynamic(a[g[d]]))return!0;return!1}}function va(a,g,d){function b(a,g){h.forEach(function(d){var b=c[d];L.isDynamic(b)&&(b=a.invoke(g,b),g(q,".",d,"=",b,";"))})}var c=g["static"][d];if(c&&Pa(c)){var e=a.global,h=Object.keys(c),w=!1,f=!1,x=!1,q=a.global.def("{}");h.forEach(function(g){var d=c[g];if(L.isDynamic(d))"function"===typeof d&&(d=c[g]=L.unbox(d)),g=k(d,null),w=w||g.thisDep,
x=x||g.propDep,f=f||g.contextDep;else{e(q,".",g,"=");switch(typeof d){case "number":e(d);break;case "string":e('"',d,'"');break;case "object":Array.isArray(d)&&e("[",d.join(),"]");break;default:e(a.link(d))}e(";")}});g.dynamic[d]=new L.DynamicVariable(4,{thisDep:w,contextDep:f,propDep:x,ref:q,append:b});delete g["static"][d]}}var sa=z.Record,da={add:32774,subtract:32778,"reverse subtract":32779};Q.ext_blend_minmax&&(da.min=32775,da.max=32776);var g=Q.angle_instanced_arrays,x=Q.webgl_draw_buffers,
w={dirty:!0,profile:wa.profile},qa={},Ha=[],Aa={},Ba={};S("dither",3024);S("blend.enable",3042);O("blend.color","blendColor",[0,0,0,0]);O("blend.equation","blendEquationSeparate",[32774,32774]);O("blend.func","blendFuncSeparate",[1,0,1,0]);S("depth.enable",2929,!0);O("depth.func","depthFunc",513);O("depth.range","depthRange",[0,1]);O("depth.mask","depthMask",!0);O("colorMask","colorMask",[!0,!0,!0,!0]);S("cull.enable",2884);O("cull.face","cullFace",1029);O("frontFace","frontFace",2305);O("lineWidth",
"lineWidth",1);S("polygonOffset.enable",32823);O("polygonOffset.offset","polygonOffset",[0,0]);S("sample.alpha",32926);S("sample.enable",32928);O("sample.coverage","sampleCoverage",[1,!1]);S("stencil.enable",2960);O("stencil.mask","stencilMask",-1);O("stencil.func","stencilFunc",[519,0,-1]);O("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);O("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);S("scissor.enable",3089);O("scissor.box","scissor",[0,0,r.drawingBufferWidth,r.drawingBufferHeight]);
O("viewport","viewport",[0,0,r.drawingBufferWidth,r.drawingBufferHeight]);var Oa={gl:r,context:la,strings:n,next:qa,current:w,draw:Da,elements:V,buffer:G,shader:J,attributes:z.state,uniforms:W,framebuffer:y,extensions:Q,timer:pa,isBufferArgs:c},Ia={primTypes:H,compareFuncs:U,blendFuncs:v,blendEquations:da,stencilOps:h,glTypes:C,orientationType:d};b.optional(function(){Oa.isArrayLike=q});x&&(Ia.backBuffer=[1029],Ia.drawBuffer=F(t.maxDrawbuffers,function(a){return 0===a?[0]:F(a,function(a){return 36064+
a})}));var Qa=0;return{next:qa,current:w,procs:function(){var a=Ca(),g=a.proc("poll"),d=a.proc("refresh"),b=a.block();g(b);d(b);var c=a.shared,e=c.gl,h=c.next,f=c.current;b(f,".dirty=false;");ha(a,g);ha(a,d,null,!0);var x=r.getExtension("angle_instanced_arrays"),k;x&&(k=a.link(x));for(var l=0;l<t.maxAttributes;++l){var v=d.def(c.attributes,"[",l,"]"),z=a.cond(v,".buffer");z.then(e,".enableVertexAttribArray(",l,");",e,".bindBuffer(",34962,",",v,".buffer.buffer);",e,".vertexAttribPointer(",l,",",v,
".size,",v,".type,",v,".normalized,",v,".stride,",v,".offset);")["else"](e,".disableVertexAttribArray(",l,");",e,".vertexAttrib4f(",l,",",v,".x,",v,".y,",v,".z,",v,".w);",v,".buffer=null;");d(z);x&&d(k,".vertexAttribDivisorANGLE(",l,",",v,".divisor);")}Object.keys(Aa).forEach(function(c){var w=Aa[c],x=b.def(h,".",c),k=a.block();k("if(",x,"){",e,".enable(",w,")}else{",e,".disable(",w,")}",f,".",c,"=",x,";");d(k);g("if(",x,"!==",f,".",c,"){",k,"}")});Object.keys(Ba).forEach(function(c){var x=Ba[c],
k=w[c],v,l,r=a.block();r(e,".",x,"(");q(k)?(x=k.length,v=a.global.def(h,".",c),l=a.global.def(f,".",c),r(F(x,function(a){return v+"["+a+"]"}),");",F(x,function(a){return l+"["+a+"]="+v+"["+a+"];"}).join("")),g("if(",F(x,function(a){return v+"["+a+"]!=="+l+"["+a+"]"}).join("||"),"){",r,"}")):(v=b.def(h,".",c),l=b.def(f,".",c),r(v,");",f,".",c,"=",v,";"),g("if(",v,"!==",l,"){",r,"}"));d(r)});return a.compile()}(),compile:function(a,g,d,b,c){var e=Ca();e.stats=e.link(c);Object.keys(g["static"]).forEach(function(a){va(e,
g,a)});A.forEach(function(g){va(e,a,g)});d=Y(a,g,d,b,e);Ja(e,d);Ma(e,d);La(e,d);return e.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/check":21,"./util/codegen":23,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/loop":29}],9:[function(n,t,y){function c(c,f){this.id=l++;this.type=c;this.data=f}function m(c){if(0===c.length)return[];var f=c.charAt(0),b=c.charAt(c.length-1);if(1<c.length&&f===b&&('"'===f||"'"===f))return['"'+
c.substr(1,c.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(f=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(c))return m(c.substr(0,f.index)).concat(m(f[1])).concat(m(c.substr(f.index+f[0].length)));f=c.split(".");if(1===f.length)return['"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];c=[];for(b=0;b<f.length;++b)c=c.concat(m(f[b]));return c}function f(c){return"["+m(c).join("][")+"]"}var l=0;t.exports={DynamicVariable:c,define:function(e,k){return new c(e,f(k+""))},isDynamic:function(e){return"function"===
typeof e&&!e._reglType||e instanceof c},unbox:function(e,f){return"function"===typeof e?new c(0,e):e},accessor:f}},{}],10:[function(n,t,y){var c=n("./util/check"),m=n("./util/is-typed-array"),f=n("./util/is-ndarray"),l=n("./util/values"),e=n("./constants/primitives.json"),k=n("./constants/usage.json");t.exports=function(b,p,n,Q){function r(b){this.id=C++;t[this.id]=this;this.buffer=b;this.primType=4;this.type=this.vertCount=0}function q(e,k,q,h,a,d,l){e.buffer.bind();if(k){var r=l;l||m(k)&&(!f(k)||
m(k.data))||(r=p.oes_element_index_uint?5125:5123);n._initBuffer(e.buffer,k,q,r,3)}else b.bufferData(34963,d,q),e.buffer.dtype=r||5121,e.buffer.usage=q,e.buffer.dimension=3,e.buffer.byteLength=d;r=l;if(!l){switch(e.buffer.dtype){case 5121:case 5120:r=5121;break;case 5123:case 5122:r=5123;break;case 5125:case 5124:r=5125;break;default:c.raise("unsupported type for element array")}e.buffer.dtype=r}e.type=r;c(5125!==r||!!p.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");
k=a;0>k&&(k=e.buffer.byteLength,5123===r?k>>=1:5125===r&&(k>>=2));e.vertCount=k;k=h;0>h&&(k=4,h=e.buffer.dimension,1===h&&(k=0),2===h&&(k=1),3===h&&(k=4));e.primType=k}function L(b){Q.elementsCount--;c(null!==b.buffer,"must not double destroy elements");delete t[b.id];b.buffer.destroy();b.buffer=null}var t={},C=0,K={uint8:5121,uint16:5123};p.oes_element_index_uint&&(K.uint32=5125);r.prototype.bind=function(){this.buffer.bind()};var A=[];return{create:function(b,l){function p(d){if(d)if("number"===
typeof d)h(d),a.primType=4,a.vertCount=d|0,a.type=5121;else{var b=null,r=35044,l=-1,v=-1,n=0,A=0;if(Array.isArray(d)||m(d)||f(d))b=d;else if(c.type(d,"object","invalid arguments for elements"),"data"in d&&(b=d.data,c(Array.isArray(b)||m(b)||f(b),"invalid data for element buffer")),"usage"in d&&(c.parameter(d.usage,k,"invalid element buffer usage"),r=k[d.usage]),"primitive"in d&&(c.parameter(d.primitive,e,"invalid element buffer primitive"),l=e[d.primitive]),"count"in d&&(c("number"===typeof d.count&&
0<=d.count,"invalid vertex count for elements"),v=d.count|0),"type"in d&&(c.parameter(d.type,K,"invalid buffer type"),A=K[d.type]),"length"in d)n=d.length|0;else if(n=v,5123===A||5122===A)n*=2;else if(5125===A||5124===A)n*=4;q(a,b,r,l,v,n,A)}else h(),a.primType=4,a.vertCount=0,a.type=5121;return p}var h=n.create(null,34963,!0),a=new r(h._buffer);Q.elementsCount++;p(b);p._reglType="elements";p._elements=a;p.subdata=function(a,b){h.subdata(a,b);return p};p.destroy=function(){L(a)};return p},createStream:function(b){var c=
A.pop();c||(c=new r(n.create(null,34963,!0,!1)._buffer));q(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){A.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof r?b._elements:null},clear:function(){l(t).forEach(L)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/check":21,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/values":33}],11:[function(n,t,y){var c=n("./util/check");t.exports=function(m,f){function l(b){c.type(b,"string",
"extension name must be string");b=b.toLowerCase();var f;try{f=e[b]=m.getExtension(b)}catch(k){}return!!f}for(var e={},k=0;k<f.extensions.length;++k){var b=f.extensions[k];if(!l(b))return f.onDestroy(),f.onDone('"'+b+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}f.optionalExtensions.forEach(l);return{extensions:e,restore:function(){Object.keys(e).forEach(function(b){if(!l(b))throw Error("(regl): error restoring extension "+b);})}}}},
{"./util/check":21}],12:[function(n,t,y){var c=n("./util/check"),m=n("./util/values"),f=n("./util/extend"),l=[6408],e=[];e[6408]=4;var k=[];k[5121]=1;k[5126]=4;k[36193]=2;var b=[32854,32855,36194,35907,34842,34843,34836],p={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"};t.exports=function(n,t,r,q,L,H){function C(a,d,b){this.target=a;this.texture=d;this.renderbuffer=b;var c=a=0;d?(a=d.width,c=d.height):b&&(a=
b.width,c=b.height);this.width=a;this.height=c}function K(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function A(a,d,b){if(a){if(a.texture){a=a.texture._texture;var e=Math.max(1,a.height);c(Math.max(1,a.width)===d&&e===b,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,c(a.width===d&&a.height===b,"inconsistent width/height for renderbuffer");a.refCount+=1}}function v(a,d){d&&(d.texture?n.framebufferTexture2D(36160,
a,d.target,d.texture._texture.texture,0):n.framebufferRenderbuffer(36160,a,36161,d.renderbuffer._renderbuffer.renderbuffer))}function M(a){var d=3553,b=null,e=null,h=a;"object"===typeof a&&(h=a.data,"target"in a&&(d=a.target|0));c.type(h,"function","invalid attachment data");a=h._reglType;"texture2d"===a?(b=h,c(3553===d)):"textureCube"===a?(b=h,c(34069<=d&&34075>d,"invalid cube map target")):"renderbuffer"===a?(e=h,d=36161):c.raise("invalid regl object for attachment");return new C(d,b,e)}function U(a,
d,b,c,e){if(b)return a=q.create2D({width:a,height:d,format:c,type:e}),a._texture.refCount=0,new C(3553,a,null);a=L.create({width:a,height:d,format:c});a._renderbuffer.refCount=0;return new C(36161,null,a)}function h(a){return a&&(a.texture||a.renderbuffer)}function a(a,d,b){a&&(a.texture?a.texture.resize(d,b):a.renderbuffer&&a.renderbuffer.resize(d,b))}function d(){this.id=y++;W[this.id]=this;this.framebuffer=n.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=
this.stencilAttachment=this.depthAttachment=null}function B(a){a.colorAttachments.forEach(K);K(a.depthAttachment);K(a.stencilAttachment);K(a.depthStencilAttachment)}function N(a){var d=a.framebuffer;c(d,"must not double destroy framebuffer");n.deleteFramebuffer(d);a.framebuffer=null;H.framebufferCount--;delete W[a.id]}function Na(a){var d;n.bindFramebuffer(36160,a.framebuffer);var b=a.colorAttachments;for(d=0;d<b.length;++d)v(36064+d,b[d]);for(d=b.length;d<r.maxColorAttachments;++d)n.framebufferTexture2D(36160,
36064+d,3553,null,0);n.framebufferTexture2D(36160,33306,3553,null,0);n.framebufferTexture2D(36160,36096,3553,null,0);n.framebufferTexture2D(36160,36128,3553,null,0);v(36096,a.depthAttachment);v(36128,a.stencilAttachment);v(33306,a.depthStencilAttachment);a=n.checkFramebufferStatus(36160);36053!==a&&c.raise("framebuffer configuration not supported, status = "+p[a]);n.bindFramebuffer(36160,ka.next);ka.cur=ka.next;n.getError()}function ga(q,v){function n(a,d){var f;c(ka.next!==p,"can not update framebuffer which is currently in use");
var q=t.webgl_draw_buffers,v=0,m=0,N=!0,z=!0;f=null;var L=!0,F="rgba",C="uint8",H=1,ga=null,K=null,J=null,y=!1;if("number"===typeof a)v=a|0,m=d|0||v;else if(a){c.type(a,"object","invalid arguments for framebuffer");"shape"in a?(m=a.shape,c(Array.isArray(m)&&2<=m.length,"invalid shape for framebuffer"),v=m[0],m=m[1]):("radius"in a&&(v=m=a.radius),"width"in a&&(v=a.width),"height"in a&&(m=a.height));if("color"in a||"colors"in a)f=a.color||a.colors,Array.isArray(f)&&c(1===f.length||q,"multiple render targets not supported");
if(!f){"colorCount"in a&&(H=a.colorCount|0,c(0<H,"invalid color buffer count"));"colorTexture"in a&&(L=!!a.colorTexture,F="rgba4");if("colorType"in a){C=a.colorType;if(L)c(t.oes_texture_float||!("float"===C||"float32"===C),"you must enable OES_texture_float in order to use floating point framebuffer objects"),c(t.oes_texture_half_float||!("half float"===C||"float16"===C),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===C||"float16"===
C)c(t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),F="rgba16f";else if("float"===C||"float32"===C)c(t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),F="rgba32f";c.oneOf(C,I,"invalid color type")}if("colorFormat"in a)if(F=a.colorFormat,0<=G.indexOf(F))L=!0;else if(0<=V.indexOf(F))L=!1;else if(L)c.oneOf(a.colorFormat,G,"invalid color format for texture");else c.oneOf(a.colorFormat,
V,"invalid color format for renderbuffer")}if("depthTexture"in a||"depthStencilTexture"in a)y=!(!a.depthTexture&&!a.depthStencilTexture),c(!y||t.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in a&&("boolean"===typeof a.depth?N=a.depth:(ga=a.depth,z=!1));"stencil"in a&&("boolean"===typeof a.stencil?z=a.stencil:(K=a.stencil,N=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?N=z=a.depthStencil:(J=a.depthStencil,z=N=!1))}else v=m=1;var W=q=null,ea=null,X=null;if(Array.isArray(f))q=
f.map(M);else if(f)q=[M(f)];else for(q=Array(H),f=0;f<H;++f)q[f]=U(v,m,L,F,C);c(t.webgl_draw_buffers||1>=q.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");c(q.length<=r.maxColorAttachments,"too many color attachments, not supported");v=v||q[0].width;m=m||q[0].height;ga?W=M(ga):N&&!z&&(W=U(v,m,y,"depth","uint32"));K?ea=M(K):z&&!N&&(ea=U(v,m,!1,"stencil","uint8"));J?X=M(J):!ga&&!K&&z&&N&&(X=U(v,m,y,"depth stencil","depth stencil"));c(1>=!!ga+!!K+!!J,
"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");N=null;for(f=0;f<q.length;++f)A(q[f],v,m),c(!q[f]||q[f].texture&&0<=l.indexOf(q[f].texture._texture.format)||q[f].renderbuffer&&0<=b.indexOf(q[f].renderbuffer._renderbuffer.format),"framebuffer color attachment "+f+" is invalid"),q[f]&&q[f].texture&&(z=e[q[f].texture._texture.format]*k[q[f].texture._texture.type],null===N?N=z:c(N===z,"all color attachments much have the same number of bits per pixel."));A(W,v,m);
c(!W||W.texture&&6402===W.texture._texture.format||W.renderbuffer&&33189===W.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");A(ea,v,m);c(!ea||ea.renderbuffer&&36168===ea.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");A(X,v,m);c(!X||X.texture&&34041===X.texture._texture.format||X.renderbuffer&&34041===X.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");B(p);p.width=v;p.height=m;p.colorAttachments=
q;p.depthAttachment=W;p.stencilAttachment=ea;p.depthStencilAttachment=X;n.color=q.map(h);n.depth=h(W);n.stencil=h(ea);n.depthStencil=h(X);n.width=p.width;n.height=p.height;Na(p);return n}var p=new d;H.framebufferCount++;n(q,v);return f(n,{resize:function(d,b){c(ka.next!==p,"can not resize a framebuffer which is currently in use");var e=d|0,f=b|0||e;if(e===p.width&&f===p.height)return n;for(var h=p.colorAttachments,q=0;q<h.length;++q)a(h[q],e,f);a(p.depthAttachment,e,f);a(p.stencilAttachment,e,f);
a(p.depthStencilAttachment,e,f);p.width=n.width=e;p.height=n.height=f;Na(p);return n},_reglType:"framebuffer",_framebuffer:p,destroy:function(){N(p);B(p)},bind:function(a){ka.setFBO({framebuffer:n},a)}})}var ka={cur:null,next:null,dirty:!1,setFBO:null},G=["rgba"],V=["rgba4","rgb565","rgb5 a1"];t.ext_srgb&&V.push("srgba");t.ext_color_buffer_half_float&&V.push("rgba16f","rgb16f");t.webgl_color_buffer_float&&V.push("rgba32f");var I=["uint8"];t.oes_texture_half_float&&I.push("half float","float16");t.oes_texture_float&&
I.push("float","float32");var y=0,W={};return f(ka,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof d)?a:null},create:ga,createCube:function(a){function d(a){var e;c(0>b.indexOf(ka.next),"can not update framebuffer which is currently in use");var h=t.webgl_draw_buffers,k={color:null},r=0,l=null;e="rgba";var v="uint8",p=1;if("number"===typeof a)r=a|0;else if(a){c.type(a,"object","invalid arguments for framebuffer");"shape"in a?(r=
a.shape,c(Array.isArray(r)&&2<=r.length,"invalid shape for framebuffer"),c(r[0]===r[1],"cube framebuffer must be square"),r=r[0]):("radius"in a&&(r=a.radius|0),"width"in a?(r=a.width|0,"height"in a&&c(a.height===r,"must be square")):"height"in a&&(r=a.height|0));if("color"in a||"colors"in a)l=a.color||a.colors,Array.isArray(l)&&c(1===l.length||h,"multiple render targets not supported");l||("colorCount"in a&&(p=a.colorCount|0,c(0<p,"invalid color buffer count")),"colorType"in a&&(c.oneOf(a.colorType,
I,"invalid color type"),v=a.colorType),"colorFormat"in a&&(e=a.colorFormat,c.oneOf(a.colorFormat,G,"invalid color format for texture")));"depth"in a&&(k.depth=a.depth);"stencil"in a&&(k.stencil=a.stencil);"depthStencil"in a&&(k.depthStencil=a.depthStencil)}else r=1;if(l)if(Array.isArray(l))for(a=[],e=0;e<l.length;++e)a[e]=l[e];else a=[l];else for(a=Array(p),l={radius:r,format:e,type:v},e=0;e<p;++e)a[e]=q.createCube(l);k.color=Array(a.length);for(e=0;e<a.length;++e)p=a[e],c("function"===typeof p&&
"textureCube"===p._reglType,"invalid cube map"),r=r||p.width,c(p.width===r&&p.height===r,"invalid cube map shape"),k.color[e]={target:34069,data:a[e]};for(e=0;6>e;++e){for(p=0;p<a.length;++p)k.color[p].target=34069+e;0<e&&(k.depth=b[0].depth,k.stencil=b[0].stencil,k.depthStencil=b[0].depthStencil);if(b[e])b[e](k);else b[e]=ga(k)}return f(d,{width:r,height:r,color:a})}var b=Array(6);d(a);return f(d,{faces:b,resize:function(a){var e=a|0;c(0<e&&e<=r.maxCubeMapSize,"invalid radius for cube fbo");if(e===
d.width)return d;var f=d.color;for(a=0;a<f.length;++a)f[a].resize(e);for(a=0;6>a;++a)b[a].resize(e);d.width=d.height=e;return d},_reglType:"framebufferCube",destroy:function(){b.forEach(function(a){a.destroy()})}})},clear:function(){m(W).forEach(N)},restore:function(){m(W).forEach(function(a){a.framebuffer=n.createFramebuffer();Na(a)})}})}},{"./util/check":21,"./util/extend":24,"./util/values":33}],13:[function(n,t,y){t.exports=function(c,m){var f=1;m.ext_texture_filter_anisotropic&&(f=c.getParameter(34047));
var l=1,e=1;m.webgl_draw_buffers&&(l=c.getParameter(34852),e=c.getParameter(36063));return{colorBits:[c.getParameter(3410),c.getParameter(3411),c.getParameter(3412),c.getParameter(3413)],depthBits:c.getParameter(3414),stencilBits:c.getParameter(3415),subpixelBits:c.getParameter(3408),extensions:Object.keys(m).filter(function(c){return!!m[c]}),maxAnisotropic:f,maxDrawbuffers:l,maxColorAttachments:e,pointSizeDims:c.getParameter(33901),lineWidthDims:c.getParameter(33902),maxViewportDims:c.getParameter(3386),
maxCombinedTextureUnits:c.getParameter(35661),maxCubeMapSize:c.getParameter(34076),maxRenderbufferSize:c.getParameter(34024),maxTextureUnits:c.getParameter(34930),maxTextureSize:c.getParameter(3379),maxAttributes:c.getParameter(34921),maxVertexUniforms:c.getParameter(36347),maxVertexTextureUnits:c.getParameter(35660),maxVaryingVectors:c.getParameter(36348),maxFragmentUniforms:c.getParameter(36349),glsl:c.getParameter(35724),renderer:c.getParameter(7937),vendor:c.getParameter(7936),version:c.getParameter(7938)}}},
{}],14:[function(n,t,y){var c=n("./util/check"),m=n("./util/is-typed-array");t.exports=function(f,l,e,k,b,p){function n(r){var q;null===l.next?(c(b.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),q=5121):(c(null!==l.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),q=l.next.colorAttachments[0].texture._texture.type,p.oes_texture_float?c(5121===q||5126===q,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):
c(5121===q,"Reading from a framebuffer is only allowed for the type 'uint8'"));var t=0,F=0,C=k.framebufferWidth,Q=k.framebufferHeight,A=null;m(r)?A=r:r&&(c.type(r,"object","invalid arguments to regl.read()"),t=r.x|0,F=r.y|0,c(0<=t&&t<k.framebufferWidth,"invalid x offset for regl.read"),c(0<=F&&F<k.framebufferHeight,"invalid y offset for regl.read"),C=(r.width||k.framebufferWidth-t)|0,Q=(r.height||k.framebufferHeight-F)|0,A=r.data||null);A&&(5121===q?c(A instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):
5126===q&&c(A instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));c(0<C&&C+t<=k.framebufferWidth,"invalid width for read pixels");c(0<Q&&Q+F<=k.framebufferHeight,"invalid height for read pixels");e();r=C*Q*4;A||(5121===q?A=new Uint8Array(r):5126===q&&(A=A||new Float32Array(r)));c.isTypedArray(A,"data buffer for regl.read() must be a typedarray");c(A.byteLength>=r,"data buffer for regl.read() too small");f.pixelStorei(3333,4);f.readPixels(t,F,C,
Q,6408,q,A);return A}function t(b){var c;l.setFBO({framebuffer:b.framebuffer},function(){c=n(b)});return c}return function(b){return b&&"framebuffer"in b?t(b):n(b)}}},{"./util/check":21,"./util/is-typed-array":28}],15:[function(n,t,y){var c=n("./util/check"),m=n("./util/values"),f=[];f[32854]=2;f[32855]=2;f[36194]=2;f[33189]=2;f[36168]=1;f[34041]=4;f[35907]=4;f[34836]=16;f[34842]=8;f[34843]=6;t.exports=function(l,e,k,b,p){function n(b){this.id=L++;this.refCount=1;this.renderbuffer=b;this.format=32854;
this.height=this.width=0;p.profile&&(this.stats={size:0})}function t(e){var f=e.renderbuffer;c(f,"must not double destroy renderbuffer");l.bindRenderbuffer(36161,null);l.deleteRenderbuffer(f);e.renderbuffer=null;e.refCount=0;delete H[e.id];b.renderbufferCount--}var r={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(r.srgba=35907);e.ext_color_buffer_half_float&&(r.rgba16f=34842,r.rgb16f=34843);e.webgl_color_buffer_float&&(r.rgba32f=34836);var q=
[];Object.keys(r).forEach(function(b){q[r[b]]=b});var L=0,H={};n.prototype.decRef=function(){0>=--this.refCount&&t(this)};p.profile&&(b.getTotalRenderbufferSize=function(){var b=0;Object.keys(H).forEach(function(c){b+=H[c].stats.size});return b});return{create:function(e,m){function A(b,e){var h=0,a=0,d=32854;"object"===typeof b&&b?("shape"in b?(a=b.shape,c(Array.isArray(a)&&2<=a.length,"invalid renderbuffer shape"),h=a[0]|0,a=a[1]|0):("radius"in b&&(h=a=b.radius|0),"width"in b&&(h=b.width|0),"height"in
b&&(a=b.height|0)),"format"in b&&(c.parameter(b.format,r,"invalid renderbuffer format"),d=r[b.format])):"number"===typeof b?(h=b|0,a="number"===typeof e?e|0:h):b?c.raise("invalid arguments to renderbuffer constructor"):h=a=1;c(0<h&&0<a&&h<=k.maxRenderbufferSize&&a<=k.maxRenderbufferSize,"invalid renderbuffer size");if(h!==v.width||a!==v.height||d!==v.format)return A.width=v.width=h,A.height=v.height=a,v.format=d,l.bindRenderbuffer(36161,v.renderbuffer),l.renderbufferStorage(36161,d,h,a),p.profile&&
(v.stats.size=f[v.format]*v.width*v.height),A.format=q[v.format],A}var v=new n(l.createRenderbuffer());H[v.id]=v;b.renderbufferCount++;A(e,m);A.resize=function(b,e){var h=b|0,a=e|0||h;if(h===v.width&&a===v.height)return A;c(0<h&&0<a&&h<=k.maxRenderbufferSize&&a<=k.maxRenderbufferSize,"invalid renderbuffer size");A.width=v.width=h;A.height=v.height=a;l.bindRenderbuffer(36161,v.renderbuffer);l.renderbufferStorage(36161,v.format,h,a);p.profile&&(v.stats.size=f[v.format]*v.width*v.height);return A};A._reglType=
"renderbuffer";A._renderbuffer=v;p.profile&&(A.stats=v.stats);A.destroy=function(){v.decRef()};return A},clear:function(){m(H).forEach(t)},restore:function(){m(H).forEach(function(b){b.renderbuffer=l.createRenderbuffer();l.bindRenderbuffer(36161,b.renderbuffer);l.renderbufferStorage(36161,b.format,b.width,b.height)});l.bindRenderbuffer(36161,null)}}}},{"./util/check":21,"./util/values":33}],16:[function(n,t,y){var c=n("./util/check"),m=n("./util/values");t.exports=function(f,l,e,k){function b(b,c,
e,f){this.name=b;this.id=c;this.location=e;this.info=f}function p(b,c){for(var e=0;e<b.length;++e)if(b[e].id===c.id){b[e].location=c.location;return}b.push(c)}function n(b,e,k){var r=35632===b?q:L,h=r[e];if(!h){var a=l.str(e),h=f.createShader(b);f.shaderSource(h,a);f.compileShader(h);c.shaderError(f,h,a,b,k);r[e]=h}return h}function t(b,c){this.id=K++;this.fragId=b;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];k.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function r(e,
q){var r,m;r=n(35632,e.fragId);m=n(35633,e.vertId);var h=e.program=f.createProgram();f.attachShader(h,r);f.attachShader(h,m);f.linkProgram(h);c.linkError(f,h,l.str(e.fragId),l.str(e.vertId),q);var a=f.getProgramParameter(h,35718);k.profile&&(e.stats.uniformsCount=a);var d=e.uniforms;for(r=0;r<a;++r)if(m=f.getActiveUniform(h,r))if(1<m.size)for(var B=0;B<m.size;++B){var N=m.name.replace("[0]","["+B+"]");p(d,new b(N,l.id(N),f.getUniformLocation(h,N),m))}else p(d,new b(m.name,l.id(m.name),f.getUniformLocation(h,
m.name),m));a=f.getProgramParameter(h,35721);k.profile&&(e.stats.attributesCount=a);d=e.attributes;for(r=0;r<a;++r)(m=f.getActiveAttrib(h,r))&&p(d,new b(m.name,l.id(m.name),f.getAttribLocation(h,m.name),m))}var q={},L={},H={},C=[],K=0;k.profile&&(e.getMaxUniformsCount=function(){var b=0;C.forEach(function(c){c.stats.uniformsCount>b&&(b=c.stats.uniformsCount)});return b},e.getMaxAttributesCount=function(){var b=0;C.forEach(function(c){c.stats.attributesCount>b&&(b=c.stats.attributesCount)});return b});
return{clear:function(){var b=f.deleteShader.bind(f);m(q).forEach(b);q={};m(L).forEach(b);L={};C.forEach(function(b){f.deleteProgram(b.program)});C.length=0;H={};e.shaderCount=0},program:function(b,f,k){c.command(0<=b,"missing vertex shader",k);c.command(0<=f,"missing fragment shader",k);var q=H[f];q||(q=H[f]={});var h=q[b];h||(h=new t(f,b),e.shaderCount++,r(h,k),q[b]=h,C.push(h));return h},restore:function(){q={};L={};for(var b=0;b<C.length;++b)r(C[b])},shader:n,frag:-1,vert:-1}}},{"./util/check":21,
"./util/values":33}],17:[function(n,t,y){t.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(n,t,y){t.exports=function(){var c={"":0},m=[""];return{id:function(f){var l=c[f];if(l)return l;l=c[f]=m.length;m.push(f);return l},str:function(c){return m[c]}}}},{}],19:[function(n,t,y){function c(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function m(a){return Array.isArray(a)&&
0!==a.length&&H(a[0])?!0:!1}function f(a){return Object.prototype.toString.call(a)}function l(a){if(!a)return!1;var b=f(a);return 0<=U.indexOf(b)?!0:c(a)||m(a)||r(a)}function e(a,b){36193===a.type?(a.data=L(b),q.freeType(b)):a.data=b}function k(b,c,e,f,k,q){b="undefined"!==typeof a[b]?a[b]:M[b]*h[c];q&&(b*=6);if(k){for(f=0;1<=e;)f+=b*e*e,e/=2;return f}return b*e*f}var b=n("./util/check"),p=n("./util/extend"),F=n("./util/values"),Q=n("./util/is-typed-array"),r=n("./util/is-ndarray"),q=n("./util/pool"),
L=n("./util/to-half-float"),H=n("./util/is-array-like"),C=n("./util/flatten");y=n("./constants/arraytypes.json");var K=n("./constants/arraytypes.json"),A=[9984,9986,9985,9987],v=[0,6409,6410,6407,6408],M={};M[6409]=M[6406]=M[6402]=1;M[34041]=M[6410]=2;M[6407]=M[35904]=3;M[6408]=M[35906]=4;var U=Object.keys(y).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),h=[];h[5121]=1;h[5126]=4;h[36193]=2;h[5123]=2;h[5125]=4;var a=
[];a[32854]=2;a[32855]=2;a[36194]=2;a[34041]=4;a[33776]=.5;a[33777]=.5;a[33778]=1;a[33779]=1;a[35986]=.5;a[35987]=1;a[34798]=1;a[35840]=.5;a[35841]=.25;a[35842]=.5;a[35843]=.25;a[36196]=.5;t.exports=function(a,h,n,t,ga,y,G){function V(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function I(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;
a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function ea(a,d){if("object"===typeof d&&d){"premultiplyAlpha"in d&&(b.type(d.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=d.premultiplyAlpha);"flipY"in d&&(b.type(d.flipY,"boolean","invalid texture flip"),a.flipY=d.flipY);"alignment"in d&&(b.oneOf(d.alignment,[1,2,4,8],"invalid texture unpack alignment"),
a.unpackAlignment=d.alignment);"colorSpace"in d&&(b.parameter(d.colorSpace,X,"invalid colorSpace"),a.colorSpace=X[d.colorSpace]);if("type"in d){var c=d.type;b(h.oes_texture_float||!("float"===c||"float32"===c),"you must enable the OES_texture_float extension in order to use floating point textures.");b(h.oes_texture_half_float||!("half float"===c||"float16"===c),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");b(h.webgl_depth_texture||!("uint16"===
c||"uint32"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");b.parameter(c,R,"invalid texture type");a.type=R[c]}var e=a.width,f=a.height,k=a.channels,c=!1;"shape"in d?(b(Array.isArray(d.shape)&&2<=d.shape.length,"shape must be an array"),e=d.shape[0],f=d.shape[1],3===d.shape.length&&(k=d.shape[2],b(0<k&&4>=k,"invalid number of channels"),c=!0),b(0<=e&&e<=n.maxTextureSize,"invalid width"),b(0<=f&&f<=n.maxTextureSize,"invalid height")):
("radius"in d&&(e=f=d.radius,b(0<=e&&e<=n.maxTextureSize,"invalid radius")),"width"in d&&(e=d.width,b(0<=e&&e<=n.maxTextureSize,"invalid width")),"height"in d&&(f=d.height,b(0<=f&&f<=n.maxTextureSize,"invalid height")),"channels"in d&&(k=d.channels,b(0<k&&4>=k,"invalid number of channels"),c=!0));a.width=e|0;a.height=f|0;a.channels=k|0;e=!1;"format"in d&&(e=d.format,b(h.webgl_depth_texture||!("depth"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),
b.parameter(e,aa,"invalid texture format"),f=a.internalformat=aa[e],a.format=Ka[f],e in R&&!("type"in d)&&(a.type=R[e]),e in fa&&(a.compressed=!0),e=!0);!c&&e?a.channels=M[a.format]:c&&!e?a.channels!==v[a.format]&&(a.format=a.internalformat=v[a.channels]):e&&c&&b(a.channels===M[a.format],"number of channels inconsistent with specified format")}}function W(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}
function z(){V.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function J(a,d){var h=null;l(d)?h=d:d&&(b.type(d,"object","invalid pixel data type"),ea(a,d),"x"in d&&(a.xOffset=d.x|0),"y"in d&&(a.yOffset=d.y|0),l(d.data)&&(h=d.data));b(!a.compressed||h instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(d.copy){b(!h,"can not specify copy and data field for the same texture");var k=ga.viewportWidth,p=ga.viewportHeight;
a.width=a.width||k-a.xOffset;a.height=a.height||p-a.yOffset;a.needsCopy=!0;b(0<=a.xOffset&&a.xOffset<k&&0<=a.yOffset&&a.yOffset<p&&0<a.width&&a.width<=k&&0<a.height&&a.height<=p,"copy texture read out of bounds")}else if(!h)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(Q(h))a.channels=a.channels||4,a.data=h,"type"in d||5121!==a.type||(a.type=K[Object.prototype.toString.call(h)]|0);else if(c(h)){a.channels=a.channels||4;k=h;p=k.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:p=
q.allocType(a.type,p);p.set(k);a.data=p;break;case 36193:a.data=L(k);break;default:b.raise("unsupported texture type, must specify a typed array")}a.alignment=1;a.needsFree=!0}else if(r(h)){k=h.data;Array.isArray(k)||5121!==a.type||(a.type=K[Object.prototype.toString.call(k)]|0);var p=h.shape,B=h.stride,t,F,z,G;3===p.length?(z=p[2],G=B[2]):(b(2===p.length,"invalid ndarray pixel data, must be 2 or 3D"),G=z=1);t=p[0];F=p[1];p=B[0];B=B[1];a.alignment=1;a.width=t;a.height=F;a.channels=z;a.format=a.internalformat=
v[z];a.needsFree=!0;t=G;h=h.offset;z=a.width;G=a.height;F=a.channels;for(var u=q.allocType(36193===a.type?5126:a.type,z*G*F),A=0,I=0;I<G;++I)for(var y=0;y<z;++y)for(var V=0;V<F;++V)u[A++]=k[p*y+B*I+t*V+h];e(a,u)}else if("[object HTMLCanvasElement]"===f(h)||"[object CanvasRenderingContext2D]"===f(h))"[object HTMLCanvasElement]"===f(h)?a.element=h:a.element=h.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if("[object HTMLImageElement]"===f(h))a.element=h,a.width=h.naturalWidth,
a.height=h.naturalHeight,a.channels=4;else if("[object HTMLVideoElement]"===f(h))a.element=h,a.width=h.videoWidth,a.height=h.videoHeight,a.channels=4;else if(m(h)){k=a.width||h[0].length;p=a.height||h.length;B=a.channels;B=H(h[0][0])?B||h[0][0].length:B||1;t=C.shape(h);z=1;for(G=0;G<t.length;++G)z*=t[G];z=q.allocType(36193===a.type?5126:a.type,z);C.flatten(h,t,"",z);e(a,z);a.alignment=1;a.width=k;a.height=p;a.channels=B;a.format=a.internalformat=v[B];a.needsFree=!0}5126===a.type?b(0<=n.extensions.indexOf("oes_texture_float"),
"oes_texture_float extension not enabled"):36193===a.type&&b(0<=n.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}function U(b,c,e,h,f){var k=b.element,q=b.data,r=b.internalformat,p=b.format,l=b.type,m=b.width,n=b.height;W(b);k?a.texSubImage2D(c,f,e,h,p,l,k):b.compressed?a.compressedTexSubImage2D(c,f,e,h,r,m,n,q):b.needsCopy?(t(),a.copyTexSubImage2D(c,f,e,h,b.xOffset,b.yOffset,m,n)):a.texSubImage2D(c,f,e,h,m,n,p,l,q)}function la(){return La.pop()||new z}
function pa(a){a.needsFree&&q.freeType(a.data);z.call(a);La.push(a)}function wa(){V.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function ba(a,b,d){var c=a.images[0]=la();a.mipmask=1;c.width=a.width=b;c.height=a.height=d;c.channels=a.channels=4}function S(a,d){var c=null;if(l(d))c=a.images[0]=la(),I(c,a),J(c,d),a.mipmask=1;else if(ea(a,d),Array.isArray(d.mipmap))for(var e=d.mipmap,h=0;h<e.length;++h)c=a.images[h]=la(),I(c,a),c.width>>=h,c.height>>=h,J(c,
e[h]),a.mipmask|=1<<h;else c=a.images[0]=la(),I(c,a),J(c,d),a.mipmask=1;I(a,a.images[0]);(a.compressed&&33776===a.internalformat||33777===a.internalformat||33778===a.internalformat||33779===a.internalformat)&&b(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function O(b,c){for(var e=b.images,h=0;h<e.length&&e[h];++h){var f=e[h],k=c,q=h,r=f.element,p=f.data,l=f.internalformat,m=f.format,n=f.type,v=f.width,B=f.height;
W(f);r?a.texImage2D(k,q,m,m,n,r):f.compressed?a.compressedTexImage2D(k,q,l,v,B,0,p):f.needsCopy?(t(),a.copyTexImage2D(k,q,m,f.xOffset,f.yOffset,v,B,0)):a.texImage2D(k,q,m,v,B,0,m,n,p)}}function Ca(){var a=Ma.pop()||new wa;V.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ta(a){for(var b=a.images,d=0;d<b.length;++d)b[d]&&pa(b[d]),b[d]=null;Ma.push(a)}function xa(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=
4352}function ca(a,d){if("min"in d){var c=d.min;b.parameter(c,ha);a.minFilter=ha[c];0<=A.indexOf(a.minFilter)&&(a.genMipmaps=!0)}"mag"in d&&(c=d.mag,b.parameter(c,Z),a.magFilter=Z[c]);var c=a.wrapS,e=a.wrapT;if("wrap"in d){var h=d.wrap;"string"===typeof h?(b.parameter(h,Y),c=e=Y[h]):Array.isArray(h)&&(b.parameter(h[0],Y),b.parameter(h[1],Y),c=Y[h[0]],e=Y[h[1]])}else"wrapS"in d&&(c=d.wrapS,b.parameter(c,Y),c=Y[c]),"wrapT"in d&&(e=d.wrapT,b.parameter(e,Y),e=Y[e]);a.wrapS=c;a.wrapT=e;"anisotropic"in
d&&(c=d.anisotropic,b("number"===typeof c&&1<=c&&c<=n.maxAnisotropic,"aniso samples must be between 1 and "),a.anisotropic=d.anisotropic);if("mipmap"in d){c=!1;switch(typeof d.mipmap){case "string":b.parameter(d.mipmap,ya,"invalid mipmap hint");a.mipmapHint=ya[d.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=d.mipmap;break;case "object":b(Array.isArray(d.mipmap),"invalid mipmap type");a.genMipmaps=!1;c=!0;break;default:b.raise("invalid mipmap type")}!c||"min"in d||(a.minFilter=9984)}}
function ja(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);h.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function ma(b){V.call(this);this.mipmask=0;this.internalformat=6408;this.id=Pa++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new xa;G.profile&&(this.stats=
{size:0})}function na(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function oa(){var b=da[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function ra(g){var c=g.texture;b(c,"must not double destroy texture");var e=g.unit,h=g.target;0<=e&&(a.activeTexture(33984+e),a.bindTexture(h,null),da[e]=null);a.deleteTexture(c);g.texture=null;g.params=null;g.pixels=null;g.refCount=0;delete va[g.id];y.textureCount--}var ya={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
Y={repeat:10497,clamp:33071,mirror:33648},Z={nearest:9728,linear:9729},ha=p({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},Z),X={none:0,browser:37444},R={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},aa={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},fa={};h.ext_srgb&&(aa.srgb=35904,aa.srgba=35906);h.oes_texture_float&&(R.float32=R["float"]=5126);
h.oes_texture_half_float&&(R.float16=R["half float"]=36193);h.webgl_depth_texture&&(p(aa,{depth:6402,"depth stencil":34041}),p(R,{uint16:5123,uint32:5125,"depth stencil":34042}));h.webgl_compressed_texture_s3tc&&p(fa,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});h.webgl_compressed_texture_atc&&p(fa,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});h.webgl_compressed_texture_pvrtc&&p(fa,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,
"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});h.webgl_compressed_texture_etc1&&(fa["rgb etc1"]=36196);var za=Array.prototype.slice.call(a.getParameter(34467));Object.keys(fa).forEach(function(a){var b=fa[a];0<=za.indexOf(b)&&(aa[a]=b)});var ia=Object.keys(aa);n.textureFormats=ia;var ua=[];Object.keys(aa).forEach(function(a){ua[aa[a]]=a});var Ea=[];Object.keys(R).forEach(function(a){Ea[R[a]]=a});var Ga=[];Object.keys(Z).forEach(function(a){Ga[Z[a]]=a});var Ja=[];Object.keys(ha).forEach(function(a){Ja[ha[a]]=
a});var Fa=[];Object.keys(Y).forEach(function(a){Fa[Y[a]]=a});var Ka=ia.reduce(function(a,b){var d=aa[b];6409===d||6406===d||6409===d||6410===d||6402===d||34041===d?a[d]=d:32855===d||0<=b.indexOf("rgba")?a[d]=6408:a[d]=6407;return a},{}),La=[],Ma=[],Pa=0,va={},sa=n.maxTextureUnits,da=Array(sa).map(function(){return null});p(ma.prototype,{bind:function(){this.bindCount+=1;var c=this.unit;if(0>c){for(var e=0;e<sa;++e){var h=da[e];if(h){if(0<h.bindCount)continue;h.unit=-1}da[e]=this;c=e;break}c>=sa&&
b.raise("insufficient number of texture units");G.profile&&y.maxTextureUnits<c+1&&(y.maxTextureUnits=c+1);this.unit=c;a.activeTexture(33984+c);a.bindTexture(this.target,this.texture)}return c},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&ra(this)}});G.profile&&(y.getTotalTextureSize=function(){var a=0;Object.keys(va).forEach(function(b){a+=va[b].stats.size});return a});return{create2D:function(c,e){function h(a,d){var c=f.texInfo;xa.call(c);var g=Ca();"number"===typeof a?
"number"===typeof d?ba(g,a|0,d|0):ba(g,a|0,a|0):a?(b.type(a,"object","invalid arguments to regl.texture"),ca(c,a),S(g,a)):ba(g,1,1);c.genMipmaps&&(g.mipmask=(g.width<<1)-1);f.mipmask=g.mipmask;I(f,g);b.texture2D(c,g,n);f.internalformat=g.internalformat;h.width=g.width;h.height=g.height;na(f);O(g,3553);ja(c,3553);oa();ta(g);G.profile&&(f.stats.size=k(f.internalformat,f.type,g.width,g.height,c.genMipmaps,!1));h.format=ua[f.internalformat];h.type=Ea[f.type];h.mag=Ga[c.magFilter];h.min=Ja[c.minFilter];
h.wrapS=Fa[c.wrapS];h.wrapT=Fa[c.wrapT];return h}var f=new ma(3553);va[f.id]=f;y.textureCount++;h(c,e);h.subimage=function(a,d,c,g){b(!!a,"must specify image data");d|=0;c|=0;g|=0;var e=la();I(e,f);e.width=0;e.height=0;J(e,a);e.width=e.width||(f.width>>g)-d;e.height=e.height||(f.height>>g)-c;b(f.type===e.type&&f.format===e.format&&f.internalformat===e.internalformat,"incompatible format for texture.subimage");b(0<=d&&0<=c&&d+e.width<=f.width&&c+e.height<=f.height,"texture.subimage write out of bounds");
b(f.mipmask&1<<g,"missing mipmap data");b(e.data||e.element||e.needsCopy,"missing image data");na(f);U(e,3553,d,c,g);oa();pa(e);return h};h.resize=function(b,c){var g=b|0,e=c|0||g;if(g===f.width&&e===f.height)return h;h.width=f.width=g;h.height=f.height=e;na(f);for(var q=0;f.mipmask>>q;++q)a.texImage2D(3553,q,f.format,g>>q,e>>q,0,f.format,f.type,null);oa();G.profile&&(f.stats.size=k(f.internalformat,f.type,g,e,!1,!1));return h};h._reglType="texture2d";h._texture=f;G.profile&&(h.stats=f.stats);h.destroy=
function(){f.decRef()};return h},createCube:function(c,e,h,f,q,r){function p(a,d,c,g,e,h){var f,q=l.texInfo;xa.call(q);for(f=0;6>f;++f)m[f]=Ca();if("number"!==typeof a&&a)if("object"===typeof a)if(d)S(m[0],a),S(m[1],d),S(m[2],c),S(m[3],g),S(m[4],e),S(m[5],h);else if(ca(q,a),ea(l,a),"faces"in a)for(a=a.faces,b(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),f=0;6>f;++f)b("object"===typeof a[f]&&!!a[f],"invalid input for cube map face"),I(m[f],l),S(m[f],a[f]);else for(f=0;6>f;++f)S(m[f],
a);else b.raise("invalid arguments to cube map");else for(a=a|0||1,f=0;6>f;++f)ba(m[f],a,a);I(l,m[0]);l.mipmask=q.genMipmaps?(m[0].width<<1)-1:m[0].mipmask;b.textureCube(l,q,m,n);l.internalformat=m[0].internalformat;p.width=m[0].width;p.height=m[0].height;na(l);for(f=0;6>f;++f)O(m[f],34069+f);ja(q,34067);oa();G.profile&&(l.stats.size=k(l.internalformat,l.type,p.width,p.height,q.genMipmaps,!0));p.format=ua[l.internalformat];p.type=Ea[l.type];p.mag=Ga[q.magFilter];p.min=Ja[q.minFilter];p.wrapS=Fa[q.wrapS];
p.wrapT=Fa[q.wrapT];for(f=0;6>f;++f)ta(m[f]);return p}var l=new ma(34067);va[l.id]=l;y.cubeCount++;var m=Array(6);p(c,e,h,f,q,r);p.subimage=function(a,d,c,g,e){b(!!d,"must specify image data");b("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");c|=0;g|=0;e|=0;var f=la();I(f,l);f.width=0;f.height=0;J(f,d);f.width=f.width||(l.width>>e)-c;f.height=f.height||(l.height>>e)-g;b(l.type===f.type&&l.format===f.format&&l.internalformat===f.internalformat,"incompatible format for texture.subimage");
b(0<=c&&0<=g&&c+f.width<=l.width&&g+f.height<=l.height,"texture.subimage write out of bounds");b(l.mipmask&1<<e,"missing mipmap data");b(f.data||f.element||f.needsCopy,"missing image data");na(l);U(f,34069+a,c,g,e);oa();pa(f);return p};p.resize=function(b){b|=0;if(b!==l.width){p.width=l.width=b;p.height=l.height=b;na(l);for(var c=0;6>c;++c)for(var g=0;l.mipmask>>g;++g)a.texImage2D(34069+c,g,l.format,b>>g,b>>g,0,l.format,l.type,null);oa();G.profile&&(l.stats.size=k(l.internalformat,l.type,p.width,
p.height,!1,!0));return p}};p._reglType="textureCube";p._texture=l;G.profile&&(p.stats=l.stats);p.destroy=function(){l.decRef()};return p},clear:function(){for(var b=0;b<sa;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),da[b]=null;F(va).forEach(ra);y.cubeCount=0;y.textureCount=0},getTexture:function(a){return null},restore:function(){F(va).forEach(function(b){b.texture=a.createTexture();a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!==(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,
c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var e=0;6>e;++e)a.texImage2D(34069+e,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);ja(b.texInfo,b.target)})}}}},{"./constants/arraytypes.json":4,"./util/check":21,"./util/extend":24,"./util/flatten":25,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/to-half-float":32,"./util/values":33}],20:[function(n,t,y){t.exports=function(c,m){function f(){this.endQueryIndex=
this.startQueryIndex=-1;this.sum=0;this.stats=null}function l(b,c,e){var k=p.pop()||new f;k.startQueryIndex=b;k.endQueryIndex=c;k.sum=0;k.stats=e;n.push(k)}var e=m.ext_disjoint_timer_query;if(!e)return null;var k=[],b=[],p=[],n=[],t=[],r=[];return{beginQuery:function(c){var f=k.pop()||e.createQueryEXT();e.beginQueryEXT(35007,f);b.push(f);l(b.length-1,b.length,c)},endQuery:function(){e.endQueryEXT(35007)},pushScopeStats:l,update:function(){var c,f;c=b.length;if(0!==c){r.length=Math.max(r.length,c+
1);t.length=Math.max(t.length,c+1);t[0]=0;var l=r[0]=0;for(f=c=0;f<b.length;++f){var m=b[f];e.getQueryObjectEXT(m,34919)?(l+=e.getQueryObjectEXT(m,34918),k.push(m)):b[c++]=m;t[f+1]=l;r[f+1]=c}b.length=c;for(f=c=0;f<n.length;++f){var l=n[f],y=l.startQueryIndex,m=l.endQueryIndex;l.sum+=t[m]-t[y];y=r[y];m=r[m];m===y?(l.stats.gpuTime+=l.sum/1E6,p.push(l)):(l.startQueryIndex=y,l.endQueryIndex=m,n[c++]=l)}n.length=c}},getNumPendingQueries:function(){return b.length},clear:function(){k.push.apply(k,b);for(var c=
0;c<k.length;c++)e.deleteQueryEXT(k[c]);b.length=0;k.length=0},restore:function(){b.length=0;k.length=0}}}},{}],21:[function(n,t,y){function c(a){return"undefined"!==typeof btoa?btoa(a):"base64:"+a}function m(a){a=Error("(regl) "+a);console.error(a);throw a;}function f(a,b){a||m(b)}function l(a){return a?": "+a:""}function e(a,b,c){0>b.indexOf(a)&&m("invalid value"+l(c)+". must be one of: "+b)}function k(a,b){for(a+="";a.length<b;)a=" "+a;return a}function b(){this.name="unknown";this.lines=[];this.index=
{};this.hasErrors=!1}function p(a,b){this.number=a;this.line=b;this.errors=[]}function F(a,b,c){this.file=a;this.line=b;this.message=c}function Q(){var a=Error(),a=(a.stack||a).toString(),b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function r(){var a=Error(),a=(a.stack||a).toString(),b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function q(a,
d){var e=a.split("\n"),f=1,h=0,k={unknown:new b,0:new b};k.unknown.name=k[0].name=d||Q();k.unknown.lines.push(new p(0,""));for(var q=0;q<e.length;++q){var l=e[q],m=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(l);if(m)switch(m[1]){case "line":if(m=/(\d+)(\s+\d+)?/.exec(m[2]))f=m[1]|0,m[2]&&(h=m[2]|0,h in k||(k[h]=new b));break;case "define":if(m=/SHADER_NAME(_B64)?\s+(.*)$/.exec(m[2]))k[h].name=m[1]?c(m[2]):m[2]}k[h].lines.push(new p(f++,l))}Object.keys(k).forEach(function(a){var b=k[a];b.lines.forEach(function(a){b.index[a.number]=
a})});return k}function L(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var c=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(a);c?b.push(new F(c[1]|0,c[2]|0,c[3].trim())):0<a.length&&b.push(new F("unknown",0,a))}});return b}function H(a,b){b.forEach(function(b){var d=a[b.file];if(d){var c=d.index[b.line];if(c){c.errors.push(b);d.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(b)})}function C(a){a._commandRef=Q()}function K(a,b){var c=r();m(a+" in command "+(b||
Q())+("unknown"===c?"":" called from "+c))}function A(a,b,c,e){typeof a!==b&&K("invalid parameter type"+l(c)+". expected "+b+", got "+typeof a,e||Q())}function v(a,b){return 32820===a||32819===a||33635===a?2:34042===a?4:h[a]*b}var M=n("./is-typed-array");n=n("./extend");var U="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),h={};h[5120]=h[5121]=1;h[5122]=h[5123]=h[36193]=h[33635]=h[32819]=h[32820]=2;h[5124]=h[5125]=h[5126]=h[34042]=4;t.exports=n(f,
{optional:function(a){a()},raise:m,commandRaise:K,command:function(a,b,c){a||K(b,c||Q())},parameter:function(a,b,c){a in b||m("unknown parameter ("+a+")"+l(c)+". possible values: "+Object.keys(b).join())},commandParameter:function(a,b,c,e){a in b||K("unknown parameter ("+a+")"+l(c)+". possible values: "+Object.keys(b).join(),e||Q())},constructor:function(a){Object.keys(a).forEach(function(a){0>U.indexOf(a)&&m('invalid regl constructor argument "'+a+'". must be one of '+U)})},type:function(a,b,c){typeof a!==
b&&m("invalid parameter type"+l(c)+". expected "+b+", got "+typeof a)},commandType:A,isTypedArray:function(a,b){M(a)||m("invalid parameter type"+l(b)+". must be a typed array")},nni:function(a,b){0<=a&&(a|0)===a||m("invalid parameter type, ("+a+")"+l(b)+". must be a nonnegative integer")},oneOf:e,shaderError:function(a,b,c,e,h){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);a=e===a.FRAGMENT_SHADER?"fragment":"vertex";A(c,"string",a+" shader source must be a string",h);var l=
q(c,h);c=L(b);H(l,c);Object.keys(l).forEach(function(a){function b(a,d){c.push(a);e.push(d||"")}var d=l[a];if(d.hasErrors){var c=[""],e=[""];b("file number "+a+": "+d.name+"\n","color:red;text-decoration:underline;font-weight:bold");d.lines.forEach(function(a){if(0<a.errors.length){b(k(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var d=0;a.errors.forEach(function(c){c=c.message;var e=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(c);
if(e){var f=e[1];c=e[2];switch(f){case "assign":f="="}d=Math.max(a.line.indexOf(f,d),0)}else d=0;b(k("| ",6));b(k("^^^",d+3)+"\n","font-weight:bold");b(k("| ",6));b(c+"\n","font-weight:bold")});b(k("| ",6)+"\n")}else b(k(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"!==typeof document?(e[0]=c.join("%c"),console.log.apply(console,e)):console.log(c.join(""))}});f.raise("Error compiling "+a+" shader, "+l[0].name)}},linkError:function(a,b,c,e,h){a.getProgramParameter(b,a.LINK_STATUS)||(a=
a.getProgramInfoLog(b),c=q(c,h),e='Error linking program with vertex shader, "'+q(e,h)[0].name+'", and fragment shader "'+c[0].name+'"',"undefined"!==typeof document?console.log("%c"+e+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(e+"\n"+a),f.raise(e))},callSite:r,saveCommandRef:C,saveDrawInfo:function(a,b,c,e){function f(a){return a?e.id(a):0}function h(a,b){Object.keys(b).forEach(function(b){a[e.id(b)]=!0})}C(a);a._fragId=f(a["static"].frag);a._vertId=
f(a["static"].vert);var k=a._uniformSet={};h(k,b["static"]);h(k,b.dynamic);b=a._attributeSet={};h(b,c["static"]);h(b,c.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,b,c){a.texture?e(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):e(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")},guessCommand:Q,texture2D:function(a,b,c){var e=b.width,
h=b.height,k=b.channels;f(0<e&&e<=c.maxTextureSize&&0<h&&h<=c.maxTextureSize,"invalid texture shape");33071===a.wrapS&&33071===a.wrapT||f(!(e&e-1)&&!!e&&!(h&h-1)&&!!h,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==e&&1!==h&&f(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(f(!(e&e-1)&&!!e&&!(h&h-1)&&!!h,"texture must be a square power of 2 to support mipmapping"),f(b.mipmask===(e<<1)-1,
"missing or incomplete mipmap data"));5126===b.type&&(0>c.extensions.indexOf("oes_texture_float_linear")&&f(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),f(!a.genMipmaps,"mipmap generation not supported with float textures"));var q=b.images;for(c=0;16>c;++c)if(q[c]){var l=e>>c,m=h>>c;f(b.mipmask&1<<c,"missing mipmap data");var p=q[c];f(p.width===l&&p.height===m,"invalid shape for mip images");f(p.format===b.format&&p.internalformat===b.internalformat&&
p.type===b.type,"incompatible type for mip image");p.compressed||p.data&&f(p.data.byteLength===l*m*Math.max(v(p.type,k),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}else a.genMipmaps||f(0===(b.mipmask&1<<c),"extra mipmap data");b.compressed&&f(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,c,e){var h=a.width,k=a.height,q=a.channels;f(0<h&&h<=e.maxTextureSize&&0<k&&k<=e.maxTextureSize,"invalid texture shape");
f(h===k,"cube map must be square");f(33071===b.wrapS&&33071===b.wrapT,"wrap mode not supported by cube map");for(e=0;e<c.length;++e){var l=c[e];f(l.width===h&&l.height===k,"inconsistent cube map face shape");b.genMipmaps&&(f(!l.compressed,"can not generate mipmap for compressed textures"),f(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var p=l.images,m=0;16>m;++m){var r=p[m];if(r){var n=h>>m,t=k>>m;f(l.mipmask&1<<m,"missing mipmap data");f(r.width===n&&r.height===t,"invalid shape for mip images");
f(r.format===a.format&&r.internalformat===a.internalformat&&r.type===a.type,"incompatible type for mip image");r.compressed||r.data&&f(r.data.byteLength===n*t*Math.max(v(r.type,q),r.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}})},{"./extend":24,"./is-typed-array":28}],22:[function(n,t,y){t.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],23:[function(n,t,y){function c(c){return Array.prototype.slice.call(c)}
function m(f){return c(f).join("")}var f=n("./extend");t.exports=function(){function l(){var b=[],e=[];return f(function(){b.push.apply(b,c(arguments))},{def:function(){var f="v"+k++;e.push(f);0<arguments.length&&(b.push(f,"="),b.push.apply(b,c(arguments)),b.push(";"));return f},toString:function(){return m([0<e.length?"var "+e+";":"",m(b)])}})}function e(){function b(c,f){k(c,f,"=",e.def(c,f),";")}var e=l(),k=l(),m=e.toString,p=k.toString;return f(function(){e.apply(e,c(arguments))},{def:e.def,entry:e,
exit:k,save:b,set:function(c,f,k){b(c,f);e(c,f,"=",k,";")},toString:function(){return m()+p()}})}var k=0,b=[],p=[],n=l(),t={};return{global:n,link:function(c){for(var e=0;e<p.length;++e)if(p[e]===c)return b[e];e="g"+k++;b.push(e);p.push(c);return e},block:l,proc:function(b,c){function k(){var b="a"+l.length;l.push(b);return b}var l=[];c=c||0;for(var p=0;p<c;++p)k();var p=e(),n=p.toString;return t[b]=f(p,{arg:k,toString:function(){return m(["function(",l.join(),"){",n(),"}"])}})},scope:e,cond:function(){var b=
m(arguments),k=e(),l=e(),p=k.toString,n=l.toString;return f(k,{then:function(){k.apply(k,c(arguments));return this},"else":function(){l.apply(l,c(arguments));return this},toString:function(){var c=n();c&&(c="else{"+c+"}");return m(["if(",b,"){",p(),"}",c])}})},compile:function(){var c=['"use strict";',n,"return {"];Object.keys(t).forEach(function(b){c.push('"',b,'":',t[b].toString(),",")});c.push("}");var e=m(c).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,
b.concat(e)).apply(null,p)}}}},{"./extend":24}],24:[function(n,t,y){t.exports=function(c,m){for(var f=Object.keys(m),l=0;l<f.length;++l)c[f[l]]=m[f[l]];return c}},{}],25:[function(n,t,y){function c(c,e,f,b,p,m){for(var n=0;n<e;++n)for(var r=c[n],q=0;q<f;++q)for(var t=r[q],y=0;y<b;++y)p[m++]=t[y]}function m(f,e,k,b,p){for(var n=1,t=k+1;t<e.length;++t)n*=e[t];var r=e[k];if(4===e.length-k){var q=e[k+1],y=e[k+2];e=e[k+3];for(t=0;t<r;++t)c(f[t],q,y,e,b,p),p+=n}else for(t=0;t<r;++t)m(f[t],e,k+1,b,p),p+=
n}var f=n("./pool");t.exports={shape:function(c){for(var e=[];c.length;c=c[0])e.push(c.length);return e},flatten:function(l,e,k,b){var p=1;if(e.length)for(var n=0;n<e.length;++n)p*=e[n];else p=0;k=b||f.allocType(k,p);switch(e.length){case 0:break;case 1:b=e[0];for(e=0;e<b;++e)k[e]=l[e];break;case 2:b=e[0];e=e[1];for(n=p=0;n<b;++n)for(var t=l[n],r=0;r<e;++r)k[p++]=t[r];break;case 3:c(l,e[0],e[1],e[2],k,0);break;default:m(l,e,0,k,0)}return k}}},{"./pool":30}],26:[function(n,t,y){var c=n("./is-typed-array");
t.exports=function(m){return Array.isArray(m)||c(m)}},{"./is-typed-array":28}],27:[function(n,t,y){var c=n("./is-typed-array");t.exports=function(m){return!!m&&"object"===typeof m&&Array.isArray(m.shape)&&Array.isArray(m.stride)&&"number"===typeof m.offset&&m.shape.length===m.stride.length&&(Array.isArray(m.data)||c(m.data))}},{"./is-typed-array":28}],28:[function(n,t,y){var c=n("../constants/arraytypes.json");t.exports=function(m){return Object.prototype.toString.call(m)in c}},{"../constants/arraytypes.json":4}],
29:[function(n,t,y){t.exports=function(c,m){for(var f=Array(c),l=0;l<c;++l)f[l]=m(l);return f}},{}],30:[function(n,t,y){function c(c){var f,b;f=(65535<c)<<4;c>>>=f;b=(255<c)<<3;c>>>=b;f|=b;b=(15<c)<<2;c>>>=b;f|=b;b=(3<c)<<1;return f|b|c>>>b>>1}function m(e){a:{for(var f=16;268435456>=f;f*=16)if(e<=f){e=f;break a}e=0}f=l[c(e)>>2];return 0<f.length?f.pop():new ArrayBuffer(e)}function f(e){l[c(e.byteLength)>>2].push(e)}var l=n("./loop")(8,function(){return[]});t.exports={alloc:m,free:f,allocType:function(c,
f){var b=null;switch(c){case 5120:b=new Int8Array(m(f),0,f);break;case 5121:b=new Uint8Array(m(f),0,f);break;case 5122:b=new Int16Array(m(2*f),0,f);break;case 5123:b=new Uint16Array(m(2*f),0,f);break;case 5124:b=new Int32Array(m(4*f),0,f);break;case 5125:b=new Uint32Array(m(4*f),0,f);break;case 5126:b=new Float32Array(m(4*f),0,f);break;default:return null}return b.length!==f?b.subarray(0,f):b},freeType:function(c){f(c.buffer)}}},{"./loop":29}],31:[function(n,t,y){t.exports={next:"function"===typeof requestAnimationFrame?
function(c){return requestAnimationFrame(c)}:function(c){return setTimeout(c,16)},cancel:"function"===typeof cancelAnimationFrame?function(c){return cancelAnimationFrame(c)}:clearTimeout}},{}],32:[function(n,t,y){var c=n("./pool"),m=new Float32Array(1),f=new Uint32Array(m.buffer);t.exports=function(l){for(var e=c.allocType(5123,l.length),k=0;k<l.length;++k)if(isNaN(l[k]))e[k]=65535;else if(Infinity===l[k])e[k]=31744;else if(-Infinity===l[k])e[k]=64512;else{m[0]=l[k];var b=f[0],p=b>>>31<<15,n=(b<<
1>>>24)-127,b=b>>13&1023;e[k]=-24>n?p:-14>n?p+(b+1024>>-14-n):15<n?p+31744:p+(n+15<<10)+b}return e}},{"./pool":30}],33:[function(n,t,y){t.exports=function(c){return Object.keys(c).map(function(m){return c[m]})}},{}],34:[function(n,t,y){function c(b,c,e){function f(){var c=window.innerWidth,p=window.innerHeight;b!==document.body&&(p=b.getBoundingClientRect(),c=p.right-p.left,p=p.bottom-p.top);l.width=e*c;l.height=e*p;k(l.style,{width:c+"px",height:p+"px"})}var l=document.createElement("canvas");k(l.style,
{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(l);b===document.body&&(l.style.position="absolute",k(b.style,{margin:0,padding:0}));window.addEventListener("resize",f,!1);f();return{canvas:l,onDestroy:function(){window.removeEventListener("resize",f);b.removeChild(l)}}}function m(b,c){function e(f){try{return b.getContext(f,c)}catch(k){return null}}return e("webgl")||e("experimental-webgl")||e("webgl-experimental")}function f(b){if("string"===typeof b)return b.split();e(Array.isArray(b),
"invalid extension array");return b}function l(b){return"string"===typeof b?(e("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(b)):b}var e=n("./util/check"),k=n("./util/extend");t.exports=function(b){var k=b||{},n,t,r,q;b={};var y=[],H=[],C="undefined"===typeof window?1:window.devicePixelRatio,K=!1,A=function(b){b&&e.raise(b)},v=function(){};"string"===typeof k?(e("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(k),
e(n,"invalid query string for element")):"object"===typeof k?"string"===typeof k.nodeName&&"function"===typeof k.appendChild&&"function"===typeof k.getBoundingClientRect?n=k:"function"===typeof k.drawArrays||"function"===typeof k.drawElements?(q=k,r=q.canvas):(e.constructor(k),"gl"in k?q=k.gl:"canvas"in k?r=l(k.canvas):"container"in k&&(t=l(k.container)),"attributes"in k&&(b=k.attributes,e.type(b,"object","invalid context attributes")),"extensions"in k&&(y=f(k.extensions)),"optionalExtensions"in k&&
(H=f(k.optionalExtensions)),"onDone"in k&&(e.type(k.onDone,"function","invalid or missing onDone callback"),A=k.onDone),"profile"in k&&(K=!!k.profile),"pixelRatio"in k&&(C=+k.pixelRatio,e(0<C,"invalid pixel ratio"))):e.raise("invalid arguments to regl");n&&("canvas"===n.nodeName.toLowerCase()?r=n:t=n);if(!q){if(!r){e("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");n=c(t||document.body,A,C);if(!n)return null;r=n.canvas;v=n.onDestroy}q=m(r,b)}return q?
{gl:q,canvas:r,container:t,extensions:y,optionalExtensions:H,pixelRatio:C,profile:K,onDone:A,onDestroy:v}:(v(),A("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/check":21,"./util/extend":24}],35:[function(n,t,y){function c(b){throw Error("resl: "+b);}function m(b,e,f){Object.keys(b).forEach(function(b){0>e.indexOf(b)&&c('invalid parameter "'+b+'" in '+f)})}function f(b,c){this.state=0;this.ready=!1;this.progress=0;this.name=b;this.cancel=
c}var l=["manifest","onDone","onProgress","onError"],e=["type","src","stream","credentials","parser"],k=["onData","onDone"];t.exports=function(b){function n(e,a){if(e in b){var d=b[e];"function"!==typeof d&&c('invalid callback "'+e+'"');return d}return null}function t(b){function a(){if(!(2>m.readyState||1===p.state||-1===p.state)){if(200!==m.status)return r('error loading resource "'+b.name+'"');if(2<m.readyState&&0===p.state){var a;a="binary"===b.type?m.response:m.responseText;if(l.data)try{n=l.data(a)}catch(e){return r(e)}else n=
a}if(3<m.readyState&&0===p.state){if(l.done)try{n=l.done()}catch(e){return r(e)}p.state=1}A[c]=n;p.progress=.75*p.progress+.25;p.ready=b.stream&&!!n||1===p.state;q()}}var c=b.name,e=b.stream,k="binary"===b.type,l=b.parser,m=new XMLHttpRequest,n=null,p=new f(c,function(){1!==p.state&&-1!==p.state&&(m.onreadystatechange=null,m.abort(),p.state=-1)});m.onreadystatechange=e?a:function(){4===m.readyState&&a()};k&&(m.responseType="arraybuffer");b.credentials&&(m.withCredentials=!0);m.open("GET",b.src,!0);
m.send();return p}function y(b,a){function c(){if(0===t.state)if(p.data)try{v=p.data(a)}catch(b){return r(b)}else v=a}function e(a){c();A[n]=v;t.progress=a.lengthComputable?Math.max(t.progress,a.loaded/a.total):.75*t.progress+.25;q(n)}function k(){c();if(0===t.state){if(p.done)try{v=p.done()}catch(a){return r(a)}t.state=1}t.progress=1;t.ready=!0;A[n]=v;m();q("finish "+n)}function l(){r('error loading asset "'+n+'"')}function m(){b.stream&&a.removeEventListener("progress",e);"image"===b.type?a.addEventListener("load",
k):a.addEventListener("canplay",k);a.removeEventListener("error",l)}var n=b.name,p=b.parser,t=new f(n,function(){1!==t.state&&-1!==t.state&&(t.state=-1,m(),a.src="")}),v=a;b.stream&&a.addEventListener("progress",e);if("image"===b.type)a.addEventListener("load",k);else{var C=!1,F=!1;a.addEventListener("loadedmetadata",function(){F=!0;C&&k()});a.addEventListener("canplay",function(){C=!0;F&&k()})}a.addEventListener("error",l);a.crossOrigin=b.credentials?"use-credentials":"anonymous";a.src=b.src;return t}
function r(b){-1!==v&&1!==v&&(v=-1,U.forEach(function(a){a.cancel()}),K?"string"===typeof b?K(Error("resl: "+b)):K(b):console.error("resl error:",b))}function q(b){if(-1!==v&&1!==v){var a=0,c=0;U.forEach(function(b){b.ready&&(c+=1);a+=b.progress});c===U.length?(v=1,H(A)):C&&C(a/U.length,b)}}"object"===typeof b&&b||c("invalid or missing configuration");m(b,l,"config");var L=b.manifest;"object"===typeof L&&L||c("missing manifest");var H=n("onDone");H||c("missing onDone() callback");var C=n("onProgress"),
K=n("onError"),A={},v=0,M={text:t,binary:function(b){return t(b)},image:function(b){return y(b,document.createElement("img"))},video:function(b){return y(b,document.createElement("video"))},audio:function(b){return y(b,document.createElement("audio"))}},U=Object.keys(L).map(function(b){function a(a,b){if(a in d.parser){var e=d.parser[a];"function"!==typeof e&&c("invalid parser callback "+a+' for asset "'+a+'"');return e}return b}var d=L[b];"string"===typeof d?d={src:d}:"object"===typeof d&&d||c('invalid asset definition "'+
b+'"');m(d,e,'asset "'+b+'"');var f={};"parser"in d&&("function"===typeof d.parser?f={data:d.parser}:"object"===typeof d.parser&&d.parser?(m(f,k,'parser for asset "'+b+'"'),"onData"in f||c('missing onData callback for parser in asset "'+b+'"'),f={data:a("onData"),done:a("onDone")}):c('invalid parser for asset "'+b+'"'));return{name:b,type:function(a,e,f){a in d&&(f=d[a]);0>e.indexOf(f)&&c("invalid "+a+' "'+f+'" for asset "'+b+'", possible values: '+e);return f}("type",Object.keys(M),"text"),stream:!!d.stream,
credentials:!!d.credentials,src:function(a,e,f){a in d?f=d[a]:e&&c("missing "+a+' for asset "'+b+'"');"string"!==typeof f&&c("invalid "+a+' for asset "'+b+'", must be a string');return f}("src",!0,""),parser:f}}).map(function(b){return M[b.type](b)});0===U.length&&setTimeout(function(){q("done")},1)}},{}],36:[function(n,t,y){function c(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var m=n("./lib/util/check"),f=n("./lib/util/extend"),l=n("./lib/dynamic"),e=n("./lib/util/raf"),k=n("./lib/util/clock"),
b=n("./lib/strings"),p=n("./lib/webgl"),F=n("./lib/extension"),Q=n("./lib/limits"),r=n("./lib/buffer"),q=n("./lib/elements"),L=n("./lib/texture"),H=n("./lib/renderbuffer"),C=n("./lib/framebuffer"),K=n("./lib/attribute"),A=n("./lib/shader"),v=n("./lib/read"),M=n("./lib/core"),U=n("./lib/stats"),h=n("./lib/timer");t.exports=function(a){function d(){if(0===R.length)O&&O.update(),ia=null;else{ia=e.next(d);ea();for(var a=R.length-1;0<=a;--a){var b=R[a];b&&b(ca,null,0)}J.flush();O&&O.update()}}function n(){!ia&&
0<R.length&&(ia=e.next(d))}function t(){ia&&(e.cancel(d),ia=null)}function y(a){a.preventDefault();la=!0;t();aa.forEach(function(a){a()})}function ga(a){J.getError();la=!1;pa.restore();oa.restore();ma.restore();ra.restore();ya.restore();Y.restore();O&&O.restore();Z.procs.refresh();n();fa.forEach(function(a){a()})}function ka(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];l.isDynamic(e)?d[b]=l.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;r.length<
a;)r.push(null);return r}m(!!a,"invalid args to regl({...})");m.type(a,"object","invalid args to regl({...})");var d=b(a.context||{}),e=b(a.uniforms||{}),h=b(a.attributes||{}),k=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=f({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");
b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var d=Z.compile(k,h,e,d,a),n=d.draw,p=d.batch,q=d.scope,r=[];return f(function(a,b){var d;la&&m.raise("context lost");if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)q.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)q.call(this,a[d],b,d);else return q.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,
c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return n.call(this,a)},{stats:a})}function G(a,b){var c=0;Z.procs.poll();var d=b.color;d&&(J.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in b&&(J.clearDepth(+b.depth),c|=256);"stencil"in b&&(J.clearStencil(b.stencil|0),c|=1024);m(!!c,"called regl.clear with no buffer specified");J.clear(c)}function V(a){m.type(a,"function","regl.frame() callback must be a function");R.push(a);n();return{cancel:function(){function b(){var a=
c(R,b);R[a]=R[R.length-1];--R.length;0>=R.length&&t()}var d=c(R,a);m(0<=d,"cannot cancel a frame twice");R[d]=b}}}function I(){var a=ha.viewport,b=ha.scissor_box;a[0]=a[1]=b[0]=b[1]=0;ca.viewportWidth=ca.framebufferWidth=ca.drawingBufferWidth=a[2]=b[2]=J.drawingBufferWidth;ca.viewportHeight=ca.framebufferHeight=ca.drawingBufferHeight=a[3]=b[3]=J.drawingBufferHeight}function ea(){ca.tick+=1;ca.time=z();I();Z.procs.poll()}function W(){I();Z.procs.refresh();O&&O.update()}function z(){return(k()-Ca)/
1E3}a=p(a);if(!a)return null;var J=a.gl,Da=J.getContextAttributes(),la=J.isContextLost(),pa=F(J,a);if(!pa)return null;var wa=b(),ba=U(),S=pa.extensions,O=h(J,S),Ca=k(),ta=J.drawingBufferWidth,xa=J.drawingBufferHeight,ca={tick:0,time:0,viewportWidth:ta,viewportHeight:xa,framebufferWidth:ta,framebufferHeight:xa,drawingBufferWidth:ta,drawingBufferHeight:xa,pixelRatio:a.pixelRatio},ja=Q(J,S),ma=r(J,ba,a),na=q(J,S,ma,ba),ta=K(J,S,ja,ma,wa),oa=A(J,wa,ba,a),ra=L(J,S,ja,function(){Z.procs.poll()},ca,ba,a),
ya=H(J,S,ja,ba,a),Y=C(J,S,ja,ra,ya,ba),Z=M(J,wa,S,ja,ma,na,ra,Y,{},ta,oa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},ca,O,a),wa=v(J,Y,Z.procs.poll,ca,Da,S),ha=Z.next,X=J.canvas,R=[],aa=[],fa=[],za=[a.onDestroy],ia=null;X&&(X.addEventListener("webglcontextlost",y,!1),X.addEventListener("webglcontextrestored",ga,!1));var ua=Y.setFBO=ka({framebuffer:l.define.call(null,1,"framebuffer")});W();Da=f(ka,{clear:function(a){m("object"===typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in
a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)ua(f({framebuffer:a.framebuffer.faces[b]},a),G);else ua(a,G);else G(null,a)},prop:l.define.bind(null,1),context:l.define.bind(null,2),"this":l.define.bind(null,3),draw:ka({}),buffer:function(a){return ma.create(a,34962,!1,!1)},elements:function(a){return na.create(a,!1)},texture:ra.create2D,cube:ra.createCube,renderbuffer:ya.create,framebuffer:Y.create,framebufferCube:Y.createCube,attributes:Da,frame:V,on:function(a,
b){m.type(b,"function","listener callback must be a function");var c;switch(a){case "frame":return V(b);case "lost":c=aa;break;case "restore":c=fa;break;case "destroy":c=za;break;default:m.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:ja,hasExtension:function(a){return 0<=ja.extensions.indexOf(a.toLowerCase())},read:wa,destroy:function(){R.length=0;t();X&&(X.removeEventListener("webglcontextlost",
y),X.removeEventListener("webglcontextrestored",ga));oa.clear();Y.clear();ya.clear();ra.clear();na.clear();ma.clear();O&&O.clear();za.forEach(function(a){a()})},_gl:J,_refresh:W,poll:function(){ea();O&&O.update()},now:z,stats:ba});a.onDone(null,Da);return Da}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,
"./lib/texture":19,"./lib/timer":20,"./lib/util/check":21,"./lib/util/clock":22,"./lib/util/extend":24,"./lib/util/raf":31,"./lib/webgl":34}]},{},[1]);
