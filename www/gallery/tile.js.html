<!DOCTYPE html>
      <html>
        <head>
          <title>example/tile.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(u,y,c){function f(e,m){if(!y[e]){if(!u[e]){var b="function"==typeof require&&require;if(!m&&b)return b(e,!0);if(h)return h(e,!0);b=Error("Cannot find module '"+e+"'");throw b.code="MODULE_NOT_FOUND",b;}b=y[e]={exports:{}};u[e][0].call(b.exports,function(b){var c=u[e][1][b];return f(c?c:b)},b,b.exports,e$$0,u,y,c)}return y[e].exports}for(var h="function"==typeof require&&require,w=0;w<c.length;w++)f(c[w]);return f})({1:[function(k,u,y){var c=k("../regl")(),f=k("mouse-change")();k("resl")({manifest:{map:{type:"text",
src:"assets/map.json",parser:JSON.parse},tiles:{type:"image",src:"assets/tiles.png",parser:c.texture}},onDone:function(h){var w=h.map,e=c({frag:"\n      precision mediump float;\n      uniform sampler2D map, tiles;\n      uniform vec2 mapSize, tileSize;\n      varying vec2 uv;\n      void main() {\n        vec2 tileCoord = floor(255.0 * texture2D(map, floor(uv) / mapSize).ra);\n        gl_FragColor = texture2D(tiles, (tileCoord + fract(uv)) / tileSize);\n      }",vert:"\n      precision mediump float;\n      attribute vec2 position;\n      uniform vec4 view;\n      varying vec2 uv;\n      void main() {\n        uv = mix(view.xw, view.zy, 0.5 * (1.0 + position));\n        gl_Position = vec4(position, 1, 1);\n      }",
depth:{enable:!1},uniforms:{tiles:h.tiles,tileSize:[16,16],map:c.texture(w),mapSize:[w[0].length,w.length],view:c.prop("view")},attributes:{position:[-1,-1,1,-1,-1,1,1,1,-1,1,1,-1]},count:6});c.frame(function(c){var b=c.viewportWidth,h=c.viewportHeight;c=w[0].length*f.x/b;var k=w.length*f.y/h,b=b/h*10;e({view:[c-.5*b,k-5,c+.5*b,k+5]})})}})},{"../regl":38,"mouse-change":35,resl:37}],2:[function(k,u,y){function c(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=
!1;this.type=5126;this.divisor=this.stride=this.offset=0}u.exports=function(f,h,w,e,m){f=w.maxAttributes;h=Array(f);for(w=0;w<f;++w)h[w]=new c;return{Record:c,scope:{},state:h}}},{}],3:[function(k,u,y){function c(b){return v[Object.prototype.toString.call(b)]|0}function f(b,c){for(var e=0;e<c.length;++e)b[e]=c[e]}function h(b,c,e,f,m,h,l){for(var a=0,d=0;d<e;++d)for(var w=0;w<f;++w)b[a++]=c[m*d+h*w+l]}var w=k("./util/check"),e=k("./util/is-typed-array"),m=k("./util/is-ndarray"),b=k("./util/values"),
n=k("./util/pool");y=k("./util/flatten");var E=y.flatten,C=y.shape,v=k("./constants/arraytypes.json"),q=k("./constants/dtypes.json"),F=k("./constants/usage.json"),A=[];A[5120]=1;A[5122]=2;A[5124]=4;A[5121]=1;A[5123]=2;A[5125]=4;A[5126]=4;u.exports=function(k,v,p){function r(b){this.id=a++;this.buffer=k.createBuffer();this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;p.profile&&(this.stats={size:0})}function N(b,a,d){b.byteLength=a.byteLength;
k.bufferData(b.type,a,d)}function I(b,a,d,l,q,r){b.usage=d;if(Array.isArray(a)){if(b.dtype=l||5126,0<a.length)if(Array.isArray(a[0])){q=C(a);for(var p=l=1;p<q.length;++p)l*=q[p];b.dimension=l;a=E(a,q,b.dtype);N(b,a,d);r?b.persistentData=a:n.freeType(a)}else"number"===typeof a[0]?(b.dimension=q,q=n.allocType(b.dtype,a.length),f(q,a),N(b,q,d),r?b.persistentData=q:n.freeType(q)):e(a[0])?(b.dimension=a[0].length,b.dtype=l||c(a[0])||5126,a=E(a,[a.length,a[0].length],b.dtype),N(b,a,d),r?b.persistentData=
a:n.freeType(a)):w.raise("invalid buffer data")}else if(e(a))b.dtype=l||c(a),b.dimension=q,N(b,a,d),r&&(b.persistentData=new Uint8Array(new Uint8Array(a.buffer)));else if(m(a)){q=a.shape;var k=a.stride,p=a.offset,K=0,Q=0,v=0,I=0;1===q.length?(K=q[0],Q=1,v=k[0],I=0):2===q.length?(K=q[0],Q=q[1],v=k[0],I=k[1]):w.raise("invalid shape");b.dtype=l||c(a.data)||5126;b.dimension=Q;q=n.allocType(b.dtype,K*Q);h(q,a.data,K,Q,v,I,p);N(b,q,d);r?b.persistentData=q:n.freeType(q)}else w.raise("invalid buffer data")}
function l(b){v.bufferCount--;var a=b.buffer;w(a,"buffer must not be deleted already");k.deleteBuffer(a);b.buffer=null;delete d[b.id]}var a=0,d={};r.prototype.bind=function(){k.bindBuffer(this.type,this.buffer)};r.prototype.destroy=function(){l(this)};var K=[];p.profile&&(v.getTotalBufferSize=function(){var b=0;Object.keys(d).forEach(function(a){b+=d[a].stats.size});return b});return{create:function(b,a,K,N){function H(b){var a=35044,d=null,c=0,f=0,l=1;Array.isArray(b)||e(b)||m(b)?d=b:"number"===
typeof b?c=b|0:b&&(w.type(b,"object","buffer arguments must be an object, a number or an array"),"data"in b&&(w(null===d||Array.isArray(d)||e(d)||m(d),"invalid data for buffer"),d=b.data),"usage"in b&&(w.parameter(b.usage,F,"invalid buffer usage"),a=F[b.usage]),"type"in b&&(w.parameter(b.type,q,"invalid buffer type"),f=q[b.type]),"dimension"in b&&(w.type(b.dimension,"number","invalid dimension"),l=b.dimension|0),"length"in b&&(w.nni(c,"buffer length must be a nonnegative integer"),c=b.length|0));
J.bind();d?I(J,d,a,f,l,N):(k.bufferData(J.type,c,a),J.dtype=f||5121,J.usage=a,J.dimension=l,J.byteLength=c);p.profile&&(J.stats.size=J.byteLength*A[J.dtype]);return H}function u(b,a){w(a+b.byteLength<=J.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+b.byteLength+" starting from offset "+a+" to a buffer of size "+J.byteLength);k.bufferSubData(J.type,a,b)}v.bufferCount++;var J=new r(a);d[J.id]=J;K||H(b);H._reglType="buffer";H._buffer=J;H.subdata=function(b,
a){var d=(a||0)|0,l;J.bind();if(Array.isArray(b)){if(0<b.length)if("number"===typeof b[0]){var q=n.allocType(J.dtype,b.length);f(q,b);u(q,d);n.freeType(q)}else Array.isArray(b[0])||e(b[0])?(l=C(b),q=E(b,l,J.dtype),u(q,d),n.freeType(q)):w.raise("invalid buffer data")}else if(e(b))u(b,d);else if(m(b)){l=b.shape;var V=b.stride,r=q=0,p=0,K=0;1===l.length?(q=l[0],r=1,p=V[0],K=0):2===l.length?(q=l[0],r=l[1],p=V[0],K=V[1]):w.raise("invalid shape");l=Array.isArray(b.data)?J.dtype:c(b.data);l=n.allocType(l,
q*r);h(l,b.data,q,r,p,K,b.offset);u(l,d);n.freeType(l)}else w.raise("invalid data for buffer subdata");return H};p.profile&&(H.stats=J.stats);H.destroy=function(){l(J)};return H},createStream:function(b,a){var d=K.pop();d||(d=new r(b));d.bind();I(d,a,35040,0,1,!1);return d},destroyStream:function(b){K.push(b)},clear:function(){b(d).forEach(l);K.forEach(l)},getBuffer:function(b){return b&&b._buffer instanceof r?b._buffer:null},restore:function(){b(d).forEach(function(b){b.buffer=k.createBuffer();k.bindBuffer(b.type,
b.buffer);k.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:I}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/check":21,"./util/flatten":25,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/values":33}],4:[function(k,u,y){u.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,
"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(k,u,y){u.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(k,u,y){u.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(k,u,y){u.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(k,u,y){function c(b){return Array.isArray(b)||
C(b)||v(b)}function f(b){return b.sort(function(b,a){return"viewport"===b?-1:"viewport"===a?1:b<a?-1:1})}function h(b,a,d,c){this.thisDep=b;this.contextDep=a;this.propDep=d;this.append=c}function w(b){return b&&!(b.thisDep||b.contextDep||b.propDep)}function e(b){return new h(!1,!1,!1,b)}function m(b,a){var d=b.type;return 0===d?(d=b.data.length,new h(!0,1<=d,2<=d,a)):4===d?(d=b.data,new h(d.thisDep,d.contextDep,d.propDep,a)):new h(3===d,2===d,1===d,a)}var b=k("./util/check"),n=k("./util/codegen"),
E=k("./util/loop"),C=k("./util/is-typed-array"),v=k("./util/is-ndarray"),q=k("./util/is-array-like"),F=k("./dynamic"),A=k("./constants/primitives.json"),B=k("./constants/dtypes.json"),G=["x","y","z","w"],p="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),r={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,
"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},N="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
I={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},l={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},a={frag:35632,vert:35633},d={cw:2304,ccw:2305},K=new h(!1,!1,!1,function(){});u.exports=function(k,v,C,u,H,ia,J,y,da,Q,M,ra,ka,oa,wa){function ba(b){return b.replace(".","_")}function S(b,a,g){var d=ba(b);
Ga.push(b);pa[d]=x[d]=!!g;Aa[d]=a}function O(b,a,g){var d=ba(b);Ga.push(b);Array.isArray(g)?(x[d]=g.slice(),pa[d]=g.slice()):x[d]=pa[d]=g;Ba[d]=a}function Ca(){var a=n(),g=a.link,d=a.global;a.id=Qa++;a.batchId="0";var c=g(Oa),e=a.shared={props:"a0"};Object.keys(Oa).forEach(function(b){e[b]=d.def(c,".",b)});b.optional(function(){a.CHECK=g(b);a.commandStr=b.guessCommand();a.command=g(a.commandStr);a.assert=function(b,a,d){b("if(!(",a,"))",this.CHECK,".commandRaise(",g(d),",",this.command,");")};Ha.invalidBlendCombinations=
N});var P=a.next={},l=a.current={};Object.keys(Ba).forEach(function(b){Array.isArray(x[b])&&(P[b]=d.def(e.next,".",b),l[b]=d.def(e.current,".",b))});var Ra=a.constants={};Object.keys(Ha).forEach(function(b){Ra[b]=d.def(JSON.stringify(Ha[b]))});a.invoke=function(b,d){switch(d.type){case 0:var L=["this",e.context,e.props,a.batchId];return b.def(g(d.data),".call(",L.slice(0,Math.max(d.data.length+1,4)),")");case 1:return b.def(e.props,d.data);case 2:return b.def(e.context,d.data);case 3:return b.def("this",
d.data);case 4:return d.data.append(a,b),d.data.ref}};a.attribCache={};var L={};a.scopeAttrib=function(b){b=v.id(b);if(b in L)return L[b];var a=Q.scope[b];a||(a=Q.scope[b]=new sa);return L[b]=g(a)};return a}function ta(b){var a=b["static"];b=b.dynamic;var g;if("profile"in a){var d=!!a.profile;g=e(function(b,a){return d});g.enable=d}else if("profile"in b){var c=b.profile;g=m(c,function(b,a){return b.invoke(a,c)})}return g}function xa(a,g){var d=a["static"],c=a.dynamic;if("framebuffer"in d){var l=d.framebuffer;
return l?(l=y.getFramebuffer(l),b.command(l,"invalid framebuffer object"),e(function(b,a){var g=b.link(l),d=b.shared;a.set(d.framebuffer,".next",g);d=d.context;a.set(d,".framebufferWidth",g+".width");a.set(d,".framebufferHeight",g+".height");return g})):e(function(b,a){var g=b.shared;a.set(g.framebuffer,".next","null");g=g.context;a.set(g,".framebufferWidth",g+".drawingBufferWidth");a.set(g,".framebufferHeight",g+".drawingBufferHeight");return"null"})}if("framebuffer"in c){var P=c.framebuffer;return m(P,
function(a,g){var d=a.invoke(g,P),D=a.shared,X=D.framebuffer,t=g.def(X,".getFramebuffer(",d,")");b.optional(function(){a.assert(g,"!"+d+"||"+t,"invalid framebuffer object")});g.set(X,".next",t);D=D.context;g.set(D,".framebufferWidth",t+"?"+t+".width:"+D+".drawingBufferWidth");g.set(D,".framebufferHeight",t+"?"+t+".height:"+D+".drawingBufferHeight");return t})}return null}function ca(a,g,d){function c(a){if(a in e){var L=e[a];b.commandType(L,"object","invalid "+a,d.commandStr);var t=!0,X=L.x|0,l=L.y|
0,x,f;"width"in L?(x=L.width|0,b.command(0<=x,"invalid "+a,d.commandStr)):t=!1;"height"in L?(f=L.height|0,b.command(0<=f,"invalid "+a,d.commandStr)):t=!1;return new h(!t&&g&&g.thisDep,!t&&g&&g.contextDep,!t&&g&&g.propDep,function(b,a){var g=b.shared.context,d=x;"width"in L||(d=a.def(g,".","framebufferWidth","-",X));var t=f;"height"in L||(t=a.def(g,".","framebufferHeight","-",l));return[X,l,d,t]})}if(a in P){var q=P[a],t=m(q,function(g,d){var L=g.invoke(d,q);b.optional(function(){g.assert(d,L+"&&typeof "+
L+'==="object"',"invalid "+a)});var X=g.shared.context,t=d.def(L,".x|0"),D=d.def(L,".y|0"),c=d.def('"width" in ',L,"?",L,".width|0:","(",X,".","framebufferWidth","-",t,")"),e=d.def('"height" in ',L,"?",L,".height|0:","(",X,".","framebufferHeight","-",D,")");b.optional(function(){g.assert(d,c+">=0&&"+e+">=0","invalid "+a)});return[t,D,c,e]});g&&(t.thisDep=t.thisDep||g.thisDep,t.contextDep=t.contextDep||g.contextDep,t.propDep=t.propDep||g.propDep);return t}return g?new h(g.thisDep,g.contextDep,g.propDep,
function(b,a){var g=b.shared.context;return[0,0,a.def(g,".","framebufferWidth"),a.def(g,".","framebufferHeight")]}):null}var e=a["static"],P=a.dynamic;if(a=c("viewport")){var l=a;a=new h(a.thisDep,a.contextDep,a.propDep,function(b,a){var g=l.append(b,a),d=b.shared.context;a.set(d,".viewportWidth",g[2]);a.set(d,".viewportHeight",g[3]);return g})}return{viewport:a,scissor_box:c("scissor.box")}}function ja(g){function d(g){if(g in c){var L=v.id(c[g]);b.optional(function(){M.shader(a[g],L,b.guessCommand())});
var t=e(function(){return L});t.id=L;return t}if(g in l){var X=l[g];return m(X,function(d,L){var t=d.invoke(L,X),D=L.def(d.shared.strings,".id(",t,")");b.optional(function(){L(d.shared.shader,".shader(",a[g],",",D,",",d.command,");")});return D})}return null}var c=g["static"],l=g.dynamic,x=d("frag"),P=d("vert"),f=null;w(x)&&w(P)?(f=M.program(P.id,x.id),g=e(function(b,a){return b.link(f)})):g=new h(x&&x.thisDep||P&&P.thisDep,x&&x.contextDep||P&&P.contextDep,x&&x.propDep||P&&P.propDep,function(a,g){var d=
a.shared.shader,X;X=x?x.append(a,g):g.def(d,".","frag");var t;t=P?P.append(a,g):g.def(d,".","vert");var D=d+".program("+t+","+X;b.optional(function(){D+=","+a.command});return g.def(D+")")});return{frag:x,vert:P,progVar:g,program:f}}function la(a,g){function d(a,L){if(a in l){var t=l[a]|0;b.command(!L||0<=t,"invalid "+a,g.commandStr);return e(function(b,a){L&&(b.OFFSET=t);return t})}if(a in x){var X=x[a];return m(X,function(g,d){var t=g.invoke(d,X);L&&(g.OFFSET=t,b.optional(function(){g.assert(d,
t+">=0","invalid "+a)}));return t})}return L&&P?e(function(b,a){b.OFFSET="0";return 0}):null}var l=a["static"],x=a.dynamic,P=function(){if("elements"in l){var a=l.elements;c(a)?a=ia.getElements(ia.create(a,!0)):a&&(a=ia.getElements(a),b.command(a,"invalid elements",g.commandStr));var d=e(function(b,g){if(a){var d=b.link(a);return b.ELEMENTS=d}return b.ELEMENTS=null});d.value=a;return d}if("elements"in x){var t=x.elements;return m(t,function(a,g){var d=a.shared,L=d.isBufferArgs,d=d.elements,D=a.invoke(g,
t),c=g.def("null"),L=g.def(L,"(",D,")"),e=a.cond(L).then(c,"=",d,".createStream(",D,");")["else"](c,"=",d,".getElements(",D,");");b.optional(function(){a.assert(e["else"],"!"+D+"||"+c,"invalid elements")});g.entry(e);g.exit(a.cond(L).then(d,".destroyStream(",c,");"));return a.ELEMENTS=c})}return null}(),f=d("offset",!0);return{elements:P,primitive:function(){if("primitive"in l){var a=l.primitive;b.commandParameter(a,A,"invalid primitve",g.commandStr);return e(function(b,g){return A[a]})}if("primitive"in
x){var d=x.primitive;return m(d,function(a,g){var t=a.constants.primTypes,D=a.invoke(g,d);b.optional(function(){a.assert(g,D+" in "+t,"invalid primitive, must be one of "+Object.keys(A))});return g.def(t,"[",D,"]")})}return P?w(P)?P.value?e(function(b,a){return a.def(b.ELEMENTS,".primType")}):e(function(){return 4}):new h(P.thisDep,P.contextDep,P.propDep,function(b,a){var g=b.ELEMENTS;return a.def(g,"?",g,".primType:",4)}):null}(),count:function(){if("count"in l){var a=l.count|0;b.command("number"===
typeof a&&0<=a,"invalid vertex count",g.commandStr);return e(function(){return a})}if("count"in x){var d=x.count;return m(d,function(a,g){var t=a.invoke(g,d);b.optional(function(){a.assert(g,"typeof "+t+'==="number"&&'+t+">=0&&"+t+"===("+t+"|0)","invalid vertex count")});return t})}if(P){if(w(P)){if(P)return f?new h(f.thisDep,f.contextDep,f.propDep,function(a,g){var d=g.def(a.ELEMENTS,".vertCount-",a.OFFSET);b.optional(function(){a.assert(g,d+">=0","invalid vertex offset/element buffer too small")});
return d}):e(function(b,a){return a.def(b.ELEMENTS,".vertCount")});var t=e(function(){return-1});b.optional(function(){t.MISSING=!0});return t}var X=new h(P.thisDep||f.thisDep,P.contextDep||f.contextDep,P.propDep||f.propDep,function(b,a){var g=b.ELEMENTS;return b.OFFSET?a.def(g,"?",g,".vertCount-",b.OFFSET,":-1"):a.def(g,"?",g,".vertCount:-1")});b.optional(function(){X.DYNAMIC=!0});return X}return null}(),instances:d("instances",!1),offset:f}}function ma(a,g){var c=a["static"],x=a.dynamic,f={};Ga.forEach(function(a){function t(b,
g){if(a in c){var d=b(c[a]);f[h]=e(function(){return d})}else if(a in x){var D=x[a];f[h]=m(D,function(b,a){return g(b,a,b.invoke(a,D))})}}var h=ba(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return t(function(d){b.commandType(d,"boolean",a,g.commandStr);return d},function(g,d,t){b.optional(function(){g.assert(d,"typeof "+t+'==="boolean"',
"invalid flag "+a,g.commandStr)});return t});case "depth.func":return t(function(d){b.commandParameter(d,I,"invalid "+a,g.commandStr);return I[d]},function(g,d,t){var c=g.constants.compareFuncs;b.optional(function(){g.assert(d,t+" in "+c,"invalid "+a+", must be one of "+Object.keys(I))});return d.def(c,"[",t,"]")});case "depth.range":return t(function(a){b.command(q(a)&&2===a.length&&"number"===typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",g.commandStr);return a},function(a,
g,d){b.optional(function(){a.assert(g,a.shared.isArrayLike+"("+d+")&&"+d+".length===2&&typeof "+d+'[0]==="number"&&typeof '+d+'[1]==="number"&&'+d+"[0]<="+d+"[1]","depth range must be a 2d array")});var t=g.def("+",d,"[0]"),c=g.def("+",d,"[1]");return[t,c]});case "blend.func":return t(function(a){b.commandType(a,"object","blend.func",g.commandStr);var d="srcRGB"in a?a.srcRGB:a.src,t="srcAlpha"in a?a.srcAlpha:a.src,c="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;b.commandParameter(d,
r,h+".srcRGB",g.commandStr);b.commandParameter(t,r,h+".srcAlpha",g.commandStr);b.commandParameter(c,r,h+".dstRGB",g.commandStr);b.commandParameter(a,r,h+".dstAlpha",g.commandStr);b.command(-1===N.indexOf(d+", "+c),"unallowed blending combination (srcRGB, dstRGB) = ("+d+", "+c+")",g.commandStr);return[r[d],r[c],r[t],r[a]]},function(g,d,t){function c(e,l){var x=d.def('"',e,l,'" in ',t,"?",t,".",e,l,":",t,".",e);b.optional(function(){g.assert(d,x+" in "+D,"invalid "+a+"."+e+l+", must be one of "+Object.keys(r))});
return x}var D=g.constants.blendFuncs;b.optional(function(){g.assert(d,t+"&&typeof "+t+'==="object"',"invalid blend func, must be an object")});var e=c("src","RGB"),l=c("dst","RGB");b.optional(function(){g.assert(d,g.constants.invalidBlendCombinations+".indexOf("+e+'+", "+'+l+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var x=d.def(D,"[",e,"]"),f=d.def(D,"[",c("src","Alpha"),"]"),h=d.def(D,"[",l,"]"),m=d.def(D,"[",c("dst","Alpha"),"]");return[x,h,f,m]});case "blend.equation":return t(function(d){if("string"===
typeof d)return b.commandParameter(d,ea,"invalid "+a,g.commandStr),[ea[d],ea[d]];if("object"===typeof d)return b.commandParameter(d.rgb,ea,a+".rgb",g.commandStr),b.commandParameter(d.alpha,ea,a+".alpha",g.commandStr),[ea[d.rgb],ea[d.alpha]];b.commandRaise("invalid blend.equation",g.commandStr)},function(g,d,t){var c=g.constants.blendEquations,D=d.def(),e=d.def(),l=g.cond("typeof ",t,'==="string"');b.optional(function(){function b(a,d,t){g.assert(a,t+" in "+c,"invalid "+d+", must be one of "+Object.keys(ea))}
b(l.then,a,t);g.assert(l["else"],t+"&&typeof "+t+'==="object"',"invalid "+a);b(l["else"],a+".rgb",t+".rgb");b(l["else"],a+".alpha",t+".alpha")});l.then(D,"=",e,"=",c,"[",t,"];");l["else"](D,"=",c,"[",t,".rgb];",e,"=",c,"[",t,".alpha];");d(l);return[D,e]});case "blend.color":return t(function(a){b.command(q(a)&&4===a.length,"blend.color must be a 4d array",g.commandStr);return E(4,function(b){return+a[b]})},function(a,g,d){b.optional(function(){a.assert(g,a.shared.isArrayLike+"("+d+")&&"+d+".length===4",
"blend.color must be a 4d array")});return E(4,function(b){return g.def("+",d,"[",b,"]")})});case "stencil.mask":return t(function(a){b.commandType(a,"number",h,g.commandStr);return a|0},function(a,g,d){b.optional(function(){a.assert(g,"typeof "+d+'==="number"',"invalid stencil.mask")});return g.def(d,"|0")});case "stencil.func":return t(function(d){b.commandType(d,"object",h,g.commandStr);var t=d.cmp||"keep",c=d.ref||0;d="mask"in d?d.mask:-1;b.commandParameter(t,I,a+".cmp",g.commandStr);b.commandType(c,
"number",a+".ref",g.commandStr);b.commandType(d,"number",a+".mask",g.commandStr);return[I[t],c,d]},function(a,g,d){var t=a.constants.compareFuncs;b.optional(function(){function b(){a.assert(g,Array.prototype.join.call(arguments,""),"invalid stencil.func")}b(d+"&&typeof ",d,'==="object"');b('!("cmp" in ',d,")||(",d,".cmp in ",t,")")});var c=g.def('"cmp" in ',d,"?",t,"[",d,".cmp]",":",7680),D=g.def(d,".ref|0"),e=g.def('"mask" in ',d,"?",d,".mask|0:-1");return[c,D,e]});case "stencil.opFront":case "stencil.opBack":return t(function(d){b.commandType(d,
"object",h,g.commandStr);var t=d.fail||"keep",c=d.zfail||"keep";d=d.zpass||"keep";b.commandParameter(t,l,a+".fail",g.commandStr);b.commandParameter(c,l,a+".zfail",g.commandStr);b.commandParameter(d,l,a+".zpass",g.commandStr);return["stencil.opBack"===a?1029:1028,l[t],l[c],l[d]]},function(g,d,t){function c(e){b.optional(function(){g.assert(d,'!("'+e+'" in '+t+")||("+t+"."+e+" in "+D+")","invalid "+a+"."+e+", must be one of "+Object.keys(l))});return d.def('"',e,'" in ',t,"?",D,"[",t,".",e,"]:",7680)}
var D=g.constants.stencilOps;b.optional(function(){g.assert(d,t+"&&typeof "+t+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,c("fail"),c("zfail"),c("zpass")]});case "polygonOffset.offset":return t(function(a){b.commandType(a,"object",h,g.commandStr);var d=a.factor|0;a=a.units|0;b.commandType(d,"number",h+".factor",g.commandStr);b.commandType(a,"number",h+".units",g.commandStr);return[d,a]},function(g,d,t){b.optional(function(){g.assert(d,t+"&&typeof "+t+'==="object"',"invalid "+
a)});var c=d.def(t,".factor|0"),D=d.def(t,".units|0");return[c,D]});case "cull.face":return t(function(a){var d=0;"front"===a?d=1028:"back"===a&&(d=1029);b.command(!!d,h,g.commandStr);return d},function(a,g,d){b.optional(function(){a.assert(g,d+'==="front"||'+d+'==="back"',"invalid cull.face")});return g.def(d,'==="front"?',1028,":",1029)});case "lineWidth":return t(function(a){b.command("number"===typeof a&&a>=u.lineWidthDims[0]&&a<=u.lineWidthDims[1],"invalid line width, must positive number between "+
u.lineWidthDims[0]+" and "+u.lineWidthDims[1],g.commandStr);return a},function(a,g,d){b.optional(function(){a.assert(g,"typeof "+d+'==="number"&&'+d+">="+u.lineWidthDims[0]+"&&"+d+"<="+u.lineWidthDims[1],"invalid line width")});return d});case "frontFace":return t(function(a){b.commandParameter(a,d,h,g.commandStr);return d[a]},function(a,g,d){b.optional(function(){a.assert(g,d+'==="cw"||'+d+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return g.def(d+'==="cw"?2304:2305')});case "colorMask":return t(function(a){b.command(q(a)&&
4===a.length,"color.mask must be length 4 array",g.commandStr);return a.map(function(a){return!!a})},function(a,g,d){b.optional(function(){a.assert(g,a.shared.isArrayLike+"("+d+")&&"+d+".length===4","invalid color.mask")});return E(4,function(a){return"!!"+d+"["+a+"]"})});case "sample.coverage":return t(function(a){b.command("object"===typeof a&&a,h,g.commandStr);var d="value"in a?a.value:1;a=!!a.invert;b.command("number"===typeof d&&0<=d&&1>=d,"sample.coverage.value must be a number between 0 and 1",
g.commandStr);return[d,a]},function(a,g,d){b.optional(function(){a.assert(g,d+"&&typeof "+d+'==="object"',"invalid sample.coverage")});var t=g.def('"value" in ',d,"?+",d,".value:1"),c=g.def("!!",d,".invert");return[t,c]})}});return f}function na(a,g){var d=a["static"],c=a.dynamic,l={};Object.keys(d).forEach(function(a){var t=d[a],c;if("number"===typeof t||"boolean"===typeof t)c=e(function(){return t});else if("function"===typeof t){var x=t._reglType;"texture2d"===x||"textureCube"===x?c=e(function(a){return a.link(t)}):
"framebuffer"===x||"framebufferCube"===x?(b.command(0<t.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',g.commandStr),c=e(function(a){return a.link(t.color[0])})):b.commandRaise('invalid data for uniform "'+a+'"',g.commandStr)}else q(t)?c=e(function(g){return g.global.def("[",E(t.length,function(d){b.command("number"===typeof t[d]||"boolean"===typeof t[d],"invalid uniform "+a,g.commandStr);return t[d]}),"]")}):b.commandRaise('invalid or missing data for uniform "'+
a+'"',g.commandStr);c.value=t;l[a]=c});Object.keys(c).forEach(function(a){var b=c[a];l[a]=m(b,function(a,g){return a.invoke(g,b)})});return l}function qa(a,d){var l=a["static"],x=a.dynamic,f={};Object.keys(l).forEach(function(a){var t=l[a],x=v.id(a),h=new sa;if(c(t))h.state=1,h.buffer=H.getBuffer(H.create(t,34962,!1,!0)),h.type=0;else{var m=H.getBuffer(t);if(m)h.state=1,h.buffer=m,h.type=0;else if(b.command("object"===typeof t&&t,"invalid data for attribute "+a,d.commandStr),t.constant){var z=t.constant;
h.buffer="null";h.state=2;"number"===typeof z?h.x=z:(b.command(q(z)&&0<z.length&&4>=z.length,"invalid constant for attribute "+a,d.commandStr),G.forEach(function(a,b){b<z.length&&(h[a]=z[b])}))}else{m=c(t.buffer)?H.getBuffer(H.create(t.buffer,34962,!1,!0)):H.getBuffer(t.buffer);b.command(!!m,'missing buffer for attribute "'+a+'"',d.commandStr);var w=t.offset|0;b.command(0<=w,'invalid offset for attribute "'+a+'"',d.commandStr);var r=t.stride|0;b.command(0<=r&&256>r,'invalid stride for attribute "'+
a+'", must be integer betweeen [0, 255]',d.commandStr);var p=t.size|0;b.command(!("size"in t)||0<p&&4>=p,'invalid size for attribute "'+a+'", must be 1,2,3,4',d.commandStr);var k=!!t.normalized,K=0;"type"in t&&(b.commandParameter(t.type,B,"invalid type for attribute "+a,d.commandStr),K=B[t.type]);var n=t.divisor|0;"divisor"in t&&(b.command(0===n||g,'cannot specify divisor for attribute "'+a+'", instancing not supported',d.commandStr),b.command(0<=n,'invalid divisor for attribute "'+a+'"',d.commandStr));
b.optional(function(){var g=d.commandStr,c="buffer offset divisor normalized type size stride".split(" ");Object.keys(t).forEach(function(d){b.command(0<=c.indexOf(d),'unknown parameter "'+d+'" for attribute pointer "'+a+'" (valid parameters are '+c+")",g)})});h.buffer=m;h.state=1;h.size=p;h.normalized=k;h.type=K||m.dtype;h.offset=w;h.stride=r;h.divisor=n}}f[a]=e(function(a,b){var d=a.attribCache;if(x in d)return d[x];var g={isStream:!1};Object.keys(h).forEach(function(a){g[a]=h[a]});h.buffer&&(g.buffer=
a.link(h.buffer),g.type=g.type||g.buffer+".dtype");return d[x]=g})});Object.keys(x).forEach(function(a){var d=x[a];f[a]=m(d,function(g,t){function c(a){t(f[a],"=",e,".",a,"|0;")}var e=g.invoke(t,d),l=g.shared,D=l.isBufferArgs,x=l.buffer;b.optional(function(){g.assert(t,e+"&&(typeof "+e+'==="object"||typeof '+e+'==="function")&&('+D+"("+e+")||"+x+".getBuffer("+e+")||"+x+".getBuffer("+e+".buffer)||"+D+"("+e+'.buffer)||("constant" in '+e+"&&(typeof "+e+'.constant==="number"||'+l.isArrayLike+"("+e+".constant))))",
'invalid dynamic attribute "'+a+'"')});var f={isStream:t.def(!1)},h=new sa;h.state=1;Object.keys(h).forEach(function(a){f[a]=t.def(""+h[a])});var m=f.buffer,q=f.type;t("if(",D,"(",e,")){",f.isStream,"=true;",m,"=",x,".createStream(",34962,",",e,");",q,"=",m,".dtype;","}else{",m,"=",x,".getBuffer(",e,");","if(",m,"){",q,"=",m,".dtype;",'}else if("constant" in ',e,"){",f.state,"=",2,";","if(typeof "+e+'.constant === "number"){',f[G[0]],"=",e,".constant;",G.slice(1).map(function(a){return f[a]}).join("="),
"=0;","}else{",G.map(function(a,b){return f[a]+"="+e+".constant.length>="+b+"?"+e+".constant["+b+"]:0;"}).join(""),"}}else{","if(",D,"(",e,".buffer)){",m,"=",x,".createStream(",34962,",",e,".buffer);","}else{",m,"=",x,".getBuffer(",e,".buffer);","}",q,'="type" in ',e,"?",l.glTypes,"[",e,".type]:",m,".dtype;",f.normalized,"=!!",e,".normalized;");c("size");c("offset");c("stride");c("divisor");t("}}");t.exit("if(",f.isStream,"){",x,".destroyStream(",m,");","}");return f})});return f}function ya(a){var b=
a["static"],d=a.dynamic,g={};Object.keys(b).forEach(function(a){var d=b[a];g[a]=e(function(a,b){return"number"===typeof d||"boolean"===typeof d?""+d:a.link(d)})});Object.keys(d).forEach(function(a){var b=d[a];g[a]=m(b,function(a,d){return a.invoke(d,b)})});return g}function W(a,d,g,c,e){function l(a){var d=m[a];d&&(z[a]=d)}var x=a["static"],f=a.dynamic;b.optional(function(){function a(g){Object.keys(g).forEach(function(a){b.command(0<=d.indexOf(a),'unknown parameter "'+a+'"',e.commandStr)})}var d=
"framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(Ga);a(x);a(f)});var h=xa(a,e),m=ca(a,h,e),q=la(a,e),z=ma(a,e),w=ja(a,e);l("viewport");l(ba("scissor.box"));var r=0<Object.keys(z).length,h={framebuffer:h,draw:q,shader:w,state:z,dirty:r};h.profile=ta(a,e);h.uniforms=na(g,e);h.attributes=qa(d,e);h.context=ya(c,e);return h}function Z(a,d,b){var g=a.shared.context,c=a.scope();Object.keys(b).forEach(function(e){d.save(g,"."+e);c(g,".",e,"=",b[e].append(a,d),";")});
d(c)}function T(a,d,b,g){var c=a.shared,e=c.gl,l=c.framebuffer,x;z&&(x=d.def(c.extensions,".webgl_draw_buffers"));var f=a.constants,c=f.drawBuffer,f=f.backBuffer;a=b?b.append(a,d):d.def(l,".next");g||d("if(",a,"!==",l,".cur){");d("if(",a,"){",e,".bindFramebuffer(",36160,",",a,".framebuffer);");z&&d(x,".drawBuffersWEBGL(",c,"[",a,".colorAttachments.length]);");d("}else{",e,".bindFramebuffer(",36160,",null);");z&&d(x,".drawBuffersWEBGL(",f,");");d("}",l,".cur=",a,";");g||d("}")}function U(a,d,b){var g=
a.shared,c=g.gl,e=a.current,l=a.next,f=g.current,h=g.next,m=a.cond(f,".dirty");Ga.forEach(function(d){d=ba(d);if(!(d in b.state)){var g,D;if(d in l){g=l[d];D=e[d];var q=E(x[d].length,function(a){return m.def(g,"[",a,"]")});m(a.cond(q.map(function(a,d){return a+"!=="+D+"["+d+"]"}).join("||")).then(c,".",Ba[d],"(",q,");",q.map(function(a,d){return D+"["+d+"]="+a}).join(";"),";"))}else g=m.def(h,".",d),q=a.cond(g,"!==",f,".",d),m(q),d in Aa?q(a.cond(g).then(c,".enable(",Aa[d],");")["else"](c,".disable(",
Aa[d],");"),f,".",d,"=",g,";"):q(c,".",Ba[d],"(",g,");",f,".",d,"=",g,";")}});0===Object.keys(b.state).length&&m(f,".dirty=false;");d(m)}function R(a,d,g,b){var c=a.shared,e=a.current,l=c.current,x=c.gl;f(Object.keys(g)).forEach(function(c){var f=g[c];if(!b||b(f)){var h=f.append(a,d);if(Aa[c]){var m=Aa[c];w(f)?h?d(x,".enable(",m,");"):d(x,".disable(",m,");"):d(a.cond(h).then(x,".enable(",m,");")["else"](x,".disable(",m,");"));d(l,".",c,"=",h,";")}else if(q(h)){var z=e[c];d(x,".",Ba[c],"(",h,");",
h.map(function(a,d){return z+"["+d+"]="+a}).join(";"),";")}else d(x,".",Ba[c],"(",h,");",l,".",c,"=",h,";")}})}function aa(a,d){g&&(a.instancing=d.def(a.shared.extensions,".angle_instanced_arrays"))}function fa(a,d,g,b,c){function e(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function l(a){r=d.def();a(r,"=",e(),";");"string"===typeof c?a(m,".count+=",c,";"):a(m,".count++;");oa&&(b?(p=d.def(),a(p,"=",z,".getNumPendingQueries();")):a(z,".beginQuery(",m,");"))}function x(a){a(m,
".cpuTime+=",e(),"-",r,";");oa&&(b?a(z,".pushScopeStats(",p,",",z,".getNumPendingQueries(),",m,");"):a(z,".endQuery();"))}function f(a){var g=d.def(q,".profile");d(q,".profile=",a,";");d.exit(q,".profile=",g,";")}var h=a.shared,m=a.stats,q=h.current,z=h.timer;g=g.profile;var r,p;if(g){if(w(g)){g.enable?(l(d),x(d.exit),f("true")):f("false");return}g=g.append(a,d);f(g)}else g=d.def(q,".profile");h=a.block();l(h);d("if(",g,"){",h,"}");a=a.block();x(a);d.exit("if(",g,"){",a,"}")}function za(a,d,c,e,l){function x(a){switch(a){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function f(b,c,e){function l(){d("if(!",z,".buffer){",m,".enableVertexAttribArray(",q,");}");var b=e.type,x;x=e.size?d.def(e.size,"||",c):c;d("if(",z,".type!==",b,"||",z,".size!==",x,"||",p.map(function(a){return z+"."+a+"!=="+e[a]}).join("||"),"){",m,".bindBuffer(",34962,",",w,".buffer);",m,".vertexAttribPointer(",[q,x,b,e.normalized,e.stride,e.offset],");",z,".type=",b,";",z,".size=",x,";",p.map(function(a){return z+
"."+a+"="+e[a]+";"}).join(""),"}");g&&(b=e.divisor,d("if(",z,".divisor!==",b,"){",a.instancing,".vertexAttribDivisorANGLE(",[q,b],");",z,".divisor=",b,";}"))}function x(){d("if(",z,".buffer){",m,".disableVertexAttribArray(",q,");","}if(",G.map(function(a,d){return z+"."+a+"!=="+r[d]}).join("||"),"){",m,".vertexAttrib4f(",q,",",r,");",G.map(function(a,d){return z+"."+a+"="+r[d]+";"}).join(""),"}")}var m=h.gl,q=d.def(b,".location"),z=d.def(h.attributes,"[",q,"]");b=e.state;var w=e.buffer,r=[e.x,e.y,
e.z,e.w],p=["buffer","normalized","offset","stride"];1===b?l():2===b?x():(d("if(",b,"===",1,"){"),l(),d("}else{"),x(),d("}"))}var h=a.shared;e.forEach(function(g){var e=g.name,h=c.attributes[e],m;if(h){if(!l(h))return;m=h.append(a,d)}else{if(!l(K))return;var q=a.scopeAttrib(e);b.optional(function(){a.assert(d,q+".state","missing attribute "+e)});m={};Object.keys(new sa).forEach(function(a){m[a]=d.def(q,".",a)})}f(a.link(g),x(g.info.type),m)})}function ha(a,d,g,c,e){for(var x=a.shared,l=x.gl,f,h=0;h<
c.length;++h){var m=c[h],z=m.name,r=m.info.type,p=g.uniforms[z],m=a.link(m)+".location",k;if(p){if(!e(p))continue;if(w(p)){var n=p.value;b.command(null!==n&&"undefined"!==typeof n,'missing uniform "'+z+'"',a.commandStr);if(35678===r||35680===r)b.command("function"===typeof n&&(35678===r&&("texture2d"===n._reglType||"framebuffer"===n._reglType)||35680===r&&("textureCube"===n._reglType||"framebufferCube"===n._reglType)),"invalid texture for uniform "+z,a.commandStr),p=a.link(n._texture||n.color[0]._texture),
d(l,".uniform1i(",m,",",p+".bind());"),d.exit(p,".unbind();");else if(35674===r||35675===r||35676===r){b.optional(function(){b.command(q(n),"invalid matrix for uniform "+z,a.commandStr);b.command(35674===r&&4===n.length||35675===r&&9===n.length||35676===r&&16===n.length,"invalid length for matrix uniform "+z,a.commandStr)});var p=a.global.def("new Float32Array(["+Array.prototype.slice.call(n)+"])"),Q=2;35675===r?Q=3:35676===r&&(Q=4);d(l,".uniformMatrix",Q,"fv(",m,",false,",p,");")}else{switch(r){case 5126:b.commandType(n,
"number","uniform "+z,a.commandStr);f="1f";break;case 35664:b.command(q(n)&&2===n.length,"uniform "+z,a.commandStr);f="2f";break;case 35665:b.command(q(n)&&3===n.length,"uniform "+z,a.commandStr);f="3f";break;case 35666:b.command(q(n)&&4===n.length,"uniform "+z,a.commandStr);f="4f";break;case 35670:b.commandType(n,"boolean","uniform "+z,a.commandStr);f="1i";break;case 5124:b.commandType(n,"number","uniform "+z,a.commandStr);f="1i";break;case 35671:b.command(q(n)&&2===n.length,"uniform "+z,a.commandStr);
f="2i";break;case 35667:b.command(q(n)&&2===n.length,"uniform "+z,a.commandStr);f="2i";break;case 35672:b.command(q(n)&&3===n.length,"uniform "+z,a.commandStr);f="3i";break;case 35668:b.command(q(n)&&3===n.length,"uniform "+z,a.commandStr);f="3i";break;case 35673:b.command(q(n)&&4===n.length,"uniform "+z,a.commandStr);f="4i";break;case 35669:b.command(q(n)&&4===n.length,"uniform "+z,a.commandStr),f="4i"}d(l,".uniform",f,"(",m,",",q(n)?Array.prototype.slice.call(n):n,");")}continue}else k=p.append(a,
d)}else{if(!e(K))continue;k=d.def(x.uniforms,"[",v.id(z),"]")}35678===r?d("if(",k,"&&",k,'._reglType==="framebuffer"){',k,"=",k,".color[0];","}"):35680===r&&d("if(",k,"&&",k,'._reglType==="framebufferCube"){',k,"=",k,".color[0];","}");b.optional(function(){function g(b,c){a.assert(d,b,'bad data or missing for uniform "'+z+'".  '+c)}function b(a){g("typeof "+k+'==="'+a+'"',"invalid type, expected "+a)}function c(d,b){g(x.isArrayLike+"("+k+")&&"+k+".length==="+d,"invalid vector, should have length "+
d,a.commandStr)}function e(d){g("typeof "+k+'==="function"&&'+k+'._reglType==="texture'+(3553===d?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(r){case 5124:b("number");break;case 35667:c(2,"number");break;case 35668:c(3,"number");break;case 35669:c(4,"number");break;case 5126:b("number");break;case 35664:c(2,"number");break;case 35665:c(3,"number");break;case 35666:c(4,"number");break;case 35670:b("boolean");break;case 35671:c(2,"boolean");break;case 35672:c(3,"boolean");break;case 35673:c(4,
"boolean");break;case 35674:c(4,"number");break;case 35675:c(9,"number");break;case 35676:c(16,"number");break;case 35678:e(3553);break;case 35680:e(34067)}});p=1;switch(r){case 35678:case 35680:p=d.def(k,"._texture");d(l,".uniform1i(",m,",",p,".bind());");d.exit(p,".unbind();");continue;case 5124:case 35670:f="1i";break;case 35667:case 35671:f="2i";p=2;break;case 35668:case 35672:f="3i";p=3;break;case 35669:case 35673:f="4i";p=4;break;case 5126:f="1f";break;case 35664:f="2f";p=2;break;case 35665:f=
"3f";p=3;break;case 35666:f="4f";p=4;break;case 35674:f="Matrix2fv";break;case 35675:f="Matrix3fv";break;case 35676:f="Matrix4fv"}d(l,".uniform",f,"(",m,",");if("M"===f.charAt(0)){var m=Math.pow(r-35674+2,2),pa=a.global.def("new Float32Array(",m,")");d("false,(Array.isArray(",k,")||",k," instanceof Float32Array)?",k,":(",E(m,function(a){return pa+"["+a+"]="+k+"["+a+"]"}),",",pa,")")}else 1<p?d(E(p,function(a){return k+"["+a+"]"})):d(k);d(");")}}function ua(a,d,c,e){function f(g){var b=q[g];return b?
b.contextDep&&e.contextDynamic||b.propDep?b.append(a,c):b.append(a,d):d.def(z,".",g)}function l(){function a(){c(v,".drawElementsInstancedANGLE(",[r,k,Q,p+"<<(("+Q+"-5121)>>1)",K],");")}function d(){c(v,".drawArraysInstancedANGLE(",[r,p,k,K],");")}n?pa?a():(c("if(",n,"){"),a(),c("}else{"),d(),c("}")):d()}function x(){function a(){c(m+".drawElements("+[r,k,Q,p+"<<(("+Q+"-5121)>>1)"]+");")}function d(){c(m+".drawArrays("+[r,p,k]+");")}n?pa?a():(c("if(",n,"){"),a(),c("}else{"),d(),c("}")):d()}var h=
a.shared,m=h.gl,z=h.draw,q=e.draw,n=function(){var g=q.elements,b=d;if(g){if(g.contextDep&&e.contextDynamic||g.propDep)b=c;g=g.append(a,b)}else g=b.def(z,".","elements");g&&b("if("+g+")"+m+".bindBuffer(34963,"+g+".buffer.buffer);");return g}(),r=f("primitive"),p=f("offset"),k=function(){var g=q.count,f,l=d;if(g){if(g.contextDep&&e.contextDynamic||g.propDep)l=c;f=g.append(a,l);b.optional(function(){g.MISSING&&a.assert(d,"false","missing vertex count");g.DYNAMIC&&a.assert(l,f+">=0","missing vertex count")})}else f=
l.def(z,".","count"),b.optional(function(){a.assert(l,f+">=0","missing vertex count")});return f}();if("number"===typeof k){if(0===k)return}else c("if(",k,"){"),c.exit("}");var K,v;g&&(K=f("instances"),v=a.instancing);var Q=n+".type",pa=q.elements&&w(q.elements);g&&("number"!==typeof K||0<=K)?"string"===typeof K?(c("if(",K,">0){"),l(),c("}else if(",K,"<0){"),x(),c("}")):l():x()}function Da(a,d,c,e,f){var l=Ca();f=l.proc("body",f);b.optional(function(){l.commandStr=d.commandStr;l.command=l.link(d.commandStr)});
g&&(l.instancing=f.def(l.shared.extensions,".angle_instanced_arrays"));a(l,f,c,e);return l.compile().body}function Fa(a,d,g,b){aa(a,d);za(a,d,g,b.attributes,function(){return!0});ha(a,d,g,b.uniforms,function(){return!0});ua(a,d,d,g)}function Ia(a,d){var g=a.proc("draw",1);aa(a,g);Z(a,g,d.context);T(a,g,d.framebuffer);U(a,g,d);R(a,g,d.state);fa(a,g,d,!1,!0);var b=d.shader.progVar.append(a,g);g(a.shared.gl,".useProgram(",b,".program);");if(d.shader.program)Fa(a,g,d,d.shader.program);else{var c=a.global.def("{}"),
e=g.def(b,".id"),f=g.def(c,"[",e,"]");g(a.cond(f).then(f,".call(this,a0);")["else"](f,"=",c,"[",e,"]=",a.link(function(g){return Da(Fa,a,d,g,1)}),"(",b,");",f,".call(this,a0);"))}0<Object.keys(d.state).length&&g(a.shared.current,".dirty=true;")}function Ea(a,d,g,b){function c(){return!0}a.batchId="a1";aa(a,d);za(a,d,g,b.attributes,c);ha(a,d,g,b.uniforms,c);ua(a,d,d,g)}function Ja(a,d,g,b){function c(a){return a.contextDep&&f||a.propDep}function e(a){return!c(a)}aa(a,d);var f=g.contextDep,l=d.def(),
x=d.def();a.shared.props=x;a.batchId=l;var h=a.scope(),m=a.scope();d(h.entry,"for(",l,"=0;",l,"<","a1",";++",l,"){",x,"=","a0","[",l,"];",m,"}",h.exit);g.needsContext&&Z(a,m,g.context);g.needsFramebuffer&&T(a,m,g.framebuffer);R(a,m,g.state,c);g.profile&&c(g.profile)&&fa(a,m,g,!1,!0);b?(za(a,h,g,b.attributes,e),za(a,m,g,b.attributes,c),ha(a,h,g,b.uniforms,e),ha(a,m,g,b.uniforms,c),ua(a,h,m,g)):(d=a.global.def("{}"),b=g.shader.progVar.append(a,m),x=m.def(b,".id"),h=m.def(d,"[",x,"]"),m(a.shared.gl,
".useProgram(",b,".program);","if(!",h,"){",h,"=",d,"[",x,"]=",a.link(function(d){return Da(Ea,a,g,d,2)}),"(",b,");}",h,".call(this,a0[",l,"],",l,");"))}function Ka(a,d){function g(a){return a.contextDep&&c||a.propDep}var b=a.proc("batch",2);a.batchId="0";aa(a,b);var c=!1,e=!0;Object.keys(d.context).forEach(function(a){c=c||d.context[a].propDep});c||(Z(a,b,d.context),e=!1);var f=d.framebuffer,l=!1;f?(f.propDep?c=l=!0:f.contextDep&&c&&(l=!0),l||T(a,b,f)):T(a,b,null);d.state.viewport&&d.state.viewport.propDep&&
(c=!0);U(a,b,d);R(a,b,d.state,function(a){return!g(a)});d.profile&&g(d.profile)||fa(a,b,d,!1,"a1");d.contextDep=c;d.needsContext=e;d.needsFramebuffer=l;e=d.shader.progVar;if(e.contextDep&&c||e.propDep)Ja(a,b,d,null);else if(e=e.append(a,b),b(a.shared.gl,".useProgram(",e,".program);"),d.shader.program)Ja(a,b,d,d.shader.program);else{var f=a.global.def("{}"),l=b.def(e,".id"),x=b.def(f,"[",l,"]");b(a.cond(x).then(x,".call(this,a0,a1);")["else"](x,"=",f,"[",l,"]=",a.link(function(g){return Da(Ja,a,d,
g,2)}),"(",e,");",x,".call(this,a0,a1);"))}0<Object.keys(d.state).length&&b(a.shared.current,".dirty=true;")}function La(a,d){function g(e){var f=d.shader[e];f&&b.set(c.shader,"."+e,f.append(a,b))}var b=a.proc("scope",3);a.batchId="a2";var c=a.shared,e=c.current;Z(a,b,d.context);d.framebuffer&&d.framebuffer.append(a,b);f(Object.keys(d.state)).forEach(function(g){var e=d.state[g].append(a,b);q(e)?e.forEach(function(d,c){b.set(a.next[g],"["+c+"]",d)}):b.set(c.next,"."+g,e)});fa(a,b,d,!0,!0);["elements",
"offset","count","instances","primitive"].forEach(function(g){var e=d.draw[g];e&&b.set(c.draw,"."+g,""+e.append(a,b))});Object.keys(d.uniforms).forEach(function(g){b.set(c.uniforms,"["+v.id(g)+"]",d.uniforms[g].append(a,b))});Object.keys(d.attributes).forEach(function(g){var c=d.attributes[g].append(a,b),e=a.scopeAttrib(g);Object.keys(new sa).forEach(function(a){b.set(e,"."+a,c[a])})});g("vert");g("frag");0<Object.keys(d.state).length&&(b(e,".dirty=true;"),b.exit(e,".dirty=true;"));b("a1(",a.shared.context,
",a0,",a.batchId,");")}function Pa(a){if("object"===typeof a&&!q(a)){for(var d=Object.keys(a),g=0;g<d.length;++g)if(F.isDynamic(a[d[g]]))return!0;return!1}}function va(a,d,g){function b(a,d){f.forEach(function(g){var b=c[g];F.isDynamic(b)&&(b=a.invoke(d,b),d(z,".",g,"=",b,";"))})}var c=d["static"][g];if(c&&Pa(c)){var e=a.global,f=Object.keys(c),l=!1,x=!1,h=!1,z=a.global.def("{}");f.forEach(function(d){var g=c[d];if(F.isDynamic(g))"function"===typeof g&&(g=c[d]=F.unbox(g)),d=m(g,null),l=l||d.thisDep,
h=h||d.propDep,x=x||d.contextDep;else{e(z,".",d,"=");switch(typeof g){case "number":e(g);break;case "string":e('"',g,'"');break;case "object":Array.isArray(g)&&e("[",g.join(),"]");break;default:e(a.link(g))}e(";")}});d.dynamic[g]=new F.DynamicVariable(4,{thisDep:l,contextDep:x,propDep:h,ref:z,append:b});delete d["static"][g]}}var sa=Q.Record,ea={add:32774,subtract:32778,"reverse subtract":32779};C.ext_blend_minmax&&(ea.min=32775,ea.max=32776);var g=C.angle_instanced_arrays,z=C.webgl_draw_buffers,
x={dirty:!0,profile:wa.profile},pa={},Ga=[],Aa={},Ba={};S("dither",3024);S("blend.enable",3042);O("blend.color","blendColor",[0,0,0,0]);O("blend.equation","blendEquationSeparate",[32774,32774]);O("blend.func","blendFuncSeparate",[1,0,1,0]);S("depth.enable",2929,!0);O("depth.func","depthFunc",513);O("depth.range","depthRange",[0,1]);O("depth.mask","depthMask",!0);O("colorMask","colorMask",[!0,!0,!0,!0]);S("cull.enable",2884);O("cull.face","cullFace",1029);O("frontFace","frontFace",2305);O("lineWidth",
"lineWidth",1);S("polygonOffset.enable",32823);O("polygonOffset.offset","polygonOffset",[0,0]);S("sample.alpha",32926);S("sample.enable",32928);O("sample.coverage","sampleCoverage",[1,!1]);S("stencil.enable",2960);O("stencil.mask","stencilMask",-1);O("stencil.func","stencilFunc",[519,0,-1]);O("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);O("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);S("scissor.enable",3089);O("scissor.box","scissor",[0,0,k.drawingBufferWidth,k.drawingBufferHeight]);
O("viewport","viewport",[0,0,k.drawingBufferWidth,k.drawingBufferHeight]);var Oa={gl:k,context:ka,strings:v,next:pa,current:x,draw:ra,elements:ia,buffer:H,shader:M,attributes:Q.state,uniforms:da,framebuffer:y,extensions:C,timer:oa,isBufferArgs:c},Ha={primTypes:A,compareFuncs:I,blendFuncs:r,blendEquations:ea,stencilOps:l,glTypes:B,orientationType:d};b.optional(function(){Oa.isArrayLike=q});z&&(Ha.backBuffer=[1029],Ha.drawBuffer=E(u.maxDrawbuffers,function(a){return 0===a?[0]:E(a,function(a){return 36064+
a})}));var Qa=0;return{next:pa,current:x,procs:function(){var a=Ca(),d=a.proc("poll"),g=a.proc("refresh"),b=a.block();d(b);g(b);var c=a.shared,e=c.gl,f=c.next,l=c.current;b(l,".dirty=false;");T(a,d);T(a,g,null,!0);var h=k.getExtension("angle_instanced_arrays"),m;h&&(m=a.link(h));for(var z=0;z<u.maxAttributes;++z){var n=g.def(c.attributes,"[",z,"]"),r=a.cond(n,".buffer");r.then(e,".enableVertexAttribArray(",z,");",e,".bindBuffer(",34962,",",n,".buffer.buffer);",e,".vertexAttribPointer(",z,",",n,".size,",
n,".type,",n,".normalized,",n,".stride,",n,".offset);")["else"](e,".disableVertexAttribArray(",z,");",e,".vertexAttrib4f(",z,",",n,".x,",n,".y,",n,".z,",n,".w);",n,".buffer=null;");g(r);h&&g(m,".vertexAttribDivisorANGLE(",z,",",n,".divisor);")}Object.keys(Aa).forEach(function(c){var x=Aa[c],h=b.def(f,".",c),m=a.block();m("if(",h,"){",e,".enable(",x,")}else{",e,".disable(",x,")}",l,".",c,"=",h,";");g(m);d("if(",h,"!==",l,".",c,"){",m,"}")});Object.keys(Ba).forEach(function(c){var h=Ba[c],m=x[c],z,
n,r=a.block();r(e,".",h,"(");q(m)?(h=m.length,z=a.global.def(f,".",c),n=a.global.def(l,".",c),r(E(h,function(a){return z+"["+a+"]"}),");",E(h,function(a){return n+"["+a+"]="+z+"["+a+"];"}).join("")),d("if(",E(h,function(a){return z+"["+a+"]!=="+n+"["+a+"]"}).join("||"),"){",r,"}")):(z=b.def(f,".",c),n=b.def(l,".",c),r(z,");",l,".",c,"=",z,";"),d("if(",z,"!==",n,"){",r,"}"));g(r)});return a.compile()}(),compile:function(a,d,g,b,c){var e=Ca();e.stats=e.link(c);Object.keys(d["static"]).forEach(function(a){va(e,
d,a)});p.forEach(function(d){va(e,a,d)});g=W(a,d,g,b,e);Ia(e,g);La(e,g);Ka(e,g);return e.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/check":21,"./util/codegen":23,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/loop":29}],9:[function(k,u,y){function c(c,f){this.id=w++;this.type=c;this.data=f}function f(c){if(0===c.length)return[];var h=c.charAt(0),b=c.charAt(c.length-1);if(1<c.length&&h===b&&('"'===h||"'"===h))return['"'+
c.substr(1,c.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(h=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(c))return f(c.substr(0,h.index)).concat(f(h[1])).concat(f(c.substr(h.index+h[0].length)));h=c.split(".");if(1===h.length)return['"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];c=[];for(b=0;b<h.length;++b)c=c.concat(f(h[b]));return c}function h(c){return"["+f(c).join("][")+"]"}var w=0;u.exports={DynamicVariable:c,define:function(e,f){return new c(e,h(f+""))},isDynamic:function(e){return"function"===
typeof e&&!e._reglType||e instanceof c},unbox:function(e,f){return"function"===typeof e?new c(0,e):e},accessor:h}},{}],10:[function(k,u,y){var c=k("./util/check"),f=k("./util/is-typed-array"),h=k("./util/is-ndarray"),w=k("./util/values"),e=k("./constants/primitives.json"),m=k("./constants/usage.json");u.exports=function(b,n,k,C){function v(b){this.id=B++;A[this.id]=this;this.buffer=b;this.primType=4;this.type=this.vertCount=0}function q(e,m,q,l,a,d,p){e.buffer.bind();if(m){var w=p;p||f(m)&&(!h(m)||
f(m.data))||(w=n.oes_element_index_uint?5125:5123);k._initBuffer(e.buffer,m,q,w,3)}else b.bufferData(34963,d,q),e.buffer.dtype=w||5121,e.buffer.usage=q,e.buffer.dimension=3,e.buffer.byteLength=d;w=p;if(!p){switch(e.buffer.dtype){case 5121:case 5120:w=5121;break;case 5123:case 5122:w=5123;break;case 5125:case 5124:w=5125;break;default:c.raise("unsupported type for element array")}e.buffer.dtype=w}e.type=w;c(5125!==w||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");
m=a;0>m&&(m=e.buffer.byteLength,5123===w?m>>=1:5125===w&&(m>>=2));e.vertCount=m;m=l;0>l&&(m=4,l=e.buffer.dimension,1===l&&(m=0),2===l&&(m=1),3===l&&(m=4));e.primType=m}function u(b){C.elementsCount--;c(null!==b.buffer,"must not double destroy elements");delete A[b.id];b.buffer.destroy();b.buffer=null}var A={},B=0,G={uint8:5121,uint16:5123};n.oes_element_index_uint&&(G.uint32=5125);v.prototype.bind=function(){this.buffer.bind()};var p=[];return{create:function(b,n){function p(d){if(d)if("number"===
typeof d)l(d),a.primType=4,a.vertCount=d|0,a.type=5121;else{var b=null,n=35044,k=-1,w=-1,r=0,v=0;if(Array.isArray(d)||f(d)||h(d))b=d;else if(c.type(d,"object","invalid arguments for elements"),"data"in d&&(b=d.data,c(Array.isArray(b)||f(b)||h(b),"invalid data for element buffer")),"usage"in d&&(c.parameter(d.usage,m,"invalid element buffer usage"),n=m[d.usage]),"primitive"in d&&(c.parameter(d.primitive,e,"invalid element buffer primitive"),k=e[d.primitive]),"count"in d&&(c("number"===typeof d.count&&
0<=d.count,"invalid vertex count for elements"),w=d.count|0),"type"in d&&(c.parameter(d.type,G,"invalid buffer type"),v=G[d.type]),"length"in d)r=d.length|0;else if(r=w,5123===v||5122===v)r*=2;else if(5125===v||5124===v)r*=4;q(a,b,n,k,w,r,v)}else l(),a.primType=4,a.vertCount=0,a.type=5121;return p}var l=k.create(null,34963,!0),a=new v(l._buffer);C.elementsCount++;p(b);p._reglType="elements";p._elements=a;p.subdata=function(a,b){l.subdata(a,b);return p};p.destroy=function(){u(a)};return p},createStream:function(b){var c=
p.pop();c||(c=new v(k.create(null,34963,!0,!1)._buffer));q(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){p.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof v?b._elements:null},clear:function(){w(A).forEach(u)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/check":21,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/values":33}],11:[function(k,u,y){var c=k("./util/check");u.exports=function(f,h){function k(b){c.type(b,"string",
"extension name must be string");b=b.toLowerCase();var h;try{h=e[b]=f.getExtension(b)}catch(m){}return!!h}for(var e={},m=0;m<h.extensions.length;++m){var b=h.extensions[m];if(!k(b))return h.onDestroy(),h.onDone('"'+b+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}h.optionalExtensions.forEach(k);return{extensions:e,restore:function(){Object.keys(e).forEach(function(b){if(!k(b))throw Error("(regl): error restoring extension "+b);})}}}},
{"./util/check":21}],12:[function(k,u,y){var c=k("./util/check"),f=k("./util/values"),h=k("./util/extend"),w=[6408],e=[];e[6408]=4;var m=[];m[5121]=1;m[5126]=4;m[36193]=2;var b=[32854,32855,36194,35907,34842,34843,34836],n={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"};u.exports=function(k,u,v,q,F,A){function B(a,d,b){this.target=a;this.texture=d;this.renderbuffer=b;var c=a=0;d?(a=d.width,c=d.height):b&&(a=
b.width,c=b.height);this.width=a;this.height=c}function G(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function p(a,d,b){if(a){if(a.texture){a=a.texture._texture;var e=Math.max(1,a.height);c(Math.max(1,a.width)===d&&e===b,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,c(a.width===d&&a.height===b,"inconsistent width/height for renderbuffer");a.refCount+=1}}function r(a,d){d&&(d.texture?k.framebufferTexture2D(36160,
a,d.target,d.texture._texture.texture,0):k.framebufferRenderbuffer(36160,a,36161,d.renderbuffer._renderbuffer.renderbuffer))}function N(a){var d=3553,b=null,e=null,f=a;"object"===typeof a&&(f=a.data,"target"in a&&(d=a.target|0));c.type(f,"function","invalid attachment data");a=f._reglType;"texture2d"===a?(b=f,c(3553===d)):"textureCube"===a?(b=f,c(34069<=d&&34075>d,"invalid cube map target")):"renderbuffer"===a?(e=f,d=36161):c.raise("invalid regl object for attachment");return new B(d,b,e)}function I(a,
d,b,c,e){if(b)return a=q.create2D({width:a,height:d,format:c,type:e}),a._texture.refCount=0,new B(3553,a,null);a=F.create({width:a,height:d,format:c});a._renderbuffer.refCount=0;return new B(36161,null,a)}function l(a){return a&&(a.texture||a.renderbuffer)}function a(a,d,b){a&&(a.texture?a.texture.resize(d,b):a.renderbuffer&&a.renderbuffer.resize(d,b))}function d(){this.id=Y++;da[this.id]=this;this.framebuffer=k.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=
this.stencilAttachment=this.depthAttachment=null}function K(a){a.colorAttachments.forEach(G);G(a.depthAttachment);G(a.stencilAttachment);G(a.depthStencilAttachment)}function V(a){var d=a.framebuffer;c(d,"must not double destroy framebuffer");k.deleteFramebuffer(d);a.framebuffer=null;A.framebufferCount--;delete da[a.id]}function Ma(a){var d;k.bindFramebuffer(36160,a.framebuffer);var b=a.colorAttachments;for(d=0;d<b.length;++d)r(36064+d,b[d]);for(d=b.length;d<v.maxColorAttachments;++d)k.framebufferTexture2D(36160,
36064+d,3553,null,0);k.framebufferTexture2D(36160,33306,3553,null,0);k.framebufferTexture2D(36160,36096,3553,null,0);k.framebufferTexture2D(36160,36128,3553,null,0);r(36096,a.depthAttachment);r(36128,a.stencilAttachment);r(33306,a.depthStencilAttachment);a=k.checkFramebufferStatus(36160);36053!==a&&c.raise("framebuffer configuration not supported, status = "+n[a]);k.bindFramebuffer(36160,y.next);y.cur=y.next;k.getError()}function ga(f,q){function n(a,d){var f;c(y.next!==k,"can not update framebuffer which is currently in use");
var h=u.webgl_draw_buffers,q=0,r=0,V=!0,B=!0;f=null;var A=!0,E="rgba",F="uint8",G=1,ga=null,Q=null,M=null,da=!1;if("number"===typeof a)q=a|0,r=d|0||q;else if(a){c.type(a,"object","invalid arguments for framebuffer");"shape"in a?(r=a.shape,c(Array.isArray(r)&&2<=r.length,"invalid shape for framebuffer"),q=r[0],r=r[1]):("radius"in a&&(q=r=a.radius),"width"in a&&(q=a.width),"height"in a&&(r=a.height));if("color"in a||"colors"in a)f=a.color||a.colors,Array.isArray(f)&&c(1===f.length||h,"multiple render targets not supported");
if(!f){"colorCount"in a&&(G=a.colorCount|0,c(0<G,"invalid color buffer count"));"colorTexture"in a&&(A=!!a.colorTexture,E="rgba4");if("colorType"in a){F=a.colorType;if(A)c(u.oes_texture_float||!("float"===F||"float32"===F),"you must enable OES_texture_float in order to use floating point framebuffer objects"),c(u.oes_texture_half_float||!("half float"===F||"float16"===F),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===F||"float16"===
F)c(u.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),E="rgba16f";else if("float"===F||"float32"===F)c(u.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),E="rgba32f";c.oneOf(F,J,"invalid color type")}if("colorFormat"in a)if(E=a.colorFormat,0<=H.indexOf(E))A=!0;else if(0<=ia.indexOf(E))A=!1;else if(A)c.oneOf(a.colorFormat,H,"invalid color format for texture");else c.oneOf(a.colorFormat,
ia,"invalid color format for renderbuffer")}if("depthTexture"in a||"depthStencilTexture"in a)da=!(!a.depthTexture&&!a.depthStencilTexture),c(!da||u.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in a&&("boolean"===typeof a.depth?V=a.depth:(ga=a.depth,B=!1));"stencil"in a&&("boolean"===typeof a.stencil?B=a.stencil:(Q=a.stencil,V=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?V=B=a.depthStencil:(M=a.depthStencil,B=V=!1))}else q=r=1;var Y=h=null,T=null,U=null;
if(Array.isArray(f))h=f.map(N);else if(f)h=[N(f)];else for(h=Array(G),f=0;f<G;++f)h[f]=I(q,r,A,E,F);c(u.webgl_draw_buffers||1>=h.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");c(h.length<=v.maxColorAttachments,"too many color attachments, not supported");q=q||h[0].width;r=r||h[0].height;ga?Y=N(ga):V&&!B&&(Y=I(q,r,da,"depth","uint32"));Q?T=N(Q):B&&!V&&(T=I(q,r,!1,"stencil","uint8"));M?U=N(M):!ga&&!Q&&B&&V&&(U=I(q,r,da,"depth stencil","depth stencil"));
c(1>=!!ga+!!Q+!!M,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");V=null;for(f=0;f<h.length;++f)p(h[f],q,r),c(!h[f]||h[f].texture&&0<=w.indexOf(h[f].texture._texture.format)||h[f].renderbuffer&&0<=b.indexOf(h[f].renderbuffer._renderbuffer.format),"framebuffer color attachment "+f+" is invalid"),h[f]&&h[f].texture&&(B=e[h[f].texture._texture.format]*m[h[f].texture._texture.type],null===V?V=B:c(V===B,"all color attachments much have the same number of bits per pixel."));
p(Y,q,r);c(!Y||Y.texture&&6402===Y.texture._texture.format||Y.renderbuffer&&33189===Y.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");p(T,q,r);c(!T||T.renderbuffer&&36168===T.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");p(U,q,r);c(!U||U.texture&&34041===U.texture._texture.format||U.renderbuffer&&34041===U.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");K(k);k.width=q;k.height=
r;k.colorAttachments=h;k.depthAttachment=Y;k.stencilAttachment=T;k.depthStencilAttachment=U;n.color=h.map(l);n.depth=l(Y);n.stencil=l(T);n.depthStencil=l(U);n.width=k.width;n.height=k.height;Ma(k);return n}var k=new d;A.framebufferCount++;n(f,q);return h(n,{resize:function(d,b){c(y.next!==k,"can not resize a framebuffer which is currently in use");var e=d|0,f=b|0||e;if(e===k.width&&f===k.height)return n;for(var h=k.colorAttachments,l=0;l<h.length;++l)a(h[l],e,f);a(k.depthAttachment,e,f);a(k.stencilAttachment,
e,f);a(k.depthStencilAttachment,e,f);k.width=n.width=e;k.height=n.height=f;Ma(k);return n},_reglType:"framebuffer",_framebuffer:k,destroy:function(){V(k);K(k)},bind:function(a){y.setFBO({framebuffer:n},a)}})}var y={cur:null,next:null,dirty:!1,setFBO:null},H=["rgba"],ia=["rgba4","rgb565","rgb5 a1"];u.ext_srgb&&ia.push("srgba");u.ext_color_buffer_half_float&&ia.push("rgba16f","rgb16f");u.webgl_color_buffer_float&&ia.push("rgba32f");var J=["uint8"];u.oes_texture_half_float&&J.push("half float","float16");
u.oes_texture_float&&J.push("float","float32");var Y=0,da={};return h(y,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof d)?a:null},create:ga,createCube:function(a){function d(a){var e;c(0>b.indexOf(y.next),"can not update framebuffer which is currently in use");var f=u.webgl_draw_buffers,l={color:null},m=0,k=null;e="rgba";var n="uint8",p=1;if("number"===typeof a)m=a|0;else if(a){c.type(a,"object","invalid arguments for framebuffer");
"shape"in a?(m=a.shape,c(Array.isArray(m)&&2<=m.length,"invalid shape for framebuffer"),c(m[0]===m[1],"cube framebuffer must be square"),m=m[0]):("radius"in a&&(m=a.radius|0),"width"in a?(m=a.width|0,"height"in a&&c(a.height===m,"must be square")):"height"in a&&(m=a.height|0));if("color"in a||"colors"in a)k=a.color||a.colors,Array.isArray(k)&&c(1===k.length||f,"multiple render targets not supported");k||("colorCount"in a&&(p=a.colorCount|0,c(0<p,"invalid color buffer count")),"colorType"in a&&(c.oneOf(a.colorType,
J,"invalid color type"),n=a.colorType),"colorFormat"in a&&(e=a.colorFormat,c.oneOf(a.colorFormat,H,"invalid color format for texture")));"depth"in a&&(l.depth=a.depth);"stencil"in a&&(l.stencil=a.stencil);"depthStencil"in a&&(l.depthStencil=a.depthStencil)}else m=1;if(k)if(Array.isArray(k))for(a=[],e=0;e<k.length;++e)a[e]=k[e];else a=[k];else for(a=Array(p),k={radius:m,format:e,type:n},e=0;e<p;++e)a[e]=q.createCube(k);l.color=Array(a.length);for(e=0;e<a.length;++e)p=a[e],c("function"===typeof p&&
"textureCube"===p._reglType,"invalid cube map"),m=m||p.width,c(p.width===m&&p.height===m,"invalid cube map shape"),l.color[e]={target:34069,data:a[e]};for(e=0;6>e;++e){for(p=0;p<a.length;++p)l.color[p].target=34069+e;0<e&&(l.depth=b[0].depth,l.stencil=b[0].stencil,l.depthStencil=b[0].depthStencil);if(b[e])b[e](l);else b[e]=ga(l)}return h(d,{width:m,height:m,color:a})}var b=Array(6);d(a);return h(d,{faces:b,resize:function(a){var e=a|0;c(0<e&&e<=v.maxCubeMapSize,"invalid radius for cube fbo");if(e===
d.width)return d;var f=d.color;for(a=0;a<f.length;++a)f[a].resize(e);for(a=0;6>a;++a)b[a].resize(e);d.width=d.height=e;return d},_reglType:"framebufferCube",destroy:function(){b.forEach(function(a){a.destroy()})}})},clear:function(){f(da).forEach(V)},restore:function(){f(da).forEach(function(a){a.framebuffer=k.createFramebuffer();Ma(a)})}})}},{"./util/check":21,"./util/extend":24,"./util/values":33}],13:[function(k,u,y){u.exports=function(c,f){var h=1;f.ext_texture_filter_anisotropic&&(h=c.getParameter(34047));
var k=1,e=1;f.webgl_draw_buffers&&(k=c.getParameter(34852),e=c.getParameter(36063));return{colorBits:[c.getParameter(3410),c.getParameter(3411),c.getParameter(3412),c.getParameter(3413)],depthBits:c.getParameter(3414),stencilBits:c.getParameter(3415),subpixelBits:c.getParameter(3408),extensions:Object.keys(f).filter(function(c){return!!f[c]}),maxAnisotropic:h,maxDrawbuffers:k,maxColorAttachments:e,pointSizeDims:c.getParameter(33901),lineWidthDims:c.getParameter(33902),maxViewportDims:c.getParameter(3386),
maxCombinedTextureUnits:c.getParameter(35661),maxCubeMapSize:c.getParameter(34076),maxRenderbufferSize:c.getParameter(34024),maxTextureUnits:c.getParameter(34930),maxTextureSize:c.getParameter(3379),maxAttributes:c.getParameter(34921),maxVertexUniforms:c.getParameter(36347),maxVertexTextureUnits:c.getParameter(35660),maxVaryingVectors:c.getParameter(36348),maxFragmentUniforms:c.getParameter(36349),glsl:c.getParameter(35724),renderer:c.getParameter(7937),vendor:c.getParameter(7936),version:c.getParameter(7938)}}},
{}],14:[function(k,u,y){var c=k("./util/check"),f=k("./util/is-typed-array");u.exports=function(h,k,e,m,b,n){function u(v){var q;null===k.next?(c(b.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),q=5121):(c(null!==k.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),q=k.next.colorAttachments[0].texture._texture.type,n.oes_texture_float?c(5121===q||5126===q,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):
c(5121===q,"Reading from a framebuffer is only allowed for the type 'uint8'"));var F=0,A=0,B=m.framebufferWidth,E=m.framebufferHeight,p=null;f(v)?p=v:v&&(c.type(v,"object","invalid arguments to regl.read()"),F=v.x|0,A=v.y|0,c(0<=F&&F<m.framebufferWidth,"invalid x offset for regl.read"),c(0<=A&&A<m.framebufferHeight,"invalid y offset for regl.read"),B=(v.width||m.framebufferWidth-F)|0,E=(v.height||m.framebufferHeight-A)|0,p=v.data||null);p&&(5121===q?c(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):
5126===q&&c(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));c(0<B&&B+F<=m.framebufferWidth,"invalid width for read pixels");c(0<E&&E+A<=m.framebufferHeight,"invalid height for read pixels");e();v=B*E*4;p||(5121===q?p=new Uint8Array(v):5126===q&&(p=p||new Float32Array(v)));c.isTypedArray(p,"data buffer for regl.read() must be a typedarray");c(p.byteLength>=v,"data buffer for regl.read() too small");h.pixelStorei(3333,4);h.readPixels(F,A,B,
E,6408,q,p);return p}function C(b){var c;k.setFBO({framebuffer:b.framebuffer},function(){c=u(b)});return c}return function(b){return b&&"framebuffer"in b?C(b):u(b)}}},{"./util/check":21,"./util/is-typed-array":28}],15:[function(k,u,y){var c=k("./util/check"),f=k("./util/values"),h=[];h[32854]=2;h[32855]=2;h[36194]=2;h[33189]=2;h[36168]=1;h[34041]=4;h[35907]=4;h[34836]=16;h[34842]=8;h[34843]=6;u.exports=function(k,e,m,b,n){function u(b){this.id=F++;this.refCount=1;this.renderbuffer=b;this.format=32854;
this.height=this.width=0;n.profile&&(this.stats={size:0})}function C(e){var f=e.renderbuffer;c(f,"must not double destroy renderbuffer");k.bindRenderbuffer(36161,null);k.deleteRenderbuffer(f);e.renderbuffer=null;e.refCount=0;delete A[e.id];b.renderbufferCount--}var v={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(v.srgba=35907);e.ext_color_buffer_half_float&&(v.rgba16f=34842,v.rgb16f=34843);e.webgl_color_buffer_float&&(v.rgba32f=34836);var q=
[];Object.keys(v).forEach(function(b){q[v[b]]=b});var F=0,A={};u.prototype.decRef=function(){0>=--this.refCount&&C(this)};n.profile&&(b.getTotalRenderbufferSize=function(){var b=0;Object.keys(A).forEach(function(c){b+=A[c].stats.size});return b});return{create:function(e,f){function p(b,e){var f=0,a=0,d=32854;"object"===typeof b&&b?("shape"in b?(a=b.shape,c(Array.isArray(a)&&2<=a.length,"invalid renderbuffer shape"),f=a[0]|0,a=a[1]|0):("radius"in b&&(f=a=b.radius|0),"width"in b&&(f=b.width|0),"height"in
b&&(a=b.height|0)),"format"in b&&(c.parameter(b.format,v,"invalid renderbuffer format"),d=v[b.format])):"number"===typeof b?(f=b|0,a="number"===typeof e?e|0:f):b?c.raise("invalid arguments to renderbuffer constructor"):f=a=1;c(0<f&&0<a&&f<=m.maxRenderbufferSize&&a<=m.maxRenderbufferSize,"invalid renderbuffer size");if(f!==r.width||a!==r.height||d!==r.format)return p.width=r.width=f,p.height=r.height=a,r.format=d,k.bindRenderbuffer(36161,r.renderbuffer),k.renderbufferStorage(36161,d,f,a),n.profile&&
(r.stats.size=h[r.format]*r.width*r.height),p.format=q[r.format],p}var r=new u(k.createRenderbuffer());A[r.id]=r;b.renderbufferCount++;p(e,f);p.resize=function(b,e){var f=b|0,a=e|0||f;if(f===r.width&&a===r.height)return p;c(0<f&&0<a&&f<=m.maxRenderbufferSize&&a<=m.maxRenderbufferSize,"invalid renderbuffer size");p.width=r.width=f;p.height=r.height=a;k.bindRenderbuffer(36161,r.renderbuffer);k.renderbufferStorage(36161,r.format,f,a);n.profile&&(r.stats.size=h[r.format]*r.width*r.height);return p};p._reglType=
"renderbuffer";p._renderbuffer=r;n.profile&&(p.stats=r.stats);p.destroy=function(){r.decRef()};return p},clear:function(){f(A).forEach(C)},restore:function(){f(A).forEach(function(b){b.renderbuffer=k.createRenderbuffer();k.bindRenderbuffer(36161,b.renderbuffer);k.renderbufferStorage(36161,b.format,b.width,b.height)});k.bindRenderbuffer(36161,null)}}}},{"./util/check":21,"./util/values":33}],16:[function(k,u,y){var c=k("./util/check"),f=k("./util/values");u.exports=function(h,k,e,m){function b(b,c,
e,f){this.name=b;this.id=c;this.location=e;this.info=f}function n(b,c){for(var e=0;e<b.length;++e)if(b[e].id===c.id){b[e].location=c.location;return}b.push(c)}function u(b,e,f){var m=35632===b?q:F,l=m[e];if(!l){var a=k.str(e),l=h.createShader(b);h.shaderSource(l,a);h.compileShader(l);c.shaderError(h,l,a,b,f);m[e]=l}return l}function C(b,c){this.id=G++;this.fragId=b;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];m.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function v(e,
f){var q,v;q=u(35632,e.fragId);v=u(35633,e.vertId);var l=e.program=h.createProgram();h.attachShader(l,q);h.attachShader(l,v);h.linkProgram(l);c.linkError(h,l,k.str(e.fragId),k.str(e.vertId),f);var a=h.getProgramParameter(l,35718);m.profile&&(e.stats.uniformsCount=a);var d=e.uniforms;for(q=0;q<a;++q)if(v=h.getActiveUniform(l,q))if(1<v.size)for(var K=0;K<v.size;++K){var V=v.name.replace("[0]","["+K+"]");n(d,new b(V,k.id(V),h.getUniformLocation(l,V),v))}else n(d,new b(v.name,k.id(v.name),h.getUniformLocation(l,
v.name),v));a=h.getProgramParameter(l,35721);m.profile&&(e.stats.attributesCount=a);d=e.attributes;for(q=0;q<a;++q)(v=h.getActiveAttrib(l,q))&&n(d,new b(v.name,k.id(v.name),h.getAttribLocation(l,v.name),v))}var q={},F={},A={},B=[],G=0;m.profile&&(e.getMaxUniformsCount=function(){var b=0;B.forEach(function(c){c.stats.uniformsCount>b&&(b=c.stats.uniformsCount)});return b},e.getMaxAttributesCount=function(){var b=0;B.forEach(function(c){c.stats.attributesCount>b&&(b=c.stats.attributesCount)});return b});
return{clear:function(){var b=h.deleteShader.bind(h);f(q).forEach(b);q={};f(F).forEach(b);F={};B.forEach(function(b){h.deleteProgram(b.program)});B.length=0;A={};e.shaderCount=0},program:function(b,f,h){c.command(0<=b,"missing vertex shader",h);c.command(0<=f,"missing fragment shader",h);var m=A[f];m||(m=A[f]={});var l=m[b];l||(l=new C(f,b),e.shaderCount++,v(l,h),m[b]=l,B.push(l));return l},restore:function(){q={};F={};for(var b=0;b<B.length;++b)v(B[b])},shader:u,frag:-1,vert:-1}}},{"./util/check":21,
"./util/values":33}],17:[function(k,u,y){u.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(k,u,y){u.exports=function(){var c={"":0},f=[""];return{id:function(h){var k=c[h];if(k)return k;k=c[h]=f.length;f.push(h);return k},str:function(c){return f[c]}}}},{}],19:[function(k,u,y){function c(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function f(a){return Array.isArray(a)&&
0!==a.length&&A(a[0])?!0:!1}function h(a){return Object.prototype.toString.call(a)}function w(a){if(!a)return!1;var b=h(a);return 0<=I.indexOf(b)?!0:c(a)||f(a)||v(a)}function e(a,b){36193===a.type?(a.data=F(b),q.freeType(b)):a.data=b}function m(b,c,e,f,h,m){b="undefined"!==typeof a[b]?a[b]:N[b]*l[c];m&&(b*=6);if(h){for(f=0;1<=e;)f+=b*e*e,e/=2;return f}return b*e*f}var b=k("./util/check"),n=k("./util/extend"),E=k("./util/values"),C=k("./util/is-typed-array"),v=k("./util/is-ndarray"),q=k("./util/pool"),
F=k("./util/to-half-float"),A=k("./util/is-array-like"),B=k("./util/flatten");y=k("./constants/arraytypes.json");var G=k("./constants/arraytypes.json"),p=[9984,9986,9985,9987],r=[0,6409,6410,6407,6408],N={};N[6409]=N[6406]=N[6402]=1;N[34041]=N[6410]=2;N[6407]=N[35904]=3;N[6408]=N[35906]=4;var I=Object.keys(y).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),l=[];l[5121]=1;l[5126]=4;l[36193]=2;l[5123]=2;l[5125]=4;var a=
[];a[32854]=2;a[32855]=2;a[36194]=2;a[34041]=4;a[33776]=.5;a[33777]=.5;a[33778]=1;a[33779]=1;a[35986]=.5;a[35987]=1;a[34798]=1;a[35840]=.5;a[35841]=.25;a[35842]=.5;a[35843]=.25;a[36196]=.5;u.exports=function(a,l,k,u,ga,I,H){function y(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function J(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;
a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function Y(a,d){if("object"===typeof d&&d){"premultiplyAlpha"in d&&(b.type(d.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=d.premultiplyAlpha);"flipY"in d&&(b.type(d.flipY,"boolean","invalid texture flip"),a.flipY=d.flipY);"alignment"in d&&(b.oneOf(d.alignment,[1,2,4,8],"invalid texture unpack alignment"),
a.unpackAlignment=d.alignment);"colorSpace"in d&&(b.parameter(d.colorSpace,U,"invalid colorSpace"),a.colorSpace=U[d.colorSpace]);if("type"in d){var c=d.type;b(l.oes_texture_float||!("float"===c||"float32"===c),"you must enable the OES_texture_float extension in order to use floating point textures.");b(l.oes_texture_half_float||!("half float"===c||"float16"===c),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");b(l.webgl_depth_texture||!("uint16"===
c||"uint32"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");b.parameter(c,R,"invalid texture type");a.type=R[c]}var e=a.width,f=a.height,h=a.channels,c=!1;"shape"in d?(b(Array.isArray(d.shape)&&2<=d.shape.length,"shape must be an array"),e=d.shape[0],f=d.shape[1],3===d.shape.length&&(h=d.shape[2],b(0<h&&4>=h,"invalid number of channels"),c=!0),b(0<=e&&e<=k.maxTextureSize,"invalid width"),b(0<=f&&f<=k.maxTextureSize,"invalid height")):
("radius"in d&&(e=f=d.radius,b(0<=e&&e<=k.maxTextureSize,"invalid radius")),"width"in d&&(e=d.width,b(0<=e&&e<=k.maxTextureSize,"invalid width")),"height"in d&&(f=d.height,b(0<=f&&f<=k.maxTextureSize,"invalid height")),"channels"in d&&(h=d.channels,b(0<h&&4>=h,"invalid number of channels"),c=!0));a.width=e|0;a.height=f|0;a.channels=h|0;e=!1;"format"in d&&(e=d.format,b(l.webgl_depth_texture||!("depth"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),
b.parameter(e,aa,"invalid texture format"),f=a.internalformat=aa[e],a.format=Ja[f],e in R&&!("type"in d)&&(a.type=R[e]),e in fa&&(a.compressed=!0),e=!0);!c&&e?a.channels=N[a.format]:c&&!e?a.channels!==r[a.format]&&(a.format=a.internalformat=r[a.channels]):e&&c&&b(a.channels===N[a.format],"number of channels inconsistent with specified format")}}function da(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}
function Q(){y.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function M(a,d){var l=null;w(d)?l=d:d&&(b.type(d,"object","invalid pixel data type"),Y(a,d),"x"in d&&(a.xOffset=d.x|0),"y"in d&&(a.yOffset=d.y|0),w(d.data)&&(l=d.data));b(!a.compressed||l instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(d.copy){b(!l,"can not specify copy and data field for the same texture");var m=ga.viewportWidth,n=ga.viewportHeight;
a.width=a.width||m-a.xOffset;a.height=a.height||n-a.yOffset;a.needsCopy=!0;b(0<=a.xOffset&&a.xOffset<m&&0<=a.yOffset&&a.yOffset<n&&0<a.width&&a.width<=m&&0<a.height&&a.height<=n,"copy texture read out of bounds")}else if(!l)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(C(l))a.channels=a.channels||4,a.data=l,"type"in d||5121!==a.type||(a.type=G[Object.prototype.toString.call(l)]|0);else if(c(l)){a.channels=a.channels||4;m=l;n=m.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:n=
q.allocType(a.type,n);n.set(m);a.data=n;break;case 36193:a.data=F(m);break;default:b.raise("unsupported texture type, must specify a typed array")}a.alignment=1;a.needsFree=!0}else if(v(l)){m=l.data;Array.isArray(m)||5121!==a.type||(a.type=G[Object.prototype.toString.call(m)]|0);var n=l.shape,p=l.stride,u,K,E,H;3===n.length?(E=n[2],H=p[2]):(b(2===n.length,"invalid ndarray pixel data, must be 2 or 3D"),H=E=1);u=n[0];K=n[1];n=p[0];p=p[1];a.alignment=1;a.width=u;a.height=K;a.channels=E;a.format=a.internalformat=
r[E];a.needsFree=!0;u=H;l=l.offset;E=a.width;H=a.height;K=a.channels;for(var t=q.allocType(36193===a.type?5126:a.type,E*H*K),D=0,J=0;J<H;++J)for(var I=0;I<E;++I)for(var y=0;y<K;++y)t[D++]=m[n*I+p*J+u*y+l];e(a,t)}else if("[object HTMLCanvasElement]"===h(l)||"[object CanvasRenderingContext2D]"===h(l))"[object HTMLCanvasElement]"===h(l)?a.element=l:a.element=l.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if("[object HTMLImageElement]"===h(l))a.element=l,a.width=l.naturalWidth,
a.height=l.naturalHeight,a.channels=4;else if("[object HTMLVideoElement]"===h(l))a.element=l,a.width=l.videoWidth,a.height=l.videoHeight,a.channels=4;else if(f(l)){m=a.width||l[0].length;n=a.height||l.length;p=a.channels;p=A(l[0][0])?p||l[0][0].length:p||1;u=B.shape(l);E=1;for(H=0;H<u.length;++H)E*=u[H];E=q.allocType(36193===a.type?5126:a.type,E);B.flatten(l,u,"",E);e(a,E);a.alignment=1;a.width=m;a.height=n;a.channels=p;a.format=a.internalformat=r[p];a.needsFree=!0}5126===a.type?b(0<=k.extensions.indexOf("oes_texture_float"),
"oes_texture_float extension not enabled"):36193===a.type&&b(0<=k.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}function ra(b,c,e,f,l){var h=b.element,m=b.data,k=b.internalformat,q=b.format,n=b.type,t=b.width,p=b.height;da(b);h?a.texSubImage2D(c,l,e,f,q,n,h):b.compressed?a.compressedTexSubImage2D(c,l,e,f,k,t,p,m):b.needsCopy?(u(),a.copyTexSubImage2D(c,l,e,f,b.xOffset,b.yOffset,t,p)):a.texSubImage2D(c,l,e,f,t,p,q,n,m)}function ka(){return Ka.pop()||new Q}
function oa(a){a.needsFree&&q.freeType(a.data);Q.call(a);Ka.push(a)}function wa(){y.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function ba(a,b,d){var c=a.images[0]=ka();a.mipmask=1;c.width=a.width=b;c.height=a.height=d;c.channels=a.channels=4}function S(a,d){var c=null;if(w(d))c=a.images[0]=ka(),J(c,a),M(c,d),a.mipmask=1;else if(Y(a,d),Array.isArray(d.mipmap))for(var e=d.mipmap,f=0;f<e.length;++f)c=a.images[f]=ka(),J(c,a),c.width>>=f,c.height>>=f,M(c,e[f]),
a.mipmask|=1<<f;else c=a.images[0]=ka(),J(c,a),M(c,d),a.mipmask=1;J(a,a.images[0]);(a.compressed&&33776===a.internalformat||33777===a.internalformat||33778===a.internalformat||33779===a.internalformat)&&b(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function O(b,c){for(var e=b.images,f=0;f<e.length&&e[f];++f){var l=e[f],h=c,m=f,k=l.element,q=l.data,n=l.internalformat,t=l.format,p=l.type,r=l.width,v=l.height;da(l);
k?a.texImage2D(h,m,t,t,p,k):l.compressed?a.compressedTexImage2D(h,m,n,r,v,0,q):l.needsCopy?(u(),a.copyTexImage2D(h,m,t,l.xOffset,l.yOffset,r,v,0)):a.texImage2D(h,m,t,r,v,0,t,p,q)}}function Ca(){var a=La.pop()||new wa;y.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ta(a){for(var b=a.images,d=0;d<b.length;++d)b[d]&&oa(b[d]),b[d]=null;La.push(a)}function xa(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=
4352}function ca(a,d){if("min"in d){var c=d.min;b.parameter(c,T);a.minFilter=T[c];0<=p.indexOf(a.minFilter)&&(a.genMipmaps=!0)}"mag"in d&&(c=d.mag,b.parameter(c,Z),a.magFilter=Z[c]);var c=a.wrapS,e=a.wrapT;if("wrap"in d){var f=d.wrap;"string"===typeof f?(b.parameter(f,W),c=e=W[f]):Array.isArray(f)&&(b.parameter(f[0],W),b.parameter(f[1],W),c=W[f[0]],e=W[f[1]])}else"wrapS"in d&&(c=d.wrapS,b.parameter(c,W),c=W[c]),"wrapT"in d&&(e=d.wrapT,b.parameter(e,W),e=W[e]);a.wrapS=c;a.wrapT=e;"anisotropic"in d&&
(c=d.anisotropic,b("number"===typeof c&&1<=c&&c<=k.maxAnisotropic,"aniso samples must be between 1 and "),a.anisotropic=d.anisotropic);if("mipmap"in d){c=!1;switch(typeof d.mipmap){case "string":b.parameter(d.mipmap,ya,"invalid mipmap hint");a.mipmapHint=ya[d.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=d.mipmap;break;case "object":b(Array.isArray(d.mipmap),"invalid mipmap type");a.genMipmaps=!1;c=!0;break;default:b.raise("invalid mipmap type")}!c||"min"in d||(a.minFilter=9984)}}
function ja(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);l.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function la(b){y.call(this);this.mipmask=0;this.internalformat=6408;this.id=Pa++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new xa;H.profile&&(this.stats=
{size:0})}function ma(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function na(){var b=ea[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function qa(c){var e=c.texture;b(e,"must not double destroy texture");var f=c.unit,l=c.target;0<=f&&(a.activeTexture(33984+f),a.bindTexture(l,null),ea[f]=null);a.deleteTexture(e);c.texture=null;c.params=null;c.pixels=null;c.refCount=0;delete va[c.id];I.textureCount--}var ya={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
W={repeat:10497,clamp:33071,mirror:33648},Z={nearest:9728,linear:9729},T=n({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},Z),U={none:0,browser:37444},R={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},aa={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},fa={};l.ext_srgb&&(aa.srgb=35904,aa.srgba=35906);l.oes_texture_float&&(R.float32=R["float"]=5126);
l.oes_texture_half_float&&(R.float16=R["half float"]=36193);l.webgl_depth_texture&&(n(aa,{depth:6402,"depth stencil":34041}),n(R,{uint16:5123,uint32:5125,"depth stencil":34042}));l.webgl_compressed_texture_s3tc&&n(fa,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});l.webgl_compressed_texture_atc&&n(fa,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});l.webgl_compressed_texture_pvrtc&&n(fa,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,
"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});l.webgl_compressed_texture_etc1&&(fa["rgb etc1"]=36196);var za=Array.prototype.slice.call(a.getParameter(34467));Object.keys(fa).forEach(function(a){var b=fa[a];0<=za.indexOf(b)&&(aa[a]=b)});var ha=Object.keys(aa);k.textureFormats=ha;var ua=[];Object.keys(aa).forEach(function(a){ua[aa[a]]=a});var Da=[];Object.keys(R).forEach(function(a){Da[R[a]]=a});var Fa=[];Object.keys(Z).forEach(function(a){Fa[Z[a]]=a});var Ia=[];Object.keys(T).forEach(function(a){Ia[T[a]]=
a});var Ea=[];Object.keys(W).forEach(function(a){Ea[W[a]]=a});var Ja=ha.reduce(function(a,b){var d=aa[b];6409===d||6406===d||6409===d||6410===d||6402===d||34041===d?a[d]=d:32855===d||0<=b.indexOf("rgba")?a[d]=6408:a[d]=6407;return a},{}),Ka=[],La=[],Pa=0,va={},sa=k.maxTextureUnits,ea=Array(sa).map(function(){return null});n(la.prototype,{bind:function(){this.bindCount+=1;var c=this.unit;if(0>c){for(var e=0;e<sa;++e){var f=ea[e];if(f){if(0<f.bindCount)continue;f.unit=-1}ea[e]=this;c=e;break}c>=sa&&
b.raise("insufficient number of texture units");H.profile&&I.maxTextureUnits<c+1&&(I.maxTextureUnits=c+1);this.unit=c;a.activeTexture(33984+c);a.bindTexture(this.target,this.texture)}return c},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&qa(this)}});H.profile&&(I.getTotalTextureSize=function(){var a=0;Object.keys(va).forEach(function(b){a+=va[b].stats.size});return a});return{create2D:function(c,e){function f(a,d){var c=l.texInfo;xa.call(c);var e=Ca();"number"===typeof a?
"number"===typeof d?ba(e,a|0,d|0):ba(e,a|0,a|0):a?(b.type(a,"object","invalid arguments to regl.texture"),ca(c,a),S(e,a)):ba(e,1,1);c.genMipmaps&&(e.mipmask=(e.width<<1)-1);l.mipmask=e.mipmask;J(l,e);b.texture2D(c,e,k);l.internalformat=e.internalformat;f.width=e.width;f.height=e.height;ma(l);O(e,3553);ja(c,3553);na();ta(e);H.profile&&(l.stats.size=m(l.internalformat,l.type,e.width,e.height,c.genMipmaps,!1));f.format=ua[l.internalformat];f.type=Da[l.type];f.mag=Fa[c.magFilter];f.min=Ia[c.minFilter];
f.wrapS=Ea[c.wrapS];f.wrapT=Ea[c.wrapT];return f}var l=new la(3553);va[l.id]=l;I.textureCount++;f(c,e);f.subimage=function(a,d,c,e){b(!!a,"must specify image data");d|=0;c|=0;e|=0;var g=ka();J(g,l);g.width=0;g.height=0;M(g,a);g.width=g.width||(l.width>>e)-d;g.height=g.height||(l.height>>e)-c;b(l.type===g.type&&l.format===g.format&&l.internalformat===g.internalformat,"incompatible format for texture.subimage");b(0<=d&&0<=c&&d+g.width<=l.width&&c+g.height<=l.height,"texture.subimage write out of bounds");
b(l.mipmask&1<<e,"missing mipmap data");b(g.data||g.element||g.needsCopy,"missing image data");ma(l);ra(g,3553,d,c,e);na();oa(g);return f};f.resize=function(b,c){var e=b|0,g=c|0||e;if(e===l.width&&g===l.height)return f;f.width=l.width=e;f.height=l.height=g;ma(l);for(var h=0;l.mipmask>>h;++h)a.texImage2D(3553,h,l.format,e>>h,g>>h,0,l.format,l.type,null);na();H.profile&&(l.stats.size=m(l.internalformat,l.type,e,g,!1,!1));return f};f._reglType="texture2d";f._texture=l;H.profile&&(f.stats=l.stats);f.destroy=
function(){l.decRef()};return f},createCube:function(c,e,f,l,h,q){function n(a,d,c,e,f,g){var l,h=p.texInfo;xa.call(h);for(l=0;6>l;++l)r[l]=Ca();if("number"!==typeof a&&a)if("object"===typeof a)if(d)S(r[0],a),S(r[1],d),S(r[2],c),S(r[3],e),S(r[4],f),S(r[5],g);else if(ca(h,a),Y(p,a),"faces"in a)for(a=a.faces,b(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),l=0;6>l;++l)b("object"===typeof a[l]&&!!a[l],"invalid input for cube map face"),J(r[l],p),S(r[l],a[l]);else for(l=0;6>l;++l)S(r[l],
a);else b.raise("invalid arguments to cube map");else for(a=a|0||1,l=0;6>l;++l)ba(r[l],a,a);J(p,r[0]);p.mipmask=h.genMipmaps?(r[0].width<<1)-1:r[0].mipmask;b.textureCube(p,h,r,k);p.internalformat=r[0].internalformat;n.width=r[0].width;n.height=r[0].height;ma(p);for(l=0;6>l;++l)O(r[l],34069+l);ja(h,34067);na();H.profile&&(p.stats.size=m(p.internalformat,p.type,n.width,n.height,h.genMipmaps,!0));n.format=ua[p.internalformat];n.type=Da[p.type];n.mag=Fa[h.magFilter];n.min=Ia[h.minFilter];n.wrapS=Ea[h.wrapS];
n.wrapT=Ea[h.wrapT];for(l=0;6>l;++l)ta(r[l]);return n}var p=new la(34067);va[p.id]=p;I.cubeCount++;var r=Array(6);n(c,e,f,l,h,q);n.subimage=function(a,d,c,e,f){b(!!d,"must specify image data");b("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");c|=0;e|=0;f|=0;var g=ka();J(g,p);g.width=0;g.height=0;M(g,d);g.width=g.width||(p.width>>f)-c;g.height=g.height||(p.height>>f)-e;b(p.type===g.type&&p.format===g.format&&p.internalformat===g.internalformat,"incompatible format for texture.subimage");
b(0<=c&&0<=e&&c+g.width<=p.width&&e+g.height<=p.height,"texture.subimage write out of bounds");b(p.mipmask&1<<f,"missing mipmap data");b(g.data||g.element||g.needsCopy,"missing image data");ma(p);ra(g,34069+a,c,e,f);na();oa(g);return n};n.resize=function(b){b|=0;if(b!==p.width){n.width=p.width=b;n.height=p.height=b;ma(p);for(var c=0;6>c;++c)for(var e=0;p.mipmask>>e;++e)a.texImage2D(34069+c,e,p.format,b>>e,b>>e,0,p.format,p.type,null);na();H.profile&&(p.stats.size=m(p.internalformat,p.type,n.width,
n.height,!1,!0));return n}};n._reglType="textureCube";n._texture=p;H.profile&&(n.stats=p.stats);n.destroy=function(){p.decRef()};return n},clear:function(){for(var b=0;b<sa;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),ea[b]=null;E(va).forEach(qa);I.cubeCount=0;I.textureCount=0},getTexture:function(a){return null},restore:function(){E(va).forEach(function(b){b.texture=a.createTexture();a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!==(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,
c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var e=0;6>e;++e)a.texImage2D(34069+e,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);ja(b.texInfo,b.target)})}}}},{"./constants/arraytypes.json":4,"./util/check":21,"./util/extend":24,"./util/flatten":25,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/to-half-float":32,"./util/values":33}],20:[function(k,u,y){u.exports=function(c,f){function h(){this.endQueryIndex=
this.startQueryIndex=-1;this.sum=0;this.stats=null}function k(b,c,e){var f=n.pop()||new h;f.startQueryIndex=b;f.endQueryIndex=c;f.sum=0;f.stats=e;u.push(f)}var e=f.ext_disjoint_timer_query;if(!e)return null;var m=[],b=[],n=[],u=[],C=[],v=[];return{beginQuery:function(c){var f=m.pop()||e.createQueryEXT();e.beginQueryEXT(35007,f);b.push(f);k(b.length-1,b.length,c)},endQuery:function(){e.endQueryEXT(35007)},pushScopeStats:k,update:function(){var c,f;c=b.length;if(0!==c){v.length=Math.max(v.length,c+
1);C.length=Math.max(C.length,c+1);C[0]=0;var h=v[0]=0;for(f=c=0;f<b.length;++f){var k=b[f];e.getQueryObjectEXT(k,34919)?(h+=e.getQueryObjectEXT(k,34918),m.push(k)):b[c++]=k;C[f+1]=h;v[f+1]=c}b.length=c;for(f=c=0;f<u.length;++f){var h=u[f],w=h.startQueryIndex,k=h.endQueryIndex;h.sum+=C[k]-C[w];w=v[w];k=v[k];k===w?(h.stats.gpuTime+=h.sum/1E6,n.push(h)):(h.startQueryIndex=w,h.endQueryIndex=k,u[c++]=h)}u.length=c}},getNumPendingQueries:function(){return b.length},clear:function(){m.push.apply(m,b);for(var c=
0;c<m.length;c++)e.deleteQueryEXT(m[c]);b.length=0;m.length=0},restore:function(){b.length=0;m.length=0}}}},{}],21:[function(k,u,y){function c(a){return"undefined"!==typeof btoa?btoa(a):"base64:"+a}function f(a){a=Error("(regl) "+a);console.error(a);throw a;}function h(a,b){a||f(b)}function w(a){return a?": "+a:""}function e(a,b,c){0>b.indexOf(a)&&f("invalid value"+w(c)+". must be one of: "+b)}function m(a,b){for(a+="";a.length<b;)a=" "+a;return a}function b(){this.name="unknown";this.lines=[];this.index=
{};this.hasErrors=!1}function n(a,b){this.number=a;this.line=b;this.errors=[]}function E(a,b,c){this.file=a;this.line=b;this.message=c}function C(){var a=Error(),a=(a.stack||a).toString(),b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function v(){var a=Error(),a=(a.stack||a).toString(),b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function q(a,
d){var e=a.split("\n"),f=1,l=0,h={unknown:new b,0:new b};h.unknown.name=h[0].name=d||C();h.unknown.lines.push(new n(0,""));for(var m=0;m<e.length;++m){var k=e[m],q=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(k);if(q)switch(q[1]){case "line":if(q=/(\d+)(\s+\d+)?/.exec(q[2]))f=q[1]|0,q[2]&&(l=q[2]|0,l in h||(h[l]=new b));break;case "define":if(q=/SHADER_NAME(_B64)?\s+(.*)$/.exec(q[2]))h[l].name=q[1]?c(q[2]):q[2]}h[l].lines.push(new n(f++,k))}Object.keys(h).forEach(function(a){var b=h[a];b.lines.forEach(function(a){b.index[a.number]=
a})});return h}function F(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var c=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(a);c?b.push(new E(c[1]|0,c[2]|0,c[3].trim())):0<a.length&&b.push(new E("unknown",0,a))}});return b}function A(a,b){b.forEach(function(b){var d=a[b.file];if(d){var c=d.index[b.line];if(c){c.errors.push(b);d.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(b)})}function B(a){a._commandRef=C()}function G(a,b){var c=v();f(a+" in command "+(b||
C())+("unknown"===c?"":" called from "+c))}function p(a,b,c,e){typeof a!==b&&G("invalid parameter type"+w(c)+". expected "+b+", got "+typeof a,e||C())}function r(a,b){return 32820===a||32819===a||33635===a?2:34042===a?4:l[a]*b}var N=k("./is-typed-array");k=k("./extend");var I="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),l={};l[5120]=l[5121]=1;l[5122]=l[5123]=l[36193]=l[33635]=l[32819]=l[32820]=2;l[5124]=l[5125]=l[5126]=l[34042]=4;u.exports=k(h,
{optional:function(a){a()},raise:f,commandRaise:G,command:function(a,b,c){a||G(b,c||C())},parameter:function(a,b,c){a in b||f("unknown parameter ("+a+")"+w(c)+". possible values: "+Object.keys(b).join())},commandParameter:function(a,b,c,e){a in b||G("unknown parameter ("+a+")"+w(c)+". possible values: "+Object.keys(b).join(),e||C())},constructor:function(a){Object.keys(a).forEach(function(a){0>I.indexOf(a)&&f('invalid regl constructor argument "'+a+'". must be one of '+I)})},type:function(a,b,c){typeof a!==
b&&f("invalid parameter type"+w(c)+". expected "+b+", got "+typeof a)},commandType:p,isTypedArray:function(a,b){N(a)||f("invalid parameter type"+w(b)+". must be a typed array")},nni:function(a,b){0<=a&&(a|0)===a||f("invalid parameter type, ("+a+")"+w(b)+". must be a nonnegative integer")},oneOf:e,shaderError:function(a,b,c,e,f){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);a=e===a.FRAGMENT_SHADER?"fragment":"vertex";p(c,"string",a+" shader source must be a string",f);var l=
q(c,f);c=F(b);A(l,c);Object.keys(l).forEach(function(a){function b(a,d){c.push(a);e.push(d||"")}var d=l[a];if(d.hasErrors){var c=[""],e=[""];b("file number "+a+": "+d.name+"\n","color:red;text-decoration:underline;font-weight:bold");d.lines.forEach(function(a){if(0<a.errors.length){b(m(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var d=0;a.errors.forEach(function(c){c=c.message;var e=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(c);
if(e){var f=e[1];c=e[2];switch(f){case "assign":f="="}d=Math.max(a.line.indexOf(f,d),0)}else d=0;b(m("| ",6));b(m("^^^",d+3)+"\n","font-weight:bold");b(m("| ",6));b(c+"\n","font-weight:bold")});b(m("| ",6)+"\n")}else b(m(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"!==typeof document?(e[0]=c.join("%c"),console.log.apply(console,e)):console.log(c.join(""))}});h.raise("Error compiling "+a+" shader, "+l[0].name)}},linkError:function(a,b,c,e,f){a.getProgramParameter(b,a.LINK_STATUS)||(a=
a.getProgramInfoLog(b),c=q(c,f),e='Error linking program with vertex shader, "'+q(e,f)[0].name+'", and fragment shader "'+c[0].name+'"',"undefined"!==typeof document?console.log("%c"+e+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(e+"\n"+a),h.raise(e))},callSite:v,saveCommandRef:B,saveDrawInfo:function(a,b,c,e){function f(a){return a?e.id(a):0}function l(a,b){Object.keys(b).forEach(function(b){a[e.id(b)]=!0})}B(a);a._fragId=f(a["static"].frag);a._vertId=
f(a["static"].vert);var h=a._uniformSet={};l(h,b["static"]);l(h,b.dynamic);b=a._attributeSet={};l(b,c["static"]);l(b,c.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,b,c){a.texture?e(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):e(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")},guessCommand:C,texture2D:function(a,b,c){var e=b.width,
f=b.height,l=b.channels;h(0<e&&e<=c.maxTextureSize&&0<f&&f<=c.maxTextureSize,"invalid texture shape");33071===a.wrapS&&33071===a.wrapT||h(!(e&e-1)&&!!e&&!(f&f-1)&&!!f,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==e&&1!==f&&h(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(h(!(e&e-1)&&!!e&&!(f&f-1)&&!!f,"texture must be a square power of 2 to support mipmapping"),h(b.mipmask===(e<<1)-1,
"missing or incomplete mipmap data"));5126===b.type&&(0>c.extensions.indexOf("oes_texture_float_linear")&&h(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),h(!a.genMipmaps,"mipmap generation not supported with float textures"));var m=b.images;for(c=0;16>c;++c)if(m[c]){var k=e>>c,n=f>>c;h(b.mipmask&1<<c,"missing mipmap data");var q=m[c];h(q.width===k&&q.height===n,"invalid shape for mip images");h(q.format===b.format&&q.internalformat===b.internalformat&&
q.type===b.type,"incompatible type for mip image");q.compressed||q.data&&h(q.data.byteLength===k*n*Math.max(r(q.type,l),q.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}else a.genMipmaps||h(0===(b.mipmask&1<<c),"extra mipmap data");b.compressed&&h(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,c,e){var f=a.width,l=a.height,m=a.channels;h(0<f&&f<=e.maxTextureSize&&0<l&&l<=e.maxTextureSize,"invalid texture shape");
h(f===l,"cube map must be square");h(33071===b.wrapS&&33071===b.wrapT,"wrap mode not supported by cube map");for(e=0;e<c.length;++e){var k=c[e];h(k.width===f&&k.height===l,"inconsistent cube map face shape");b.genMipmaps&&(h(!k.compressed,"can not generate mipmap for compressed textures"),h(1===k.mipmask,"can not specify mipmaps and generate mipmaps"));for(var n=k.images,q=0;16>q;++q){var p=n[q];if(p){var v=f>>q,w=l>>q;h(k.mipmask&1<<q,"missing mipmap data");h(p.width===v&&p.height===w,"invalid shape for mip images");
h(p.format===a.format&&p.internalformat===a.internalformat&&p.type===a.type,"incompatible type for mip image");p.compressed||p.data&&h(p.data.byteLength===v*w*Math.max(r(p.type,m),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}})},{"./extend":24,"./is-typed-array":28}],22:[function(k,u,y){u.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],23:[function(k,u,y){function c(c){return Array.prototype.slice.call(c)}
function f(f){return c(f).join("")}var h=k("./extend");u.exports=function(){function k(){var b=[],e=[];return h(function(){b.push.apply(b,c(arguments))},{def:function(){var f="v"+m++;e.push(f);0<arguments.length&&(b.push(f,"="),b.push.apply(b,c(arguments)),b.push(";"));return f},toString:function(){return f([0<e.length?"var "+e+";":"",f(b)])}})}function e(){function b(c,h){f(c,h,"=",e.def(c,h),";")}var e=k(),f=k(),m=e.toString,n=f.toString;return h(function(){e.apply(e,c(arguments))},{def:e.def,entry:e,
exit:f,save:b,set:function(c,f,h){b(c,f);e(c,f,"=",h,";")},toString:function(){return m()+n()}})}var m=0,b=[],n=[],u=k(),C={};return{global:u,link:function(c){for(var e=0;e<n.length;++e)if(n[e]===c)return b[e];e="g"+m++;b.push(e);n.push(c);return e},block:k,proc:function(b,c){function m(){var b="a"+k.length;k.push(b);return b}var k=[];c=c||0;for(var n=0;n<c;++n)m();var n=e(),w=n.toString;return C[b]=h(n,{arg:m,toString:function(){return f(["function(",k.join(),"){",w(),"}"])}})},scope:e,cond:function(){var b=
f(arguments),m=e(),k=e(),n=m.toString,w=k.toString;return h(m,{then:function(){m.apply(m,c(arguments));return this},"else":function(){k.apply(k,c(arguments));return this},toString:function(){var c=w();c&&(c="else{"+c+"}");return f(["if(",b,"){",n(),"}",c])}})},compile:function(){var c=['"use strict";',u,"return {"];Object.keys(C).forEach(function(b){c.push('"',b,'":',C[b].toString(),",")});c.push("}");var e=f(c).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,
b.concat(e)).apply(null,n)}}}},{"./extend":24}],24:[function(k,u,y){u.exports=function(c,f){for(var h=Object.keys(f),k=0;k<h.length;++k)c[h[k]]=f[h[k]];return c}},{}],25:[function(k,u,y){function c(c,e,f,b,h,k){for(var u=0;u<e;++u)for(var v=c[u],q=0;q<f;++q)for(var y=v[q],A=0;A<b;++A)h[k++]=y[A]}function f(h,e,m,b,k){for(var u=1,C=m+1;C<e.length;++C)u*=e[C];var v=e[m];if(4===e.length-m){var q=e[m+1],y=e[m+2];e=e[m+3];for(C=0;C<v;++C)c(h[C],q,y,e,b,k),k+=u}else for(C=0;C<v;++C)f(h[C],e,m+1,b,k),k+=
u}var h=k("./pool");u.exports={shape:function(c){for(var e=[];c.length;c=c[0])e.push(c.length);return e},flatten:function(k,e,m,b){var n=1;if(e.length)for(var u=0;u<e.length;++u)n*=e[u];else n=0;m=b||h.allocType(m,n);switch(e.length){case 0:break;case 1:b=e[0];for(e=0;e<b;++e)m[e]=k[e];break;case 2:b=e[0];e=e[1];for(u=n=0;u<b;++u)for(var C=k[u],v=0;v<e;++v)m[n++]=C[v];break;case 3:c(k,e[0],e[1],e[2],m,0);break;default:f(k,e,0,m,0)}return m}}},{"./pool":30}],26:[function(k,u,y){var c=k("./is-typed-array");
u.exports=function(f){return Array.isArray(f)||c(f)}},{"./is-typed-array":28}],27:[function(k,u,y){var c=k("./is-typed-array");u.exports=function(f){return!!f&&"object"===typeof f&&Array.isArray(f.shape)&&Array.isArray(f.stride)&&"number"===typeof f.offset&&f.shape.length===f.stride.length&&(Array.isArray(f.data)||c(f.data))}},{"./is-typed-array":28}],28:[function(k,u,y){var c=k("../constants/arraytypes.json");u.exports=function(f){return Object.prototype.toString.call(f)in c}},{"../constants/arraytypes.json":4}],
29:[function(k,u,y){u.exports=function(c,f){for(var h=Array(c),k=0;k<c;++k)h[k]=f(k);return h}},{}],30:[function(k,u,y){function c(c){var f,b;f=(65535<c)<<4;c>>>=f;b=(255<c)<<3;c>>>=b;f|=b;b=(15<c)<<2;c>>>=b;f|=b;b=(3<c)<<1;return f|b|c>>>b>>1}function f(e){a:{for(var f=16;268435456>=f;f*=16)if(e<=f){e=f;break a}e=0}f=w[c(e)>>2];return 0<f.length?f.pop():new ArrayBuffer(e)}function h(e){w[c(e.byteLength)>>2].push(e)}var w=k("./loop")(8,function(){return[]});u.exports={alloc:f,free:h,allocType:function(c,
h){var b=null;switch(c){case 5120:b=new Int8Array(f(h),0,h);break;case 5121:b=new Uint8Array(f(h),0,h);break;case 5122:b=new Int16Array(f(2*h),0,h);break;case 5123:b=new Uint16Array(f(2*h),0,h);break;case 5124:b=new Int32Array(f(4*h),0,h);break;case 5125:b=new Uint32Array(f(4*h),0,h);break;case 5126:b=new Float32Array(f(4*h),0,h);break;default:return null}return b.length!==h?b.subarray(0,h):b},freeType:function(c){h(c.buffer)}}},{"./loop":29}],31:[function(k,u,y){u.exports={next:"function"===typeof requestAnimationFrame?
function(c){return requestAnimationFrame(c)}:function(c){return setTimeout(c,16)},cancel:"function"===typeof cancelAnimationFrame?function(c){return cancelAnimationFrame(c)}:clearTimeout}},{}],32:[function(k,u,y){var c=k("./pool"),f=new Float32Array(1),h=new Uint32Array(f.buffer);u.exports=function(k){for(var e=c.allocType(5123,k.length),m=0;m<k.length;++m)if(isNaN(k[m]))e[m]=65535;else if(Infinity===k[m])e[m]=31744;else if(-Infinity===k[m])e[m]=64512;else{f[0]=k[m];var b=h[0],n=b>>>31<<15,u=(b<<
1>>>24)-127,b=b>>13&1023;e[m]=-24>u?n:-14>u?n+(b+1024>>-14-u):15<u?n+31744:n+(u+15<<10)+b}return e}},{"./pool":30}],33:[function(k,u,y){u.exports=function(c){return Object.keys(c).map(function(f){return c[f]})}},{}],34:[function(k,u,y){function c(b,c,e){function f(){var c=window.innerWidth,k=window.innerHeight;b!==document.body&&(k=b.getBoundingClientRect(),c=k.right-k.left,k=k.bottom-k.top);h.width=e*c;h.height=e*k;m(h.style,{width:c+"px",height:k+"px"})}var h=document.createElement("canvas");m(h.style,
{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(h);b===document.body&&(h.style.position="absolute",m(b.style,{margin:0,padding:0}));window.addEventListener("resize",f,!1);f();return{canvas:h,onDestroy:function(){window.removeEventListener("resize",f);b.removeChild(h)}}}function f(b,c){function e(f){try{return b.getContext(f,c)}catch(h){return null}}return e("webgl")||e("experimental-webgl")||e("webgl-experimental")}function h(b){if("string"===typeof b)return b.split();e(Array.isArray(b),
"invalid extension array");return b}function w(b){return"string"===typeof b?(e("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(b)):b}var e=k("./util/check"),m=k("./util/extend");u.exports=function(b){var k=b||{},m,u,v,q;b={};var y=[],A=[],B="undefined"===typeof window?1:window.devicePixelRatio,G=!1,p=function(b){b&&e.raise(b)},r=function(){};"string"===typeof k?(e("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),m=document.querySelector(k),
e(m,"invalid query string for element")):"object"===typeof k?"string"===typeof k.nodeName&&"function"===typeof k.appendChild&&"function"===typeof k.getBoundingClientRect?m=k:"function"===typeof k.drawArrays||"function"===typeof k.drawElements?(q=k,v=q.canvas):(e.constructor(k),"gl"in k?q=k.gl:"canvas"in k?v=w(k.canvas):"container"in k&&(u=w(k.container)),"attributes"in k&&(b=k.attributes,e.type(b,"object","invalid context attributes")),"extensions"in k&&(y=h(k.extensions)),"optionalExtensions"in k&&
(A=h(k.optionalExtensions)),"onDone"in k&&(e.type(k.onDone,"function","invalid or missing onDone callback"),p=k.onDone),"profile"in k&&(G=!!k.profile),"pixelRatio"in k&&(B=+k.pixelRatio,e(0<B,"invalid pixel ratio"))):e.raise("invalid arguments to regl");m&&("canvas"===m.nodeName.toLowerCase()?v=m:u=m);if(!q){if(!v){e("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");m=c(u||document.body,p,B);if(!m)return null;v=m.canvas;r=m.onDestroy}q=f(v,b)}return q?
{gl:q,canvas:v,container:u,extensions:y,optionalExtensions:A,pixelRatio:B,profile:G,onDone:p,onDestroy:r}:(r(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/check":21,"./util/extend":24}],35:[function(k,u,y){u.exports=function(f,h){function k(b){var c=!1;"altKey"in b&&(c=c||b.altKey!==p.alt,p.alt=!!b.altKey);"shiftKey"in b&&(c=c||b.shiftKey!==p.shift,p.shift=!!b.shiftKey);"ctrlKey"in b&&(c=c||b.ctrlKey!==p.control,p.control=!!b.ctrlKey);
"metaKey"in b&&(c=c||b.metaKey!==p.meta,p.meta=!!b.metaKey);return c}function e(b,e){var a=c.x(e),d=c.y(e);"buttons"in e&&(b=e.buttons|0);if(b!==A||a!==B||d!==G||k(e))A=b|0,B=a||0,G=d||0,h&&h(A,B,G,p)}function m(b){e(0,b)}function b(){if(A||B||G||p.shift||p.alt||p.meta||p.control)A=B=G=0,p.shift=p.alt=p.control=p.meta=!1,h&&h(0,0,0,p)}function n(b){k(b)&&h&&h(A,B,G,p)}function u(b){0===c.buttons(b)?e(0,b):e(A,b)}function y(b){e(A|c.buttons(b),b)}function v(b){e(A&~c.buttons(b),b)}function q(){r||
(r=!0,f.addEventListener("mousemove",u),f.addEventListener("mousedown",y),f.addEventListener("mouseup",v),f.addEventListener("mouseleave",m),f.addEventListener("mouseenter",m),f.addEventListener("mouseout",m),f.addEventListener("mouseover",m),f.addEventListener("blur",b),f.addEventListener("keyup",n),f.addEventListener("keydown",n),f.addEventListener("keypress",n),f!==window&&(window.addEventListener("blur",b),window.addEventListener("keyup",n),window.addEventListener("keydown",n),window.addEventListener("keypress",
n)))}function F(){r&&(r=!1,f.removeEventListener("mousemove",u),f.removeEventListener("mousedown",y),f.removeEventListener("mouseup",v),f.removeEventListener("mouseleave",m),f.removeEventListener("mouseenter",m),f.removeEventListener("mouseout",m),f.removeEventListener("mouseover",m),f.removeEventListener("blur",b),f.removeEventListener("keyup",n),f.removeEventListener("keydown",n),f.removeEventListener("keypress",n),f!==window&&(window.removeEventListener("blur",b),window.removeEventListener("keyup",
n),window.removeEventListener("keydown",n),window.removeEventListener("keypress",n)))}h||(h=f,f=window);var A=0,B=0,G=0,p={shift:!1,alt:!1,control:!1,meta:!1},r=!1;q();var N={element:f};Object.defineProperties(N,{enabled:{get:function(){return r},set:function(b){b?q():F},enumerable:!0},buttons:{get:function(){return A},enumerable:!0},x:{get:function(){return B},enumerable:!0},y:{get:function(){return G},enumerable:!0},mods:{get:function(){return p},enumerable:!0}});return N};var c=k("mouse-event")},
{"mouse-event":36}],36:[function(k,u,y){function c(c){return c.target||c.srcElement||window}y.buttons=function(c){if("object"===typeof c){if("buttons"in c)return c.buttons;if("which"in c){c=c.which;if(2===c)return 4;if(3===c)return 2;if(0<c)return 1<<c-1}else if("button"in c){c=c.button;if(1===c)return 4;if(2===c)return 2;if(0<=c)return 1<<c}}return 0};y.element=c;y.x=function(f){if("object"===typeof f){if("offsetX"in f)return f.offsetX;var h=c(f).getBoundingClientRect();return f.clientX-h.left}return 0};
y.y=function(f){if("object"===typeof f){if("offsetY"in f)return f.offsetY;var h=c(f).getBoundingClientRect();return f.clientY-h.top}return 0}},{}],37:[function(k,u,y){function c(b){throw Error("resl: "+b);}function f(b,e,f){Object.keys(b).forEach(function(b){0>e.indexOf(b)&&c('invalid parameter "'+b+'" in '+f)})}function h(b,c){this.state=0;this.ready=!1;this.progress=0;this.name=b;this.cancel=c}var w=["manifest","onDone","onProgress","onError"],e=["type","src","stream","credentials","parser"],m=
["onData","onDone"];u.exports=function(b){function k(e,a){if(e in b){var d=b[e];"function"!==typeof d&&c('invalid callback "'+e+'"');return d}return null}function u(b){function a(){if(!(2>k.readyState||1===n.state||-1===n.state)){if(200!==k.status)return v('error loading resource "'+b.name+'"');if(2<k.readyState&&0===n.state){var a;a="binary"===b.type?k.response:k.responseText;if(f.data)try{m=f.data(a)}catch(c){return v(c)}else m=a}if(3<k.readyState&&0===n.state){if(f.done)try{m=f.done()}catch(c){return v(c)}n.state=
1}p[d]=m;n.progress=.75*n.progress+.25;n.ready=b.stream&&!!m||1===n.state;q()}}var d=b.name,c=b.stream,e="binary"===b.type,f=b.parser,k=new XMLHttpRequest,m=null,n=new h(d,function(){1!==n.state&&-1!==n.state&&(k.onreadystatechange=null,k.abort(),n.state=-1)});k.onreadystatechange=c?a:function(){4===k.readyState&&a()};e&&(k.responseType="arraybuffer");b.credentials&&(k.withCredentials=!0);k.open("GET",b.src,!0);k.send();return n}function y(b,a){function d(){if(0===r.state)if(n.data)try{u=n.data(a)}catch(b){return v(b)}else u=
a}function c(a){d();p[m]=u;r.progress=a.lengthComputable?Math.max(r.progress,a.loaded/a.total):.75*r.progress+.25;q(m)}function e(){d();if(0===r.state){if(n.done)try{u=n.done()}catch(a){return v(a)}r.state=1}r.progress=1;r.ready=!0;p[m]=u;k();q("finish "+m)}function f(){v('error loading asset "'+m+'"')}function k(){b.stream&&a.removeEventListener("progress",c);"image"===b.type?a.addEventListener("load",e):a.addEventListener("canplay",e);a.removeEventListener("error",f)}var m=b.name,n=b.parser,r=new h(m,
function(){1!==r.state&&-1!==r.state&&(r.state=-1,k(),a.src="")}),u=a;b.stream&&a.addEventListener("progress",c);if("image"===b.type)a.addEventListener("load",e);else{var w=!1,A=!1;a.addEventListener("loadedmetadata",function(){A=!0;w&&e()});a.addEventListener("canplay",function(){w=!0;A&&e()})}a.addEventListener("error",f);a.crossOrigin=b.credentials?"use-credentials":"anonymous";a.src=b.src;return r}function v(b){-1!==r&&1!==r&&(r=-1,I.forEach(function(a){a.cancel()}),G?"string"===typeof b?G(Error("resl: "+
b)):G(b):console.error("resl error:",b))}function q(b){if(-1!==r&&1!==r){var a=0,c=0;I.forEach(function(b){b.ready&&(c+=1);a+=b.progress});c===I.length?(r=1,A(p)):B&&B(a/I.length,b)}}"object"===typeof b&&b||c("invalid or missing configuration");f(b,w,"config");var F=b.manifest;"object"===typeof F&&F||c("missing manifest");var A=k("onDone");A||c("missing onDone() callback");var B=k("onProgress"),G=k("onError"),p={},r=0,N={text:u,binary:function(b){return u(b)},image:function(b){return y(b,document.createElement("img"))},
video:function(b){return y(b,document.createElement("video"))},audio:function(b){return y(b,document.createElement("audio"))}},I=Object.keys(F).map(function(b){function a(a,b){if(a in d.parser){var e=d.parser[a];"function"!==typeof e&&c("invalid parser callback "+a+' for asset "'+a+'"');return e}return b}var d=F[b];"string"===typeof d?d={src:d}:"object"===typeof d&&d||c('invalid asset definition "'+b+'"');f(d,e,'asset "'+b+'"');var h={};"parser"in d&&("function"===typeof d.parser?h={data:d.parser}:
"object"===typeof d.parser&&d.parser?(f(h,m,'parser for asset "'+b+'"'),"onData"in h||c('missing onData callback for parser in asset "'+b+'"'),h={data:a("onData"),done:a("onDone")}):c('invalid parser for asset "'+b+'"'));return{name:b,type:function(a,e,f){a in d&&(f=d[a]);0>e.indexOf(f)&&c("invalid "+a+' "'+f+'" for asset "'+b+'", possible values: '+e);return f}("type",Object.keys(N),"text"),stream:!!d.stream,credentials:!!d.credentials,src:function(a,e,f){a in d?f=d[a]:e&&c("missing "+a+' for asset "'+
b+'"');"string"!==typeof f&&c("invalid "+a+' for asset "'+b+'", must be a string');return f}("src",!0,""),parser:h}}).map(function(b){return N[b.type](b)});0===I.length&&setTimeout(function(){q("done")},1)}},{}],38:[function(k,u,y){function c(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var f=k("./lib/util/check"),h=k("./lib/util/extend"),w=k("./lib/dynamic"),e=k("./lib/util/raf"),m=k("./lib/util/clock"),b=k("./lib/strings"),n=k("./lib/webgl"),E=k("./lib/extension"),C=k("./lib/limits"),
v=k("./lib/buffer"),q=k("./lib/elements"),F=k("./lib/texture"),A=k("./lib/renderbuffer"),B=k("./lib/framebuffer"),G=k("./lib/attribute"),p=k("./lib/shader"),r=k("./lib/read"),N=k("./lib/core"),I=k("./lib/stats"),l=k("./lib/timer");u.exports=function(a){function d(){if(0===R.length)O&&O.update(),ha=null;else{ha=e.next(d);Y();for(var a=R.length-1;0<=a;--a){var b=R[a];b&&b(ca,null,0)}M.flush();O&&O.update()}}function k(){!ha&&0<R.length&&(ha=e.next(d))}function u(){ha&&(e.cancel(d),ha=null)}function y(a){a.preventDefault();
ka=!0;u();aa.forEach(function(a){a()})}function ga(a){M.getError();ka=!1;oa.restore();na.restore();la.restore();qa.restore();ya.restore();W.restore();O&&O.restore();Z.procs.refresh();k();fa.forEach(function(a){a()})}function Na(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];w.isDynamic(e)?d[b]=w.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;q.length<a;)q.push(null);return q}f(!!a,"invalid args to regl({...})");f.type(a,"object","invalid args to regl({...})");
var d=b(a.context||{}),e=b(a.uniforms||{}),k=b(a.attributes||{}),l=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=h({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var d=Z.compile(l,
k,e,d,a),m=d.draw,n=d.batch,p=d.scope,q=[];return h(function(a,b){var d;ka&&f.raise("context lost");if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)p.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)p.call(this,a[d],b,d);else return p.call(this,a,b,0);else if("number"===typeof a){if(0<a)return n.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return n.call(this,a,a.length)}else return m.call(this,
a)},{stats:a})}function H(a,b){var c=0;Z.procs.poll();var d=b.color;d&&(M.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in b&&(M.clearDepth(+b.depth),c|=256);"stencil"in b&&(M.clearStencil(b.stencil|0),c|=1024);f(!!c,"called regl.clear with no buffer specified");M.clear(c)}function ia(a){f.type(a,"function","regl.frame() callback must be a function");R.push(a);k();return{cancel:function(){function b(){var a=c(R,b);R[a]=R[R.length-1];--R.length;0>=R.length&&u()}var d=c(R,a);f(0<=
d,"cannot cancel a frame twice");R[d]=b}}}function J(){var a=T.viewport,b=T.scissor_box;a[0]=a[1]=b[0]=b[1]=0;ca.viewportWidth=ca.framebufferWidth=ca.drawingBufferWidth=a[2]=b[2]=M.drawingBufferWidth;ca.viewportHeight=ca.framebufferHeight=ca.drawingBufferHeight=a[3]=b[3]=M.drawingBufferHeight}function Y(){ca.tick+=1;ca.time=Q();J();Z.procs.poll()}function da(){J();Z.procs.refresh();O&&O.update()}function Q(){return(m()-Ca)/1E3}a=n(a);if(!a)return null;var M=a.gl,ra=M.getContextAttributes(),ka=M.isContextLost(),
oa=E(M,a);if(!oa)return null;var wa=b(),ba=I(),S=oa.extensions,O=l(M,S),Ca=m(),ta=M.drawingBufferWidth,xa=M.drawingBufferHeight,ca={tick:0,time:0,viewportWidth:ta,viewportHeight:xa,framebufferWidth:ta,framebufferHeight:xa,drawingBufferWidth:ta,drawingBufferHeight:xa,pixelRatio:a.pixelRatio},ja=C(M,S),la=v(M,ba,a),ma=q(M,S,la,ba),ta=G(M,S,ja,la,wa),na=p(M,wa,ba,a),qa=F(M,S,ja,function(){Z.procs.poll()},ca,ba,a),ya=A(M,S,ja,ba,a),W=B(M,S,ja,qa,ya,ba),Z=N(M,wa,S,ja,la,ma,qa,W,{},ta,na,{elements:null,
primitive:4,count:-1,offset:0,instances:-1},ca,O,a),wa=r(M,W,Z.procs.poll,ca,ra,S),T=Z.next,U=M.canvas,R=[],aa=[],fa=[],za=[a.onDestroy],ha=null;U&&(U.addEventListener("webglcontextlost",y,!1),U.addEventListener("webglcontextrestored",ga,!1));var ua=W.setFBO=Na({framebuffer:w.define.call(null,1,"framebuffer")});da();ra=h(Na,{clear:function(a){f("object"===typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=
0;6>b;++b)ua(h({framebuffer:a.framebuffer.faces[b]},a),H);else ua(a,H);else H(null,a)},prop:w.define.bind(null,1),context:w.define.bind(null,2),"this":w.define.bind(null,3),draw:Na({}),buffer:function(a){return la.create(a,34962,!1,!1)},elements:function(a){return ma.create(a,!1)},texture:qa.create2D,cube:qa.createCube,renderbuffer:ya.create,framebuffer:W.create,framebufferCube:W.createCube,attributes:ra,frame:ia,on:function(a,b){f.type(b,"function","listener callback must be a function");var c;switch(a){case "frame":return ia(b);
case "lost":c=aa;break;case "restore":c=fa;break;case "destroy":c=za;break;default:f.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:ja,hasExtension:function(a){return 0<=ja.extensions.indexOf(a.toLowerCase())},read:wa,destroy:function(){R.length=0;u();U&&(U.removeEventListener("webglcontextlost",y),U.removeEventListener("webglcontextrestored",ga));na.clear();W.clear();
ya.clear();qa.clear();ma.clear();la.clear();O&&O.clear();za.forEach(function(a){a()})},_gl:M,_refresh:da,poll:function(){Y();O&&O.update()},now:Q,stats:ba});a.onDone(null,ra);return ra}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/check":21,"./lib/util/clock":22,
"./lib/util/extend":24,"./lib/util/raf":31,"./lib/webgl":34}]},{},[1]);

        </script>
        </body>
      </html>