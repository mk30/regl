(function e$$0(t,x,c){function l(e,f){if(!x[e]){if(!t[e]){var b="function"==typeof require&&require;if(!f&&b)return b(e,!0);if(g)return g(e,!0);b=Error("Cannot find module '"+e+"'");throw b.code="MODULE_NOT_FOUND",b;}b=x[e]={exports:{}};t[e][0].call(b.exports,function(b){var c=t[e][1][b];return l(c?c:b)},b,b.exports,e$$0,t,x,c)}return x[e].exports}for(var g="function"==typeof require&&require,m=0;m<c.length;m++)l(c[m]);return l})({1:[function(n,t,x){var c=n("../regl")({pixelRatio:1}),l=n("gl-mat4/perspective"),
g=n("gl-mat4/lookAt");n("resl")({manifest:{song:{type:"audio",src:"assets/8bitpeoples-bamboo-cactus.mp3",stream:!0}},onDone:function(m){m=m.song;var e=new AudioContext,f=e.createMediaElementSource(m),b=e.createAnalyser();f.connect(b);f.connect(e.destination);m.play();var r=c.texture({data:(new Uint8Array(65536)).fill(128),radius:256,channels:1,min:"linear",mag:"linear",wrap:"repeat"}),z=c.texture({width:64,height:1,channels:4,min:"linear",mag:"linear",wrap:"repeat"}),n=c({vert:"\n      precision highp float;\n\n      #define N float(256)\n      #define WEIGHT1 vec4(-1.0, 8.0, -8.0, 1.0)\n      #define WEIGHT2 vec4(-1.0, 16.0, 16.0, -1.0)\n\n      attribute vec2 vertId;\n\n      uniform float t;\n      uniform mat4 projection, view;\n      uniform vec3 lightPosition;\n      uniform float offsetRow;\n      uniform sampler2D terrain, color;\n\n      varying vec3 grad, fragColor, eyeDir, lightDir;\n      varying float curvature;\n\n      float f(vec2 x) {\n        return 0.025 * pow(texture2D(terrain, x).r, 2.0) *\n          (1.0 + 2.5 * pow(texture2D(color, vec2(x.y, 0.0)).a, 3.0));\n      }\n\n      vec4 stencil(vec2 x, vec2 d) {\n        return vec4(\n          f(x - 2.0 * d),\n          f(x - d),\n          f(x + d),\n          f(x + 2.0 * d));\n      }\n\n      void main () {\n        vec2 uv = (vertId + vec2(0.0, offsetRow)) / N;\n\n        float h0 = f(uv);\n        vec4 hx = stencil(uv, vec2(1.0 / N, 0.0));\n        vec4 hy = stencil(uv, vec2(0.0, 1.0 / N));\n\n        grad = normalize(vec3(\n          dot(WEIGHT1, hx),\n          dot(WEIGHT1, hy),\n          0.025));\n\n        curvature =\n          max(max((dot(WEIGHT2, hx) - 30.0 * h0),\n              (dot(WEIGHT2, hy) - 30.0 * h0)), 0.0);\n\n        vec3 pos = vec3(vertId / N, h0 + 0.4);\n        lightDir = lightPosition - pos;\n\n        vec4 viewPos = view * vec4(pos, 1);\n        gl_Position = projection * viewPos;\n        eyeDir = viewPos.xyz / viewPos.w;\n\n        vec3 audioColor = texture2D(color, vec2(uv.y, 0)).rgb;\n        float minC = 0.9 * min(min(audioColor.r, audioColor.g), audioColor.b);\n        float maxC = max(max(audioColor.r, audioColor.g), audioColor.b);\n        fragColor = (audioColor - minC) / (maxC - minC);\n      }",
frag:"\n      precision highp float;\n\n      varying vec3 grad, fragColor, eyeDir, lightDir;\n      varying float curvature;\n\n      void main () {\n        vec3 N = normalize(grad);\n        vec3 V = normalize(eyeDir);\n        vec3 L = normalize(lightDir);\n\n        vec3 H = normalize(V + L);\n\n        float ao = 1.0 - curvature;\n        float diffuse = max(dot(L, N), 0.0);\n        float fresnel = 0.1 + 0.5 * pow(1.0 - max(dot(H, V), 0.0), 5.0);\n        float light = 0.25 * ao + 0.8 * diffuse + fresnel;\n        gl_FragColor = vec4(light * fragColor, 1);\n      }",
attributes:{vertId:Array(262144).fill().map(function(b,c){var e=.5*Math.floor(c/512),f=c%512*.5;return[e,f,e+.5,f,e,f+.5,e,f+.5,e+.5,f+.5,e+.5,f]})},uniforms:{offsetRow:function(b){return b.tick%256},terrain:r,projection:function(b){return l([],Math.PI/8,b.viewportWidth/b.viewportHeight,.01,1E3)},view:function(b){b=b.tick;return g([],[.5+.2*Math.cos(.001*b),1,.7+.2*Math.cos(.003*b+2.4)],[.5,0,0],[0,0,1])},lightPosition:function(b){b=b.tick;return[.5+Math.sin(.01*b),1+Math.cos(.01*b),1+.6*Math.cos(.04*
b)]},color:z,t:function(b){return.01*b.tick}},elements:null,instances:-1,count:1572864}),q={width:256,height:1,data:new Uint8Array(256)},p=new Uint8Array(256);c.frame(function(e){e=e.tick%256;c.clear({color:[0,0,0,1],depth:1});b.getByteTimeDomainData(q.data);r.subimage(q,0,e);b.getByteFrequencyData(p);z.subimage(p);n()})}})},{"../regl":39,"gl-mat4/lookAt":36,"gl-mat4/perspective":37,resl:38}],2:[function(n,t,x){function c(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=
!1;this.type=5126;this.divisor=this.stride=this.offset=0}t.exports=function(l,g,m,e,f){l=m.maxAttributes;g=Array(l);for(m=0;m<l;++m)g[m]=new c;return{Record:c,scope:{},state:g}}},{}],3:[function(n,t,x){function c(b){return q[Object.prototype.toString.call(b)]|0}function l(b,c){for(var e=0;e<c.length;++e)b[e]=c[e]}function g(b,c,e,f,m,g,p){for(var a=0,d=0;d<e;++d)for(var l=0;l<f;++l)b[a++]=c[m*d+g*l+p]}var m=n("./util/check"),e=n("./util/is-typed-array"),f=n("./util/is-ndarray"),b=n("./util/values"),
r=n("./util/pool");x=n("./util/flatten");var z=x.flatten,L=x.shape,q=n("./constants/arraytypes.json"),p=n("./constants/dtypes.json"),C=n("./constants/usage.json"),H=[];H[5120]=1;H[5122]=2;H[5124]=4;H[5121]=1;H[5123]=2;H[5125]=4;H[5126]=4;t.exports=function(q,n,A){function u(b){this.id=a++;this.buffer=q.createBuffer();this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;A.profile&&(this.stats={size:0})}function N(b,a,d){b.byteLength=a.byteLength;
q.bufferData(b.type,a,d)}function t(b,a,d,p,h,q){b.usage=d;if(Array.isArray(a)){if(b.dtype=p||5126,0<a.length)if(Array.isArray(a[0])){h=L(a);for(var F=p=1;F<h.length;++F)p*=h[F];b.dimension=p;a=z(a,h,b.dtype);N(b,a,d);q?b.persistentData=a:r.freeType(a)}else"number"===typeof a[0]?(b.dimension=h,h=r.allocType(b.dtype,a.length),l(h,a),N(b,h,d),q?b.persistentData=h:r.freeType(h)):e(a[0])?(b.dimension=a[0].length,b.dtype=p||c(a[0])||5126,a=z(a,[a.length,a[0].length],b.dtype),N(b,a,d),q?b.persistentData=
a:r.freeType(a)):m.raise("invalid buffer data")}else if(e(a))b.dtype=p||c(a),b.dimension=h,N(b,a,d),q&&(b.persistentData=new Uint8Array(new Uint8Array(a.buffer)));else if(f(a)){h=a.shape;var u=a.stride,F=a.offset,n=0,y=0,K=0,A=0;1===h.length?(n=h[0],y=1,K=u[0],A=0):2===h.length?(n=h[0],y=h[1],K=u[0],A=u[1]):m.raise("invalid shape");b.dtype=p||c(a.data)||5126;b.dimension=y;h=r.allocType(b.dtype,n*y);g(h,a.data,n,y,K,A,F);N(b,h,d);q?b.persistentData=h:r.freeType(h)}else m.raise("invalid buffer data")}
function h(b){n.bufferCount--;var a=b.buffer;m(a,"buffer must not be deleted already");q.deleteBuffer(a);b.buffer=null;delete d[b.id]}var a=0,d={};u.prototype.bind=function(){q.bindBuffer(this.type,this.buffer)};u.prototype.destroy=function(){h(this)};var F=[];A.profile&&(n.getTotalBufferSize=function(){var b=0;Object.keys(d).forEach(function(a){b+=d[a].stats.size});return b});return{create:function(b,a,F,N){function I(b){var a=35044,d=null,c=0,h=0,g=1;Array.isArray(b)||e(b)||f(b)?d=b:"number"===
typeof b?c=b|0:b&&(m.type(b,"object","buffer arguments must be an object, a number or an array"),"data"in b&&(m(null===d||Array.isArray(d)||e(d)||f(d),"invalid data for buffer"),d=b.data),"usage"in b&&(m.parameter(b.usage,C,"invalid buffer usage"),a=C[b.usage]),"type"in b&&(m.parameter(b.type,p,"invalid buffer type"),h=p[b.type]),"dimension"in b&&(m.type(b.dimension,"number","invalid dimension"),g=b.dimension|0),"length"in b&&(m.nni(c,"buffer length must be a nonnegative integer"),c=b.length|0));
J.bind();d?t(J,d,a,h,g,N):(q.bufferData(J.type,c,a),J.dtype=h||5121,J.usage=a,J.dimension=g,J.byteLength=c);A.profile&&(J.stats.size=J.byteLength*H[J.dtype]);return I}function T(b,a){m(a+b.byteLength<=J.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+b.byteLength+" starting from offset "+a+" to a buffer of size "+J.byteLength);q.bufferSubData(J.type,a,b)}n.bufferCount++;var J=new u(a);d[J.id]=J;F||I(b);I._reglType="buffer";I._buffer=J;I.subdata=function(b,
a){var d=(a||0)|0,h;J.bind();if(Array.isArray(b)){if(0<b.length)if("number"===typeof b[0]){var p=r.allocType(J.dtype,b.length);l(p,b);T(p,d);r.freeType(p)}else Array.isArray(b[0])||e(b[0])?(h=L(b),p=z(b,h,J.dtype),T(p,d),r.freeType(p)):m.raise("invalid buffer data")}else if(e(b))T(b,d);else if(f(b)){h=b.shape;var da=b.stride,q=p=0,F=0,u=0;1===h.length?(p=h[0],q=1,F=da[0],u=0):2===h.length?(p=h[0],q=h[1],F=da[0],u=da[1]):m.raise("invalid shape");h=Array.isArray(b.data)?J.dtype:c(b.data);h=r.allocType(h,
p*q);g(h,b.data,p,q,F,u,b.offset);T(h,d);r.freeType(h)}else m.raise("invalid data for buffer subdata");return I};A.profile&&(I.stats=J.stats);I.destroy=function(){h(J)};return I},createStream:function(b,a){var d=F.pop();d||(d=new u(b));d.bind();t(d,a,35040,0,1,!1);return d},destroyStream:function(b){F.push(b)},clear:function(){b(d).forEach(h);F.forEach(h)},getBuffer:function(b){return b&&b._buffer instanceof u?b._buffer:null},restore:function(){b(d).forEach(function(b){b.buffer=q.createBuffer();q.bindBuffer(b.type,
b.buffer);q.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:t}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/check":21,"./util/flatten":25,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/values":33}],4:[function(n,t,x){t.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,
"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(n,t,x){t.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(n,t,x){t.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(n,t,x){t.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(n,t,x){function c(b){return Array.isArray(b)||
L(b)||q(b)}function l(b){return b.sort(function(b,a){return"viewport"===b?-1:"viewport"===a?1:b<a?-1:1})}function g(b,a,d,c){this.thisDep=b;this.contextDep=a;this.propDep=d;this.append=c}function m(b){return b&&!(b.thisDep||b.contextDep||b.propDep)}function e(b){return new g(!1,!1,!1,b)}function f(b,a){var d=b.type;return 0===d?(d=b.data.length,new g(!0,1<=d,2<=d,a)):4===d?(d=b.data,new g(d.thisDep,d.contextDep,d.propDep,a)):new g(3===d,2===d,1===d,a)}var b=n("./util/check"),r=n("./util/codegen"),
z=n("./util/loop"),L=n("./util/is-typed-array"),q=n("./util/is-ndarray"),p=n("./util/is-array-like"),C=n("./dynamic"),H=n("./constants/primitives.json"),E=n("./constants/dtypes.json"),M=["x","y","z","w"],A="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),u={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,
"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},N="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
S={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},h={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},a={frag:35632,vert:35633},d={cw:2304,ccw:2305},F=new g(!1,!1,!1,function(){});t.exports=function(q,n,L,t,I,T,J,x,U,y,K,Ca,ka,pa,va){function Z(b){return b.replace(".","_")}function R(b,a,k){var d=Z(b);Ga.push(b);
la[d]=w[d]=!!k;za[d]=a}function O(b,a,k){var d=Z(b);Ga.push(b);Array.isArray(k)?(w[d]=k.slice(),la[d]=k.slice()):w[d]=la[d]=k;Aa[d]=a}function Ba(){var a=r(),k=a.link,d=a.global;a.id=Qa++;a.batchId="0";var c=k(Oa),e=a.shared={props:"a0"};Object.keys(Oa).forEach(function(b){e[b]=d.def(c,".",b)});b.optional(function(){a.CHECK=k(b);a.commandStr=b.guessCommand();a.command=k(a.commandStr);a.assert=function(b,a,G){b("if(!(",a,"))",this.CHECK,".commandRaise(",k(G),",",this.command,");")};Ha.invalidBlendCombinations=
N});var P=a.next={},f=a.current={};Object.keys(Aa).forEach(function(b){Array.isArray(w[b])&&(P[b]=d.def(e.next,".",b),f[b]=d.def(e.current,".",b))});var Ra=a.constants={};Object.keys(Ha).forEach(function(b){Ra[b]=d.def(JSON.stringify(Ha[b]))});a.invoke=function(b,G){switch(G.type){case 0:var d=["this",e.context,e.props,a.batchId];return b.def(k(G.data),".call(",d.slice(0,Math.max(G.data.length+1,4)),")");case 1:return b.def(e.props,G.data);case 2:return b.def(e.context,G.data);case 3:return b.def("this",
G.data);case 4:return G.data.append(a,b),G.data.ref}};a.attribCache={};var G={};a.scopeAttrib=function(b){b=n.id(b);if(b in G)return G[b];var a=y.scope[b];a||(a=y.scope[b]=new ra);return G[b]=k(a)};return a}function sa(b){var a=b["static"];b=b.dynamic;var k;if("profile"in a){var d=!!a.profile;k=e(function(b,a){return d});k.enable=d}else if("profile"in b){var c=b.profile;k=f(c,function(b,a){return b.invoke(a,c)})}return k}function wa(a,k){var d=a["static"],c=a.dynamic;if("framebuffer"in d){var h=d.framebuffer;
return h?(h=x.getFramebuffer(h),b.command(h,"invalid framebuffer object"),e(function(b,a){var k=b.link(h),d=b.shared;a.set(d.framebuffer,".next",k);d=d.context;a.set(d,".framebufferWidth",k+".width");a.set(d,".framebufferHeight",k+".height");return k})):e(function(b,a){var k=b.shared;a.set(k.framebuffer,".next","null");k=k.context;a.set(k,".framebufferWidth",k+".drawingBufferWidth");a.set(k,".framebufferHeight",k+".drawingBufferHeight");return"null"})}if("framebuffer"in c){var P=c.framebuffer;return f(P,
function(a,k){var d=a.invoke(k,P),D=a.shared,ga=D.framebuffer,c=k.def(ga,".getFramebuffer(",d,")");b.optional(function(){a.assert(k,"!"+d+"||"+c,"invalid framebuffer object")});k.set(ga,".next",c);D=D.context;k.set(D,".framebufferWidth",c+"?"+c+".width:"+D+".drawingBufferWidth");k.set(D,".framebufferHeight",c+"?"+c+".height:"+D+".drawingBufferHeight");return c})}return null}function aa(a,k,d){function c(a){if(a in e){var G=e[a];b.commandType(G,"object","invalid "+a,d.commandStr);var v=!0,ga=G.x|0,
h=G.y|0,w,p;"width"in G?(w=G.width|0,b.command(0<=w,"invalid "+a,d.commandStr)):v=!1;"height"in G?(p=G.height|0,b.command(0<=p,"invalid "+a,d.commandStr)):v=!1;return new g(!v&&k&&k.thisDep,!v&&k&&k.contextDep,!v&&k&&k.propDep,function(b,a){var k=b.shared.context,d=w;"width"in G||(d=a.def(k,".","framebufferWidth","-",ga));var c=p;"height"in G||(c=a.def(k,".","framebufferHeight","-",h));return[ga,h,d,c]})}if(a in P){var m=P[a],v=f(m,function(k,d){var G=k.invoke(d,m);b.optional(function(){k.assert(d,
G+"&&typeof "+G+'==="object"',"invalid "+a)});var c=k.shared.context,ga=d.def(G,".x|0"),v=d.def(G,".y|0"),D=d.def('"width" in ',G,"?",G,".width|0:","(",c,".","framebufferWidth","-",ga,")"),e=d.def('"height" in ',G,"?",G,".height|0:","(",c,".","framebufferHeight","-",v,")");b.optional(function(){k.assert(d,D+">=0&&"+e+">=0","invalid "+a)});return[ga,v,D,e]});k&&(v.thisDep=v.thisDep||k.thisDep,v.contextDep=v.contextDep||k.contextDep,v.propDep=v.propDep||k.propDep);return v}return k?new g(k.thisDep,
k.contextDep,k.propDep,function(b,a){var k=b.shared.context;return[0,0,a.def(k,".","framebufferWidth"),a.def(k,".","framebufferHeight")]}):null}var e=a["static"],P=a.dynamic;if(a=c("viewport")){var h=a;a=new g(a.thisDep,a.contextDep,a.propDep,function(b,a){var k=h.append(b,a),d=b.shared.context;a.set(d,".viewportWidth",k[2]);a.set(d,".viewportHeight",k[3]);return k})}return{viewport:a,scissor_box:c("scissor.box")}}function ja(k){function d(k){if(k in c){var G=n.id(c[k]);b.optional(function(){K.shader(a[k],
G,b.guessCommand())});var D=e(function(){return G});D.id=G;return D}if(k in h){var ga=h[k];return f(ga,function(d,G){var c=d.invoke(G,ga),D=G.def(d.shared.strings,".id(",c,")");b.optional(function(){G(d.shared.shader,".shader(",a[k],",",D,",",d.command,");")});return D})}return null}var c=k["static"],h=k.dynamic,w=d("frag"),P=d("vert"),p=null;m(w)&&m(P)?(p=K.program(P.id,w.id),k=e(function(b,a){return b.link(p)})):k=new g(w&&w.thisDep||P&&P.thisDep,w&&w.contextDep||P&&P.contextDep,w&&w.propDep||P&&
P.propDep,function(a,k){var d=a.shared.shader,c;c=w?w.append(a,k):k.def(d,".","frag");var D;D=P?P.append(a,k):k.def(d,".","vert");var v=d+".program("+D+","+c;b.optional(function(){v+=","+a.command});return k.def(v+")")});return{frag:w,vert:P,progVar:k,program:p}}function ma(a,k){function d(a,G){if(a in w){var c=w[a]|0;b.command(!G||0<=c,"invalid "+a,k.commandStr);return e(function(b,a){G&&(b.OFFSET=c);return c})}if(a in h){var ga=h[a];return f(ga,function(k,d){var c=k.invoke(d,ga);G&&(k.OFFSET=c,
b.optional(function(){k.assert(d,c+">=0","invalid "+a)}));return c})}return G&&P?e(function(b,a){b.OFFSET="0";return 0}):null}var w=a["static"],h=a.dynamic,P=function(){if("elements"in w){var a=w.elements;c(a)?a=T.getElements(T.create(a,!0)):a&&(a=T.getElements(a),b.command(a,"invalid elements",k.commandStr));var d=e(function(b,k){if(a){var d=b.link(a);return b.ELEMENTS=d}return b.ELEMENTS=null});d.value=a;return d}if("elements"in h){var v=h.elements;return f(v,function(a,k){var d=a.shared,G=d.isBufferArgs,
d=d.elements,c=a.invoke(k,v),D=k.def("null"),G=k.def(G,"(",c,")"),e=a.cond(G).then(D,"=",d,".createStream(",c,");")["else"](D,"=",d,".getElements(",c,");");b.optional(function(){a.assert(e["else"],"!"+c+"||"+D,"invalid elements")});k.entry(e);k.exit(a.cond(G).then(d,".destroyStream(",D,");"));return a.ELEMENTS=D})}return null}(),p=d("offset",!0);return{elements:P,primitive:function(){if("primitive"in w){var a=w.primitive;b.commandParameter(a,H,"invalid primitve",k.commandStr);return e(function(b,
k){return H[a]})}if("primitive"in h){var d=h.primitive;return f(d,function(a,k){var c=a.constants.primTypes,D=a.invoke(k,d);b.optional(function(){a.assert(k,D+" in "+c,"invalid primitive, must be one of "+Object.keys(H))});return k.def(c,"[",D,"]")})}return P?m(P)?P.value?e(function(b,a){return a.def(b.ELEMENTS,".primType")}):e(function(){return 4}):new g(P.thisDep,P.contextDep,P.propDep,function(b,a){var k=b.ELEMENTS;return a.def(k,"?",k,".primType:",4)}):null}(),count:function(){if("count"in w){var a=
w.count|0;b.command("number"===typeof a&&0<=a,"invalid vertex count",k.commandStr);return e(function(){return a})}if("count"in h){var d=h.count;return f(d,function(a,k){var c=a.invoke(k,d);b.optional(function(){a.assert(k,"typeof "+c+'==="number"&&'+c+">=0&&"+c+"===("+c+"|0)","invalid vertex count")});return c})}if(P){if(m(P)){if(P)return p?new g(p.thisDep,p.contextDep,p.propDep,function(a,k){var d=k.def(a.ELEMENTS,".vertCount-",a.OFFSET);b.optional(function(){a.assert(k,d+">=0","invalid vertex offset/element buffer too small")});
return d}):e(function(b,a){return a.def(b.ELEMENTS,".vertCount")});var c=e(function(){return-1});b.optional(function(){c.MISSING=!0});return c}var v=new g(P.thisDep||p.thisDep,P.contextDep||p.contextDep,P.propDep||p.propDep,function(b,a){var k=b.ELEMENTS;return b.OFFSET?a.def(k,"?",k,".vertCount-",b.OFFSET,":-1"):a.def(k,"?",k,".vertCount:-1")});b.optional(function(){v.DYNAMIC=!0});return v}return null}(),instances:d("instances",!1),offset:p}}function na(a,k){var c=a["static"],w=a.dynamic,m={};Ga.forEach(function(a){function v(b,
k){if(a in c){var d=b(c[a]);m[g]=e(function(){return d})}else if(a in w){var D=w[a];m[g]=f(D,function(b,a){return k(b,a,b.invoke(a,D))})}}var g=Z(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return v(function(d){b.commandType(d,"boolean",a,k.commandStr);return d},function(k,d,c){b.optional(function(){k.assert(d,"typeof "+c+'==="boolean"',
"invalid flag "+a,k.commandStr)});return c});case "depth.func":return v(function(d){b.commandParameter(d,S,"invalid "+a,k.commandStr);return S[d]},function(k,d,c){var v=k.constants.compareFuncs;b.optional(function(){k.assert(d,c+" in "+v,"invalid "+a+", must be one of "+Object.keys(S))});return d.def(v,"[",c,"]")});case "depth.range":return v(function(a){b.command(p(a)&&2===a.length&&"number"===typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",k.commandStr);return a},function(a,
k,d){b.optional(function(){a.assert(k,a.shared.isArrayLike+"("+d+")&&"+d+".length===2&&typeof "+d+'[0]==="number"&&typeof '+d+'[1]==="number"&&'+d+"[0]<="+d+"[1]","depth range must be a 2d array")});var c=k.def("+",d,"[0]"),v=k.def("+",d,"[1]");return[c,v]});case "blend.func":return v(function(a){b.commandType(a,"object","blend.func",k.commandStr);var d="srcRGB"in a?a.srcRGB:a.src,c="srcAlpha"in a?a.srcAlpha:a.src,v="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;b.commandParameter(d,
u,g+".srcRGB",k.commandStr);b.commandParameter(c,u,g+".srcAlpha",k.commandStr);b.commandParameter(v,u,g+".dstRGB",k.commandStr);b.commandParameter(a,u,g+".dstAlpha",k.commandStr);b.command(-1===N.indexOf(d+", "+v),"unallowed blending combination (srcRGB, dstRGB) = ("+d+", "+v+")",k.commandStr);return[u[d],u[v],u[c],u[a]]},function(k,d,c){function v(D,w){var h=d.def('"',D,w,'" in ',c,"?",c,".",D,w,":",c,".",D);b.optional(function(){k.assert(d,h+" in "+e,"invalid "+a+"."+D+w+", must be one of "+Object.keys(u))});
return h}var e=k.constants.blendFuncs;b.optional(function(){k.assert(d,c+"&&typeof "+c+'==="object"',"invalid blend func, must be an object")});var D=v("src","RGB"),w=v("dst","RGB");b.optional(function(){k.assert(d,k.constants.invalidBlendCombinations+".indexOf("+D+'+", "+'+w+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var h=d.def(e,"[",D,"]"),f=d.def(e,"[",v("src","Alpha"),"]"),p=d.def(e,"[",w,"]"),g=d.def(e,"[",v("dst","Alpha"),"]");return[h,p,f,g]});case "blend.equation":return v(function(d){if("string"===
typeof d)return b.commandParameter(d,ca,"invalid "+a,k.commandStr),[ca[d],ca[d]];if("object"===typeof d)return b.commandParameter(d.rgb,ca,a+".rgb",k.commandStr),b.commandParameter(d.alpha,ca,a+".alpha",k.commandStr),[ca[d.rgb],ca[d.alpha]];b.commandRaise("invalid blend.equation",k.commandStr)},function(k,d,c){var v=k.constants.blendEquations,e=d.def(),D=d.def(),w=k.cond("typeof ",c,'==="string"');b.optional(function(){function b(a,d,c){k.assert(a,c+" in "+v,"invalid "+d+", must be one of "+Object.keys(ca))}
b(w.then,a,c);k.assert(w["else"],c+"&&typeof "+c+'==="object"',"invalid "+a);b(w["else"],a+".rgb",c+".rgb");b(w["else"],a+".alpha",c+".alpha")});w.then(e,"=",D,"=",v,"[",c,"];");w["else"](e,"=",v,"[",c,".rgb];",D,"=",v,"[",c,".alpha];");d(w);return[e,D]});case "blend.color":return v(function(a){b.command(p(a)&&4===a.length,"blend.color must be a 4d array",k.commandStr);return z(4,function(b){return+a[b]})},function(a,k,d){b.optional(function(){a.assert(k,a.shared.isArrayLike+"("+d+")&&"+d+".length===4",
"blend.color must be a 4d array")});return z(4,function(b){return k.def("+",d,"[",b,"]")})});case "stencil.mask":return v(function(a){b.commandType(a,"number",g,k.commandStr);return a|0},function(a,k,d){b.optional(function(){a.assert(k,"typeof "+d+'==="number"',"invalid stencil.mask")});return k.def(d,"|0")});case "stencil.func":return v(function(d){b.commandType(d,"object",g,k.commandStr);var c=d.cmp||"keep",v=d.ref||0;d="mask"in d?d.mask:-1;b.commandParameter(c,S,a+".cmp",k.commandStr);b.commandType(v,
"number",a+".ref",k.commandStr);b.commandType(d,"number",a+".mask",k.commandStr);return[S[c],v,d]},function(a,k,d){var c=a.constants.compareFuncs;b.optional(function(){function b(){a.assert(k,Array.prototype.join.call(arguments,""),"invalid stencil.func")}b(d+"&&typeof ",d,'==="object"');b('!("cmp" in ',d,")||(",d,".cmp in ",c,")")});var v=k.def('"cmp" in ',d,"?",c,"[",d,".cmp]",":",7680),e=k.def(d,".ref|0"),D=k.def('"mask" in ',d,"?",d,".mask|0:-1");return[v,e,D]});case "stencil.opFront":case "stencil.opBack":return v(function(d){b.commandType(d,
"object",g,k.commandStr);var c=d.fail||"keep",v=d.zfail||"keep";d=d.zpass||"keep";b.commandParameter(c,h,a+".fail",k.commandStr);b.commandParameter(v,h,a+".zfail",k.commandStr);b.commandParameter(d,h,a+".zpass",k.commandStr);return["stencil.opBack"===a?1029:1028,h[c],h[v],h[d]]},function(k,d,c){function v(D){b.optional(function(){k.assert(d,'!("'+D+'" in '+c+")||("+c+"."+D+" in "+e+")","invalid "+a+"."+D+", must be one of "+Object.keys(h))});return d.def('"',D,'" in ',c,"?",e,"[",c,".",D,"]:",7680)}
var e=k.constants.stencilOps;b.optional(function(){k.assert(d,c+"&&typeof "+c+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,v("fail"),v("zfail"),v("zpass")]});case "polygonOffset.offset":return v(function(a){b.commandType(a,"object",g,k.commandStr);var d=a.factor|0;a=a.units|0;b.commandType(d,"number",g+".factor",k.commandStr);b.commandType(a,"number",g+".units",k.commandStr);return[d,a]},function(k,d,c){b.optional(function(){k.assert(d,c+"&&typeof "+c+'==="object"',"invalid "+
a)});var v=d.def(c,".factor|0"),e=d.def(c,".units|0");return[v,e]});case "cull.face":return v(function(a){var d=0;"front"===a?d=1028:"back"===a&&(d=1029);b.command(!!d,g,k.commandStr);return d},function(a,k,d){b.optional(function(){a.assert(k,d+'==="front"||'+d+'==="back"',"invalid cull.face")});return k.def(d,'==="front"?',1028,":",1029)});case "lineWidth":return v(function(a){b.command("number"===typeof a&&a>=t.lineWidthDims[0]&&a<=t.lineWidthDims[1],"invalid line width, must positive number between "+
t.lineWidthDims[0]+" and "+t.lineWidthDims[1],k.commandStr);return a},function(a,k,d){b.optional(function(){a.assert(k,"typeof "+d+'==="number"&&'+d+">="+t.lineWidthDims[0]+"&&"+d+"<="+t.lineWidthDims[1],"invalid line width")});return d});case "frontFace":return v(function(a){b.commandParameter(a,d,g,k.commandStr);return d[a]},function(a,k,d){b.optional(function(){a.assert(k,d+'==="cw"||'+d+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return k.def(d+'==="cw"?2304:2305')});case "colorMask":return v(function(a){b.command(p(a)&&
4===a.length,"color.mask must be length 4 array",k.commandStr);return a.map(function(b){return!!b})},function(a,k,d){b.optional(function(){a.assert(k,a.shared.isArrayLike+"("+d+")&&"+d+".length===4","invalid color.mask")});return z(4,function(a){return"!!"+d+"["+a+"]"})});case "sample.coverage":return v(function(a){b.command("object"===typeof a&&a,g,k.commandStr);var d="value"in a?a.value:1;a=!!a.invert;b.command("number"===typeof d&&0<=d&&1>=d,"sample.coverage.value must be a number between 0 and 1",
k.commandStr);return[d,a]},function(a,k,d){b.optional(function(){a.assert(k,d+"&&typeof "+d+'==="object"',"invalid sample.coverage")});var c=k.def('"value" in ',d,"?+",d,".value:1"),v=k.def("!!",d,".invert");return[c,v]})}});return m}function oa(a,k){var d=a["static"],c=a.dynamic,w={};Object.keys(d).forEach(function(a){var c=d[a],v;if("number"===typeof c||"boolean"===typeof c)v=e(function(){return c});else if("function"===typeof c){var h=c._reglType;"texture2d"===h||"textureCube"===h?v=e(function(a){return a.link(c)}):
"framebuffer"===h||"framebufferCube"===h?(b.command(0<c.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',k.commandStr),v=e(function(a){return a.link(c.color[0])})):b.commandRaise('invalid data for uniform "'+a+'"',k.commandStr)}else p(c)?v=e(function(k){return k.global.def("[",z(c.length,function(d){b.command("number"===typeof c[d]||"boolean"===typeof c[d],"invalid uniform "+a,k.commandStr);return c[d]}),"]")}):b.commandRaise('invalid or missing data for uniform "'+
a+'"',k.commandStr);v.value=c;w[a]=v});Object.keys(c).forEach(function(a){var b=c[a];w[a]=f(b,function(a,k){return a.invoke(k,b)})});return w}function qa(a,d){var w=a["static"],h=a.dynamic,g={};Object.keys(w).forEach(function(a){var v=w[a],h=n.id(a),f=new ra;if(c(v))f.state=1,f.buffer=I.getBuffer(I.create(v,34962,!1,!0)),f.type=0;else{var m=I.getBuffer(v);if(m)f.state=1,f.buffer=m,f.type=0;else if(b.command("object"===typeof v&&v,"invalid data for attribute "+a,d.commandStr),v.constant){var B=v.constant;
f.buffer="null";f.state=2;"number"===typeof B?f.x=B:(b.command(p(B)&&0<B.length&&4>=B.length,"invalid constant for attribute "+a,d.commandStr),M.forEach(function(a,b){b<B.length&&(f[a]=B[b])}))}else{m=c(v.buffer)?I.getBuffer(I.create(v.buffer,34962,!1,!0)):I.getBuffer(v.buffer);b.command(!!m,'missing buffer for attribute "'+a+'"',d.commandStr);var q=v.offset|0;b.command(0<=q,'invalid offset for attribute "'+a+'"',d.commandStr);var l=v.stride|0;b.command(0<=l&&256>l,'invalid stride for attribute "'+
a+'", must be integer betweeen [0, 255]',d.commandStr);var F=v.size|0;b.command(!("size"in v)||0<F&&4>=F,'invalid size for attribute "'+a+'", must be 1,2,3,4',d.commandStr);var r=!!v.normalized,u=0;"type"in v&&(b.commandParameter(v.type,E,"invalid type for attribute "+a,d.commandStr),u=E[v.type]);var z=v.divisor|0;"divisor"in v&&(b.command(0===z||k,'cannot specify divisor for attribute "'+a+'", instancing not supported',d.commandStr),b.command(0<=z,'invalid divisor for attribute "'+a+'"',d.commandStr));
b.optional(function(){var k=d.commandStr,c="buffer offset divisor normalized type size stride".split(" ");Object.keys(v).forEach(function(d){b.command(0<=c.indexOf(d),'unknown parameter "'+d+'" for attribute pointer "'+a+'" (valid parameters are '+c+")",k)})});f.buffer=m;f.state=1;f.size=F;f.normalized=r;f.type=u||m.dtype;f.offset=q;f.stride=l;f.divisor=z}}g[a]=e(function(a,b){var k=a.attribCache;if(h in k)return k[h];var d={isStream:!1};Object.keys(f).forEach(function(a){d[a]=f[a]});f.buffer&&(d.buffer=
a.link(f.buffer),d.type=d.type||d.buffer+".dtype");return k[h]=d})});Object.keys(h).forEach(function(a){var k=h[a];g[a]=f(k,function(d,c){function v(a){c(f[a],"=",e,".",a,"|0;")}var e=d.invoke(c,k),D=d.shared,w=D.isBufferArgs,h=D.buffer;b.optional(function(){d.assert(c,e+"&&(typeof "+e+'==="object"||typeof '+e+'==="function")&&('+w+"("+e+")||"+h+".getBuffer("+e+")||"+h+".getBuffer("+e+".buffer)||"+w+"("+e+'.buffer)||("constant" in '+e+"&&(typeof "+e+'.constant==="number"||'+D.isArrayLike+"("+e+".constant))))",
'invalid dynamic attribute "'+a+'"')});var f={isStream:c.def(!1)},p=new ra;p.state=1;Object.keys(p).forEach(function(a){f[a]=c.def(""+p[a])});var g=f.buffer,m=f.type;c("if(",w,"(",e,")){",f.isStream,"=true;",g,"=",h,".createStream(",34962,",",e,");",m,"=",g,".dtype;","}else{",g,"=",h,".getBuffer(",e,");","if(",g,"){",m,"=",g,".dtype;",'}else if("constant" in ',e,"){",f.state,"=",2,";","if(typeof "+e+'.constant === "number"){',f[M[0]],"=",e,".constant;",M.slice(1).map(function(a){return f[a]}).join("="),
"=0;","}else{",M.map(function(a,b){return f[a]+"="+e+".constant.length>="+b+"?"+e+".constant["+b+"]:0;"}).join(""),"}}else{","if(",w,"(",e,".buffer)){",g,"=",h,".createStream(",34962,",",e,".buffer);","}else{",g,"=",h,".getBuffer(",e,".buffer);","}",m,'="type" in ',e,"?",D.glTypes,"[",e,".type]:",g,".dtype;",f.normalized,"=!!",e,".normalized;");v("size");v("offset");v("stride");v("divisor");c("}}");c.exit("if(",f.isStream,"){",h,".destroyStream(",g,");","}");return f})});return g}function xa(a){var b=
a["static"],k=a.dynamic,d={};Object.keys(b).forEach(function(a){var k=b[a];d[a]=e(function(a,b){return"number"===typeof k||"boolean"===typeof k?""+k:a.link(k)})});Object.keys(k).forEach(function(a){var b=k[a];d[a]=f(b,function(a,k){return a.invoke(k,b)})});return d}function W(a,k,d,c,e){function w(a){var b=p[a];b&&(B[a]=b)}var h=a["static"],f=a.dynamic;b.optional(function(){function a(d){Object.keys(d).forEach(function(a){b.command(0<=k.indexOf(a),'unknown parameter "'+a+'"',e.commandStr)})}var k=
"framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(Ga);a(h);a(f)});var g=wa(a,e),p=aa(a,g,e),m=ma(a,e),B=na(a,e),q=ja(a,e);w("viewport");w(Z("scissor.box"));var l=0<Object.keys(B).length,g={framebuffer:g,draw:m,shader:q,state:B,dirty:l};g.profile=sa(a,e);g.uniforms=oa(d,e);g.attributes=qa(k,e);g.context=xa(c,e);return g}function X(a,b,k){var d=a.shared.context,c=a.scope();Object.keys(k).forEach(function(e){b.save(d,"."+e);c(d,".",e,"=",k[e].append(a,b),";")});
b(c)}function ha(a,b,k,d){var c=a.shared,e=c.gl,w=c.framebuffer,h;B&&(h=b.def(c.extensions,".webgl_draw_buffers"));var f=a.constants,c=f.drawBuffer,f=f.backBuffer;a=k?k.append(a,b):b.def(w,".next");d||b("if(",a,"!==",w,".cur){");b("if(",a,"){",e,".bindFramebuffer(",36160,",",a,".framebuffer);");B&&b(h,".drawBuffersWEBGL(",c,"[",a,".colorAttachments.length]);");b("}else{",e,".bindFramebuffer(",36160,",null);");B&&b(h,".drawBuffersWEBGL(",f,");");b("}",w,".cur=",a,";");d||b("}")}function V(a,b,k){var d=
a.shared,c=d.gl,e=a.current,h=a.next,f=d.current,g=d.next,p=a.cond(f,".dirty");Ga.forEach(function(b){b=Z(b);if(!(b in k.state)){var d,D;if(b in h){d=h[b];D=e[b];var m=z(w[b].length,function(a){return p.def(d,"[",a,"]")});p(a.cond(m.map(function(a,b){return a+"!=="+D+"["+b+"]"}).join("||")).then(c,".",Aa[b],"(",m,");",m.map(function(a,b){return D+"["+b+"]="+a}).join(";"),";"))}else d=p.def(g,".",b),m=a.cond(d,"!==",f,".",b),p(m),b in za?m(a.cond(d).then(c,".enable(",za[b],");")["else"](c,".disable(",
za[b],");"),f,".",b,"=",d,";"):m(c,".",Aa[b],"(",d,");",f,".",b,"=",d,";")}});0===Object.keys(k.state).length&&p(f,".dirty=false;");b(p)}function Q(a,b,d,k){var c=a.shared,e=a.current,w=c.current,f=c.gl;l(Object.keys(d)).forEach(function(c){var h=d[c];if(!k||k(h)){var g=h.append(a,b);if(za[c]){var B=za[c];m(h)?g?b(f,".enable(",B,");"):b(f,".disable(",B,");"):b(a.cond(g).then(f,".enable(",B,");")["else"](f,".disable(",B,");"));b(w,".",c,"=",g,";")}else if(p(g)){var q=e[c];b(f,".",Aa[c],"(",g,");",
g.map(function(a,b){return q+"["+b+"]="+a}).join(";"),";")}else b(f,".",Aa[c],"(",g,");",w,".",c,"=",g,";")}})}function Y(a,b){k&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function ea(a,b,d,k,c){function e(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function w(a){l=b.def();a(l,"=",e(),";");"string"===typeof c?a(p,".count+=",c,";"):a(p,".count++;");pa&&(k?(F=b.def(),a(F,"=",q,".getNumPendingQueries();")):a(q,".beginQuery(",p,");"))}function f(a){a(p,
".cpuTime+=",e(),"-",l,";");pa&&(k?a(q,".pushScopeStats(",F,",",q,".getNumPendingQueries(),",p,");"):a(q,".endQuery();"))}function h(a){var d=b.def(B,".profile");b(B,".profile=",a,";");b.exit(B,".profile=",d,";")}var g=a.shared,p=a.stats,B=g.current,q=g.timer;d=d.profile;var l,F;if(d){if(m(d)){d.enable?(w(b),f(b.exit),h("true")):h("false");return}d=d.append(a,b);h(d)}else d=b.def(B,".profile");g=a.block();w(g);b("if(",d,"){",g,"}");a=a.block();f(a);b.exit("if(",d,"){",a,"}")}function ya(a,d,c,e,w){function f(a){switch(a){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function h(b,c,e){function w(){d("if(!",B,".buffer){",p,".enableVertexAttribArray(",m,");}");var b=e.type,f;f=e.size?d.def(e.size,"||",c):c;d("if(",B,".type!==",b,"||",B,".size!==",f,"||",F.map(function(a){return B+"."+a+"!=="+e[a]}).join("||"),"){",p,".bindBuffer(",34962,",",q,".buffer);",p,".vertexAttribPointer(",[m,f,b,e.normalized,e.stride,e.offset],");",B,".type=",b,";",B,".size=",f,";",F.map(function(a){return B+
"."+a+"="+e[a]+";"}).join(""),"}");k&&(b=e.divisor,d("if(",B,".divisor!==",b,"){",a.instancing,".vertexAttribDivisorANGLE(",[m,b],");",B,".divisor=",b,";}"))}function f(){d("if(",B,".buffer){",p,".disableVertexAttribArray(",m,");","}if(",M.map(function(a,b){return B+"."+a+"!=="+l[b]}).join("||"),"){",p,".vertexAttrib4f(",m,",",l,");",M.map(function(a,b){return B+"."+a+"="+l[b]+";"}).join(""),"}")}var p=g.gl,m=d.def(b,".location"),B=d.def(g.attributes,"[",m,"]");b=e.state;var q=e.buffer,l=[e.x,e.y,
e.z,e.w],F=["buffer","normalized","offset","stride"];1===b?w():2===b?f():(d("if(",b,"===",1,"){"),w(),d("}else{"),f(),d("}"))}var g=a.shared;e.forEach(function(k){var e=k.name,g=c.attributes[e],p;if(g){if(!w(g))return;p=g.append(a,d)}else{if(!w(F))return;var m=a.scopeAttrib(e);b.optional(function(){a.assert(d,m+".state","missing attribute "+e)});p={};Object.keys(new ra).forEach(function(a){p[a]=d.def(m,".",a)})}h(a.link(k),f(k.info.type),p)})}function ia(a,d,k,c,e){for(var f=a.shared,w=f.gl,h,g=0;g<
c.length;++g){var B=c[g],q=B.name,l=B.info.type,r=k.uniforms[q],B=a.link(B)+".location",u;if(r){if(!e(r))continue;if(m(r)){var y=r.value;b.command(null!==y&&"undefined"!==typeof y,'missing uniform "'+q+'"',a.commandStr);if(35678===l||35680===l)b.command("function"===typeof y&&(35678===l&&("texture2d"===y._reglType||"framebuffer"===y._reglType)||35680===l&&("textureCube"===y._reglType||"framebufferCube"===y._reglType)),"invalid texture for uniform "+q,a.commandStr),r=a.link(y._texture||y.color[0]._texture),
d(w,".uniform1i(",B,",",r+".bind());"),d.exit(r,".unbind();");else if(35674===l||35675===l||35676===l){b.optional(function(){b.command(p(y),"invalid matrix for uniform "+q,a.commandStr);b.command(35674===l&&4===y.length||35675===l&&9===y.length||35676===l&&16===y.length,"invalid length for matrix uniform "+q,a.commandStr)});var r=a.global.def("new Float32Array(["+Array.prototype.slice.call(y)+"])"),la=2;35675===l?la=3:35676===l&&(la=4);d(w,".uniformMatrix",la,"fv(",B,",false,",r,");")}else{switch(l){case 5126:b.commandType(y,
"number","uniform "+q,a.commandStr);h="1f";break;case 35664:b.command(p(y)&&2===y.length,"uniform "+q,a.commandStr);h="2f";break;case 35665:b.command(p(y)&&3===y.length,"uniform "+q,a.commandStr);h="3f";break;case 35666:b.command(p(y)&&4===y.length,"uniform "+q,a.commandStr);h="4f";break;case 35670:b.commandType(y,"boolean","uniform "+q,a.commandStr);h="1i";break;case 5124:b.commandType(y,"number","uniform "+q,a.commandStr);h="1i";break;case 35671:b.command(p(y)&&2===y.length,"uniform "+q,a.commandStr);
h="2i";break;case 35667:b.command(p(y)&&2===y.length,"uniform "+q,a.commandStr);h="2i";break;case 35672:b.command(p(y)&&3===y.length,"uniform "+q,a.commandStr);h="3i";break;case 35668:b.command(p(y)&&3===y.length,"uniform "+q,a.commandStr);h="3i";break;case 35673:b.command(p(y)&&4===y.length,"uniform "+q,a.commandStr);h="4i";break;case 35669:b.command(p(y)&&4===y.length,"uniform "+q,a.commandStr),h="4i"}d(w,".uniform",h,"(",B,",",p(y)?Array.prototype.slice.call(y):y,");")}continue}else u=r.append(a,
d)}else{if(!e(F))continue;u=d.def(f.uniforms,"[",n.id(q),"]")}35678===l?d("if(",u,"&&",u,'._reglType==="framebuffer"){',u,"=",u,".color[0];","}"):35680===l&&d("if(",u,"&&",u,'._reglType==="framebufferCube"){',u,"=",u,".color[0];","}");b.optional(function(){function b(k,c){a.assert(d,k,'bad data or missing for uniform "'+q+'".  '+c)}function k(a){b("typeof "+u+'==="'+a+'"',"invalid type, expected "+a)}function c(d,k){b(f.isArrayLike+"("+u+")&&"+u+".length==="+d,"invalid vector, should have length "+
d,a.commandStr)}function e(d){b("typeof "+u+'==="function"&&'+u+'._reglType==="texture'+(3553===d?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(l){case 5124:k("number");break;case 35667:c(2,"number");break;case 35668:c(3,"number");break;case 35669:c(4,"number");break;case 5126:k("number");break;case 35664:c(2,"number");break;case 35665:c(3,"number");break;case 35666:c(4,"number");break;case 35670:k("boolean");break;case 35671:c(2,"boolean");break;case 35672:c(3,"boolean");break;case 35673:c(4,
"boolean");break;case 35674:c(4,"number");break;case 35675:c(9,"number");break;case 35676:c(16,"number");break;case 35678:e(3553);break;case 35680:e(34067)}});r=1;switch(l){case 35678:case 35680:r=d.def(u,"._texture");d(w,".uniform1i(",B,",",r,".bind());");d.exit(r,".unbind();");continue;case 5124:case 35670:h="1i";break;case 35667:case 35671:h="2i";r=2;break;case 35668:case 35672:h="3i";r=3;break;case 35669:case 35673:h="4i";r=4;break;case 5126:h="1f";break;case 35664:h="2f";r=2;break;case 35665:h=
"3f";r=3;break;case 35666:h="4f";r=4;break;case 35674:h="Matrix2fv";break;case 35675:h="Matrix3fv";break;case 35676:h="Matrix4fv"}d(w,".uniform",h,"(",B,",");if("M"===h.charAt(0)){var B=Math.pow(l-35674+2,2),da=a.global.def("new Float32Array(",B,")");d("false,(Array.isArray(",u,")||",u," instanceof Float32Array)?",u,":(",z(B,function(a){return da+"["+a+"]="+u+"["+a+"]"}),",",da,")")}else 1<r?d(z(r,function(a){return u+"["+a+"]"})):d(u);d(");")}}function ta(a,d,c,e){function h(b){var k=q[b];return k?
k.contextDep&&e.contextDynamic||k.propDep?k.append(a,c):k.append(a,d):d.def(B,".",b)}function f(){function a(){c(n,".drawElementsInstancedANGLE(",[r,y,z,u+"<<(("+z+"-5121)>>1)",F],");")}function b(){c(n,".drawArraysInstancedANGLE(",[r,u,y,F],");")}l?la?a():(c("if(",l,"){"),a(),c("}else{"),b(),c("}")):b()}function w(){function a(){c(p+".drawElements("+[r,y,z,u+"<<(("+z+"-5121)>>1)"]+");")}function b(){c(p+".drawArrays("+[r,u,y]+");")}l?la?a():(c("if(",l,"){"),a(),c("}else{"),b(),c("}")):b()}var g=
a.shared,p=g.gl,B=g.draw,q=e.draw,l=function(){var b=q.elements,k=d;if(b){if(b.contextDep&&e.contextDynamic||b.propDep)k=c;b=b.append(a,k)}else b=k.def(B,".","elements");b&&k("if("+b+")"+p+".bindBuffer(34963,"+b+".buffer.buffer);");return b}(),r=h("primitive"),u=h("offset"),y=function(){var k=q.count,h,f=d;if(k){if(k.contextDep&&e.contextDynamic||k.propDep)f=c;h=k.append(a,f);b.optional(function(){k.MISSING&&a.assert(d,"false","missing vertex count");k.DYNAMIC&&a.assert(f,h+">=0","missing vertex count")})}else h=
f.def(B,".","count"),b.optional(function(){a.assert(f,h+">=0","missing vertex count")});return h}();if("number"===typeof y){if(0===y)return}else c("if(",y,"){"),c.exit("}");var F,n;k&&(F=h("instances"),n=a.instancing);var z=l+".type",la=q.elements&&m(q.elements);k&&("number"!==typeof F||0<=F)?"string"===typeof F?(c("if(",F,">0){"),f(),c("}else if(",F,"<0){"),w(),c("}")):f():w()}function Da(a,d,c,e,h){var f=Ba();h=f.proc("body",h);b.optional(function(){f.commandStr=d.commandStr;f.command=f.link(d.commandStr)});
k&&(f.instancing=h.def(f.shared.extensions,".angle_instanced_arrays"));a(f,h,c,e);return f.compile().body}function Fa(a,b,d,k){Y(a,b);ya(a,b,d,k.attributes,function(){return!0});ia(a,b,d,k.uniforms,function(){return!0});ta(a,b,b,d)}function Ia(a,b){var d=a.proc("draw",1);Y(a,d);X(a,d,b.context);ha(a,d,b.framebuffer);V(a,d,b);Q(a,d,b.state);ea(a,d,b,!1,!0);var k=b.shader.progVar.append(a,d);d(a.shared.gl,".useProgram(",k,".program);");if(b.shader.program)Fa(a,d,b,b.shader.program);else{var c=a.global.def("{}"),
e=d.def(k,".id"),h=d.def(c,"[",e,"]");d(a.cond(h).then(h,".call(this,a0);")["else"](h,"=",c,"[",e,"]=",a.link(function(d){return Da(Fa,a,b,d,1)}),"(",k,");",h,".call(this,a0);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function Ea(a,b,d,k){function c(){return!0}a.batchId="a1";Y(a,b);ya(a,b,d,k.attributes,c);ia(a,b,d,k.uniforms,c);ta(a,b,b,d)}function Ja(a,b,d,k){function c(a){return a.contextDep&&h||a.propDep}function e(a){return!c(a)}Y(a,b);var h=d.contextDep,f=b.def(),
w=b.def();a.shared.props=w;a.batchId=f;var g=a.scope(),p=a.scope();b(g.entry,"for(",f,"=0;",f,"<","a1",";++",f,"){",w,"=","a0","[",f,"];",p,"}",g.exit);d.needsContext&&X(a,p,d.context);d.needsFramebuffer&&ha(a,p,d.framebuffer);Q(a,p,d.state,c);d.profile&&c(d.profile)&&ea(a,p,d,!1,!0);k?(ya(a,g,d,k.attributes,e),ya(a,p,d,k.attributes,c),ia(a,g,d,k.uniforms,e),ia(a,p,d,k.uniforms,c),ta(a,g,p,d)):(b=a.global.def("{}"),k=d.shader.progVar.append(a,p),w=p.def(k,".id"),g=p.def(b,"[",w,"]"),p(a.shared.gl,
".useProgram(",k,".program);","if(!",g,"){",g,"=",b,"[",w,"]=",a.link(function(b){return Da(Ea,a,d,b,2)}),"(",k,");}",g,".call(this,a0[",f,"],",f,");"))}function Ka(a,b){function d(a){return a.contextDep&&c||a.propDep}var k=a.proc("batch",2);a.batchId="0";Y(a,k);var c=!1,e=!0;Object.keys(b.context).forEach(function(a){c=c||b.context[a].propDep});c||(X(a,k,b.context),e=!1);var h=b.framebuffer,f=!1;h?(h.propDep?c=f=!0:h.contextDep&&c&&(f=!0),f||ha(a,k,h)):ha(a,k,null);b.state.viewport&&b.state.viewport.propDep&&
(c=!0);V(a,k,b);Q(a,k,b.state,function(a){return!d(a)});b.profile&&d(b.profile)||ea(a,k,b,!1,"a1");b.contextDep=c;b.needsContext=e;b.needsFramebuffer=f;e=b.shader.progVar;if(e.contextDep&&c||e.propDep)Ja(a,k,b,null);else if(e=e.append(a,k),k(a.shared.gl,".useProgram(",e,".program);"),b.shader.program)Ja(a,k,b,b.shader.program);else{var h=a.global.def("{}"),f=k.def(e,".id"),w=k.def(h,"[",f,"]");k(a.cond(w).then(w,".call(this,a0,a1);")["else"](w,"=",h,"[",f,"]=",a.link(function(d){return Da(Ja,a,b,
d,2)}),"(",e,");",w,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&k(a.shared.current,".dirty=true;")}function La(a,b){function d(e){var h=b.shader[e];h&&k.set(c.shader,"."+e,h.append(a,k))}var k=a.proc("scope",3);a.batchId="a2";var c=a.shared,e=c.current;X(a,k,b.context);b.framebuffer&&b.framebuffer.append(a,k);l(Object.keys(b.state)).forEach(function(d){var e=b.state[d].append(a,k);p(e)?e.forEach(function(b,c){k.set(a.next[d],"["+c+"]",b)}):k.set(c.next,"."+d,e)});ea(a,k,b,!0,!0);["elements",
"offset","count","instances","primitive"].forEach(function(d){var e=b.draw[d];e&&k.set(c.draw,"."+d,""+e.append(a,k))});Object.keys(b.uniforms).forEach(function(d){k.set(c.uniforms,"["+n.id(d)+"]",b.uniforms[d].append(a,k))});Object.keys(b.attributes).forEach(function(d){var c=b.attributes[d].append(a,k),e=a.scopeAttrib(d);Object.keys(new ra).forEach(function(a){k.set(e,"."+a,c[a])})});d("vert");d("frag");0<Object.keys(b.state).length&&(k(e,".dirty=true;"),k.exit(e,".dirty=true;"));k("a1(",a.shared.context,
",a0,",a.batchId,");")}function Pa(a){if("object"===typeof a&&!p(a)){for(var b=Object.keys(a),d=0;d<b.length;++d)if(C.isDynamic(a[b[d]]))return!0;return!1}}function ua(a,b,d){function k(a,b){h.forEach(function(d){var k=c[d];C.isDynamic(k)&&(k=a.invoke(b,k),b(B,".",d,"=",k,";"))})}var c=b["static"][d];if(c&&Pa(c)){var e=a.global,h=Object.keys(c),w=!1,g=!1,p=!1,B=a.global.def("{}");h.forEach(function(b){var d=c[b];if(C.isDynamic(d))"function"===typeof d&&(d=c[b]=C.unbox(d)),b=f(d,null),w=w||b.thisDep,
p=p||b.propDep,g=g||b.contextDep;else{e(B,".",b,"=");switch(typeof d){case "number":e(d);break;case "string":e('"',d,'"');break;case "object":Array.isArray(d)&&e("[",d.join(),"]");break;default:e(a.link(d))}e(";")}});b.dynamic[d]=new C.DynamicVariable(4,{thisDep:w,contextDep:g,propDep:p,ref:B,append:k});delete b["static"][d]}}var ra=y.Record,ca={add:32774,subtract:32778,"reverse subtract":32779};L.ext_blend_minmax&&(ca.min=32775,ca.max=32776);var k=L.angle_instanced_arrays,B=L.webgl_draw_buffers,
w={dirty:!0,profile:va.profile},la={},Ga=[],za={},Aa={};R("dither",3024);R("blend.enable",3042);O("blend.color","blendColor",[0,0,0,0]);O("blend.equation","blendEquationSeparate",[32774,32774]);O("blend.func","blendFuncSeparate",[1,0,1,0]);R("depth.enable",2929,!0);O("depth.func","depthFunc",513);O("depth.range","depthRange",[0,1]);O("depth.mask","depthMask",!0);O("colorMask","colorMask",[!0,!0,!0,!0]);R("cull.enable",2884);O("cull.face","cullFace",1029);O("frontFace","frontFace",2305);O("lineWidth",
"lineWidth",1);R("polygonOffset.enable",32823);O("polygonOffset.offset","polygonOffset",[0,0]);R("sample.alpha",32926);R("sample.enable",32928);O("sample.coverage","sampleCoverage",[1,!1]);R("stencil.enable",2960);O("stencil.mask","stencilMask",-1);O("stencil.func","stencilFunc",[519,0,-1]);O("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);O("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);R("scissor.enable",3089);O("scissor.box","scissor",[0,0,q.drawingBufferWidth,q.drawingBufferHeight]);
O("viewport","viewport",[0,0,q.drawingBufferWidth,q.drawingBufferHeight]);var Oa={gl:q,context:ka,strings:n,next:la,current:w,draw:Ca,elements:T,buffer:I,shader:K,attributes:y.state,uniforms:U,framebuffer:x,extensions:L,timer:pa,isBufferArgs:c},Ha={primTypes:H,compareFuncs:S,blendFuncs:u,blendEquations:ca,stencilOps:h,glTypes:E,orientationType:d};b.optional(function(){Oa.isArrayLike=p});B&&(Ha.backBuffer=[1029],Ha.drawBuffer=z(t.maxDrawbuffers,function(a){return 0===a?[0]:z(a,function(a){return 36064+
a})}));var Qa=0;return{next:la,current:w,procs:function(){var a=Ba(),b=a.proc("poll"),d=a.proc("refresh"),k=a.block();b(k);d(k);var c=a.shared,e=c.gl,h=c.next,f=c.current;k(f,".dirty=false;");ha(a,b);ha(a,d,null,!0);var g=q.getExtension("angle_instanced_arrays"),B;g&&(B=a.link(g));for(var m=0;m<t.maxAttributes;++m){var l=d.def(c.attributes,"[",m,"]"),r=a.cond(l,".buffer");r.then(e,".enableVertexAttribArray(",m,");",e,".bindBuffer(",34962,",",l,".buffer.buffer);",e,".vertexAttribPointer(",m,",",l,
".size,",l,".type,",l,".normalized,",l,".stride,",l,".offset);")["else"](e,".disableVertexAttribArray(",m,");",e,".vertexAttrib4f(",m,",",l,".x,",l,".y,",l,".z,",l,".w);",l,".buffer=null;");d(r);g&&d(B,".vertexAttribDivisorANGLE(",m,",",l,".divisor);")}Object.keys(za).forEach(function(c){var w=za[c],g=k.def(h,".",c),p=a.block();p("if(",g,"){",e,".enable(",w,")}else{",e,".disable(",w,")}",f,".",c,"=",g,";");d(p);b("if(",g,"!==",f,".",c,"){",p,"}")});Object.keys(Aa).forEach(function(c){var g=Aa[c],
B=w[c],m,l,q=a.block();q(e,".",g,"(");p(B)?(g=B.length,m=a.global.def(h,".",c),l=a.global.def(f,".",c),q(z(g,function(a){return m+"["+a+"]"}),");",z(g,function(a){return l+"["+a+"]="+m+"["+a+"];"}).join("")),b("if(",z(g,function(a){return m+"["+a+"]!=="+l+"["+a+"]"}).join("||"),"){",q,"}")):(m=k.def(h,".",c),l=k.def(f,".",c),q(m,");",f,".",c,"=",m,";"),b("if(",m,"!==",l,"){",q,"}"));d(q)});return a.compile()}(),compile:function(a,b,d,k,c){var e=Ba();e.stats=e.link(c);Object.keys(b["static"]).forEach(function(a){ua(e,
b,a)});A.forEach(function(b){ua(e,a,b)});d=W(a,b,d,k,e);Ia(e,d);La(e,d);Ka(e,d);return e.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/check":21,"./util/codegen":23,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/loop":29}],9:[function(n,t,x){function c(c,f){this.id=m++;this.type=c;this.data=f}function l(c){if(0===c.length)return[];var f=c.charAt(0),b=c.charAt(c.length-1);if(1<c.length&&f===b&&('"'===f||"'"===f))return['"'+
c.substr(1,c.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(f=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(c))return l(c.substr(0,f.index)).concat(l(f[1])).concat(l(c.substr(f.index+f[0].length)));f=c.split(".");if(1===f.length)return['"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];c=[];for(b=0;b<f.length;++b)c=c.concat(l(f[b]));return c}function g(c){return"["+l(c).join("][")+"]"}var m=0;t.exports={DynamicVariable:c,define:function(e,f){return new c(e,g(f+""))},isDynamic:function(e){return"function"===
typeof e&&!e._reglType||e instanceof c},unbox:function(e,f){return"function"===typeof e?new c(0,e):e},accessor:g}},{}],10:[function(n,t,x){var c=n("./util/check"),l=n("./util/is-typed-array"),g=n("./util/is-ndarray"),m=n("./util/values"),e=n("./constants/primitives.json"),f=n("./constants/usage.json");t.exports=function(b,r,n,L){function q(b){this.id=E++;t[this.id]=this;this.buffer=b;this.primType=4;this.type=this.vertCount=0}function p(e,f,p,h,a,d,m){e.buffer.bind();if(f){var q=m;m||l(f)&&(!g(f)||
l(f.data))||(q=r.oes_element_index_uint?5125:5123);n._initBuffer(e.buffer,f,p,q,3)}else b.bufferData(34963,d,p),e.buffer.dtype=q||5121,e.buffer.usage=p,e.buffer.dimension=3,e.buffer.byteLength=d;q=m;if(!m){switch(e.buffer.dtype){case 5121:case 5120:q=5121;break;case 5123:case 5122:q=5123;break;case 5125:case 5124:q=5125;break;default:c.raise("unsupported type for element array")}e.buffer.dtype=q}e.type=q;c(5125!==q||!!r.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");
f=a;0>f&&(f=e.buffer.byteLength,5123===q?f>>=1:5125===q&&(f>>=2));e.vertCount=f;f=h;0>h&&(f=4,h=e.buffer.dimension,1===h&&(f=0),2===h&&(f=1),3===h&&(f=4));e.primType=f}function C(b){L.elementsCount--;c(null!==b.buffer,"must not double destroy elements");delete t[b.id];b.buffer.destroy();b.buffer=null}var t={},E=0,M={uint8:5121,uint16:5123};r.oes_element_index_uint&&(M.uint32=5125);q.prototype.bind=function(){this.buffer.bind()};var A=[];return{create:function(b,m){function r(b){if(b)if("number"===
typeof b)h(b),a.primType=4,a.vertCount=b|0,a.type=5121;else{var m=null,q=35044,n=-1,u=-1,z=0,A=0;if(Array.isArray(b)||l(b)||g(b))m=b;else if(c.type(b,"object","invalid arguments for elements"),"data"in b&&(m=b.data,c(Array.isArray(m)||l(m)||g(m),"invalid data for element buffer")),"usage"in b&&(c.parameter(b.usage,f,"invalid element buffer usage"),q=f[b.usage]),"primitive"in b&&(c.parameter(b.primitive,e,"invalid element buffer primitive"),n=e[b.primitive]),"count"in b&&(c("number"===typeof b.count&&
0<=b.count,"invalid vertex count for elements"),u=b.count|0),"type"in b&&(c.parameter(b.type,M,"invalid buffer type"),A=M[b.type]),"length"in b)z=b.length|0;else if(z=u,5123===A||5122===A)z*=2;else if(5125===A||5124===A)z*=4;p(a,m,q,n,u,z,A)}else h(),a.primType=4,a.vertCount=0,a.type=5121;return r}var h=n.create(null,34963,!0),a=new q(h._buffer);L.elementsCount++;r(b);r._reglType="elements";r._elements=a;r.subdata=function(a,b){h.subdata(a,b);return r};r.destroy=function(){C(a)};return r},createStream:function(b){var c=
A.pop();c||(c=new q(n.create(null,34963,!0,!1)._buffer));p(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){A.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof q?b._elements:null},clear:function(){m(t).forEach(C)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/check":21,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/values":33}],11:[function(n,t,x){var c=n("./util/check");t.exports=function(l,g){function m(b){c.type(b,"string",
"extension name must be string");b=b.toLowerCase();var f;try{f=e[b]=l.getExtension(b)}catch(g){}return!!f}for(var e={},f=0;f<g.extensions.length;++f){var b=g.extensions[f];if(!m(b))return g.onDestroy(),g.onDone('"'+b+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}g.optionalExtensions.forEach(m);return{extensions:e,restore:function(){Object.keys(e).forEach(function(b){if(!m(b))throw Error("(regl): error restoring extension "+b);})}}}},
{"./util/check":21}],12:[function(n,t,x){var c=n("./util/check"),l=n("./util/values"),g=n("./util/extend"),m=[6408],e=[];e[6408]=4;var f=[];f[5121]=1;f[5126]=4;f[36193]=2;var b=[32854,32855,36194,35907,34842,34843,34836],r={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"};t.exports=function(n,L,q,p,C,t){function E(a,b,d){this.target=a;this.texture=b;this.renderbuffer=d;var c=a=0;b?(a=b.width,c=b.height):d&&(a=
d.width,c=d.height);this.width=a;this.height=c}function M(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function A(a,b,d){if(a){if(a.texture){a=a.texture._texture;var e=Math.max(1,a.height);c(Math.max(1,a.width)===b&&e===d,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,c(a.width===b&&a.height===d,"inconsistent width/height for renderbuffer");a.refCount+=1}}function u(a,b){b&&(b.texture?n.framebufferTexture2D(36160,
a,b.target,b.texture._texture.texture,0):n.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer))}function N(a){var b=3553,d=null,e=null,f=a;"object"===typeof a&&(f=a.data,"target"in a&&(b=a.target|0));c.type(f,"function","invalid attachment data");a=f._reglType;"texture2d"===a?(d=f,c(3553===b)):"textureCube"===a?(d=f,c(34069<=b&&34075>b,"invalid cube map target")):"renderbuffer"===a?(e=f,b=36161):c.raise("invalid regl object for attachment");return new E(b,d,e)}function S(a,
b,d,c,e){if(d)return a=p.create2D({width:a,height:b,format:c,type:e}),a._texture.refCount=0,new E(3553,a,null);a=C.create({width:a,height:b,format:c});a._renderbuffer.refCount=0;return new E(36161,null,a)}function h(a){return a&&(a.texture||a.renderbuffer)}function a(a,b,d){a&&(a.texture?a.texture.resize(b,d):a.renderbuffer&&a.renderbuffer.resize(b,d))}function d(){this.id=ba++;U[this.id]=this;this.framebuffer=n.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=
this.stencilAttachment=this.depthAttachment=null}function F(a){a.colorAttachments.forEach(M);M(a.depthAttachment);M(a.stencilAttachment);M(a.depthStencilAttachment)}function da(a){var b=a.framebuffer;c(b,"must not double destroy framebuffer");n.deleteFramebuffer(b);a.framebuffer=null;t.framebufferCount--;delete U[a.id]}function Ma(a){var b;n.bindFramebuffer(36160,a.framebuffer);var d=a.colorAttachments;for(b=0;b<d.length;++b)u(36064+b,d[b]);for(b=d.length;b<q.maxColorAttachments;++b)n.framebufferTexture2D(36160,
36064+b,3553,null,0);n.framebufferTexture2D(36160,33306,3553,null,0);n.framebufferTexture2D(36160,36096,3553,null,0);n.framebufferTexture2D(36160,36128,3553,null,0);u(36096,a.depthAttachment);u(36128,a.stencilAttachment);u(33306,a.depthStencilAttachment);a=n.checkFramebufferStatus(36160);36053!==a&&c.raise("framebuffer configuration not supported, status = "+r[a]);n.bindFramebuffer(36160,x.next);x.cur=x.next;n.getError()}function fa(p,l){function r(a,d){var g;c(x.next!==n,"can not update framebuffer which is currently in use");
var p=L.webgl_draw_buffers,l=0,u=0,z=!0,C=!0;g=null;var da=!0,t="rgba",E="uint8",y=1,H=null,fa=null,M=null,K=!1;if("number"===typeof a)l=a|0,u=d|0||l;else if(a){c.type(a,"object","invalid arguments for framebuffer");"shape"in a?(u=a.shape,c(Array.isArray(u)&&2<=u.length,"invalid shape for framebuffer"),l=u[0],u=u[1]):("radius"in a&&(l=u=a.radius),"width"in a&&(l=a.width),"height"in a&&(u=a.height));if("color"in a||"colors"in a)g=a.color||a.colors,Array.isArray(g)&&c(1===g.length||p,"multiple render targets not supported");
if(!g){"colorCount"in a&&(y=a.colorCount|0,c(0<y,"invalid color buffer count"));"colorTexture"in a&&(da=!!a.colorTexture,t="rgba4");if("colorType"in a){E=a.colorType;if(da)c(L.oes_texture_float||!("float"===E||"float32"===E),"you must enable OES_texture_float in order to use floating point framebuffer objects"),c(L.oes_texture_half_float||!("half float"===E||"float16"===E),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===E||
"float16"===E)c(L.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),t="rgba16f";else if("float"===E||"float32"===E)c(L.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),t="rgba32f";c.oneOf(E,J,"invalid color type")}if("colorFormat"in a)if(t=a.colorFormat,0<=I.indexOf(t))da=!0;else if(0<=T.indexOf(t))da=!1;else if(da)c.oneOf(a.colorFormat,I,"invalid color format for texture");
else c.oneOf(a.colorFormat,T,"invalid color format for renderbuffer")}if("depthTexture"in a||"depthStencilTexture"in a)K=!(!a.depthTexture&&!a.depthStencilTexture),c(!K||L.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in a&&("boolean"===typeof a.depth?z=a.depth:(H=a.depth,C=!1));"stencil"in a&&("boolean"===typeof a.stencil?C=a.stencil:(fa=a.stencil,z=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?z=C=a.depthStencil:(M=a.depthStencil,C=z=!1))}else l=u=1;var U=
p=null,ba=null,V=null;if(Array.isArray(g))p=g.map(N);else if(g)p=[N(g)];else for(p=Array(y),g=0;g<y;++g)p[g]=S(l,u,da,t,E);c(L.webgl_draw_buffers||1>=p.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");c(p.length<=q.maxColorAttachments,"too many color attachments, not supported");l=l||p[0].width;u=u||p[0].height;H?U=N(H):z&&!C&&(U=S(l,u,K,"depth","uint32"));fa?ba=N(fa):C&&!z&&(ba=S(l,u,!1,"stencil","uint8"));M?V=N(M):!H&&!fa&&C&&z&&(V=S(l,u,K,"depth stencil",
"depth stencil"));c(1>=!!H+!!fa+!!M,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");z=null;for(g=0;g<p.length;++g)A(p[g],l,u),c(!p[g]||p[g].texture&&0<=m.indexOf(p[g].texture._texture.format)||p[g].renderbuffer&&0<=b.indexOf(p[g].renderbuffer._renderbuffer.format),"framebuffer color attachment "+g+" is invalid"),p[g]&&p[g].texture&&(C=e[p[g].texture._texture.format]*f[p[g].texture._texture.type],null===z?z=C:c(z===C,"all color attachments much have the same number of bits per pixel."));
A(U,l,u);c(!U||U.texture&&6402===U.texture._texture.format||U.renderbuffer&&33189===U.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");A(ba,l,u);c(!ba||ba.renderbuffer&&36168===ba.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");A(V,l,u);c(!V||V.texture&&34041===V.texture._texture.format||V.renderbuffer&&34041===V.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");F(n);n.width=l;n.height=
u;n.colorAttachments=p;n.depthAttachment=U;n.stencilAttachment=ba;n.depthStencilAttachment=V;r.color=p.map(h);r.depth=h(U);r.stencil=h(ba);r.depthStencil=h(V);r.width=n.width;r.height=n.height;Ma(n);return r}var n=new d;t.framebufferCount++;r(p,l);return g(r,{resize:function(b,d){c(x.next!==n,"can not resize a framebuffer which is currently in use");var e=b|0,f=d|0||e;if(e===n.width&&f===n.height)return r;for(var h=n.colorAttachments,g=0;g<h.length;++g)a(h[g],e,f);a(n.depthAttachment,e,f);a(n.stencilAttachment,
e,f);a(n.depthStencilAttachment,e,f);n.width=r.width=e;n.height=r.height=f;Ma(n);return r},_reglType:"framebuffer",_framebuffer:n,destroy:function(){da(n);F(n)},bind:function(a){x.setFBO({framebuffer:r},a)}})}var x={cur:null,next:null,dirty:!1,setFBO:null},I=["rgba"],T=["rgba4","rgb565","rgb5 a1"];L.ext_srgb&&T.push("srgba");L.ext_color_buffer_half_float&&T.push("rgba16f","rgb16f");L.webgl_color_buffer_float&&T.push("rgba32f");var J=["uint8"];L.oes_texture_half_float&&J.push("half float","float16");
L.oes_texture_float&&J.push("float","float32");var ba=0,U={};return g(x,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof d)?a:null},create:fa,createCube:function(a){function b(a){var e;c(0>d.indexOf(x.next),"can not update framebuffer which is currently in use");var f=L.webgl_draw_buffers,h={color:null},m=0,l=null;e="rgba";var q="uint8",r=1;if("number"===typeof a)m=a|0;else if(a){c.type(a,"object","invalid arguments for framebuffer");
"shape"in a?(m=a.shape,c(Array.isArray(m)&&2<=m.length,"invalid shape for framebuffer"),c(m[0]===m[1],"cube framebuffer must be square"),m=m[0]):("radius"in a&&(m=a.radius|0),"width"in a?(m=a.width|0,"height"in a&&c(a.height===m,"must be square")):"height"in a&&(m=a.height|0));if("color"in a||"colors"in a)l=a.color||a.colors,Array.isArray(l)&&c(1===l.length||f,"multiple render targets not supported");l||("colorCount"in a&&(r=a.colorCount|0,c(0<r,"invalid color buffer count")),"colorType"in a&&(c.oneOf(a.colorType,
J,"invalid color type"),q=a.colorType),"colorFormat"in a&&(e=a.colorFormat,c.oneOf(a.colorFormat,I,"invalid color format for texture")));"depth"in a&&(h.depth=a.depth);"stencil"in a&&(h.stencil=a.stencil);"depthStencil"in a&&(h.depthStencil=a.depthStencil)}else m=1;if(l)if(Array.isArray(l))for(a=[],e=0;e<l.length;++e)a[e]=l[e];else a=[l];else for(a=Array(r),l={radius:m,format:e,type:q},e=0;e<r;++e)a[e]=p.createCube(l);h.color=Array(a.length);for(e=0;e<a.length;++e)r=a[e],c("function"===typeof r&&
"textureCube"===r._reglType,"invalid cube map"),m=m||r.width,c(r.width===m&&r.height===m,"invalid cube map shape"),h.color[e]={target:34069,data:a[e]};for(e=0;6>e;++e){for(r=0;r<a.length;++r)h.color[r].target=34069+e;0<e&&(h.depth=d[0].depth,h.stencil=d[0].stencil,h.depthStencil=d[0].depthStencil);if(d[e])d[e](h);else d[e]=fa(h)}return g(b,{width:m,height:m,color:a})}var d=Array(6);b(a);return g(b,{faces:d,resize:function(a){var e=a|0;c(0<e&&e<=q.maxCubeMapSize,"invalid radius for cube fbo");if(e===
b.width)return b;var f=b.color;for(a=0;a<f.length;++a)f[a].resize(e);for(a=0;6>a;++a)d[a].resize(e);b.width=b.height=e;return b},_reglType:"framebufferCube",destroy:function(){d.forEach(function(a){a.destroy()})}})},clear:function(){l(U).forEach(da)},restore:function(){l(U).forEach(function(a){a.framebuffer=n.createFramebuffer();Ma(a)})}})}},{"./util/check":21,"./util/extend":24,"./util/values":33}],13:[function(n,t,x){t.exports=function(c,l){var g=1;l.ext_texture_filter_anisotropic&&(g=c.getParameter(34047));
var m=1,e=1;l.webgl_draw_buffers&&(m=c.getParameter(34852),e=c.getParameter(36063));return{colorBits:[c.getParameter(3410),c.getParameter(3411),c.getParameter(3412),c.getParameter(3413)],depthBits:c.getParameter(3414),stencilBits:c.getParameter(3415),subpixelBits:c.getParameter(3408),extensions:Object.keys(l).filter(function(c){return!!l[c]}),maxAnisotropic:g,maxDrawbuffers:m,maxColorAttachments:e,pointSizeDims:c.getParameter(33901),lineWidthDims:c.getParameter(33902),maxViewportDims:c.getParameter(3386),
maxCombinedTextureUnits:c.getParameter(35661),maxCubeMapSize:c.getParameter(34076),maxRenderbufferSize:c.getParameter(34024),maxTextureUnits:c.getParameter(34930),maxTextureSize:c.getParameter(3379),maxAttributes:c.getParameter(34921),maxVertexUniforms:c.getParameter(36347),maxVertexTextureUnits:c.getParameter(35660),maxVaryingVectors:c.getParameter(36348),maxFragmentUniforms:c.getParameter(36349),glsl:c.getParameter(35724),renderer:c.getParameter(7937),vendor:c.getParameter(7936),version:c.getParameter(7938)}}},
{}],14:[function(n,t,x){var c=n("./util/check"),l=n("./util/is-typed-array");t.exports=function(g,m,e,f,b,r){function n(q){var p;null===m.next?(c(b.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),p=5121):(c(null!==m.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),p=m.next.colorAttachments[0].texture._texture.type,r.oes_texture_float?c(5121===p||5126===p,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):
c(5121===p,"Reading from a framebuffer is only allowed for the type 'uint8'"));var z=0,t=0,E=f.framebufferWidth,L=f.framebufferHeight,A=null;l(q)?A=q:q&&(c.type(q,"object","invalid arguments to regl.read()"),z=q.x|0,t=q.y|0,c(0<=z&&z<f.framebufferWidth,"invalid x offset for regl.read"),c(0<=t&&t<f.framebufferHeight,"invalid y offset for regl.read"),E=(q.width||f.framebufferWidth-z)|0,L=(q.height||f.framebufferHeight-t)|0,A=q.data||null);A&&(5121===p?c(A instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):
5126===p&&c(A instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));c(0<E&&E+z<=f.framebufferWidth,"invalid width for read pixels");c(0<L&&L+t<=f.framebufferHeight,"invalid height for read pixels");e();q=E*L*4;A||(5121===p?A=new Uint8Array(q):5126===p&&(A=A||new Float32Array(q)));c.isTypedArray(A,"data buffer for regl.read() must be a typedarray");c(A.byteLength>=q,"data buffer for regl.read() too small");g.pixelStorei(3333,4);g.readPixels(z,t,E,
L,6408,p,A);return A}function t(b){var c;m.setFBO({framebuffer:b.framebuffer},function(){c=n(b)});return c}return function(b){return b&&"framebuffer"in b?t(b):n(b)}}},{"./util/check":21,"./util/is-typed-array":28}],15:[function(n,t,x){var c=n("./util/check"),l=n("./util/values"),g=[];g[32854]=2;g[32855]=2;g[36194]=2;g[33189]=2;g[36168]=1;g[34041]=4;g[35907]=4;g[34836]=16;g[34842]=8;g[34843]=6;t.exports=function(m,e,f,b,r){function n(b){this.id=C++;this.refCount=1;this.renderbuffer=b;this.format=32854;
this.height=this.width=0;r.profile&&(this.stats={size:0})}function t(e){var f=e.renderbuffer;c(f,"must not double destroy renderbuffer");m.bindRenderbuffer(36161,null);m.deleteRenderbuffer(f);e.renderbuffer=null;e.refCount=0;delete H[e.id];b.renderbufferCount--}var q={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(q.srgba=35907);e.ext_color_buffer_half_float&&(q.rgba16f=34842,q.rgb16f=34843);e.webgl_color_buffer_float&&(q.rgba32f=34836);var p=
[];Object.keys(q).forEach(function(b){p[q[b]]=b});var C=0,H={};n.prototype.decRef=function(){0>=--this.refCount&&t(this)};r.profile&&(b.getTotalRenderbufferSize=function(){var b=0;Object.keys(H).forEach(function(c){b+=H[c].stats.size});return b});return{create:function(e,l){function A(b,e){var h=0,a=0,d=32854;"object"===typeof b&&b?("shape"in b?(a=b.shape,c(Array.isArray(a)&&2<=a.length,"invalid renderbuffer shape"),h=a[0]|0,a=a[1]|0):("radius"in b&&(h=a=b.radius|0),"width"in b&&(h=b.width|0),"height"in
b&&(a=b.height|0)),"format"in b&&(c.parameter(b.format,q,"invalid renderbuffer format"),d=q[b.format])):"number"===typeof b?(h=b|0,a="number"===typeof e?e|0:h):b?c.raise("invalid arguments to renderbuffer constructor"):h=a=1;c(0<h&&0<a&&h<=f.maxRenderbufferSize&&a<=f.maxRenderbufferSize,"invalid renderbuffer size");if(h!==u.width||a!==u.height||d!==u.format)return A.width=u.width=h,A.height=u.height=a,u.format=d,m.bindRenderbuffer(36161,u.renderbuffer),m.renderbufferStorage(36161,d,h,a),r.profile&&
(u.stats.size=g[u.format]*u.width*u.height),A.format=p[u.format],A}var u=new n(m.createRenderbuffer());H[u.id]=u;b.renderbufferCount++;A(e,l);A.resize=function(b,e){var h=b|0,a=e|0||h;if(h===u.width&&a===u.height)return A;c(0<h&&0<a&&h<=f.maxRenderbufferSize&&a<=f.maxRenderbufferSize,"invalid renderbuffer size");A.width=u.width=h;A.height=u.height=a;m.bindRenderbuffer(36161,u.renderbuffer);m.renderbufferStorage(36161,u.format,h,a);r.profile&&(u.stats.size=g[u.format]*u.width*u.height);return A};A._reglType=
"renderbuffer";A._renderbuffer=u;r.profile&&(A.stats=u.stats);A.destroy=function(){u.decRef()};return A},clear:function(){l(H).forEach(t)},restore:function(){l(H).forEach(function(b){b.renderbuffer=m.createRenderbuffer();m.bindRenderbuffer(36161,b.renderbuffer);m.renderbufferStorage(36161,b.format,b.width,b.height)});m.bindRenderbuffer(36161,null)}}}},{"./util/check":21,"./util/values":33}],16:[function(n,t,x){var c=n("./util/check"),l=n("./util/values");t.exports=function(g,m,e,f){function b(b,c,
e,f){this.name=b;this.id=c;this.location=e;this.info=f}function r(b,c){for(var e=0;e<b.length;++e)if(b[e].id===c.id){b[e].location=c.location;return}b.push(c)}function n(b,e,f){var l=35632===b?p:C,h=l[e];if(!h){var a=m.str(e),h=g.createShader(b);g.shaderSource(h,a);g.compileShader(h);c.shaderError(g,h,a,b,f);l[e]=h}return h}function t(b,c){this.id=x++;this.fragId=b;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];f.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function q(e,
p){var l,q;l=n(35632,e.fragId);q=n(35633,e.vertId);var h=e.program=g.createProgram();g.attachShader(h,l);g.attachShader(h,q);g.linkProgram(h);c.linkError(g,h,m.str(e.fragId),m.str(e.vertId),p);var a=g.getProgramParameter(h,35718);f.profile&&(e.stats.uniformsCount=a);var d=e.uniforms;for(l=0;l<a;++l)if(q=g.getActiveUniform(h,l))if(1<q.size)for(var F=0;F<q.size;++F){var t=q.name.replace("[0]","["+F+"]");r(d,new b(t,m.id(t),g.getUniformLocation(h,t),q))}else r(d,new b(q.name,m.id(q.name),g.getUniformLocation(h,
q.name),q));a=g.getProgramParameter(h,35721);f.profile&&(e.stats.attributesCount=a);d=e.attributes;for(l=0;l<a;++l)(q=g.getActiveAttrib(h,l))&&r(d,new b(q.name,m.id(q.name),g.getAttribLocation(h,q.name),q))}var p={},C={},H={},E=[],x=0;f.profile&&(e.getMaxUniformsCount=function(){var b=0;E.forEach(function(c){c.stats.uniformsCount>b&&(b=c.stats.uniformsCount)});return b},e.getMaxAttributesCount=function(){var b=0;E.forEach(function(c){c.stats.attributesCount>b&&(b=c.stats.attributesCount)});return b});
return{clear:function(){var b=g.deleteShader.bind(g);l(p).forEach(b);p={};l(C).forEach(b);C={};E.forEach(function(b){g.deleteProgram(b.program)});E.length=0;H={};e.shaderCount=0},program:function(b,f,g){c.command(0<=b,"missing vertex shader",g);c.command(0<=f,"missing fragment shader",g);var p=H[f];p||(p=H[f]={});var h=p[b];h||(h=new t(f,b),e.shaderCount++,q(h,g),p[b]=h,E.push(h));return h},restore:function(){p={};C={};for(var b=0;b<E.length;++b)q(E[b])},shader:n,frag:-1,vert:-1}}},{"./util/check":21,
"./util/values":33}],17:[function(n,t,x){t.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(n,t,x){t.exports=function(){var c={"":0},l=[""];return{id:function(g){var m=c[g];if(m)return m;m=c[g]=l.length;l.push(g);return m},str:function(c){return l[c]}}}},{}],19:[function(n,t,x){function c(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function l(a){return Array.isArray(a)&&
0!==a.length&&H(a[0])?!0:!1}function g(a){return Object.prototype.toString.call(a)}function m(a){if(!a)return!1;var b=g(a);return 0<=S.indexOf(b)?!0:c(a)||l(a)||q(a)}function e(a,b){36193===a.type?(a.data=C(b),p.freeType(b)):a.data=b}function f(b,c,e,f,g,p){b="undefined"!==typeof a[b]?a[b]:N[b]*h[c];p&&(b*=6);if(g){for(f=0;1<=e;)f+=b*e*e,e/=2;return f}return b*e*f}var b=n("./util/check"),r=n("./util/extend"),z=n("./util/values"),L=n("./util/is-typed-array"),q=n("./util/is-ndarray"),p=n("./util/pool"),
C=n("./util/to-half-float"),H=n("./util/is-array-like"),E=n("./util/flatten");x=n("./constants/arraytypes.json");var M=n("./constants/arraytypes.json"),A=[9984,9986,9985,9987],u=[0,6409,6410,6407,6408],N={};N[6409]=N[6406]=N[6402]=1;N[34041]=N[6410]=2;N[6407]=N[35904]=3;N[6408]=N[35906]=4;var S=Object.keys(x).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),h=[];h[5121]=1;h[5126]=4;h[36193]=2;h[5123]=2;h[5125]=4;var a=
[];a[32854]=2;a[32855]=2;a[36194]=2;a[34041]=4;a[33776]=.5;a[33777]=.5;a[33778]=1;a[33779]=1;a[35986]=.5;a[35987]=1;a[34798]=1;a[35840]=.5;a[35841]=.25;a[35842]=.5;a[35843]=.25;a[36196]=.5;t.exports=function(a,h,n,t,fa,x,I){function T(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function J(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;
a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function ba(a,d){if("object"===typeof d&&d){"premultiplyAlpha"in d&&(b.type(d.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=d.premultiplyAlpha);"flipY"in d&&(b.type(d.flipY,"boolean","invalid texture flip"),a.flipY=d.flipY);"alignment"in d&&(b.oneOf(d.alignment,[1,2,4,8],"invalid texture unpack alignment"),
a.unpackAlignment=d.alignment);"colorSpace"in d&&(b.parameter(d.colorSpace,V,"invalid colorSpace"),a.colorSpace=V[d.colorSpace]);if("type"in d){var c=d.type;b(h.oes_texture_float||!("float"===c||"float32"===c),"you must enable the OES_texture_float extension in order to use floating point textures.");b(h.oes_texture_half_float||!("half float"===c||"float16"===c),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");b(h.webgl_depth_texture||!("uint16"===
c||"uint32"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");b.parameter(c,Q,"invalid texture type");a.type=Q[c]}var e=a.width,f=a.height,g=a.channels,c=!1;"shape"in d?(b(Array.isArray(d.shape)&&2<=d.shape.length,"shape must be an array"),e=d.shape[0],f=d.shape[1],3===d.shape.length&&(g=d.shape[2],b(0<g&&4>=g,"invalid number of channels"),c=!0),b(0<=e&&e<=n.maxTextureSize,"invalid width"),b(0<=f&&f<=n.maxTextureSize,"invalid height")):
("radius"in d&&(e=f=d.radius,b(0<=e&&e<=n.maxTextureSize,"invalid radius")),"width"in d&&(e=d.width,b(0<=e&&e<=n.maxTextureSize,"invalid width")),"height"in d&&(f=d.height,b(0<=f&&f<=n.maxTextureSize,"invalid height")),"channels"in d&&(g=d.channels,b(0<g&&4>=g,"invalid number of channels"),c=!0));a.width=e|0;a.height=f|0;a.channels=g|0;e=!1;"format"in d&&(e=d.format,b(h.webgl_depth_texture||!("depth"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),
b.parameter(e,Y,"invalid texture format"),f=a.internalformat=Y[e],a.format=Ja[f],e in Q&&!("type"in d)&&(a.type=Q[e]),e in ea&&(a.compressed=!0),e=!0);!c&&e?a.channels=N[a.format]:c&&!e?a.channels!==u[a.format]&&(a.format=a.internalformat=u[a.channels]):e&&c&&b(a.channels===N[a.format],"number of channels inconsistent with specified format")}}function U(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function y(){T.call(this);
this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function K(a,d){var f=null;m(d)?f=d:d&&(b.type(d,"object","invalid pixel data type"),ba(a,d),"x"in d&&(a.xOffset=d.x|0),"y"in d&&(a.yOffset=d.y|0),m(d.data)&&(f=d.data));b(!a.compressed||f instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(d.copy){b(!f,"can not specify copy and data field for the same texture");var h=fa.viewportWidth,r=fa.viewportHeight;a.width=a.width||
h-a.xOffset;a.height=a.height||r-a.yOffset;a.needsCopy=!0;b(0<=a.xOffset&&a.xOffset<h&&0<=a.yOffset&&a.yOffset<r&&0<a.width&&a.width<=h&&0<a.height&&a.height<=r,"copy texture read out of bounds")}else if(!f)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(L(f))a.channels=a.channels||4,a.data=f,"type"in d||5121!==a.type||(a.type=M[Object.prototype.toString.call(f)]|0);else if(c(f)){a.channels=a.channels||4;h=f;r=h.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:r=
p.allocType(a.type,r);r.set(h);a.data=r;break;case 36193:a.data=C(h);break;default:b.raise("unsupported texture type, must specify a typed array")}a.alignment=1;a.needsFree=!0}else if(q(f)){h=f.data;Array.isArray(h)||5121!==a.type||(a.type=M[Object.prototype.toString.call(h)]|0);var r=f.shape,t=f.stride,z,F,y,I;3===r.length?(y=r[2],I=t[2]):(b(2===r.length,"invalid ndarray pixel data, must be 2 or 3D"),I=y=1);z=r[0];F=r[1];r=t[0];t=t[1];a.alignment=1;a.width=z;a.height=F;a.channels=y;a.format=a.internalformat=
u[y];a.needsFree=!0;z=I;f=f.offset;y=a.width;I=a.height;F=a.channels;for(var v=p.allocType(36193===a.type?5126:a.type,y*I*F),D=0,A=0;A<I;++A)for(var J=0;J<y;++J)for(var x=0;x<F;++x)v[D++]=h[r*J+t*A+z*x+f];e(a,v)}else if("[object HTMLCanvasElement]"===g(f)||"[object CanvasRenderingContext2D]"===g(f))"[object HTMLCanvasElement]"===g(f)?a.element=f:a.element=f.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if("[object HTMLImageElement]"===g(f))a.element=f,a.width=f.naturalWidth,
a.height=f.naturalHeight,a.channels=4;else if("[object HTMLVideoElement]"===g(f))a.element=f,a.width=f.videoWidth,a.height=f.videoHeight,a.channels=4;else if(l(f)){h=a.width||f[0].length;r=a.height||f.length;t=a.channels;t=H(f[0][0])?t||f[0][0].length:t||1;z=E.shape(f);y=1;for(I=0;I<z.length;++I)y*=z[I];y=p.allocType(36193===a.type?5126:a.type,y);E.flatten(f,z,"",y);e(a,y);a.alignment=1;a.width=h;a.height=r;a.channels=t;a.format=a.internalformat=u[t];a.needsFree=!0}5126===a.type?b(0<=n.extensions.indexOf("oes_texture_float"),
"oes_texture_float extension not enabled"):36193===a.type&&b(0<=n.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}function S(b,c,e,f,h){var g=b.element,p=b.data,m=b.internalformat,l=b.format,q=b.type,r=b.width,n=b.height;U(b);g?a.texSubImage2D(c,h,e,f,l,q,g):b.compressed?a.compressedTexSubImage2D(c,h,e,f,m,r,n,p):b.needsCopy?(t(),a.copyTexSubImage2D(c,h,e,f,b.xOffset,b.yOffset,r,n)):a.texSubImage2D(c,h,e,f,r,n,l,q,p)}function ka(){return Ka.pop()||new y}
function pa(a){a.needsFree&&p.freeType(a.data);y.call(a);Ka.push(a)}function va(){T.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function Z(a,b,d){var c=a.images[0]=ka();a.mipmask=1;c.width=a.width=b;c.height=a.height=d;c.channels=a.channels=4}function R(a,d){var c=null;if(m(d))c=a.images[0]=ka(),J(c,a),K(c,d),a.mipmask=1;else if(ba(a,d),Array.isArray(d.mipmap))for(var e=d.mipmap,f=0;f<e.length;++f)c=a.images[f]=ka(),J(c,a),c.width>>=f,c.height>>=f,K(c,e[f]),
a.mipmask|=1<<f;else c=a.images[0]=ka(),J(c,a),K(c,d),a.mipmask=1;J(a,a.images[0]);(a.compressed&&33776===a.internalformat||33777===a.internalformat||33778===a.internalformat||33779===a.internalformat)&&b(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function O(b,c){for(var e=b.images,f=0;f<e.length&&e[f];++f){var h=e[f],g=c,p=f,m=h.element,l=h.data,q=h.internalformat,r=h.format,n=h.type,z=h.width,u=h.height;U(h);
m?a.texImage2D(g,p,r,r,n,m):h.compressed?a.compressedTexImage2D(g,p,q,z,u,0,l):h.needsCopy?(t(),a.copyTexImage2D(g,p,r,h.xOffset,h.yOffset,z,u,0)):a.texImage2D(g,p,r,z,u,0,r,n,l)}}function Ba(){var a=La.pop()||new va;T.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function sa(a){for(var b=a.images,d=0;d<b.length;++d)b[d]&&pa(b[d]),b[d]=null;La.push(a)}function wa(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=
4352}function aa(a,d){if("min"in d){var c=d.min;b.parameter(c,ha);a.minFilter=ha[c];0<=A.indexOf(a.minFilter)&&(a.genMipmaps=!0)}"mag"in d&&(c=d.mag,b.parameter(c,X),a.magFilter=X[c]);var c=a.wrapS,e=a.wrapT;if("wrap"in d){var f=d.wrap;"string"===typeof f?(b.parameter(f,W),c=e=W[f]):Array.isArray(f)&&(b.parameter(f[0],W),b.parameter(f[1],W),c=W[f[0]],e=W[f[1]])}else"wrapS"in d&&(c=d.wrapS,b.parameter(c,W),c=W[c]),"wrapT"in d&&(e=d.wrapT,b.parameter(e,W),e=W[e]);a.wrapS=c;a.wrapT=e;"anisotropic"in
d&&(c=d.anisotropic,b("number"===typeof c&&1<=c&&c<=n.maxAnisotropic,"aniso samples must be between 1 and "),a.anisotropic=d.anisotropic);if("mipmap"in d){c=!1;switch(typeof d.mipmap){case "string":b.parameter(d.mipmap,xa,"invalid mipmap hint");a.mipmapHint=xa[d.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=d.mipmap;break;case "object":b(Array.isArray(d.mipmap),"invalid mipmap type");a.genMipmaps=!1;c=!0;break;default:b.raise("invalid mipmap type")}!c||"min"in d||(a.minFilter=9984)}}
function ja(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);h.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function ma(b){T.call(this);this.mipmask=0;this.internalformat=6408;this.id=Pa++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new wa;I.profile&&(this.stats=
{size:0})}function na(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function oa(){var b=ca[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function qa(c){var e=c.texture;b(e,"must not double destroy texture");var f=c.unit,h=c.target;0<=f&&(a.activeTexture(33984+f),a.bindTexture(h,null),ca[f]=null);a.deleteTexture(e);c.texture=null;c.params=null;c.pixels=null;c.refCount=0;delete ua[c.id];x.textureCount--}var xa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
W={repeat:10497,clamp:33071,mirror:33648},X={nearest:9728,linear:9729},ha=r({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},X),V={none:0,browser:37444},Q={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Y={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ea={};h.ext_srgb&&(Y.srgb=35904,Y.srgba=35906);h.oes_texture_float&&(Q.float32=Q["float"]=5126);h.oes_texture_half_float&&
(Q.float16=Q["half float"]=36193);h.webgl_depth_texture&&(r(Y,{depth:6402,"depth stencil":34041}),r(Q,{uint16:5123,uint32:5125,"depth stencil":34042}));h.webgl_compressed_texture_s3tc&&r(ea,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});h.webgl_compressed_texture_atc&&r(ea,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});h.webgl_compressed_texture_pvrtc&&r(ea,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});h.webgl_compressed_texture_etc1&&(ea["rgb etc1"]=36196);var ya=Array.prototype.slice.call(a.getParameter(34467));Object.keys(ea).forEach(function(a){var b=ea[a];0<=ya.indexOf(b)&&(Y[a]=b)});var ia=Object.keys(Y);n.textureFormats=ia;var ta=[];Object.keys(Y).forEach(function(a){ta[Y[a]]=a});var Da=[];Object.keys(Q).forEach(function(a){Da[Q[a]]=a});var Fa=[];Object.keys(X).forEach(function(a){Fa[X[a]]=a});var Ia=[];Object.keys(ha).forEach(function(a){Ia[ha[a]]=a});var Ea=
[];Object.keys(W).forEach(function(a){Ea[W[a]]=a});var Ja=ia.reduce(function(a,b){var d=Y[b];6409===d||6406===d||6409===d||6410===d||6402===d||34041===d?a[d]=d:32855===d||0<=b.indexOf("rgba")?a[d]=6408:a[d]=6407;return a},{}),Ka=[],La=[],Pa=0,ua={},ra=n.maxTextureUnits,ca=Array(ra).map(function(){return null});r(ma.prototype,{bind:function(){this.bindCount+=1;var c=this.unit;if(0>c){for(var e=0;e<ra;++e){var f=ca[e];if(f){if(0<f.bindCount)continue;f.unit=-1}ca[e]=this;c=e;break}c>=ra&&b.raise("insufficient number of texture units");
I.profile&&x.maxTextureUnits<c+1&&(x.maxTextureUnits=c+1);this.unit=c;a.activeTexture(33984+c);a.bindTexture(this.target,this.texture)}return c},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&qa(this)}});I.profile&&(x.getTotalTextureSize=function(){var a=0;Object.keys(ua).forEach(function(b){a+=ua[b].stats.size});return a});return{create2D:function(c,e){function h(a,d){var c=g.texInfo;wa.call(c);var e=Ba();"number"===typeof a?"number"===typeof d?Z(e,a|0,d|0):Z(e,a|0,a|0):
a?(b.type(a,"object","invalid arguments to regl.texture"),aa(c,a),R(e,a)):Z(e,1,1);c.genMipmaps&&(e.mipmask=(e.width<<1)-1);g.mipmask=e.mipmask;J(g,e);b.texture2D(c,e,n);g.internalformat=e.internalformat;h.width=e.width;h.height=e.height;na(g);O(e,3553);ja(c,3553);oa();sa(e);I.profile&&(g.stats.size=f(g.internalformat,g.type,e.width,e.height,c.genMipmaps,!1));h.format=ta[g.internalformat];h.type=Da[g.type];h.mag=Fa[c.magFilter];h.min=Ia[c.minFilter];h.wrapS=Ea[c.wrapS];h.wrapT=Ea[c.wrapT];return h}
var g=new ma(3553);ua[g.id]=g;x.textureCount++;h(c,e);h.subimage=function(a,d,c,e){b(!!a,"must specify image data");d|=0;c|=0;e|=0;var f=ka();J(f,g);f.width=0;f.height=0;K(f,a);f.width=f.width||(g.width>>e)-d;f.height=f.height||(g.height>>e)-c;b(g.type===f.type&&g.format===f.format&&g.internalformat===f.internalformat,"incompatible format for texture.subimage");b(0<=d&&0<=c&&d+f.width<=g.width&&c+f.height<=g.height,"texture.subimage write out of bounds");b(g.mipmask&1<<e,"missing mipmap data");b(f.data||
f.element||f.needsCopy,"missing image data");na(g);S(f,3553,d,c,e);oa();pa(f);return h};h.resize=function(b,c){var e=b|0,k=c|0||e;if(e===g.width&&k===g.height)return h;h.width=g.width=e;h.height=g.height=k;na(g);for(var p=0;g.mipmask>>p;++p)a.texImage2D(3553,p,g.format,e>>p,k>>p,0,g.format,g.type,null);oa();I.profile&&(g.stats.size=f(g.internalformat,g.type,e,k,!1,!1));return h};h._reglType="texture2d";h._texture=g;I.profile&&(h.stats=g.stats);h.destroy=function(){g.decRef()};return h},createCube:function(c,
e,h,g,p,m){function l(a,d,c,e,k,h){var g,p=q.texInfo;wa.call(p);for(g=0;6>g;++g)r[g]=Ba();if("number"!==typeof a&&a)if("object"===typeof a)if(d)R(r[0],a),R(r[1],d),R(r[2],c),R(r[3],e),R(r[4],k),R(r[5],h);else if(aa(p,a),ba(q,a),"faces"in a)for(a=a.faces,b(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),g=0;6>g;++g)b("object"===typeof a[g]&&!!a[g],"invalid input for cube map face"),J(r[g],q),R(r[g],a[g]);else for(g=0;6>g;++g)R(r[g],a);else b.raise("invalid arguments to cube map");
else for(a=a|0||1,g=0;6>g;++g)Z(r[g],a,a);J(q,r[0]);q.mipmask=p.genMipmaps?(r[0].width<<1)-1:r[0].mipmask;b.textureCube(q,p,r,n);q.internalformat=r[0].internalformat;l.width=r[0].width;l.height=r[0].height;na(q);for(g=0;6>g;++g)O(r[g],34069+g);ja(p,34067);oa();I.profile&&(q.stats.size=f(q.internalformat,q.type,l.width,l.height,p.genMipmaps,!0));l.format=ta[q.internalformat];l.type=Da[q.type];l.mag=Fa[p.magFilter];l.min=Ia[p.minFilter];l.wrapS=Ea[p.wrapS];l.wrapT=Ea[p.wrapT];for(g=0;6>g;++g)sa(r[g]);
return l}var q=new ma(34067);ua[q.id]=q;x.cubeCount++;var r=Array(6);l(c,e,h,g,p,m);l.subimage=function(a,d,c,e,f){b(!!d,"must specify image data");b("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");c|=0;e|=0;f|=0;var k=ka();J(k,q);k.width=0;k.height=0;K(k,d);k.width=k.width||(q.width>>f)-c;k.height=k.height||(q.height>>f)-e;b(q.type===k.type&&q.format===k.format&&q.internalformat===k.internalformat,"incompatible format for texture.subimage");b(0<=c&&0<=e&&c+k.width<=q.width&&e+k.height<=
q.height,"texture.subimage write out of bounds");b(q.mipmask&1<<f,"missing mipmap data");b(k.data||k.element||k.needsCopy,"missing image data");na(q);S(k,34069+a,c,e,f);oa();pa(k);return l};l.resize=function(b){b|=0;if(b!==q.width){l.width=q.width=b;l.height=q.height=b;na(q);for(var c=0;6>c;++c)for(var e=0;q.mipmask>>e;++e)a.texImage2D(34069+c,e,q.format,b>>e,b>>e,0,q.format,q.type,null);oa();I.profile&&(q.stats.size=f(q.internalformat,q.type,l.width,l.height,!1,!0));return l}};l._reglType="textureCube";
l._texture=q;I.profile&&(l.stats=q.stats);l.destroy=function(){q.decRef()};return l},clear:function(){for(var b=0;b<ra;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),ca[b]=null;z(ua).forEach(qa);x.cubeCount=0;x.textureCount=0},getTexture:function(a){return null},restore:function(){z(ua).forEach(function(b){b.texture=a.createTexture();a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!==(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,
0,b.internalformat,b.type,null);else for(var e=0;6>e;++e)a.texImage2D(34069+e,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);ja(b.texInfo,b.target)})}}}},{"./constants/arraytypes.json":4,"./util/check":21,"./util/extend":24,"./util/flatten":25,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/to-half-float":32,"./util/values":33}],20:[function(n,t,x){t.exports=function(c,l){function g(){this.endQueryIndex=this.startQueryIndex=
-1;this.sum=0;this.stats=null}function m(b,c,e){var f=r.pop()||new g;f.startQueryIndex=b;f.endQueryIndex=c;f.sum=0;f.stats=e;n.push(f)}var e=l.ext_disjoint_timer_query;if(!e)return null;var f=[],b=[],r=[],n=[],t=[],q=[];return{beginQuery:function(c){var g=f.pop()||e.createQueryEXT();e.beginQueryEXT(35007,g);b.push(g);m(b.length-1,b.length,c)},endQuery:function(){e.endQueryEXT(35007)},pushScopeStats:m,update:function(){var c,g;c=b.length;if(0!==c){q.length=Math.max(q.length,c+1);t.length=Math.max(t.length,
c+1);t[0]=0;var l=q[0]=0;for(g=c=0;g<b.length;++g){var m=b[g];e.getQueryObjectEXT(m,34919)?(l+=e.getQueryObjectEXT(m,34918),f.push(m)):b[c++]=m;t[g+1]=l;q[g+1]=c}b.length=c;for(g=c=0;g<n.length;++g){var l=n[g],x=l.startQueryIndex,m=l.endQueryIndex;l.sum+=t[m]-t[x];x=q[x];m=q[m];m===x?(l.stats.gpuTime+=l.sum/1E6,r.push(l)):(l.startQueryIndex=x,l.endQueryIndex=m,n[c++]=l)}n.length=c}},getNumPendingQueries:function(){return b.length},clear:function(){f.push.apply(f,b);for(var c=0;c<f.length;c++)e.deleteQueryEXT(f[c]);
b.length=0;f.length=0},restore:function(){b.length=0;f.length=0}}}},{}],21:[function(n,t,x){function c(a){return"undefined"!==typeof btoa?btoa(a):"base64:"+a}function l(a){a=Error("(regl) "+a);console.error(a);throw a;}function g(a,b){a||l(b)}function m(a){return a?": "+a:""}function e(a,b,c){0>b.indexOf(a)&&l("invalid value"+m(c)+". must be one of: "+b)}function f(a,b){for(a+="";a.length<b;)a=" "+a;return a}function b(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function r(a,
b){this.number=a;this.line=b;this.errors=[]}function z(a,b,c){this.file=a;this.line=b;this.message=c}function L(){var a=Error(),a=(a.stack||a).toString(),b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function q(){var a=Error(),a=(a.stack||a).toString(),b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function p(a,d){var e=a.split("\n"),f=1,h=
0,g={unknown:new b,0:new b};g.unknown.name=g[0].name=d||L();g.unknown.lines.push(new r(0,""));for(var l=0;l<e.length;++l){var p=e[l],m=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(p);if(m)switch(m[1]){case "line":if(m=/(\d+)(\s+\d+)?/.exec(m[2]))f=m[1]|0,m[2]&&(h=m[2]|0,h in g||(g[h]=new b));break;case "define":if(m=/SHADER_NAME(_B64)?\s+(.*)$/.exec(m[2]))g[h].name=m[1]?c(m[2]):m[2]}g[h].lines.push(new r(f++,p))}Object.keys(g).forEach(function(a){var b=g[a];b.lines.forEach(function(a){b.index[a.number]=a})});
return g}function C(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var c=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(a);c?b.push(new z(c[1]|0,c[2]|0,c[3].trim())):0<a.length&&b.push(new z("unknown",0,a))}});return b}function H(a,b){b.forEach(function(b){var d=a[b.file];if(d){var c=d.index[b.line];if(c){c.errors.push(b);d.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(b)})}function E(a){a._commandRef=L()}function M(a,b){var c=q();l(a+" in command "+(b||L())+
("unknown"===c?"":" called from "+c))}function A(a,b,c,e){typeof a!==b&&M("invalid parameter type"+m(c)+". expected "+b+", got "+typeof a,e||L())}function u(a,b){return 32820===a||32819===a||33635===a?2:34042===a?4:h[a]*b}var N=n("./is-typed-array");n=n("./extend");var S="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),h={};h[5120]=h[5121]=1;h[5122]=h[5123]=h[36193]=h[33635]=h[32819]=h[32820]=2;h[5124]=h[5125]=h[5126]=h[34042]=4;t.exports=n(g,{optional:function(a){a()},
raise:l,commandRaise:M,command:function(a,b,c){a||M(b,c||L())},parameter:function(a,b,c){a in b||l("unknown parameter ("+a+")"+m(c)+". possible values: "+Object.keys(b).join())},commandParameter:function(a,b,c,e){a in b||M("unknown parameter ("+a+")"+m(c)+". possible values: "+Object.keys(b).join(),e||L())},constructor:function(a){Object.keys(a).forEach(function(a){0>S.indexOf(a)&&l('invalid regl constructor argument "'+a+'". must be one of '+S)})},type:function(a,b,c){typeof a!==b&&l("invalid parameter type"+
m(c)+". expected "+b+", got "+typeof a)},commandType:A,isTypedArray:function(a,b){N(a)||l("invalid parameter type"+m(b)+". must be a typed array")},nni:function(a,b){0<=a&&(a|0)===a||l("invalid parameter type, ("+a+")"+m(b)+". must be a nonnegative integer")},oneOf:e,shaderError:function(a,b,c,e,h){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);a=e===a.FRAGMENT_SHADER?"fragment":"vertex";A(c,"string",a+" shader source must be a string",h);var l=p(c,h);c=C(b);H(l,c);Object.keys(l).forEach(function(a){function b(a,
c){d.push(a);e.push(c||"")}var c=l[a];if(c.hasErrors){var d=[""],e=[""];b("file number "+a+": "+c.name+"\n","color:red;text-decoration:underline;font-weight:bold");c.lines.forEach(function(a){if(0<a.errors.length){b(f(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var c=0;a.errors.forEach(function(d){d=d.message;var e=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(d);if(e){var h=e[1];d=e[2];switch(h){case "assign":h="="}c=Math.max(a.line.indexOf(h,
c),0)}else c=0;b(f("| ",6));b(f("^^^",c+3)+"\n","font-weight:bold");b(f("| ",6));b(d+"\n","font-weight:bold")});b(f("| ",6)+"\n")}else b(f(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"!==typeof document?(e[0]=d.join("%c"),console.log.apply(console,e)):console.log(d.join(""))}});g.raise("Error compiling "+a+" shader, "+l[0].name)}},linkError:function(a,b,c,e,f){a.getProgramParameter(b,a.LINK_STATUS)||(a=a.getProgramInfoLog(b),c=p(c,f),e='Error linking program with vertex shader, "'+p(e,
f)[0].name+'", and fragment shader "'+c[0].name+'"',"undefined"!==typeof document?console.log("%c"+e+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(e+"\n"+a),g.raise(e))},callSite:q,saveCommandRef:E,saveDrawInfo:function(a,b,c,e){function f(a){return a?e.id(a):0}function h(a,b){Object.keys(b).forEach(function(b){a[e.id(b)]=!0})}E(a);a._fragId=f(a["static"].frag);a._vertId=f(a["static"].vert);var g=a._uniformSet={};h(g,b["static"]);h(g,b.dynamic);b=a._attributeSet=
{};h(b,c["static"]);h(b,c.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,b,c){a.texture?e(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):e(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")},guessCommand:L,texture2D:function(a,b,c){var e=b.width,f=b.height,h=b.channels;g(0<e&&e<=c.maxTextureSize&&0<f&&f<=c.maxTextureSize,"invalid texture shape");
33071===a.wrapS&&33071===a.wrapT||g(!(e&e-1)&&!!e&&!(f&f-1)&&!!f,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==e&&1!==f&&g(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(g(!(e&e-1)&&!!e&&!(f&f-1)&&!!f,"texture must be a square power of 2 to support mipmapping"),g(b.mipmask===(e<<1)-1,"missing or incomplete mipmap data"));5126===b.type&&(0>c.extensions.indexOf("oes_texture_float_linear")&&
g(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),g(!a.genMipmaps,"mipmap generation not supported with float textures"));var l=b.images;for(c=0;16>c;++c)if(l[c]){var p=e>>c,m=f>>c;g(b.mipmask&1<<c,"missing mipmap data");var q=l[c];g(q.width===p&&q.height===m,"invalid shape for mip images");g(q.format===b.format&&q.internalformat===b.internalformat&&q.type===b.type,"incompatible type for mip image");q.compressed||q.data&&g(q.data.byteLength===p*
m*Math.max(u(q.type,h),q.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}else a.genMipmaps||g(0===(b.mipmask&1<<c),"extra mipmap data");b.compressed&&g(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,c,e){var f=a.width,h=a.height,l=a.channels;g(0<f&&f<=e.maxTextureSize&&0<h&&h<=e.maxTextureSize,"invalid texture shape");g(f===h,"cube map must be square");g(33071===b.wrapS&&33071===b.wrapT,"wrap mode not supported by cube map");
for(e=0;e<c.length;++e){var p=c[e];g(p.width===f&&p.height===h,"inconsistent cube map face shape");b.genMipmaps&&(g(!p.compressed,"can not generate mipmap for compressed textures"),g(1===p.mipmask,"can not specify mipmaps and generate mipmaps"));for(var m=p.images,q=0;16>q;++q){var r=m[q];if(r){var n=f>>q,t=h>>q;g(p.mipmask&1<<q,"missing mipmap data");g(r.width===n&&r.height===t,"invalid shape for mip images");g(r.format===a.format&&r.internalformat===a.internalformat&&r.type===a.type,"incompatible type for mip image");
r.compressed||r.data&&g(r.data.byteLength===n*t*Math.max(u(r.type,l),r.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}})},{"./extend":24,"./is-typed-array":28}],22:[function(n,t,x){t.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],23:[function(n,t,x){function c(c){return Array.prototype.slice.call(c)}function l(g){return c(g).join("")}var g=n("./extend");t.exports=function(){function m(){var b=
[],e=[];return g(function(){b.push.apply(b,c(arguments))},{def:function(){var g="v"+f++;e.push(g);0<arguments.length&&(b.push(g,"="),b.push.apply(b,c(arguments)),b.push(";"));return g},toString:function(){return l([0<e.length?"var "+e+";":"",l(b)])}})}function e(){function b(c,g){f(c,g,"=",e.def(c,g),";")}var e=m(),f=m(),l=e.toString,r=f.toString;return g(function(){e.apply(e,c(arguments))},{def:e.def,entry:e,exit:f,save:b,set:function(c,f,g){b(c,f);e(c,f,"=",g,";")},toString:function(){return l()+
r()}})}var f=0,b=[],r=[],n=m(),t={};return{global:n,link:function(c){for(var e=0;e<r.length;++e)if(r[e]===c)return b[e];e="g"+f++;b.push(e);r.push(c);return e},block:m,proc:function(b,c){function f(){var b="a"+m.length;m.push(b);return b}var m=[];c=c||0;for(var r=0;r<c;++r)f();var r=e(),n=r.toString;return t[b]=g(r,{arg:f,toString:function(){return l(["function(",m.join(),"){",n(),"}"])}})},scope:e,cond:function(){var b=l(arguments),f=e(),m=e(),r=f.toString,n=m.toString;return g(f,{then:function(){f.apply(f,
c(arguments));return this},"else":function(){m.apply(m,c(arguments));return this},toString:function(){var c=n();c&&(c="else{"+c+"}");return l(["if(",b,"){",r(),"}",c])}})},compile:function(){var c=['"use strict";',n,"return {"];Object.keys(t).forEach(function(b){c.push('"',b,'":',t[b].toString(),",")});c.push("}");var e=l(c).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,b.concat(e)).apply(null,r)}}}},{"./extend":24}],24:[function(n,t,x){t.exports=function(c,
l){for(var g=Object.keys(l),m=0;m<g.length;++m)c[g[m]]=l[g[m]];return c}},{}],25:[function(n,t,x){function c(c,e,f,b,g,l){for(var n=0;n<e;++n)for(var q=c[n],p=0;p<f;++p)for(var t=q[p],x=0;x<b;++x)g[l++]=t[x]}function l(g,e,f,b,r){for(var n=1,t=f+1;t<e.length;++t)n*=e[t];var q=e[f];if(4===e.length-f){var p=e[f+1],x=e[f+2];e=e[f+3];for(t=0;t<q;++t)c(g[t],p,x,e,b,r),r+=n}else for(t=0;t<q;++t)l(g[t],e,f+1,b,r),r+=n}var g=n("./pool");t.exports={shape:function(c){for(var e=[];c.length;c=c[0])e.push(c.length);
return e},flatten:function(m,e,f,b){var r=1;if(e.length)for(var n=0;n<e.length;++n)r*=e[n];else r=0;f=b||g.allocType(f,r);switch(e.length){case 0:break;case 1:b=e[0];for(e=0;e<b;++e)f[e]=m[e];break;case 2:b=e[0];e=e[1];for(n=r=0;n<b;++n)for(var t=m[n],q=0;q<e;++q)f[r++]=t[q];break;case 3:c(m,e[0],e[1],e[2],f,0);break;default:l(m,e,0,f,0)}return f}}},{"./pool":30}],26:[function(n,t,x){var c=n("./is-typed-array");t.exports=function(l){return Array.isArray(l)||c(l)}},{"./is-typed-array":28}],27:[function(n,
t,x){var c=n("./is-typed-array");t.exports=function(l){return!!l&&"object"===typeof l&&Array.isArray(l.shape)&&Array.isArray(l.stride)&&"number"===typeof l.offset&&l.shape.length===l.stride.length&&(Array.isArray(l.data)||c(l.data))}},{"./is-typed-array":28}],28:[function(n,t,x){var c=n("../constants/arraytypes.json");t.exports=function(l){return Object.prototype.toString.call(l)in c}},{"../constants/arraytypes.json":4}],29:[function(n,t,x){t.exports=function(c,l){for(var g=Array(c),m=0;m<c;++m)g[m]=
l(m);return g}},{}],30:[function(n,t,x){function c(c){var f,b;f=(65535<c)<<4;c>>>=f;b=(255<c)<<3;c>>>=b;f|=b;b=(15<c)<<2;c>>>=b;f|=b;b=(3<c)<<1;return f|b|c>>>b>>1}function l(e){a:{for(var f=16;268435456>=f;f*=16)if(e<=f){e=f;break a}e=0}f=m[c(e)>>2];return 0<f.length?f.pop():new ArrayBuffer(e)}function g(e){m[c(e.byteLength)>>2].push(e)}var m=n("./loop")(8,function(){return[]});t.exports={alloc:l,free:g,allocType:function(c,f){var b=null;switch(c){case 5120:b=new Int8Array(l(f),0,f);break;case 5121:b=
new Uint8Array(l(f),0,f);break;case 5122:b=new Int16Array(l(2*f),0,f);break;case 5123:b=new Uint16Array(l(2*f),0,f);break;case 5124:b=new Int32Array(l(4*f),0,f);break;case 5125:b=new Uint32Array(l(4*f),0,f);break;case 5126:b=new Float32Array(l(4*f),0,f);break;default:return null}return b.length!==f?b.subarray(0,f):b},freeType:function(c){g(c.buffer)}}},{"./loop":29}],31:[function(n,t,x){t.exports={next:"function"===typeof requestAnimationFrame?function(c){return requestAnimationFrame(c)}:function(c){return setTimeout(c,
16)},cancel:"function"===typeof cancelAnimationFrame?function(c){return cancelAnimationFrame(c)}:clearTimeout}},{}],32:[function(n,t,x){var c=n("./pool"),l=new Float32Array(1),g=new Uint32Array(l.buffer);t.exports=function(m){for(var e=c.allocType(5123,m.length),f=0;f<m.length;++f)if(isNaN(m[f]))e[f]=65535;else if(Infinity===m[f])e[f]=31744;else if(-Infinity===m[f])e[f]=64512;else{l[0]=m[f];var b=g[0],r=b>>>31<<15,n=(b<<1>>>24)-127,b=b>>13&1023;e[f]=-24>n?r:-14>n?r+(b+1024>>-14-n):15<n?r+31744:r+
(n+15<<10)+b}return e}},{"./pool":30}],33:[function(n,t,x){t.exports=function(c){return Object.keys(c).map(function(l){return c[l]})}},{}],34:[function(n,t,x){function c(b,c,e){function g(){var c=window.innerWidth,m=window.innerHeight;b!==document.body&&(m=b.getBoundingClientRect(),c=m.right-m.left,m=m.bottom-m.top);l.width=e*c;l.height=e*m;f(l.style,{width:c+"px",height:m+"px"})}var l=document.createElement("canvas");f(l.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(l);b===document.body&&
(l.style.position="absolute",f(b.style,{margin:0,padding:0}));window.addEventListener("resize",g,!1);g();return{canvas:l,onDestroy:function(){window.removeEventListener("resize",g);b.removeChild(l)}}}function l(b,c){function e(f){try{return b.getContext(f,c)}catch(g){return null}}return e("webgl")||e("experimental-webgl")||e("webgl-experimental")}function g(b){if("string"===typeof b)return b.split();e(Array.isArray(b),"invalid extension array");return b}function m(b){return"string"===typeof b?(e("undefined"!==
typeof document,"not supported outside of DOM"),document.querySelector(b)):b}var e=n("./util/check"),f=n("./util/extend");t.exports=function(b){var f=b||{},n,t,q,p;b={};var x=[],H=[],E="undefined"===typeof window?1:window.devicePixelRatio,M=!1,A=function(b){b&&e.raise(b)},u=function(){};"string"===typeof f?(e("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(f),e(n,"invalid query string for element")):"object"===typeof f?"string"===typeof f.nodeName&&
"function"===typeof f.appendChild&&"function"===typeof f.getBoundingClientRect?n=f:"function"===typeof f.drawArrays||"function"===typeof f.drawElements?(p=f,q=p.canvas):(e.constructor(f),"gl"in f?p=f.gl:"canvas"in f?q=m(f.canvas):"container"in f&&(t=m(f.container)),"attributes"in f&&(b=f.attributes,e.type(b,"object","invalid context attributes")),"extensions"in f&&(x=g(f.extensions)),"optionalExtensions"in f&&(H=g(f.optionalExtensions)),"onDone"in f&&(e.type(f.onDone,"function","invalid or missing onDone callback"),
A=f.onDone),"profile"in f&&(M=!!f.profile),"pixelRatio"in f&&(E=+f.pixelRatio,e(0<E,"invalid pixel ratio"))):e.raise("invalid arguments to regl");n&&("canvas"===n.nodeName.toLowerCase()?q=n:t=n);if(!p){if(!q){e("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");n=c(t||document.body,A,E);if(!n)return null;q=n.canvas;u=n.onDestroy}p=l(q,b)}return p?{gl:p,canvas:q,container:t,extensions:x,optionalExtensions:H,pixelRatio:E,profile:M,onDone:A,onDestroy:u}:
(u(),A("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/check":21,"./util/extend":24}],35:[function(n,t,x){t.exports=function(c){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c}},{}],36:[function(n,t,x){var c=n("./identity");t.exports=function(l,g,m,e){var f,b,n,t,x,q,p,C,H=g[0],E=g[1];g=g[2];n=e[0];t=e[1];b=e[2];p=m[0];e=m[1];f=m[2];if(1E-6>Math.abs(H-p)&&1E-6>
Math.abs(E-e)&&1E-6>Math.abs(g-f))return c(l);m=H-p;e=E-e;p=g-f;C=1/Math.sqrt(m*m+e*e+p*p);m*=C;e*=C;p*=C;f=t*p-b*e;b=b*m-n*p;n=n*e-t*m;(C=Math.sqrt(f*f+b*b+n*n))?(C=1/C,f*=C,b*=C,n*=C):n=b=f=0;t=e*n-p*b;x=p*f-m*n;q=m*b-e*f;(C=Math.sqrt(t*t+x*x+q*q))?(C=1/C,t*=C,x*=C,q*=C):q=x=t=0;l[0]=f;l[1]=t;l[2]=m;l[3]=0;l[4]=b;l[5]=x;l[6]=e;l[7]=0;l[8]=n;l[9]=q;l[10]=p;l[11]=0;l[12]=-(f*H+b*E+n*g);l[13]=-(t*H+x*E+q*g);l[14]=-(m*H+e*E+p*g);l[15]=1;return l}},{"./identity":35}],37:[function(n,t,x){t.exports=function(c,
l,g,m,e){l=1/Math.tan(l/2);var f=1/(m-e);c[0]=l/g;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=l;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=(e+m)*f;c[11]=-1;c[12]=0;c[13]=0;c[14]=2*e*m*f;c[15]=0;return c}},{}],38:[function(n,t,x){function c(b){throw Error("resl: "+b);}function l(b,e,f){Object.keys(b).forEach(function(b){0>e.indexOf(b)&&c('invalid parameter "'+b+'" in '+f)})}function g(b,c){this.state=0;this.ready=!1;this.progress=0;this.name=b;this.cancel=c}var m=["manifest","onDone","onProgress","onError"],e=["type",
"src","stream","credentials","parser"],f=["onData","onDone"];t.exports=function(b){function n(e,a){if(e in b){var d=b[e];"function"!==typeof d&&c('invalid callback "'+e+'"');return d}return null}function t(b){function a(){if(!(2>m.readyState||1===r.state||-1===r.state)){if(200!==m.status)return q('error loading resource "'+b.name+'"');if(2<m.readyState&&0===r.state){var a;a="binary"===b.type?m.response:m.responseText;if(l.data)try{n=l.data(a)}catch(e){return q(e)}else n=a}if(3<m.readyState&&0===r.state){if(l.done)try{n=
l.done()}catch(e){return q(e)}r.state=1}A[c]=n;r.progress=.75*r.progress+.25;r.ready=b.stream&&!!n||1===r.state;p()}}var c=b.name,e=b.stream,f="binary"===b.type,l=b.parser,m=new XMLHttpRequest,n=null,r=new g(c,function(){1!==r.state&&-1!==r.state&&(m.onreadystatechange=null,m.abort(),r.state=-1)});m.onreadystatechange=e?a:function(){4===m.readyState&&a()};f&&(m.responseType="arraybuffer");b.credentials&&(m.withCredentials=!0);m.open("GET",b.src,!0);m.send();return r}function x(b,a){function c(){if(0===
t.state)if(r.data)try{u=r.data(a)}catch(b){return q(b)}else u=a}function e(a){c();A[n]=u;t.progress=a.lengthComputable?Math.max(t.progress,a.loaded/a.total):.75*t.progress+.25;p(n)}function f(){c();if(0===t.state){if(r.done)try{u=r.done()}catch(a){return q(a)}t.state=1}t.progress=1;t.ready=!0;A[n]=u;m();p("finish "+n)}function l(){q('error loading asset "'+n+'"')}function m(){b.stream&&a.removeEventListener("progress",e);"image"===b.type?a.addEventListener("load",f):a.addEventListener("canplay",f);
a.removeEventListener("error",l)}var n=b.name,r=b.parser,t=new g(n,function(){1!==t.state&&-1!==t.state&&(t.state=-1,m(),a.src="")}),u=a;b.stream&&a.addEventListener("progress",e);if("image"===b.type)a.addEventListener("load",f);else{var z=!1,C=!1;a.addEventListener("loadedmetadata",function(){C=!0;z&&f()});a.addEventListener("canplay",function(){z=!0;C&&f()})}a.addEventListener("error",l);a.crossOrigin=b.credentials?"use-credentials":"anonymous";a.src=b.src;return t}function q(b){-1!==u&&1!==u&&
(u=-1,S.forEach(function(a){a.cancel()}),M?"string"===typeof b?M(Error("resl: "+b)):M(b):console.error("resl error:",b))}function p(b){if(-1!==u&&1!==u){var a=0,c=0;S.forEach(function(b){b.ready&&(c+=1);a+=b.progress});c===S.length?(u=1,H(A)):E&&E(a/S.length,b)}}"object"===typeof b&&b||c("invalid or missing configuration");l(b,m,"config");var C=b.manifest;"object"===typeof C&&C||c("missing manifest");var H=n("onDone");H||c("missing onDone() callback");var E=n("onProgress"),M=n("onError"),A={},u=0,
N={text:t,binary:function(b){return t(b)},image:function(b){return x(b,document.createElement("img"))},video:function(b){return x(b,document.createElement("video"))},audio:function(b){return x(b,document.createElement("audio"))}},S=Object.keys(C).map(function(b){function a(a,b){if(a in d.parser){var e=d.parser[a];"function"!==typeof e&&c("invalid parser callback "+a+' for asset "'+a+'"');return e}return b}var d=C[b];"string"===typeof d?d={src:d}:"object"===typeof d&&d||c('invalid asset definition "'+
b+'"');l(d,e,'asset "'+b+'"');var g={};"parser"in d&&("function"===typeof d.parser?g={data:d.parser}:"object"===typeof d.parser&&d.parser?(l(g,f,'parser for asset "'+b+'"'),"onData"in g||c('missing onData callback for parser in asset "'+b+'"'),g={data:a("onData"),done:a("onDone")}):c('invalid parser for asset "'+b+'"'));return{name:b,type:function(a,e,f){a in d&&(f=d[a]);0>e.indexOf(f)&&c("invalid "+a+' "'+f+'" for asset "'+b+'", possible values: '+e);return f}("type",Object.keys(N),"text"),stream:!!d.stream,
credentials:!!d.credentials,src:function(a,e,f){a in d?f=d[a]:e&&c("missing "+a+' for asset "'+b+'"');"string"!==typeof f&&c("invalid "+a+' for asset "'+b+'", must be a string');return f}("src",!0,""),parser:g}}).map(function(b){return N[b.type](b)});0===S.length&&setTimeout(function(){p("done")},1)}},{}],39:[function(n,t,x){function c(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var l=n("./lib/util/check"),g=n("./lib/util/extend"),m=n("./lib/dynamic"),e=n("./lib/util/raf"),f=n("./lib/util/clock"),
b=n("./lib/strings"),r=n("./lib/webgl"),z=n("./lib/extension"),L=n("./lib/limits"),q=n("./lib/buffer"),p=n("./lib/elements"),C=n("./lib/texture"),H=n("./lib/renderbuffer"),E=n("./lib/framebuffer"),M=n("./lib/attribute"),A=n("./lib/shader"),u=n("./lib/read"),N=n("./lib/core"),S=n("./lib/stats"),h=n("./lib/timer");t.exports=function(a){function d(){if(0===Q.length)O&&O.update(),ia=null;else{ia=e.next(d);ba();for(var a=Q.length-1;0<=a;--a){var b=Q[a];b&&b(aa,null,0)}K.flush();O&&O.update()}}function n(){!ia&&
0<Q.length&&(ia=e.next(d))}function t(){ia&&(e.cancel(d),ia=null)}function x(a){a.preventDefault();ka=!0;t();Y.forEach(function(a){a()})}function fa(a){K.getError();ka=!1;pa.restore();oa.restore();ma.restore();qa.restore();xa.restore();W.restore();O&&O.restore();X.procs.refresh();n();ea.forEach(function(a){a()})}function Na(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];m.isDynamic(e)?d[b]=m.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;r.length<
a;)r.push(null);return r}l(!!a,"invalid args to regl({...})");l.type(a,"object","invalid args to regl({...})");var d=b(a.context||{}),e=b(a.uniforms||{}),f=b(a.attributes||{}),h=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=g({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");
b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var d=X.compile(h,f,e,d,a),n=d.draw,p=d.batch,q=d.scope,r=[];return g(function(a,b){var d;ka&&l.raise("context lost");if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)q.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)q.call(this,a[d],b,d);else return q.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,
c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return n.call(this,a)},{stats:a})}function I(a,b){var c=0;X.procs.poll();var d=b.color;d&&(K.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in b&&(K.clearDepth(+b.depth),c|=256);"stencil"in b&&(K.clearStencil(b.stencil|0),c|=1024);l(!!c,"called regl.clear with no buffer specified");K.clear(c)}function T(a){l.type(a,"function","regl.frame() callback must be a function");Q.push(a);n();return{cancel:function(){function b(){var a=
c(Q,b);Q[a]=Q[Q.length-1];--Q.length;0>=Q.length&&t()}var d=c(Q,a);l(0<=d,"cannot cancel a frame twice");Q[d]=b}}}function J(){var a=ha.viewport,b=ha.scissor_box;a[0]=a[1]=b[0]=b[1]=0;aa.viewportWidth=aa.framebufferWidth=aa.drawingBufferWidth=a[2]=b[2]=K.drawingBufferWidth;aa.viewportHeight=aa.framebufferHeight=aa.drawingBufferHeight=a[3]=b[3]=K.drawingBufferHeight}function ba(){aa.tick+=1;aa.time=y();J();X.procs.poll()}function U(){J();X.procs.refresh();O&&O.update()}function y(){return(f()-Ba)/
1E3}a=r(a);if(!a)return null;var K=a.gl,Ca=K.getContextAttributes(),ka=K.isContextLost(),pa=z(K,a);if(!pa)return null;var va=b(),Z=S(),R=pa.extensions,O=h(K,R),Ba=f(),sa=K.drawingBufferWidth,wa=K.drawingBufferHeight,aa={tick:0,time:0,viewportWidth:sa,viewportHeight:wa,framebufferWidth:sa,framebufferHeight:wa,drawingBufferWidth:sa,drawingBufferHeight:wa,pixelRatio:a.pixelRatio},ja=L(K,R),ma=q(K,Z,a),na=p(K,R,ma,Z),sa=M(K,R,ja,ma,va),oa=A(K,va,Z,a),qa=C(K,R,ja,function(){X.procs.poll()},aa,Z,a),xa=
H(K,R,ja,Z,a),W=E(K,R,ja,qa,xa,Z),X=N(K,va,R,ja,ma,na,qa,W,{},sa,oa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},aa,O,a),va=u(K,W,X.procs.poll,aa,Ca,R),ha=X.next,V=K.canvas,Q=[],Y=[],ea=[],ya=[a.onDestroy],ia=null;V&&(V.addEventListener("webglcontextlost",x,!1),V.addEventListener("webglcontextrestored",fa,!1));var ta=W.setFBO=Na({framebuffer:m.define.call(null,1,"framebuffer")});U();Ca=g(Na,{clear:function(a){l("object"===typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in
a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)ta(g({framebuffer:a.framebuffer.faces[b]},a),I);else ta(a,I);else I(null,a)},prop:m.define.bind(null,1),context:m.define.bind(null,2),"this":m.define.bind(null,3),draw:Na({}),buffer:function(a){return ma.create(a,34962,!1,!1)},elements:function(a){return na.create(a,!1)},texture:qa.create2D,cube:qa.createCube,renderbuffer:xa.create,framebuffer:W.create,framebufferCube:W.createCube,attributes:Ca,frame:T,on:function(a,
b){l.type(b,"function","listener callback must be a function");var c;switch(a){case "frame":return T(b);case "lost":c=Y;break;case "restore":c=ea;break;case "destroy":c=ya;break;default:l.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:ja,hasExtension:function(a){return 0<=ja.extensions.indexOf(a.toLowerCase())},read:va,destroy:function(){Q.length=0;t();V&&(V.removeEventListener("webglcontextlost",
x),V.removeEventListener("webglcontextrestored",fa));oa.clear();W.clear();xa.clear();qa.clear();na.clear();ma.clear();O&&O.clear();ya.forEach(function(a){a()})},_gl:K,_refresh:U,poll:function(){ba();O&&O.update()},now:y,stats:Z});a.onDone(null,Ca);return Ca}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,
"./lib/texture":19,"./lib/timer":20,"./lib/util/check":21,"./lib/util/clock":22,"./lib/util/extend":24,"./lib/util/raf":31,"./lib/webgl":34}]},{},[1]);
