(function e$$0(p,x,b){function f(g,h){if(!x[g]){if(!p[g]){var a="function"==typeof require&&require;if(!h&&a)return a(g,!0);if(l)return l(g,!0);a=Error("Cannot find module '"+g+"'");throw a.code="MODULE_NOT_FOUND",a;}a=x[g]={exports:{}};p[g][0].call(a.exports,function(a){var b=p[g][1][a];return f(b?b:a)},a,a.exports,e$$0,p,x,b)}return x[g].exports}for(var l="function"==typeof require&&require,n=0;n<b.length;n++)f(b[n]);return f})({1:[function(e,p,x){p=e("../regl")();var b=e("./util/camera")(p,{center:[-12,
5,1],phi:-.2}),f=p({vert:"\n    precision mediump float;\n    attribute vec2 position;\n    void main () {\n      gl_Position = vec4(position, 0, 1);\n    }",frag:"\n    precision mediump float;\n    uniform float width, height, timestep;\n    uniform vec3 eye, center;\n    vec2 resolution = vec2(width, height);\n\n    float torus(vec3 p, vec2 t)\n    {\n      vec2 q = vec2(length(p.xz)-t.x,p.y);\n      return length(q)-t.y;\n    }\n\n    float sphere(vec3 p, float s)\n    {\n      return length(p)-s;\n    }\n\n    vec2 opU(vec2 d1, vec2 d2)\n    {\n      return (d1.x < d2.x) ? d1 : d2;\n    }\n\n    vec3 opRep(vec3 p, vec3 c)\n    {\n      return vec3(mod(p.yz, c.yz)-0.5*c.yz, p.x);\n    }\n\n    float plane(vec3 p, vec4 n)\n    {\n      return dot(p, n.xyz) + n.w;\n    }\n\n    vec2 distanceEstimate(vec3 pos)\n    {\n      float cellSize = 5.;\n      float cellNumber = floor(pos.y/cellSize)+1.;\n      float period = 50./cellNumber;\n      float s = sin(timestep/period);\n      float c = cos(timestep/period);\n      mat3 r = mat3(c,  -s,  0.,\n                    s,   c,  0.,\n                    0.,  0., 1.);\n      vec2 ball = vec2(sphere(opRep(pos-vec3(0, 0, s*2.0), vec3(cellSize)), 0.5), 45.);\n      vec2 tor = vec2(torus(opRep(pos, vec3(cellSize))*r, vec2(1.0, 0.25)), 15.);\n      vec2 floor = vec2(plane(pos, vec4(0, 1, 0, -1)), 0.);\n      vec2 objects = opU(tor, ball);\n      return opU(floor, objects);\n    }\n\n    vec3 getNormal(vec3 pos)\n    {\n      const vec2 delta = vec2(0.01, 0);\n\n      vec3 n;\n      n.x = distanceEstimate(pos + delta.xyy).x - distanceEstimate(pos - delta.xyy).x;\n      n.y = distanceEstimate(pos + delta.yxy).x - distanceEstimate(pos - delta.yxy).x;\n      n.z = distanceEstimate(pos + delta.yyx).x - distanceEstimate(pos - delta.yyx).x;\n\n      return normalize(n);\n    }\n\n    float softshadow(in vec3 ro, in vec3 rd, in float mint, in float tmax)\n    {\n      float res = 1.0;\n      float t = mint;\n      for (int i=0; i<16; i++)\n      {\n        float h = distanceEstimate(ro + rd*t).x;\n        res = min(res, 8.0*h/t);\n        t += clamp(h, 0.02, 0.11);\n        if( h<0.001 || t>tmax ) break;\n      }\n      return clamp(res, 0., 1.);\n    }\n\n    float calcAO(in vec3 pos, in vec3 nor)\n    {\n      float occ = 0.0;\n      float sca = 1.0;\n      for (int i=0; i<5; i++)\n      {\n        float hr = 0.01 + 0.12*float(i)/4.0;\n        vec3 aopos =  nor * hr + pos;\n        float dd = distanceEstimate(aopos).x;\n        occ += -(dd-hr)*sca;\n        sca *= 0.95;\n      }\n      return clamp(1.0 - 3.0*occ, 0., 1.);\n    }\n\n    vec3 sunLight  = normalize(vec3(-0.6, 0.7, 0.5));\n    vec3 sunColour = vec3(1.0, .75, .6);\n    vec3 Sky(in vec3 rayDir)\n    {\n      float sunAmount = max(dot(rayDir, sunLight), 0.0);\n      float v = pow(1.0 - max(rayDir.y, 0.0), 6.);\n      vec3  sky = mix(vec3(.1, .2, .3), vec3(.32, .32, .32), v);\n      sky = sky + sunColour * sunAmount * sunAmount * .25;\n      sky = sky + sunColour * min(pow(sunAmount, 800.0)*1.5, .3);\n\n      return clamp(sky, 0., 1.);\n    }\n\n    const float horizonLength = 100.;\n    const float surfacePrecision = 0.01;\n    const int maxIterations = 128;\n    vec2 castRay(vec3 rayOrigin, vec3 rayDir)\n    {\n      float t = 0.;\n      for (int i=0; i<maxIterations; i++)\n      {\n        vec3 p = rayOrigin + rayDir * t;\n        vec2 d = distanceEstimate(p);\n        if (abs(d.x) < surfacePrecision)\n        {\n          return vec2(t, d.y);\n        }\n        t += d.x;\n        if (t >= horizonLength) break;\n      }\n      return vec2(t, -1.);\n    }\n\n    vec3 getRay(vec3 dir, vec2 pos) {\n      pos = pos - 0.5;\n      pos.x *= resolution.x/resolution.y;\n\n      dir = normalize(dir);\n      vec3 right = normalize(cross(vec3(0., 1., 0.), dir));\n      vec3 up = normalize(cross(dir, right));\n\n      return dir + right*pos.x + up*pos.y;\n    }\n\n    vec3 render(in vec3 ro, in vec3 rd)\n    {\n      vec3 skyColor = Sky(rd);\n      vec3 color = skyColor;\n      vec2 res = castRay(ro, rd);\n      float t = res.x;\n      float material = res.y;\n      if (t < horizonLength)\n      {\n        vec3 pos = ro + t*rd;\n        vec3 normal = getNormal(pos);\n        vec3 reflectionDir = reflect(rd, normal);\n\n        // material\n        color = 0.45 + 0.3*sin(vec3(0.05, 0.08, 0.10)) * material;\n\n        if (material == 0.0)\n        {\n          float f = mod(floor(2.*pos.z) + floor(2.*pos.x), 2.);\n          color = 0.4 + 0.1*f*vec3(1.);\n        }\n\n        // lighting\n        float occ = calcAO(pos, normal);\n        float amb = clamp(0.5+0.5*normal.y, 0., 1.);\n        float dif = clamp(dot(normal, sunLight), 0., 1.);\n        float bac = clamp(dot(normal, normalize(vec3(-sunLight.x, 0., -sunLight.z))), 0., 1.) * clamp(1.0-pos.y, 0., 1.);\n        float dom = smoothstep(-0.1, 0.1, reflectionDir.y);\n        float fre = pow(clamp(1.0+dot(normal, rd), 0., 1.), 2.);\n        float spe = pow(clamp(dot(reflectionDir, sunLight), 0., 1.), 16.);\n\n        dif *= softshadow(pos, sunLight, 0.02, 2.5);\n        dom *= softshadow(pos, reflectionDir, 0.02, 2.5);\n\n        vec3 lin = vec3(0.);\n        lin += 1.20 * dif * vec3(1.00, 0.85, 0.55);\n        lin += 1.20 * spe * vec3(1.00, 0.85, 0.55) * dif;\n        lin += 0.20 * amb * vec3(0.50, 0.70, 1.00) * occ;\n        lin += 0.30 * dom * vec3(0.50, 0.70, 1.00) * occ;\n        lin += 0.30 * bac * vec3(0.25, 0.25, 0.25) * occ;\n        lin += 0.40 * fre * vec3(1.00, 1.00, 1.00) * occ;\n        color = color * lin;\n\n        color = mix(color, skyColor, 1.0-exp(-0.001*t*t));\n      }\n      return vec3(clamp(color, 0., 1.));\n    }\n\n    void main () {\n      vec2 p = gl_FragCoord.xy / resolution.xy;\n      vec3 rayDir = normalize(getRay(eye-center, p));\n      vec3 res = render(center, rayDir);\n      gl_FragColor = vec4(res.rgb, 1.);\n    }",
attributes:{position:[-4,-4,4,-4,0,4]},uniforms:{height:p.context("viewportHeight"),width:p.context("viewportWidth"),timestep:p.context("tick")},count:3});p.frame(function(){b(function(){f()})})},{"../regl":44,"./util/camera":2}],2:[function(e,p,x){var b=e("mouse-change"),f=e("mouse-wheel"),l=e("gl-mat4/identity"),n=e("gl-mat4/perspective"),g=e("gl-mat4/lookAt");p.exports=function(h,a){function r(a){a*=.9;return.1>a?0:a}function e(a){var b=m.center,k=m.eye,f=m.up;m.theta+=B;m.phi=Math.min(Math.max(m.phi+
E,-Math.PI/2),Math.PI/2);m.distance=Math.min(Math.max(m.distance+t,Q),p);B=r(B);E=r(E);t=r(t);for(var h=m.theta,l=m.phi,n=Math.exp(m.distance),y=n*Math.sin(h)*Math.cos(l),h=n*Math.cos(h)*Math.cos(l),l=n*Math.sin(l),n=0;3>n;++n)k[n]=b[n]+y*q[n]+h*w[n]+l*f[n];g(m.view,k,b,f);L(a)}var m={view:l(new Float32Array(16)),projection:l(new Float32Array(16)),center:new Float32Array(a.center||3),theta:a.theta||0,phi:a.phi||0,distance:Math.log(a.distance||10),eye:new Float32Array(3),up:new Float32Array(a.up||
[0,1,0])},w=new Float32Array([1,0,0]),q=new Float32Array([0,0,1]),Q=Math.log("minDistance"in a?a.minDistance:.1),p=Math.log("maxDistance"in a?a.maxDistance:1E3),B=0,E=0,t=0,y=0,K=0;b(function(a,b,g){if(a&1){a=(g-K)/window.innerHeight;var f=Math.max(m.distance,.5);B+=(b-y)/window.innerWidth*f;E+=f*a}y=b;K=g});f(function(a,b){t+=b/window.innerHeight});var L=h({context:Object.assign({},m,{projection:function(a){return n(m.projection,Math.PI/4,a.viewportWidth/a.viewportHeight,.01,1E3)}}),uniforms:Object.keys(m).reduce(function(a,
b){a[b]=h.context(b);return a},{})});Object.keys(m).forEach(function(a){e[a]=m[a]});return e}},{"gl-mat4/identity":36,"gl-mat4/lookAt":37,"gl-mat4/perspective":38,"mouse-change":39,"mouse-wheel":41}],3:[function(e,p,x){function b(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}p.exports=function(f,l,n,g,h){f=n.maxAttributes;l=Array(f);for(n=0;n<f;++n)l[n]=new b;return{Record:b,scope:{},state:l}}},{}],
4:[function(e,p,x){function b(a){return w[Object.prototype.toString.call(a)]|0}function f(a,b){for(var g=0;g<b.length;++g)a[g]=b[g]}function l(a,b,g,f,h,l,n){for(var c=0,k=0;k<g;++k)for(var r=0;r<f;++r)a[c++]=b[h*k+l*r+n]}var n=e("./util/check"),g=e("./util/is-typed-array"),h=e("./util/is-ndarray"),a=e("./util/values"),r=e("./util/pool");x=e("./util/flatten");var A=x.flatten,m=x.shape,w=e("./constants/arraytypes.json"),q=e("./constants/dtypes.json"),Q=e("./constants/usage.json"),z=[];z[5120]=1;z[5122]=
2;z[5124]=4;z[5121]=1;z[5123]=2;z[5125]=4;z[5126]=4;p.exports=function(e,w,t){function y(a){this.id=c++;this.buffer=e.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;t.profile&&(this.stats={size:0})}function K(a,b,g){a.byteLength=b.byteLength;e.bufferData(a.type,b,g)}function L(a,c,k,q,e,t){a.usage=k;if(Array.isArray(c)){if(a.dtype=q||5126,0<c.length)if(Array.isArray(c[0])){e=m(c);for(var w=q=1;w<e.length;++w)q*=e[w];a.dimension=
q;c=A(c,e,a.dtype);K(a,c,k);t?a.persistentData=c:r.freeType(c)}else"number"===typeof c[0]?(a.dimension=e,e=r.allocType(a.dtype,c.length),f(e,c),K(a,e,k),t?a.persistentData=e:r.freeType(e)):g(c[0])?(a.dimension=c[0].length,a.dtype=q||b(c[0])||5126,c=A(c,[c.length,c[0].length],a.dtype),K(a,c,k),t?a.persistentData=c:r.freeType(c)):n.raise("invalid buffer data")}else if(g(c))a.dtype=q||b(c),a.dimension=e,K(a,c,k),t&&(a.persistentData=new Uint8Array(new Uint8Array(c.buffer)));else if(h(c)){e=c.shape;var y=
c.stride,w=c.offset,I=0,V=0,G=0,F=0;1===e.length?(I=e[0],V=1,G=y[0],F=0):2===e.length?(I=e[0],V=e[1],G=y[0],F=y[1]):n.raise("invalid shape");a.dtype=q||b(c.data)||5126;a.dimension=V;e=r.allocType(a.dtype,I*V);l(e,c.data,I,V,G,F,w);K(a,e,k);t?a.persistentData=e:r.freeType(e)}else n.raise("invalid buffer data")}function F(a){w.bufferCount--;var b=a.buffer;n(b,"buffer must not be deleted already");e.deleteBuffer(b);a.buffer=null;delete k[a.id]}var c=0,k={};y.prototype.bind=function(){e.bindBuffer(this.type,
this.buffer)};y.prototype.destroy=function(){F(this)};var I=[];t.profile&&(w.getTotalBufferSize=function(){var a=0;Object.keys(k).forEach(function(b){a+=k[b].stats.size});return a});return{create:function(a,c,I,K){function p(a){var b=35044,c=null,k=0,f=0,l=1;Array.isArray(a)||g(a)||h(a)?c=a:"number"===typeof a?k=a|0:a&&(n.type(a,"object","buffer arguments must be an object, a number or an array"),"data"in a&&(n(null===c||Array.isArray(c)||g(c)||h(c),"invalid data for buffer"),c=a.data),"usage"in a&&
(n.parameter(a.usage,Q,"invalid buffer usage"),b=Q[a.usage]),"type"in a&&(n.parameter(a.type,q,"invalid buffer type"),f=q[a.type]),"dimension"in a&&(n.type(a.dimension,"number","invalid dimension"),l=a.dimension|0),"length"in a&&(n.nni(k,"buffer length must be a nonnegative integer"),k=a.length|0));H.bind();c?L(H,c,b,f,l,K):(e.bufferData(H.type,k,b),H.dtype=f||5121,H.usage=b,H.dimension=l,H.byteLength=k);t.profile&&(H.stats.size=H.byteLength*z[H.dtype]);return p}function x(a,b){n(b+a.byteLength<=
H.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+a.byteLength+" starting from offset "+b+" to a buffer of size "+H.byteLength);e.bufferSubData(H.type,b,a)}w.bufferCount++;var H=new y(c);k[H.id]=H;I||p(a);p._reglType="buffer";p._buffer=H;p.subdata=function(a,c){var k=(c||0)|0,e;H.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var q=r.allocType(H.dtype,a.length);f(q,a);x(q,k);r.freeType(q)}else Array.isArray(a[0])||g(a[0])?(e=m(a),q=A(a,
e,H.dtype),x(q,k),r.freeType(q)):n.raise("invalid buffer data")}else if(g(a))x(a,k);else if(h(a)){e=a.shape;var t=a.stride,w=q=0,y=0,oa=0;1===e.length?(q=e[0],w=1,y=t[0],oa=0):2===e.length?(q=e[0],w=e[1],y=t[0],oa=t[1]):n.raise("invalid shape");e=Array.isArray(a.data)?H.dtype:b(a.data);e=r.allocType(e,q*w);l(e,a.data,q,w,y,oa,a.offset);x(e,k);r.freeType(e)}else n.raise("invalid data for buffer subdata");return p};t.profile&&(p.stats=H.stats);p.destroy=function(){F(H)};return p},createStream:function(a,
b){var c=I.pop();c||(c=new y(a));c.bind();L(c,b,35040,0,1,!1);return c},destroyStream:function(a){I.push(a)},clear:function(){a(k).forEach(F);I.forEach(F)},getBuffer:function(a){return a&&a._buffer instanceof y?a._buffer:null},restore:function(){a(k).forEach(function(a){a.buffer=e.createBuffer();e.bindBuffer(a.type,a.buffer);e.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},_initBuffer:L}}},{"./constants/arraytypes.json":5,"./constants/dtypes.json":6,"./constants/usage.json":8,"./util/check":22,
"./util/flatten":26,"./util/is-ndarray":28,"./util/is-typed-array":29,"./util/pool":31,"./util/values":34}],5:[function(e,p,x){p.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],6:[function(e,p,x){p.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,
uint32:5125,"float":5126,float32:5126}},{}],7:[function(e,p,x){p.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],8:[function(e,p,x){p.exports={"static":35044,dynamic:35048,stream:35040}},{}],9:[function(e,p,x){function b(a){return Array.isArray(a)||m(a)||w(a)}function f(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function l(a,b,c,g){this.thisDep=a;this.contextDep=b;this.propDep=
c;this.append=g}function n(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function g(a){return new l(!1,!1,!1,a)}function h(a,b){var c=a.type;return 0===c?(c=a.data.length,new l(!0,1<=c,2<=c,b)):4===c?(c=a.data,new l(c.thisDep,c.contextDep,c.propDep,b)):new l(3===c,2===c,1===c,b)}var a=e("./util/check"),r=e("./util/codegen"),A=e("./util/loop"),m=e("./util/is-typed-array"),w=e("./util/is-ndarray"),q=e("./util/is-array-like"),Q=e("./dynamic"),z=e("./constants/primitives.json"),B=e("./constants/dtypes.json"),
E=["x","y","z","w"],t="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),y={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},K="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
L={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},F={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},c={frag:35632,vert:35633},k={cw:2304,ccw:2305},I=new l(!1,!1,!1,function(){});p.exports=function(e,w,m,p,x,Y,H,S,U,V,G,ta,ja,pa,ya){function Z(a){return a.replace(".","_")}function O(a,d,c){var b=Z(a);Ha.push(a);
ka[b]=v[b]=!!c;Ca[b]=d}function M(a,d,c){var b=Z(a);Ha.push(a);Array.isArray(c)?(v[b]=c.slice(),ka[b]=c.slice()):v[b]=ka[b]=c;Da[b]=d}function Ea(){var d=r(),c=d.link,b=d.global;d.id=Qa++;d.batchId="0";var g=c(Na),k=d.shared={props:"a0"};Object.keys(Na).forEach(function(a){k[a]=b.def(g,".",a)});a.optional(function(){d.CHECK=c(a);d.commandStr=a.guessCommand();d.command=c(d.commandStr);d.assert=function(a,d,D){a("if(!(",d,"))",this.CHECK,".commandRaise(",c(D),",",this.command,");")};Ia.invalidBlendCombinations=
K});var f=d.next={},h=d.current={};Object.keys(Da).forEach(function(a){Array.isArray(v[a])&&(f[a]=b.def(k.next,".",a),h[a]=b.def(k.current,".",a))});var Ra=d.constants={};Object.keys(Ia).forEach(function(a){Ra[a]=b.def(JSON.stringify(Ia[a]))});d.invoke=function(a,D){switch(D.type){case 0:var b=["this",k.context,k.props,d.batchId];return a.def(c(D.data),".call(",b.slice(0,Math.max(D.data.length+1,4)),")");case 1:return a.def(k.props,D.data);case 2:return a.def(k.context,D.data);case 3:return a.def("this",
D.data);case 4:return D.data.append(d,a),D.data.ref}};d.attribCache={};var D={};d.scopeAttrib=function(a){a=w.id(a);if(a in D)return D[a];var d=V.scope[a];d||(d=V.scope[a]=new ua);return D[a]=c(d)};return d}function va(a){var d=a["static"];a=a.dynamic;var c;if("profile"in d){var b=!!d.profile;c=g(function(a,d){return b});c.enable=b}else if("profile"in a){var k=a.profile;c=h(k,function(a,d){return a.invoke(d,k)})}return c}function za(d,c){var b=d["static"],k=d.dynamic;if("framebuffer"in b){var f=b.framebuffer;
return f?(f=S.getFramebuffer(f),a.command(f,"invalid framebuffer object"),g(function(a,d){var D=a.link(f),c=a.shared;d.set(c.framebuffer,".next",D);c=c.context;d.set(c,".framebufferWidth",D+".width");d.set(c,".framebufferHeight",D+".height");return D})):g(function(a,d){var c=a.shared;d.set(c.framebuffer,".next","null");c=c.context;d.set(c,".framebufferWidth",c+".drawingBufferWidth");d.set(c,".framebufferHeight",c+".drawingBufferHeight");return"null"})}if("framebuffer"in k){var P=k.framebuffer;return h(P,
function(d,c){var D=d.invoke(c,P),b=d.shared,ca=b.framebuffer,J=c.def(ca,".getFramebuffer(",D,")");a.optional(function(){d.assert(c,"!"+D+"||"+J,"invalid framebuffer object")});c.set(ca,".next",J);b=b.context;c.set(b,".framebufferWidth",J+"?"+J+".width:"+b+".drawingBufferWidth");c.set(b,".framebufferHeight",J+"?"+J+".height:"+b+".drawingBufferHeight");return J})}return null}function aa(d,c,b){function k(d){if(d in g){var D=g[d];a.commandType(D,"object","invalid "+d,b.commandStr);var u=!0,ca=D.x|0,
v=D.y|0,n,e;"width"in D?(n=D.width|0,a.command(0<=n,"invalid "+d,b.commandStr)):u=!1;"height"in D?(e=D.height|0,a.command(0<=e,"invalid "+d,b.commandStr)):u=!1;return new l(!u&&c&&c.thisDep,!u&&c&&c.contextDep,!u&&c&&c.propDep,function(a,d){var c=a.shared.context,b=n;"width"in D||(b=d.def(c,".","framebufferWidth","-",ca));var u=e;"height"in D||(u=d.def(c,".","framebufferHeight","-",v));return[ca,v,b,u]})}if(d in f){var q=f[d],u=h(q,function(c,b){var D=c.invoke(b,q);a.optional(function(){c.assert(b,
D+"&&typeof "+D+'==="object"',"invalid "+d)});var ca=c.shared.context,u=b.def(D,".x|0"),J=b.def(D,".y|0"),k=b.def('"width" in ',D,"?",D,".width|0:","(",ca,".","framebufferWidth","-",u,")"),g=b.def('"height" in ',D,"?",D,".height|0:","(",ca,".","framebufferHeight","-",J,")");a.optional(function(){c.assert(b,k+">=0&&"+g+">=0","invalid "+d)});return[u,J,k,g]});c&&(u.thisDep=u.thisDep||c.thisDep,u.contextDep=u.contextDep||c.contextDep,u.propDep=u.propDep||c.propDep);return u}return c?new l(c.thisDep,
c.contextDep,c.propDep,function(a,d){var c=a.shared.context;return[0,0,d.def(c,".","framebufferWidth"),d.def(c,".","framebufferHeight")]}):null}var g=d["static"],f=d.dynamic;if(d=k("viewport")){var v=d;d=new l(d.thisDep,d.contextDep,d.propDep,function(a,d){var c=v.append(a,d),b=a.shared.context;d.set(b,".viewportWidth",c[2]);d.set(b,".viewportHeight",c[3]);return c})}return{viewport:d,scissor_box:k("scissor.box")}}function ha(d){function b(d){if(d in k){var D=w.id(k[d]);a.optional(function(){G.shader(c[d],
D,a.guessCommand())});var u=g(function(){return D});u.id=D;return u}if(d in f){var ca=f[d];return h(ca,function(b,D){var k=b.invoke(D,ca),u=D.def(b.shared.strings,".id(",k,")");a.optional(function(){D(b.shared.shader,".shader(",c[d],",",u,",",b.command,");")});return u})}return null}var k=d["static"],f=d.dynamic,v=b("frag"),P=b("vert"),e=null;n(v)&&n(P)?(e=G.program(P.id,v.id),d=g(function(a,d){return a.link(e)})):d=new l(v&&v.thisDep||P&&P.thisDep,v&&v.contextDep||P&&P.contextDep,v&&v.propDep||P&&
P.propDep,function(d,c){var b=d.shared.shader,ca;ca=v?v.append(d,c):c.def(b,".","frag");var u;u=P?P.append(d,c):c.def(b,".","vert");var k=b+".program("+u+","+ca;a.optional(function(){k+=","+d.command});return c.def(k+")")});return{frag:v,vert:P,progVar:d,program:e}}function la(d,c){function k(d,b){if(d in f){var u=f[d]|0;a.command(!b||0<=u,"invalid "+d,c.commandStr);return g(function(a,d){b&&(a.OFFSET=u);return u})}if(d in v){var ca=v[d];return h(ca,function(c,k){var u=c.invoke(k,ca);b&&(c.OFFSET=
u,a.optional(function(){c.assert(k,u+">=0","invalid "+d)}));return u})}return b&&P?g(function(a,d){a.OFFSET="0";return 0}):null}var f=d["static"],v=d.dynamic,P=function(){if("elements"in f){var d=f.elements;b(d)?d=Y.getElements(Y.create(d,!0)):d&&(d=Y.getElements(d),a.command(d,"invalid elements",c.commandStr));var D=g(function(a,c){if(d){var b=a.link(d);return a.ELEMENTS=b}return a.ELEMENTS=null});D.value=d;return D}if("elements"in v){var k=v.elements;return h(k,function(d,c){var b=d.shared,D=b.isBufferArgs,
b=b.elements,u=d.invoke(c,k),g=c.def("null"),D=c.def(D,"(",u,")"),f=d.cond(D).then(g,"=",b,".createStream(",u,");")["else"](g,"=",b,".getElements(",u,");");a.optional(function(){d.assert(f["else"],"!"+u+"||"+g,"invalid elements")});c.entry(f);c.exit(d.cond(D).then(b,".destroyStream(",g,");"));return d.ELEMENTS=g})}return null}(),e=k("offset",!0);return{elements:P,primitive:function(){if("primitive"in f){var d=f.primitive;a.commandParameter(d,z,"invalid primitve",c.commandStr);return g(function(a,
c){return z[d]})}if("primitive"in v){var b=v.primitive;return h(b,function(d,c){var u=d.constants.primTypes,k=d.invoke(c,b);a.optional(function(){d.assert(c,k+" in "+u,"invalid primitive, must be one of "+Object.keys(z))});return c.def(u,"[",k,"]")})}return P?n(P)?P.value?g(function(a,d){return d.def(a.ELEMENTS,".primType")}):g(function(){return 4}):new l(P.thisDep,P.contextDep,P.propDep,function(a,d){var c=a.ELEMENTS;return d.def(c,"?",c,".primType:",4)}):null}(),count:function(){if("count"in f){var d=
f.count|0;a.command("number"===typeof d&&0<=d,"invalid vertex count",c.commandStr);return g(function(){return d})}if("count"in v){var b=v.count;return h(b,function(d,c){var u=d.invoke(c,b);a.optional(function(){d.assert(c,"typeof "+u+'==="number"&&'+u+">=0&&"+u+"===("+u+"|0)","invalid vertex count")});return u})}if(P){if(n(P)){if(P)return e?new l(e.thisDep,e.contextDep,e.propDep,function(d,c){var b=c.def(d.ELEMENTS,".vertCount-",d.OFFSET);a.optional(function(){d.assert(c,b+">=0","invalid vertex offset/element buffer too small")});
return b}):g(function(a,d){return d.def(a.ELEMENTS,".vertCount")});var u=g(function(){return-1});a.optional(function(){u.MISSING=!0});return u}var k=new l(P.thisDep||e.thisDep,P.contextDep||e.contextDep,P.propDep||e.propDep,function(a,d){var c=a.ELEMENTS;return a.OFFSET?d.def(c,"?",c,".vertCount-",a.OFFSET,":-1"):d.def(c,"?",c,".vertCount:-1")});a.optional(function(){k.DYNAMIC=!0});return k}return null}(),instances:k("instances",!1),offset:e}}function ma(d,c){var b=d["static"],f=d.dynamic,v={};Ha.forEach(function(d){function u(a,
c){if(d in b){var k=a(b[d]);v[e]=g(function(){return k})}else if(d in f){var J=f[d];v[e]=h(J,function(a,d){return c(a,d,a.invoke(d,J))})}}var e=Z(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return u(function(b){a.commandType(b,"boolean",d,c.commandStr);return b},function(c,b,u){a.optional(function(){c.assert(b,"typeof "+u+'==="boolean"',
"invalid flag "+d,c.commandStr)});return u});case "depth.func":return u(function(b){a.commandParameter(b,L,"invalid "+d,c.commandStr);return L[b]},function(c,b,u){var k=c.constants.compareFuncs;a.optional(function(){c.assert(b,u+" in "+k,"invalid "+d+", must be one of "+Object.keys(L))});return b.def(k,"[",u,"]")});case "depth.range":return u(function(d){a.command(q(d)&&2===d.length&&"number"===typeof d[0]&&"number"===typeof d[1]&&d[0]<=d[1],"depth range is 2d array",c.commandStr);return d},function(d,
c,b){a.optional(function(){d.assert(c,d.shared.isArrayLike+"("+b+")&&"+b+".length===2&&typeof "+b+'[0]==="number"&&typeof '+b+'[1]==="number"&&'+b+"[0]<="+b+"[1]","depth range must be a 2d array")});var u=c.def("+",b,"[0]"),k=c.def("+",b,"[1]");return[u,k]});case "blend.func":return u(function(d){a.commandType(d,"object","blend.func",c.commandStr);var b="srcRGB"in d?d.srcRGB:d.src,u="srcAlpha"in d?d.srcAlpha:d.src,k="dstRGB"in d?d.dstRGB:d.dst;d="dstAlpha"in d?d.dstAlpha:d.dst;a.commandParameter(b,
y,e+".srcRGB",c.commandStr);a.commandParameter(u,y,e+".srcAlpha",c.commandStr);a.commandParameter(k,y,e+".dstRGB",c.commandStr);a.commandParameter(d,y,e+".dstAlpha",c.commandStr);a.command(-1===K.indexOf(b+", "+k),"unallowed blending combination (srcRGB, dstRGB) = ("+b+", "+k+")",c.commandStr);return[y[b],y[k],y[u],y[d]]},function(c,b,u){function k(f,J){var e=b.def('"',f,J,'" in ',u,"?",u,".",f,J,":",u,".",f);a.optional(function(){c.assert(b,e+" in "+g,"invalid "+d+"."+f+J+", must be one of "+Object.keys(y))});
return e}var g=c.constants.blendFuncs;a.optional(function(){c.assert(b,u+"&&typeof "+u+'==="object"',"invalid blend func, must be an object")});var f=k("src","RGB"),J=k("dst","RGB");a.optional(function(){c.assert(b,c.constants.invalidBlendCombinations+".indexOf("+f+'+", "+'+J+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var e=b.def(g,"[",f,"]"),v=b.def(g,"[",k("src","Alpha"),"]"),h=b.def(g,"[",J,"]"),l=b.def(g,"[",k("dst","Alpha"),"]");return[e,h,v,l]});case "blend.equation":return u(function(b){if("string"===
typeof b)return a.commandParameter(b,da,"invalid "+d,c.commandStr),[da[b],da[b]];if("object"===typeof b)return a.commandParameter(b.rgb,da,d+".rgb",c.commandStr),a.commandParameter(b.alpha,da,d+".alpha",c.commandStr),[da[b.rgb],da[b.alpha]];a.commandRaise("invalid blend.equation",c.commandStr)},function(c,b,u){var k=c.constants.blendEquations,f=b.def(),g=b.def(),J=c.cond("typeof ",u,'==="string"');a.optional(function(){function a(d,b,u){c.assert(d,u+" in "+k,"invalid "+b+", must be one of "+Object.keys(da))}
a(J.then,d,u);c.assert(J["else"],u+"&&typeof "+u+'==="object"',"invalid "+d);a(J["else"],d+".rgb",u+".rgb");a(J["else"],d+".alpha",u+".alpha")});J.then(f,"=",g,"=",k,"[",u,"];");J["else"](f,"=",k,"[",u,".rgb];",g,"=",k,"[",u,".alpha];");b(J);return[f,g]});case "blend.color":return u(function(d){a.command(q(d)&&4===d.length,"blend.color must be a 4d array",c.commandStr);return A(4,function(a){return+d[a]})},function(d,c,b){a.optional(function(){d.assert(c,d.shared.isArrayLike+"("+b+")&&"+b+".length===4",
"blend.color must be a 4d array")});return A(4,function(a){return c.def("+",b,"[",a,"]")})});case "stencil.mask":return u(function(d){a.commandType(d,"number",e,c.commandStr);return d|0},function(d,c,b){a.optional(function(){d.assert(c,"typeof "+b+'==="number"',"invalid stencil.mask")});return c.def(b,"|0")});case "stencil.func":return u(function(b){a.commandType(b,"object",e,c.commandStr);var u=b.cmp||"keep",k=b.ref||0;b="mask"in b?b.mask:-1;a.commandParameter(u,L,d+".cmp",c.commandStr);a.commandType(k,
"number",d+".ref",c.commandStr);a.commandType(b,"number",d+".mask",c.commandStr);return[L[u],k,b]},function(d,c,b){var u=d.constants.compareFuncs;a.optional(function(){function a(){d.assert(c,Array.prototype.join.call(arguments,""),"invalid stencil.func")}a(b+"&&typeof ",b,'==="object"');a('!("cmp" in ',b,")||(",b,".cmp in ",u,")")});var k=c.def('"cmp" in ',b,"?",u,"[",b,".cmp]",":",7680),f=c.def(b,".ref|0"),g=c.def('"mask" in ',b,"?",b,".mask|0:-1");return[k,f,g]});case "stencil.opFront":case "stencil.opBack":return u(function(b){a.commandType(b,
"object",e,c.commandStr);var u=b.fail||"keep",k=b.zfail||"keep";b=b.zpass||"keep";a.commandParameter(u,F,d+".fail",c.commandStr);a.commandParameter(k,F,d+".zfail",c.commandStr);a.commandParameter(b,F,d+".zpass",c.commandStr);return["stencil.opBack"===d?1029:1028,F[u],F[k],F[b]]},function(c,b,u){function k(g){a.optional(function(){c.assert(b,'!("'+g+'" in '+u+")||("+u+"."+g+" in "+f+")","invalid "+d+"."+g+", must be one of "+Object.keys(F))});return b.def('"',g,'" in ',u,"?",f,"[",u,".",g,"]:",7680)}
var f=c.constants.stencilOps;a.optional(function(){c.assert(b,u+"&&typeof "+u+'==="object"',"invalid "+d)});return["stencil.opBack"===d?1029:1028,k("fail"),k("zfail"),k("zpass")]});case "polygonOffset.offset":return u(function(d){a.commandType(d,"object",e,c.commandStr);var b=d.factor|0;d=d.units|0;a.commandType(b,"number",e+".factor",c.commandStr);a.commandType(d,"number",e+".units",c.commandStr);return[b,d]},function(c,b,u){a.optional(function(){c.assert(b,u+"&&typeof "+u+'==="object"',"invalid "+
d)});var k=b.def(u,".factor|0"),g=b.def(u,".units|0");return[k,g]});case "cull.face":return u(function(d){var b=0;"front"===d?b=1028:"back"===d&&(b=1029);a.command(!!b,e,c.commandStr);return b},function(d,c,b){a.optional(function(){d.assert(c,b+'==="front"||'+b+'==="back"',"invalid cull.face")});return c.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return u(function(d){a.command("number"===typeof d&&d>=p.lineWidthDims[0]&&d<=p.lineWidthDims[1],"invalid line width, must positive number between "+
p.lineWidthDims[0]+" and "+p.lineWidthDims[1],c.commandStr);return d},function(d,c,b){a.optional(function(){d.assert(c,"typeof "+b+'==="number"&&'+b+">="+p.lineWidthDims[0]+"&&"+b+"<="+p.lineWidthDims[1],"invalid line width")});return b});case "frontFace":return u(function(d){a.commandParameter(d,k,e,c.commandStr);return k[d]},function(d,b,c){a.optional(function(){d.assert(b,c+'==="cw"||'+c+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return b.def(c+'==="cw"?2304:2305')});case "colorMask":return u(function(d){a.command(q(d)&&
4===d.length,"color.mask must be length 4 array",c.commandStr);return d.map(function(a){return!!a})},function(d,c,b){a.optional(function(){d.assert(c,d.shared.isArrayLike+"("+b+")&&"+b+".length===4","invalid color.mask")});return A(4,function(a){return"!!"+b+"["+a+"]"})});case "sample.coverage":return u(function(d){a.command("object"===typeof d&&d,e,c.commandStr);var b="value"in d?d.value:1;d=!!d.invert;a.command("number"===typeof b&&0<=b&&1>=b,"sample.coverage.value must be a number between 0 and 1",
c.commandStr);return[b,d]},function(d,b,c){a.optional(function(){d.assert(b,c+"&&typeof "+c+'==="object"',"invalid sample.coverage")});var u=b.def('"value" in ',c,"?+",c,".value:1"),k=b.def("!!",c,".invert");return[u,k]})}});return v}function na(d,b){var c=d["static"],k=d.dynamic,f={};Object.keys(c).forEach(function(d){var u=c[d],k;if("number"===typeof u||"boolean"===typeof u)k=g(function(){return u});else if("function"===typeof u){var e=u._reglType;"texture2d"===e||"textureCube"===e?k=g(function(d){return d.link(u)}):
"framebuffer"===e||"framebufferCube"===e?(a.command(0<u.color.length,'missing color attachment for framebuffer sent to uniform "'+d+'"',b.commandStr),k=g(function(d){return d.link(u.color[0])})):a.commandRaise('invalid data for uniform "'+d+'"',b.commandStr)}else q(u)?k=g(function(b){return b.global.def("[",A(u.length,function(c){a.command("number"===typeof u[c]||"boolean"===typeof u[c],"invalid uniform "+d,b.commandStr);return u[c]}),"]")}):a.commandRaise('invalid or missing data for uniform "'+
d+'"',b.commandStr);k.value=u;f[d]=k});Object.keys(k).forEach(function(d){var a=k[d];f[d]=h(a,function(d,b){return d.invoke(b,a)})});return f}function qa(c,k){var f=c["static"],e=c.dynamic,v={};Object.keys(f).forEach(function(c){var u=f[c],e=w.id(c),h=new ua;if(b(u))h.state=1,h.buffer=x.getBuffer(x.create(u,34962,!1,!0)),h.type=0;else{var l=x.getBuffer(u);if(l)h.state=1,h.buffer=l,h.type=0;else if(a.command("object"===typeof u&&u,"invalid data for attribute "+c,k.commandStr),u.constant){var n=u.constant;
h.buffer="null";h.state=2;"number"===typeof n?h.x=n:(a.command(q(n)&&0<n.length&&4>=n.length,"invalid constant for attribute "+c,k.commandStr),E.forEach(function(d,a){a<n.length&&(h[d]=n[a])}))}else{l=b(u.buffer)?x.getBuffer(x.create(u.buffer,34962,!1,!0)):x.getBuffer(u.buffer);a.command(!!l,'missing buffer for attribute "'+c+'"',k.commandStr);var C=u.offset|0;a.command(0<=C,'invalid offset for attribute "'+c+'"',k.commandStr);var r=u.stride|0;a.command(0<=r&&256>r,'invalid stride for attribute "'+
c+'", must be integer betweeen [0, 255]',k.commandStr);var t=u.size|0;a.command(!("size"in u)||0<t&&4>=t,'invalid size for attribute "'+c+'", must be 1,2,3,4',k.commandStr);var y=!!u.normalized,A=0;"type"in u&&(a.commandParameter(u.type,B,"invalid type for attribute "+c,k.commandStr),A=B[u.type]);var I=u.divisor|0;"divisor"in u&&(a.command(0===I||d,'cannot specify divisor for attribute "'+c+'", instancing not supported',k.commandStr),a.command(0<=I,'invalid divisor for attribute "'+c+'"',k.commandStr));
a.optional(function(){var d=k.commandStr,b="buffer offset divisor normalized type size stride".split(" ");Object.keys(u).forEach(function(u){a.command(0<=b.indexOf(u),'unknown parameter "'+u+'" for attribute pointer "'+c+'" (valid parameters are '+b+")",d)})});h.buffer=l;h.state=1;h.size=t;h.normalized=y;h.type=A||l.dtype;h.offset=C;h.stride=r;h.divisor=I}}v[c]=g(function(d,a){var c=d.attribCache;if(e in c)return c[e];var b={isStream:!1};Object.keys(h).forEach(function(d){b[d]=h[d]});h.buffer&&(b.buffer=
d.link(h.buffer),b.type=b.type||b.buffer+".dtype");return c[e]=b})});Object.keys(e).forEach(function(d){var c=e[d];v[d]=h(c,function(b,u){function k(d){u(v[d],"=",f,".",d,"|0;")}var f=b.invoke(u,c),g=b.shared,h=g.isBufferArgs,e=g.buffer;a.optional(function(){b.assert(u,f+"&&(typeof "+f+'==="object"||typeof '+f+'==="function")&&('+h+"("+f+")||"+e+".getBuffer("+f+")||"+e+".getBuffer("+f+".buffer)||"+h+"("+f+'.buffer)||("constant" in '+f+"&&(typeof "+f+'.constant==="number"||'+g.isArrayLike+"("+f+".constant))))",
'invalid dynamic attribute "'+d+'"')});var v={isStream:u.def(!1)},J=new ua;J.state=1;Object.keys(J).forEach(function(d){v[d]=u.def(""+J[d])});var l=v.buffer,n=v.type;u("if(",h,"(",f,")){",v.isStream,"=true;",l,"=",e,".createStream(",34962,",",f,");",n,"=",l,".dtype;","}else{",l,"=",e,".getBuffer(",f,");","if(",l,"){",n,"=",l,".dtype;",'}else if("constant" in ',f,"){",v.state,"=",2,";","if(typeof "+f+'.constant === "number"){',v[E[0]],"=",f,".constant;",E.slice(1).map(function(d){return v[d]}).join("="),
"=0;","}else{",E.map(function(d,a){return v[d]+"="+f+".constant.length>="+a+"?"+f+".constant["+a+"]:0;"}).join(""),"}}else{","if(",h,"(",f,".buffer)){",l,"=",e,".createStream(",34962,",",f,".buffer);","}else{",l,"=",e,".getBuffer(",f,".buffer);","}",n,'="type" in ',f,"?",g.glTypes,"[",f,".type]:",l,".dtype;",v.normalized,"=!!",f,".normalized;");k("size");k("offset");k("stride");k("divisor");u("}}");u.exit("if(",v.isStream,"){",e,".destroyStream(",l,");","}");return v})});return v}function Aa(d){var a=
d["static"],c=d.dynamic,b={};Object.keys(a).forEach(function(d){var c=a[d];b[d]=g(function(d,a){return"number"===typeof c||"boolean"===typeof c?""+c:d.link(c)})});Object.keys(c).forEach(function(d){var a=c[d];b[d]=h(a,function(d,c){return d.invoke(c,a)})});return b}function T(d,c,b,k,f){function g(d){var a=l[d];a&&(q[d]=a)}var h=d["static"],e=d.dynamic;a.optional(function(){function d(b){Object.keys(b).forEach(function(d){a.command(0<=c.indexOf(d),'unknown parameter "'+d+'"',f.commandStr)})}var c=
"framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(Ha);d(h);d(e)});var v=za(d,f),l=aa(d,v,f),n=la(d,f),q=ma(d,f),C=ha(d,f);g("viewport");g(Z("scissor.box"));var r=0<Object.keys(q).length,v={framebuffer:v,draw:n,shader:C,state:q,dirty:r};v.profile=va(d,f);v.uniforms=na(b,f);v.attributes=qa(c,f);v.context=Aa(k,f);return v}function W(d,a,c){var b=d.shared.context,k=d.scope();Object.keys(c).forEach(function(f){a.save(b,"."+f);k(b,".",f,"=",c[f].append(d,a),";")});
a(k)}function fa(d,a,c,b){var k=d.shared,f=k.gl,g=k.framebuffer,v;C&&(v=a.def(k.extensions,".webgl_draw_buffers"));var h=d.constants,k=h.drawBuffer,h=h.backBuffer;d=c?c.append(d,a):a.def(g,".next");b||a("if(",d,"!==",g,".cur){");a("if(",d,"){",f,".bindFramebuffer(",36160,",",d,".framebuffer);");C&&a(v,".drawBuffersWEBGL(",k,"[",d,".colorAttachments.length]);");a("}else{",f,".bindFramebuffer(",36160,",null);");C&&a(v,".drawBuffersWEBGL(",h,");");a("}",g,".cur=",d,";");b||a("}")}function R(d,a,c){var b=
d.shared,k=b.gl,f=d.current,g=d.next,h=b.current,e=b.next,l=d.cond(h,".dirty");Ha.forEach(function(a){a=Z(a);if(!(a in c.state)){var b,n;if(a in g){b=g[a];n=f[a];var J=A(v[a].length,function(d){return l.def(b,"[",d,"]")});l(d.cond(J.map(function(d,a){return d+"!=="+n+"["+a+"]"}).join("||")).then(k,".",Da[a],"(",J,");",J.map(function(d,a){return n+"["+a+"]="+d}).join(";"),";"))}else b=l.def(e,".",a),J=d.cond(b,"!==",h,".",a),l(J),a in Ca?J(d.cond(b).then(k,".enable(",Ca[a],");")["else"](k,".disable(",
Ca[a],");"),h,".",a,"=",b,";"):J(k,".",Da[a],"(",b,");",h,".",a,"=",b,";")}});0===Object.keys(c.state).length&&l(h,".dirty=false;");a(l)}function N(d,a,b,c){var k=d.shared,g=d.current,h=k.current,v=k.gl;f(Object.keys(b)).forEach(function(k){var f=b[k];if(!c||c(f)){var e=f.append(d,a);if(Ca[k]){var l=Ca[k];n(f)?e?a(v,".enable(",l,");"):a(v,".disable(",l,");"):a(d.cond(e).then(v,".enable(",l,");")["else"](v,".disable(",l,");"));a(h,".",k,"=",e,";")}else if(q(e)){var C=g[k];a(v,".",Da[k],"(",e,");",
e.map(function(d,a){return C+"["+a+"]="+d}).join(";"),";")}else a(v,".",Da[k],"(",e,");",h,".",k,"=",e,";")}})}function X(a,b){d&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function ea(d,a,b,c,k){function f(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function g(d){r=a.def();d(r,"=",f(),";");"string"===typeof k?d(l,".count+=",k,";"):d(l,".count++;");pa&&(c?(w=a.def(),d(w,"=",C,".getNumPendingQueries();")):d(C,".beginQuery(",l,");"))}function h(d){d(l,
".cpuTime+=",f(),"-",r,";");pa&&(c?d(C,".pushScopeStats(",w,",",C,".getNumPendingQueries(),",l,");"):d(C,".endQuery();"))}function v(d){var b=a.def(q,".profile");a(q,".profile=",d,";");a.exit(q,".profile=",b,";")}var e=d.shared,l=d.stats,q=e.current,C=e.timer;b=b.profile;var r,w;if(b){if(n(b)){b.enable?(g(a),h(a.exit),v("true")):v("false");return}b=b.append(d,a);v(b)}else b=a.def(q,".profile");e=d.block();g(e);a("if(",b,"){",e,"}");d=d.block();h(d);a.exit("if(",b,"){",d,"}")}function Ba(b,c,k,f,g){function h(d){switch(d){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function e(a,k,f){function g(){c("if(!",q,".buffer){",l,".enableVertexAttribArray(",n,");}");var a=f.type,h;h=f.size?c.def(f.size,"||",k):k;c("if(",q,".type!==",a,"||",q,".size!==",h,"||",w.map(function(d){return q+"."+d+"!=="+f[d]}).join("||"),"){",l,".bindBuffer(",34962,",",C,".buffer);",l,".vertexAttribPointer(",[n,h,a,f.normalized,f.stride,f.offset],");",q,".type=",a,";",q,".size=",h,";",w.map(function(d){return q+
"."+d+"="+f[d]+";"}).join(""),"}");d&&(a=f.divisor,c("if(",q,".divisor!==",a,"){",b.instancing,".vertexAttribDivisorANGLE(",[n,a],");",q,".divisor=",a,";}"))}function h(){c("if(",q,".buffer){",l,".disableVertexAttribArray(",n,");","}if(",E.map(function(d,a){return q+"."+d+"!=="+r[a]}).join("||"),"){",l,".vertexAttrib4f(",n,",",r,");",E.map(function(d,a){return q+"."+d+"="+r[a]+";"}).join(""),"}")}var l=v.gl,n=c.def(a,".location"),q=c.def(v.attributes,"[",n,"]");a=f.state;var C=f.buffer,r=[f.x,f.y,
f.z,f.w],w=["buffer","normalized","offset","stride"];1===a?g():2===a?h():(c("if(",a,"===",1,"){"),g(),c("}else{"),h(),c("}"))}var v=b.shared;f.forEach(function(d){var f=d.name,v=k.attributes[f],l;if(v){if(!g(v))return;l=v.append(b,c)}else{if(!g(I))return;var n=b.scopeAttrib(f);a.optional(function(){b.assert(c,n+".state","missing attribute "+f)});l={};Object.keys(new ua).forEach(function(d){l[d]=c.def(n,".",d)})}e(b.link(d),h(d.info.type),l)})}function ga(d,b,c,k,f){for(var g=d.shared,h=g.gl,v,e=0;e<
k.length;++e){var l=k[e],C=l.name,r=l.info.type,t=c.uniforms[C],l=d.link(l)+".location",y;if(t){if(!f(t))continue;if(n(t)){var m=t.value;a.command(null!==m&&"undefined"!==typeof m,'missing uniform "'+C+'"',d.commandStr);if(35678===r||35680===r)a.command("function"===typeof m&&(35678===r&&("texture2d"===m._reglType||"framebuffer"===m._reglType)||35680===r&&("textureCube"===m._reglType||"framebufferCube"===m._reglType)),"invalid texture for uniform "+C,d.commandStr),t=d.link(m._texture||m.color[0]._texture),
b(h,".uniform1i(",l,",",t+".bind());"),b.exit(t,".unbind();");else if(35674===r||35675===r||35676===r){a.optional(function(){a.command(q(m),"invalid matrix for uniform "+C,d.commandStr);a.command(35674===r&&4===m.length||35675===r&&9===m.length||35676===r&&16===m.length,"invalid length for matrix uniform "+C,d.commandStr)});var t=d.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),ka=2;35675===r?ka=3:35676===r&&(ka=4);b(h,".uniformMatrix",ka,"fv(",l,",false,",t,");")}else{switch(r){case 5126:a.commandType(m,
"number","uniform "+C,d.commandStr);v="1f";break;case 35664:a.command(q(m)&&2===m.length,"uniform "+C,d.commandStr);v="2f";break;case 35665:a.command(q(m)&&3===m.length,"uniform "+C,d.commandStr);v="3f";break;case 35666:a.command(q(m)&&4===m.length,"uniform "+C,d.commandStr);v="4f";break;case 35670:a.commandType(m,"boolean","uniform "+C,d.commandStr);v="1i";break;case 5124:a.commandType(m,"number","uniform "+C,d.commandStr);v="1i";break;case 35671:a.command(q(m)&&2===m.length,"uniform "+C,d.commandStr);
v="2i";break;case 35667:a.command(q(m)&&2===m.length,"uniform "+C,d.commandStr);v="2i";break;case 35672:a.command(q(m)&&3===m.length,"uniform "+C,d.commandStr);v="3i";break;case 35668:a.command(q(m)&&3===m.length,"uniform "+C,d.commandStr);v="3i";break;case 35673:a.command(q(m)&&4===m.length,"uniform "+C,d.commandStr);v="4i";break;case 35669:a.command(q(m)&&4===m.length,"uniform "+C,d.commandStr),v="4i"}b(h,".uniform",v,"(",l,",",q(m)?Array.prototype.slice.call(m):m,");")}continue}else y=t.append(d,
b)}else{if(!f(I))continue;y=b.def(g.uniforms,"[",w.id(C),"]")}35678===r?b("if(",y,"&&",y,'._reglType==="framebuffer"){',y,"=",y,".color[0];","}"):35680===r&&b("if(",y,"&&",y,'._reglType==="framebufferCube"){',y,"=",y,".color[0];","}");a.optional(function(){function a(c,k){d.assert(b,c,'bad data or missing for uniform "'+C+'".  '+k)}function c(d){a("typeof "+y+'==="'+d+'"',"invalid type, expected "+d)}function k(b,c){a(g.isArrayLike+"("+y+")&&"+y+".length==="+b,"invalid vector, should have length "+
b,d.commandStr)}function f(b){a("typeof "+y+'==="function"&&'+y+'._reglType==="texture'+(3553===b?"2d":"Cube")+'"',"invalid texture type",d.commandStr)}switch(r){case 5124:c("number");break;case 35667:k(2,"number");break;case 35668:k(3,"number");break;case 35669:k(4,"number");break;case 5126:c("number");break;case 35664:k(2,"number");break;case 35665:k(3,"number");break;case 35666:k(4,"number");break;case 35670:c("boolean");break;case 35671:k(2,"boolean");break;case 35672:k(3,"boolean");break;case 35673:k(4,
"boolean");break;case 35674:k(4,"number");break;case 35675:k(9,"number");break;case 35676:k(16,"number");break;case 35678:f(3553);break;case 35680:f(34067)}});t=1;switch(r){case 35678:case 35680:t=b.def(y,"._texture");b(h,".uniform1i(",l,",",t,".bind());");b.exit(t,".unbind();");continue;case 5124:case 35670:v="1i";break;case 35667:case 35671:v="2i";t=2;break;case 35668:case 35672:v="3i";t=3;break;case 35669:case 35673:v="4i";t=4;break;case 5126:v="1f";break;case 35664:v="2f";t=2;break;case 35665:v=
"3f";t=3;break;case 35666:v="4f";t=4;break;case 35674:v="Matrix2fv";break;case 35675:v="Matrix3fv";break;case 35676:v="Matrix4fv"}b(h,".uniform",v,"(",l,",");if("M"===v.charAt(0)){var l=Math.pow(r-35674+2,2),F=d.global.def("new Float32Array(",l,")");b("false,(Array.isArray(",y,")||",y," instanceof Float32Array)?",y,":(",A(l,function(d){return F+"["+d+"]="+y+"["+d+"]"}),",",F,")")}else 1<t?b(A(t,function(d){return y+"["+d+"]"})):b(y);b(");")}}function wa(b,c,k,f){function g(d){var a=q[d];return a?
a.contextDep&&f.contextDynamic||a.propDep?a.append(b,k):a.append(b,c):c.def(C,".",d)}function v(){function d(){k(A,".drawElementsInstancedANGLE(",[t,m,I,y+"<<(("+I+"-5121)>>1)",w],");")}function a(){k(A,".drawArraysInstancedANGLE(",[t,y,m,w],");")}r?ka?d():(k("if(",r,"){"),d(),k("}else{"),a(),k("}")):a()}function h(){function d(){k(l+".drawElements("+[t,m,I,y+"<<(("+I+"-5121)>>1)"]+");")}function a(){k(l+".drawArrays("+[t,y,m]+");")}r?ka?d():(k("if(",r,"){"),d(),k("}else{"),a(),k("}")):a()}var e=
b.shared,l=e.gl,C=e.draw,q=f.draw,r=function(){var d=q.elements,a=c;if(d){if(d.contextDep&&f.contextDynamic||d.propDep)a=k;d=d.append(b,a)}else d=a.def(C,".","elements");d&&a("if("+d+")"+l+".bindBuffer(34963,"+d+".buffer.buffer);");return d}(),t=g("primitive"),y=g("offset"),m=function(){var d=q.count,g,v=c;if(d){if(d.contextDep&&f.contextDynamic||d.propDep)v=k;g=d.append(b,v);a.optional(function(){d.MISSING&&b.assert(c,"false","missing vertex count");d.DYNAMIC&&b.assert(v,g+">=0","missing vertex count")})}else g=
v.def(C,".","count"),a.optional(function(){b.assert(v,g+">=0","missing vertex count")});return g}();if("number"===typeof m){if(0===m)return}else k("if(",m,"){"),k.exit("}");var w,A;d&&(w=g("instances"),A=b.instancing);var I=r+".type",ka=q.elements&&n(q.elements);d&&("number"!==typeof w||0<=w)?"string"===typeof w?(k("if(",w,">0){"),v(),k("}else if(",w,"<0){"),h(),k("}")):v():h()}function ra(b,c,k,f,g){var v=Ea();g=v.proc("body",g);a.optional(function(){v.commandStr=c.commandStr;v.command=v.link(c.commandStr)});
d&&(v.instancing=g.def(v.shared.extensions,".angle_instanced_arrays"));b(v,g,k,f);return v.compile().body}function Ga(d,a,b,c){X(d,a);Ba(d,a,b,c.attributes,function(){return!0});ga(d,a,b,c.uniforms,function(){return!0});wa(d,a,a,b)}function Ja(d,a){var b=d.proc("draw",1);X(d,b);W(d,b,a.context);fa(d,b,a.framebuffer);R(d,b,a);N(d,b,a.state);ea(d,b,a,!1,!0);var c=a.shader.progVar.append(d,b);b(d.shared.gl,".useProgram(",c,".program);");if(a.shader.program)Ga(d,b,a,a.shader.program);else{var k=d.global.def("{}"),
f=b.def(c,".id"),g=b.def(k,"[",f,"]");b(d.cond(g).then(g,".call(this,a0);")["else"](g,"=",k,"[",f,"]=",d.link(function(b){return ra(Ga,d,a,b,1)}),"(",c,");",g,".call(this,a0);"))}0<Object.keys(a.state).length&&b(d.shared.current,".dirty=true;")}function Fa(d,a,b,c){function k(){return!0}d.batchId="a1";X(d,a);Ba(d,a,b,c.attributes,k);ga(d,a,b,c.uniforms,k);wa(d,a,a,b)}function Ka(d,a,b,c){function k(d){return d.contextDep&&g||d.propDep}function f(d){return!k(d)}X(d,a);var g=b.contextDep,v=a.def(),
h=a.def();d.shared.props=h;d.batchId=v;var e=d.scope(),l=d.scope();a(e.entry,"for(",v,"=0;",v,"<","a1",";++",v,"){",h,"=","a0","[",v,"];",l,"}",e.exit);b.needsContext&&W(d,l,b.context);b.needsFramebuffer&&fa(d,l,b.framebuffer);N(d,l,b.state,k);b.profile&&k(b.profile)&&ea(d,l,b,!1,!0);c?(Ba(d,e,b,c.attributes,f),Ba(d,l,b,c.attributes,k),ga(d,e,b,c.uniforms,f),ga(d,l,b,c.uniforms,k),wa(d,e,l,b)):(a=d.global.def("{}"),c=b.shader.progVar.append(d,l),h=l.def(c,".id"),e=l.def(a,"[",h,"]"),l(d.shared.gl,
".useProgram(",c,".program);","if(!",e,"){",e,"=",a,"[",h,"]=",d.link(function(a){return ra(Fa,d,b,a,2)}),"(",c,");}",e,".call(this,a0[",v,"],",v,");"))}function La(d,a){function b(d){return d.contextDep&&k||d.propDep}var c=d.proc("batch",2);d.batchId="0";X(d,c);var k=!1,f=!0;Object.keys(a.context).forEach(function(d){k=k||a.context[d].propDep});k||(W(d,c,a.context),f=!1);var g=a.framebuffer,v=!1;g?(g.propDep?k=v=!0:g.contextDep&&k&&(v=!0),v||fa(d,c,g)):fa(d,c,null);a.state.viewport&&a.state.viewport.propDep&&
(k=!0);R(d,c,a);N(d,c,a.state,function(d){return!b(d)});a.profile&&b(a.profile)||ea(d,c,a,!1,"a1");a.contextDep=k;a.needsContext=f;a.needsFramebuffer=v;f=a.shader.progVar;if(f.contextDep&&k||f.propDep)Ka(d,c,a,null);else if(f=f.append(d,c),c(d.shared.gl,".useProgram(",f,".program);"),a.shader.program)Ka(d,c,a,a.shader.program);else{var g=d.global.def("{}"),v=c.def(f,".id"),h=c.def(g,"[",v,"]");c(d.cond(h).then(h,".call(this,a0,a1);")["else"](h,"=",g,"[",v,"]=",d.link(function(b){return ra(Ka,d,a,
b,2)}),"(",f,");",h,".call(this,a0,a1);"))}0<Object.keys(a.state).length&&c(d.shared.current,".dirty=true;")}function Ma(d,a){function b(f){var g=a.shader[f];g&&c.set(k.shader,"."+f,g.append(d,c))}var c=d.proc("scope",3);d.batchId="a2";var k=d.shared,g=k.current;W(d,c,a.context);a.framebuffer&&a.framebuffer.append(d,c);f(Object.keys(a.state)).forEach(function(b){var f=a.state[b].append(d,c);q(f)?f.forEach(function(a,k){c.set(d.next[b],"["+k+"]",a)}):c.set(k.next,"."+b,f)});ea(d,c,a,!0,!0);["elements",
"offset","count","instances","primitive"].forEach(function(b){var f=a.draw[b];f&&c.set(k.draw,"."+b,""+f.append(d,c))});Object.keys(a.uniforms).forEach(function(b){c.set(k.uniforms,"["+w.id(b)+"]",a.uniforms[b].append(d,c))});Object.keys(a.attributes).forEach(function(b){var k=a.attributes[b].append(d,c),f=d.scopeAttrib(b);Object.keys(new ua).forEach(function(d){c.set(f,"."+d,k[d])})});b("vert");b("frag");0<Object.keys(a.state).length&&(c(g,".dirty=true;"),c.exit(g,".dirty=true;"));c("a1(",d.shared.context,
",a0,",d.batchId,");")}function Oa(d){if("object"===typeof d&&!q(d)){for(var a=Object.keys(d),b=0;b<a.length;++b)if(Q.isDynamic(d[a[b]]))return!0;return!1}}function xa(d,a,b){function c(d,a){g.forEach(function(b){var c=k[b];Q.isDynamic(c)&&(c=d.invoke(a,c),a(n,".",b,"=",c,";"))})}var k=a["static"][b];if(k&&Oa(k)){var f=d.global,g=Object.keys(k),v=!1,e=!1,l=!1,n=d.global.def("{}");g.forEach(function(a){var b=k[a];if(Q.isDynamic(b))"function"===typeof b&&(b=k[a]=Q.unbox(b)),a=h(b,null),v=v||a.thisDep,
l=l||a.propDep,e=e||a.contextDep;else{f(n,".",a,"=");switch(typeof b){case "number":f(b);break;case "string":f('"',b,'"');break;case "object":Array.isArray(b)&&f("[",b.join(),"]");break;default:f(d.link(b))}f(";")}});a.dynamic[b]=new Q.DynamicVariable(4,{thisDep:v,contextDep:e,propDep:l,ref:n,append:c});delete a["static"][b]}}var ua=V.Record,da={add:32774,subtract:32778,"reverse subtract":32779};m.ext_blend_minmax&&(da.min=32775,da.max=32776);var d=m.angle_instanced_arrays,C=m.webgl_draw_buffers,
v={dirty:!0,profile:ya.profile},ka={},Ha=[],Ca={},Da={};O("dither",3024);O("blend.enable",3042);M("blend.color","blendColor",[0,0,0,0]);M("blend.equation","blendEquationSeparate",[32774,32774]);M("blend.func","blendFuncSeparate",[1,0,1,0]);O("depth.enable",2929,!0);M("depth.func","depthFunc",513);M("depth.range","depthRange",[0,1]);M("depth.mask","depthMask",!0);M("colorMask","colorMask",[!0,!0,!0,!0]);O("cull.enable",2884);M("cull.face","cullFace",1029);M("frontFace","frontFace",2305);M("lineWidth",
"lineWidth",1);O("polygonOffset.enable",32823);M("polygonOffset.offset","polygonOffset",[0,0]);O("sample.alpha",32926);O("sample.enable",32928);M("sample.coverage","sampleCoverage",[1,!1]);O("stencil.enable",2960);M("stencil.mask","stencilMask",-1);M("stencil.func","stencilFunc",[519,0,-1]);M("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);M("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);O("scissor.enable",3089);M("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);
M("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var Na={gl:e,context:ja,strings:w,next:ka,current:v,draw:ta,elements:Y,buffer:x,shader:G,attributes:V.state,uniforms:U,framebuffer:S,extensions:m,timer:pa,isBufferArgs:b},Ia={primTypes:z,compareFuncs:L,blendFuncs:y,blendEquations:da,stencilOps:F,glTypes:B,orientationType:k};a.optional(function(){Na.isArrayLike=q});C&&(Ia.backBuffer=[1029],Ia.drawBuffer=A(p.maxDrawbuffers,function(d){return 0===d?[0]:A(d,function(d){return 36064+
d})}));var Qa=0;return{next:ka,current:v,procs:function(){var d=Ea(),a=d.proc("poll"),b=d.proc("refresh"),c=d.block();a(c);b(c);var k=d.shared,f=k.gl,g=k.next,h=k.current;c(h,".dirty=false;");fa(d,a);fa(d,b,null,!0);var l=e.getExtension("angle_instanced_arrays"),n;l&&(n=d.link(l));for(var C=0;C<p.maxAttributes;++C){var r=b.def(k.attributes,"[",C,"]"),t=d.cond(r,".buffer");t.then(f,".enableVertexAttribArray(",C,");",f,".bindBuffer(",34962,",",r,".buffer.buffer);",f,".vertexAttribPointer(",C,",",r,
".size,",r,".type,",r,".normalized,",r,".stride,",r,".offset);")["else"](f,".disableVertexAttribArray(",C,");",f,".vertexAttrib4f(",C,",",r,".x,",r,".y,",r,".z,",r,".w);",r,".buffer=null;");b(t);l&&b(n,".vertexAttribDivisorANGLE(",C,",",r,".divisor);")}Object.keys(Ca).forEach(function(k){var v=Ca[k],e=c.def(g,".",k),l=d.block();l("if(",e,"){",f,".enable(",v,")}else{",f,".disable(",v,")}",h,".",k,"=",e,";");b(l);a("if(",e,"!==",h,".",k,"){",l,"}")});Object.keys(Da).forEach(function(k){var e=Da[k],
l=v[k],n,C,r=d.block();r(f,".",e,"(");q(l)?(e=l.length,n=d.global.def(g,".",k),C=d.global.def(h,".",k),r(A(e,function(d){return n+"["+d+"]"}),");",A(e,function(d){return C+"["+d+"]="+n+"["+d+"];"}).join("")),a("if(",A(e,function(d){return n+"["+d+"]!=="+C+"["+d+"]"}).join("||"),"){",r,"}")):(n=c.def(g,".",k),C=c.def(h,".",k),r(n,");",h,".",k,"=",n,";"),a("if(",n,"!==",C,"){",r,"}"));b(r)});return d.compile()}(),compile:function(d,a,b,c,k){var f=Ea();f.stats=f.link(k);Object.keys(a["static"]).forEach(function(d){xa(f,
a,d)});t.forEach(function(a){xa(f,d,a)});b=T(d,a,b,c,f);Ja(f,b);Ma(f,b);La(f,b);return f.compile()}}}},{"./constants/dtypes.json":6,"./constants/primitives.json":7,"./dynamic":10,"./util/check":22,"./util/codegen":24,"./util/is-array-like":27,"./util/is-ndarray":28,"./util/is-typed-array":29,"./util/loop":30}],10:[function(e,p,x){function b(b,f){this.id=n++;this.type=b;this.data=f}function f(b){if(0===b.length)return[];var h=b.charAt(0),a=b.charAt(b.length-1);if(1<b.length&&h===a&&('"'===h||"'"===
h))return['"'+b.substr(1,b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(h=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return f(b.substr(0,h.index)).concat(f(h[1])).concat(f(b.substr(h.index+h[0].length)));h=b.split(".");if(1===h.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(a=0;a<h.length;++a)b=b.concat(f(h[a]));return b}function l(b){return"["+f(b).join("][")+"]"}var n=0;p.exports={DynamicVariable:b,define:function(f,h){return new b(f,l(h+""))},
isDynamic:function(f){return"function"===typeof f&&!f._reglType||f instanceof b},unbox:function(f,h){return"function"===typeof f?new b(0,f):f},accessor:l}},{}],11:[function(e,p,x){var b=e("./util/check"),f=e("./util/is-typed-array"),l=e("./util/is-ndarray"),n=e("./util/values"),g=e("./constants/primitives.json"),h=e("./constants/usage.json");p.exports=function(a,e,A,m){function w(a){this.id=B++;z[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function q(g,h,n,q,c,k,t){g.buffer.bind();
if(h){var m=t;t||f(h)&&(!l(h)||f(h.data))||(m=e.oes_element_index_uint?5125:5123);A._initBuffer(g.buffer,h,n,m,3)}else a.bufferData(34963,k,n),g.buffer.dtype=m||5121,g.buffer.usage=n,g.buffer.dimension=3,g.buffer.byteLength=k;m=t;if(!t){switch(g.buffer.dtype){case 5121:case 5120:m=5121;break;case 5123:case 5122:m=5123;break;case 5125:case 5124:m=5125;break;default:b.raise("unsupported type for element array")}g.buffer.dtype=m}g.type=m;b(5125!==m||!!e.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");
h=c;0>h&&(h=g.buffer.byteLength,5123===m?h>>=1:5125===m&&(h>>=2));g.vertCount=h;h=q;0>q&&(h=4,q=g.buffer.dimension,1===q&&(h=0),2===q&&(h=1),3===q&&(h=4));g.primType=h}function p(a){m.elementsCount--;b(null!==a.buffer,"must not double destroy elements");delete z[a.id];a.buffer.destroy();a.buffer=null}var z={},B=0,E={uint8:5121,uint16:5123};e.oes_element_index_uint&&(E.uint32=5125);w.prototype.bind=function(){this.buffer.bind()};var t=[];return{create:function(a,e){function n(a){if(a)if("number"===
typeof a)r(a),c.primType=4,c.vertCount=a|0,c.type=5121;else{var e=null,t=35044,m=-1,w=-1,y=0,A=0;if(Array.isArray(a)||f(a)||l(a))e=a;else if(b.type(a,"object","invalid arguments for elements"),"data"in a&&(e=a.data,b(Array.isArray(e)||f(e)||l(e),"invalid data for element buffer")),"usage"in a&&(b.parameter(a.usage,h,"invalid element buffer usage"),t=h[a.usage]),"primitive"in a&&(b.parameter(a.primitive,g,"invalid element buffer primitive"),m=g[a.primitive]),"count"in a&&(b("number"===typeof a.count&&
0<=a.count,"invalid vertex count for elements"),w=a.count|0),"type"in a&&(b.parameter(a.type,E,"invalid buffer type"),A=E[a.type]),"length"in a)y=a.length|0;else if(y=w,5123===A||5122===A)y*=2;else if(5125===A||5124===A)y*=4;q(c,e,t,m,w,y,A)}else r(),c.primType=4,c.vertCount=0,c.type=5121;return n}var r=A.create(null,34963,!0),c=new w(r._buffer);m.elementsCount++;n(a);n._reglType="elements";n._elements=c;n.subdata=function(a,b){r.subdata(a,b);return n};n.destroy=function(){p(c)};return n},createStream:function(a){var b=
t.pop();b||(b=new w(A.create(null,34963,!0,!1)._buffer));q(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){t.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof w?a._elements:null},clear:function(){n(z).forEach(p)}}}},{"./constants/primitives.json":7,"./constants/usage.json":8,"./util/check":22,"./util/is-ndarray":28,"./util/is-typed-array":29,"./util/values":34}],12:[function(e,p,x){var b=e("./util/check");p.exports=function(f,e){function n(a){b.type(a,"string",
"extension name must be string");a=a.toLowerCase();var h;try{h=g[a]=f.getExtension(a)}catch(e){}return!!h}for(var g={},h=0;h<e.extensions.length;++h){var a=e.extensions[h];if(!n(a))return e.onDestroy(),e.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}e.optionalExtensions.forEach(n);return{extensions:g,restore:function(){Object.keys(g).forEach(function(a){if(!n(a))throw Error("(regl): error restoring extension "+a);})}}}},
{"./util/check":22}],13:[function(e,p,x){var b=e("./util/check"),f=e("./util/values"),l=e("./util/extend"),n=[6408],g=[];g[6408]=4;var h=[];h[5121]=1;h[5126]=4;h[36193]=2;var a=[32854,32855,36194,35907,34842,34843,34836],r={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"};p.exports=function(e,m,w,q,p,z){function B(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var k=a=0;b?(a=b.width,k=b.height):c&&(a=
c.width,k=c.height);this.width=a;this.height=k}function E(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function t(a,c,k){if(a){if(a.texture){a=a.texture._texture;var f=Math.max(1,a.height);b(Math.max(1,a.width)===c&&f===k,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,b(a.width===c&&a.height===k,"inconsistent width/height for renderbuffer");a.refCount+=1}}function y(a,b){b&&(b.texture?e.framebufferTexture2D(36160,
a,b.target,b.texture._texture.texture,0):e.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer))}function K(a){var c=3553,k=null,f=null,g=a;"object"===typeof a&&(g=a.data,"target"in a&&(c=a.target|0));b.type(g,"function","invalid attachment data");a=g._reglType;"texture2d"===a?(k=g,b(3553===c)):"textureCube"===a?(k=g,b(34069<=c&&34075>c,"invalid cube map target")):"renderbuffer"===a?(f=g,c=36161):b.raise("invalid regl object for attachment");return new B(c,k,f)}function L(a,
b,c,k,f){if(c)return a=q.create2D({width:a,height:b,format:k,type:f}),a._texture.refCount=0,new B(3553,a,null);a=p.create({width:a,height:b,format:k});a._renderbuffer.refCount=0;return new B(36161,null,a)}function F(a){return a&&(a.texture||a.renderbuffer)}function c(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function k(){this.id=S++;U[this.id]=this;this.framebuffer=e.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=
this.stencilAttachment=this.depthAttachment=null}function I(a){a.colorAttachments.forEach(E);E(a.depthAttachment);E(a.stencilAttachment);E(a.depthStencilAttachment)}function oa(a){var c=a.framebuffer;b(c,"must not double destroy framebuffer");e.deleteFramebuffer(c);a.framebuffer=null;z.framebufferCount--;delete U[a.id]}function x(a){var c;e.bindFramebuffer(36160,a.framebuffer);var k=a.colorAttachments;for(c=0;c<k.length;++c)y(36064+c,k[c]);for(c=k.length;c<w.maxColorAttachments;++c)e.framebufferTexture2D(36160,
36064+c,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0);e.framebufferTexture2D(36160,36096,3553,null,0);e.framebufferTexture2D(36160,36128,3553,null,0);y(36096,a.depthAttachment);y(36128,a.stencilAttachment);y(33306,a.depthStencilAttachment);a=e.checkFramebufferStatus(36160);36053!==a&&b.raise("framebuffer configuration not supported, status = "+r[a]);e.bindFramebuffer(36160,ia.next);ia.cur=ia.next;e.getError()}function sa(f,e){function q(c,k){var f;b(ia.next!==r,"can not update framebuffer which is currently in use");
var e=m.webgl_draw_buffers,l=0,y=0,A=!0,p=!0;f=null;var B=!0,Q="rgba",z="uint8",oa=1,E=null,G=null,sa=null,V=!1;if("number"===typeof c)l=c|0,y=k|0||l;else if(c){b.type(c,"object","invalid arguments for framebuffer");"shape"in c?(y=c.shape,b(Array.isArray(y)&&2<=y.length,"invalid shape for framebuffer"),l=y[0],y=y[1]):("radius"in c&&(l=y=c.radius),"width"in c&&(l=c.width),"height"in c&&(y=c.height));if("color"in c||"colors"in c)f=c.color||c.colors,Array.isArray(f)&&b(1===f.length||e,"multiple render targets not supported");
if(!f){"colorCount"in c&&(oa=c.colorCount|0,b(0<oa,"invalid color buffer count"));"colorTexture"in c&&(B=!!c.colorTexture,Q="rgba4");if("colorType"in c){z=c.colorType;if(B)b(m.oes_texture_float||!("float"===z||"float32"===z),"you must enable OES_texture_float in order to use floating point framebuffer objects"),b(m.oes_texture_half_float||!("half float"===z||"float16"===z),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===z||
"float16"===z)b(m.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Q="rgba16f";else if("float"===z||"float32"===z)b(m.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Q="rgba32f";b.oneOf(z,H,"invalid color type")}if("colorFormat"in c)if(Q=c.colorFormat,0<=ba.indexOf(Q))B=!0;else if(0<=Y.indexOf(Q))B=!1;else if(B)b.oneOf(c.colorFormat,ba,"invalid color format for texture");
else b.oneOf(c.colorFormat,Y,"invalid color format for renderbuffer")}if("depthTexture"in c||"depthStencilTexture"in c)V=!(!c.depthTexture&&!c.depthStencilTexture),b(!V||m.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in c&&("boolean"===typeof c.depth?A=c.depth:(E=c.depth,p=!1));"stencil"in c&&("boolean"===typeof c.stencil?p=c.stencil:(G=c.stencil,A=!1));"depthStencil"in c&&("boolean"===typeof c.depthStencil?A=p=c.depthStencil:(sa=c.depthStencil,p=A=!1))}else l=y=1;var S=
e=null,U=null,R=null;if(Array.isArray(f))e=f.map(K);else if(f)e=[K(f)];else for(e=Array(oa),f=0;f<oa;++f)e[f]=L(l,y,B,Q,z);b(m.webgl_draw_buffers||1>=e.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");b(e.length<=w.maxColorAttachments,"too many color attachments, not supported");l=l||e[0].width;y=y||e[0].height;E?S=K(E):A&&!p&&(S=L(l,y,V,"depth","uint32"));G?U=K(G):p&&!A&&(U=L(l,y,!1,"stencil","uint8"));sa?R=K(sa):!E&&!G&&p&&A&&(R=L(l,y,V,"depth stencil",
"depth stencil"));b(1>=!!E+!!G+!!sa,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");A=null;for(f=0;f<e.length;++f)t(e[f],l,y),b(!e[f]||e[f].texture&&0<=n.indexOf(e[f].texture._texture.format)||e[f].renderbuffer&&0<=a.indexOf(e[f].renderbuffer._renderbuffer.format),"framebuffer color attachment "+f+" is invalid"),e[f]&&e[f].texture&&(p=g[e[f].texture._texture.format]*h[e[f].texture._texture.type],null===A?A=p:b(A===p,"all color attachments much have the same number of bits per pixel."));
t(S,l,y);b(!S||S.texture&&6402===S.texture._texture.format||S.renderbuffer&&33189===S.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");t(U,l,y);b(!U||U.renderbuffer&&36168===U.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");t(R,l,y);b(!R||R.texture&&34041===R.texture._texture.format||R.renderbuffer&&34041===R.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");I(r);r.width=l;r.height=
y;r.colorAttachments=e;r.depthAttachment=S;r.stencilAttachment=U;r.depthStencilAttachment=R;q.color=e.map(F);q.depth=F(S);q.stencil=F(U);q.depthStencil=F(R);q.width=r.width;q.height=r.height;x(r);return q}var r=new k;z.framebufferCount++;q(f,e);return l(q,{resize:function(a,f){b(ia.next!==r,"can not resize a framebuffer which is currently in use");var k=a|0,e=f|0||k;if(k===r.width&&e===r.height)return q;for(var g=r.colorAttachments,h=0;h<g.length;++h)c(g[h],k,e);c(r.depthAttachment,k,e);c(r.stencilAttachment,
k,e);c(r.depthStencilAttachment,k,e);r.width=q.width=k;r.height=q.height=e;x(r);return q},_reglType:"framebuffer",_framebuffer:r,destroy:function(){oa(r);I(r)},bind:function(a){ia.setFBO({framebuffer:q},a)}})}var ia={cur:null,next:null,dirty:!1,setFBO:null},ba=["rgba"],Y=["rgba4","rgb565","rgb5 a1"];m.ext_srgb&&Y.push("srgba");m.ext_color_buffer_half_float&&Y.push("rgba16f","rgb16f");m.webgl_color_buffer_float&&Y.push("rgba32f");var H=["uint8"];m.oes_texture_half_float&&H.push("half float","float16");
m.oes_texture_float&&H.push("float","float32");var S=0,U={};return l(ia,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof k)?a:null},create:sa,createCube:function(a){function c(a){var f;b(0>k.indexOf(ia.next),"can not update framebuffer which is currently in use");var e=m.webgl_draw_buffers,g={color:null},h=0,n=null;f="rgba";var r="uint8",t=1;if("number"===typeof a)h=a|0;else if(a){b.type(a,"object","invalid arguments for framebuffer");
"shape"in a?(h=a.shape,b(Array.isArray(h)&&2<=h.length,"invalid shape for framebuffer"),b(h[0]===h[1],"cube framebuffer must be square"),h=h[0]):("radius"in a&&(h=a.radius|0),"width"in a?(h=a.width|0,"height"in a&&b(a.height===h,"must be square")):"height"in a&&(h=a.height|0));if("color"in a||"colors"in a)n=a.color||a.colors,Array.isArray(n)&&b(1===n.length||e,"multiple render targets not supported");n||("colorCount"in a&&(t=a.colorCount|0,b(0<t,"invalid color buffer count")),"colorType"in a&&(b.oneOf(a.colorType,
H,"invalid color type"),r=a.colorType),"colorFormat"in a&&(f=a.colorFormat,b.oneOf(a.colorFormat,ba,"invalid color format for texture")));"depth"in a&&(g.depth=a.depth);"stencil"in a&&(g.stencil=a.stencil);"depthStencil"in a&&(g.depthStencil=a.depthStencil)}else h=1;if(n)if(Array.isArray(n))for(a=[],f=0;f<n.length;++f)a[f]=n[f];else a=[n];else for(a=Array(t),n={radius:h,format:f,type:r},f=0;f<t;++f)a[f]=q.createCube(n);g.color=Array(a.length);for(f=0;f<a.length;++f)t=a[f],b("function"===typeof t&&
"textureCube"===t._reglType,"invalid cube map"),h=h||t.width,b(t.width===h&&t.height===h,"invalid cube map shape"),g.color[f]={target:34069,data:a[f]};for(f=0;6>f;++f){for(t=0;t<a.length;++t)g.color[t].target=34069+f;0<f&&(g.depth=k[0].depth,g.stencil=k[0].stencil,g.depthStencil=k[0].depthStencil);if(k[f])k[f](g);else k[f]=sa(g)}return l(c,{width:h,height:h,color:a})}var k=Array(6);c(a);return l(c,{faces:k,resize:function(a){var f=a|0;b(0<f&&f<=w.maxCubeMapSize,"invalid radius for cube fbo");if(f===
c.width)return c;var e=c.color;for(a=0;a<e.length;++a)e[a].resize(f);for(a=0;6>a;++a)k[a].resize(f);c.width=c.height=f;return c},_reglType:"framebufferCube",destroy:function(){k.forEach(function(a){a.destroy()})}})},clear:function(){f(U).forEach(oa)},restore:function(){f(U).forEach(function(a){a.framebuffer=e.createFramebuffer();x(a)})}})}},{"./util/check":22,"./util/extend":25,"./util/values":34}],14:[function(e,p,x){p.exports=function(b,f){var e=1;f.ext_texture_filter_anisotropic&&(e=b.getParameter(34047));
var n=1,g=1;f.webgl_draw_buffers&&(n=b.getParameter(34852),g=b.getParameter(36063));return{colorBits:[b.getParameter(3410),b.getParameter(3411),b.getParameter(3412),b.getParameter(3413)],depthBits:b.getParameter(3414),stencilBits:b.getParameter(3415),subpixelBits:b.getParameter(3408),extensions:Object.keys(f).filter(function(b){return!!f[b]}),maxAnisotropic:e,maxDrawbuffers:n,maxColorAttachments:g,pointSizeDims:b.getParameter(33901),lineWidthDims:b.getParameter(33902),maxViewportDims:b.getParameter(3386),
maxCombinedTextureUnits:b.getParameter(35661),maxCubeMapSize:b.getParameter(34076),maxRenderbufferSize:b.getParameter(34024),maxTextureUnits:b.getParameter(34930),maxTextureSize:b.getParameter(3379),maxAttributes:b.getParameter(34921),maxVertexUniforms:b.getParameter(36347),maxVertexTextureUnits:b.getParameter(35660),maxVaryingVectors:b.getParameter(36348),maxFragmentUniforms:b.getParameter(36349),glsl:b.getParameter(35724),renderer:b.getParameter(7937),vendor:b.getParameter(7936),version:b.getParameter(7938)}}},
{}],15:[function(e,p,x){var b=e("./util/check"),f=e("./util/is-typed-array");p.exports=function(e,n,g,h,a,r){function A(m){var q;null===n.next?(b(a.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),q=5121):(b(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),q=n.next.colorAttachments[0].texture._texture.type,r.oes_texture_float?b(5121===q||5126===q,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):
b(5121===q,"Reading from a framebuffer is only allowed for the type 'uint8'"));var A=0,p=0,B=h.framebufferWidth,E=h.framebufferHeight,t=null;f(m)?t=m:m&&(b.type(m,"object","invalid arguments to regl.read()"),A=m.x|0,p=m.y|0,b(0<=A&&A<h.framebufferWidth,"invalid x offset for regl.read"),b(0<=p&&p<h.framebufferHeight,"invalid y offset for regl.read"),B=(m.width||h.framebufferWidth-A)|0,E=(m.height||h.framebufferHeight-p)|0,t=m.data||null);t&&(5121===q?b(t instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):
5126===q&&b(t instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));b(0<B&&B+A<=h.framebufferWidth,"invalid width for read pixels");b(0<E&&E+p<=h.framebufferHeight,"invalid height for read pixels");g();m=B*E*4;t||(5121===q?t=new Uint8Array(m):5126===q&&(t=t||new Float32Array(m)));b.isTypedArray(t,"data buffer for regl.read() must be a typedarray");b(t.byteLength>=m,"data buffer for regl.read() too small");e.pixelStorei(3333,4);e.readPixels(A,p,B,
E,6408,q,t);return t}function m(a){var b;n.setFBO({framebuffer:a.framebuffer},function(){b=A(a)});return b}return function(a){return a&&"framebuffer"in a?m(a):A(a)}}},{"./util/check":22,"./util/is-typed-array":29}],16:[function(e,p,x){var b=e("./util/check"),f=e("./util/values"),l=[];l[32854]=2;l[32855]=2;l[36194]=2;l[33189]=2;l[36168]=1;l[34041]=4;l[35907]=4;l[34836]=16;l[34842]=8;l[34843]=6;p.exports=function(e,g,h,a,r){function A(a){this.id=p++;this.refCount=1;this.renderbuffer=a;this.format=32854;
this.height=this.width=0;r.profile&&(this.stats={size:0})}function m(f){var g=f.renderbuffer;b(g,"must not double destroy renderbuffer");e.bindRenderbuffer(36161,null);e.deleteRenderbuffer(g);f.renderbuffer=null;f.refCount=0;delete z[f.id];a.renderbufferCount--}var w={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};g.ext_srgb&&(w.srgba=35907);g.ext_color_buffer_half_float&&(w.rgba16f=34842,w.rgb16f=34843);g.webgl_color_buffer_float&&(w.rgba32f=34836);var q=
[];Object.keys(w).forEach(function(a){q[w[a]]=a});var p=0,z={};A.prototype.decRef=function(){0>=--this.refCount&&m(this)};r.profile&&(a.getTotalRenderbufferSize=function(){var a=0;Object.keys(z).forEach(function(b){a+=z[b].stats.size});return a});return{create:function(f,g){function t(a,f){var g=0,c=0,k=32854;"object"===typeof a&&a?("shape"in a?(c=a.shape,b(Array.isArray(c)&&2<=c.length,"invalid renderbuffer shape"),g=c[0]|0,c=c[1]|0):("radius"in a&&(g=c=a.radius|0),"width"in a&&(g=a.width|0),"height"in
a&&(c=a.height|0)),"format"in a&&(b.parameter(a.format,w,"invalid renderbuffer format"),k=w[a.format])):"number"===typeof a?(g=a|0,c="number"===typeof f?f|0:g):a?b.raise("invalid arguments to renderbuffer constructor"):g=c=1;b(0<g&&0<c&&g<=h.maxRenderbufferSize&&c<=h.maxRenderbufferSize,"invalid renderbuffer size");if(g!==m.width||c!==m.height||k!==m.format)return t.width=m.width=g,t.height=m.height=c,m.format=k,e.bindRenderbuffer(36161,m.renderbuffer),e.renderbufferStorage(36161,k,g,c),r.profile&&
(m.stats.size=l[m.format]*m.width*m.height),t.format=q[m.format],t}var m=new A(e.createRenderbuffer());z[m.id]=m;a.renderbufferCount++;t(f,g);t.resize=function(a,f){var g=a|0,c=f|0||g;if(g===m.width&&c===m.height)return t;b(0<g&&0<c&&g<=h.maxRenderbufferSize&&c<=h.maxRenderbufferSize,"invalid renderbuffer size");t.width=m.width=g;t.height=m.height=c;e.bindRenderbuffer(36161,m.renderbuffer);e.renderbufferStorage(36161,m.format,g,c);r.profile&&(m.stats.size=l[m.format]*m.width*m.height);return t};t._reglType=
"renderbuffer";t._renderbuffer=m;r.profile&&(t.stats=m.stats);t.destroy=function(){m.decRef()};return t},clear:function(){f(z).forEach(m)},restore:function(){f(z).forEach(function(a){a.renderbuffer=e.createRenderbuffer();e.bindRenderbuffer(36161,a.renderbuffer);e.renderbufferStorage(36161,a.format,a.width,a.height)});e.bindRenderbuffer(36161,null)}}}},{"./util/check":22,"./util/values":34}],17:[function(e,p,x){var b=e("./util/check"),f=e("./util/values");p.exports=function(e,n,g,h){function a(a,b,
f,e){this.name=a;this.id=b;this.location=f;this.info=e}function r(a,b){for(var f=0;f<a.length;++f)if(a[f].id===b.id){a[f].location=b.location;return}a.push(b)}function A(a,f,g){var h=35632===a?q:p,r=h[f];if(!r){var c=n.str(f),r=e.createShader(a);e.shaderSource(r,c);e.compileShader(r);b.shaderError(e,r,c,a,g);h[f]=r}return r}function m(a,b){this.id=E++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];h.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function w(f,
g){var m,q;m=A(35632,f.fragId);q=A(35633,f.vertId);var w=f.program=e.createProgram();e.attachShader(w,m);e.attachShader(w,q);e.linkProgram(w);b.linkError(e,w,n.str(f.fragId),n.str(f.vertId),g);var c=e.getProgramParameter(w,35718);h.profile&&(f.stats.uniformsCount=c);var k=f.uniforms;for(m=0;m<c;++m)if(q=e.getActiveUniform(w,m))if(1<q.size)for(var p=0;p<q.size;++p){var z=q.name.replace("[0]","["+p+"]");r(k,new a(z,n.id(z),e.getUniformLocation(w,z),q))}else r(k,new a(q.name,n.id(q.name),e.getUniformLocation(w,
q.name),q));c=e.getProgramParameter(w,35721);h.profile&&(f.stats.attributesCount=c);k=f.attributes;for(m=0;m<c;++m)(q=e.getActiveAttrib(w,m))&&r(k,new a(q.name,n.id(q.name),e.getAttribLocation(w,q.name),q))}var q={},p={},z={},B=[],E=0;h.profile&&(g.getMaxUniformsCount=function(){var a=0;B.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)});return a},g.getMaxAttributesCount=function(){var a=0;B.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});
return{clear:function(){var a=e.deleteShader.bind(e);f(q).forEach(a);q={};f(p).forEach(a);p={};B.forEach(function(a){e.deleteProgram(a.program)});B.length=0;z={};g.shaderCount=0},program:function(a,f,e){b.command(0<=a,"missing vertex shader",e);b.command(0<=f,"missing fragment shader",e);var h=z[f];h||(h=z[f]={});var l=h[a];l||(l=new m(f,a),g.shaderCount++,w(l,e),h[a]=l,B.push(l));return l},restore:function(){q={};p={};for(var a=0;a<B.length;++a)w(B[a])},shader:A,frag:-1,vert:-1}}},{"./util/check":22,
"./util/values":34}],18:[function(e,p,x){p.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],19:[function(e,p,x){p.exports=function(){var b={"":0},f=[""];return{id:function(e){var n=b[e];if(n)return n;n=b[e]=f.length;f.push(e);return n},str:function(b){return f[b]}}}},{}],20:[function(e,p,x){function b(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function f(a){return Array.isArray(a)&&
0!==a.length&&z(a[0])?!0:!1}function l(a){return Object.prototype.toString.call(a)}function n(a){if(!a)return!1;var c=l(a);return 0<=L.indexOf(c)?!0:b(a)||f(a)||w(a)}function g(a,b){36193===a.type?(a.data=Q(b),q.freeType(b)):a.data=b}function h(a,b,f,e,g,h){a="undefined"!==typeof c[a]?c[a]:K[a]*F[b];h&&(a*=6);if(g){for(e=0;1<=f;)e+=a*f*f,f/=2;return e}return a*f*e}var a=e("./util/check"),r=e("./util/extend"),A=e("./util/values"),m=e("./util/is-typed-array"),w=e("./util/is-ndarray"),q=e("./util/pool"),
Q=e("./util/to-half-float"),z=e("./util/is-array-like"),B=e("./util/flatten");x=e("./constants/arraytypes.json");var E=e("./constants/arraytypes.json"),t=[9984,9986,9985,9987],y=[0,6409,6410,6407,6408],K={};K[6409]=K[6406]=K[6402]=1;K[34041]=K[6410]=2;K[6407]=K[35904]=3;K[6408]=K[35906]=4;var L=Object.keys(x).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),F=[];F[5121]=1;F[5126]=4;F[36193]=2;F[5123]=2;F[5125]=4;var c=
[];c[32854]=2;c[32855]=2;c[36194]=2;c[34041]=4;c[33776]=.5;c[33777]=.5;c[33778]=1;c[33779]=1;c[35986]=.5;c[35987]=1;c[34798]=1;c[35840]=.5;c[35841]=.25;c[35842]=.5;c[35843]=.25;c[36196]=.5;p.exports=function(c,e,p,x,F,L,ba){function Y(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function H(a,c){a.internalformat=c.internalformat;a.format=c.format;a.type=c.type;
a.compressed=c.compressed;a.premultiplyAlpha=c.premultiplyAlpha;a.flipY=c.flipY;a.unpackAlignment=c.unpackAlignment;a.colorSpace=c.colorSpace;a.width=c.width;a.height=c.height;a.channels=c.channels}function S(d,c){if("object"===typeof c&&c){"premultiplyAlpha"in c&&(a.type(c.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),d.premultiplyAlpha=c.premultiplyAlpha);"flipY"in c&&(a.type(c.flipY,"boolean","invalid texture flip"),d.flipY=c.flipY);"alignment"in c&&(a.oneOf(c.alignment,[1,2,4,8],"invalid texture unpack alignment"),
d.unpackAlignment=c.alignment);"colorSpace"in c&&(a.parameter(c.colorSpace,R,"invalid colorSpace"),d.colorSpace=R[c.colorSpace]);if("type"in c){var b=c.type;a(e.oes_texture_float||!("float"===b||"float32"===b),"you must enable the OES_texture_float extension in order to use floating point textures.");a(e.oes_texture_half_float||!("half float"===b||"float16"===b),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");a(e.webgl_depth_texture||!("uint16"===
b||"uint32"===b||"depth stencil"===b),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");a.parameter(b,N,"invalid texture type");d.type=N[b]}var f=d.width,k=d.height,g=d.channels,b=!1;"shape"in c?(a(Array.isArray(c.shape)&&2<=c.shape.length,"shape must be an array"),f=c.shape[0],k=c.shape[1],3===c.shape.length&&(g=c.shape[2],a(0<g&&4>=g,"invalid number of channels"),b=!0),a(0<=f&&f<=p.maxTextureSize,"invalid width"),a(0<=k&&k<=p.maxTextureSize,"invalid height")):
("radius"in c&&(f=k=c.radius,a(0<=f&&f<=p.maxTextureSize,"invalid radius")),"width"in c&&(f=c.width,a(0<=f&&f<=p.maxTextureSize,"invalid width")),"height"in c&&(k=c.height,a(0<=k&&k<=p.maxTextureSize,"invalid height")),"channels"in c&&(g=c.channels,a(0<g&&4>=g,"invalid number of channels"),b=!0));d.width=f|0;d.height=k|0;d.channels=g|0;f=!1;"format"in c&&(f=c.format,a(e.webgl_depth_texture||!("depth"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),
a.parameter(f,X,"invalid texture format"),k=d.internalformat=X[f],d.format=Ka[k],f in N&&!("type"in c)&&(d.type=N[f]),f in ea&&(d.compressed=!0),f=!0);!b&&f?d.channels=K[d.format]:b&&!f?d.channels!==y[d.format]&&(d.format=d.internalformat=y[d.channels]):f&&b&&a(d.channels===K[d.format],"number of channels inconsistent with specified format")}}function U(a){c.pixelStorei(37440,a.flipY);c.pixelStorei(37441,a.premultiplyAlpha);c.pixelStorei(37443,a.colorSpace);c.pixelStorei(3317,a.unpackAlignment)}function V(){Y.call(this);
this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function G(d,c){var e=null;n(c)?e=c:c&&(a.type(c,"object","invalid pixel data type"),S(d,c),"x"in c&&(d.xOffset=c.x|0),"y"in c&&(d.yOffset=c.y|0),n(c.data)&&(e=c.data));a(!d.compressed||e instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(c.copy){a(!e,"can not specify copy and data field for the same texture");var k=F.viewportWidth,h=F.viewportHeight;d.width=d.width||k-
d.xOffset;d.height=d.height||h-d.yOffset;d.needsCopy=!0;a(0<=d.xOffset&&d.xOffset<k&&0<=d.yOffset&&d.yOffset<h&&0<d.width&&d.width<=k&&0<d.height&&d.height<=h,"copy texture read out of bounds")}else if(!e)d.width=d.width||1,d.height=d.height||1,d.channels=d.channels||4;else if(m(e))d.channels=d.channels||4,d.data=e,"type"in c||5121!==d.type||(d.type=E[Object.prototype.toString.call(e)]|0);else if(b(e)){d.channels=d.channels||4;k=e;h=k.length;switch(d.type){case 5121:case 5123:case 5125:case 5126:h=
q.allocType(d.type,h);h.set(k);d.data=h;break;case 36193:d.data=Q(k);break;default:a.raise("unsupported texture type, must specify a typed array")}d.alignment=1;d.needsFree=!0}else if(w(e)){k=e.data;Array.isArray(k)||5121!==d.type||(d.type=E[Object.prototype.toString.call(k)]|0);var h=e.shape,r=e.stride,t,A,I,x;3===h.length?(I=h[2],x=r[2]):(a(2===h.length,"invalid ndarray pixel data, must be 2 or 3D"),x=I=1);t=h[0];A=h[1];h=r[0];r=r[1];d.alignment=1;d.width=t;d.height=A;d.channels=I;d.format=d.internalformat=
y[I];d.needsFree=!0;t=x;e=e.offset;I=d.width;x=d.height;A=d.channels;for(var u=q.allocType(36193===d.type?5126:d.type,I*x*A),H=0,L=0;L<x;++L)for(var ra=0;ra<I;++ra)for(var G=0;G<A;++G)u[H++]=k[h*ra+r*L+t*G+e];g(d,u)}else if("[object HTMLCanvasElement]"===l(e)||"[object CanvasRenderingContext2D]"===l(e))"[object HTMLCanvasElement]"===l(e)?d.element=e:d.element=e.canvas,d.width=d.element.width,d.height=d.element.height,d.channels=4;else if("[object HTMLImageElement]"===l(e))d.element=e,d.width=e.naturalWidth,
d.height=e.naturalHeight,d.channels=4;else if("[object HTMLVideoElement]"===l(e))d.element=e,d.width=e.videoWidth,d.height=e.videoHeight,d.channels=4;else if(f(e)){k=d.width||e[0].length;h=d.height||e.length;r=d.channels;r=z(e[0][0])?r||e[0][0].length:r||1;t=B.shape(e);I=1;for(x=0;x<t.length;++x)I*=t[x];I=q.allocType(36193===d.type?5126:d.type,I);B.flatten(e,t,"",I);g(d,I);d.alignment=1;d.width=k;d.height=h;d.channels=r;d.format=d.internalformat=y[r];d.needsFree=!0}5126===d.type?a(0<=p.extensions.indexOf("oes_texture_float"),
"oes_texture_float extension not enabled"):36193===d.type&&a(0<=p.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}function ta(a,b,f,e,g){var h=a.element,l=a.data,r=a.internalformat,n=a.format,q=a.type,m=a.width,t=a.height;U(a);h?c.texSubImage2D(b,g,f,e,n,q,h):a.compressed?c.compressedTexSubImage2D(b,g,f,e,r,m,t,l):a.needsCopy?(x(),c.copyTexSubImage2D(b,g,f,e,a.xOffset,a.yOffset,m,t)):c.texSubImage2D(b,g,f,e,m,t,n,q,l)}function ja(){return La.pop()||new V}
function pa(a){a.needsFree&&q.freeType(a.data);V.call(a);La.push(a)}function ya(){Y.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function Z(a,c,b){var f=a.images[0]=ja();a.mipmask=1;f.width=a.width=c;f.height=a.height=b;f.channels=a.channels=4}function O(d,c){var b=null;if(n(c))b=d.images[0]=ja(),H(b,d),G(b,c),d.mipmask=1;else if(S(d,c),Array.isArray(c.mipmap))for(var f=c.mipmap,e=0;e<f.length;++e)b=d.images[e]=ja(),H(b,d),b.width>>=e,b.height>>=e,G(b,f[e]),
d.mipmask|=1<<e;else b=d.images[0]=ja(),H(b,d),G(b,c),d.mipmask=1;H(d,d.images[0]);(d.compressed&&33776===d.internalformat||33777===d.internalformat||33778===d.internalformat||33779===d.internalformat)&&a(0===d.width%4&&0===d.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function M(a,b){for(var f=a.images,e=0;e<f.length&&f[e];++e){var g=f[e],h=b,l=e,r=g.element,n=g.data,q=g.internalformat,m=g.format,t=g.type,p=g.width,w=g.height;U(g);
r?c.texImage2D(h,l,m,m,t,r):g.compressed?c.compressedTexImage2D(h,l,q,p,w,0,n):g.needsCopy?(x(),c.copyTexImage2D(h,l,m,g.xOffset,g.yOffset,p,w,0)):c.texImage2D(h,l,m,p,w,0,m,t,n)}}function Ea(){var a=Ma.pop()||new ya;Y.call(a);for(var c=a.mipmask=0;16>c;++c)a.images[c]=null;return a}function va(a){for(var c=a.images,b=0;b<c.length;++b)c[b]&&pa(c[b]),c[b]=null;Ma.push(a)}function za(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=
4352}function aa(d,c){if("min"in c){var b=c.min;a.parameter(b,fa);d.minFilter=fa[b];0<=t.indexOf(d.minFilter)&&(d.genMipmaps=!0)}"mag"in c&&(b=c.mag,a.parameter(b,W),d.magFilter=W[b]);var b=d.wrapS,f=d.wrapT;if("wrap"in c){var e=c.wrap;"string"===typeof e?(a.parameter(e,T),b=f=T[e]):Array.isArray(e)&&(a.parameter(e[0],T),a.parameter(e[1],T),b=T[e[0]],f=T[e[1]])}else"wrapS"in c&&(b=c.wrapS,a.parameter(b,T),b=T[b]),"wrapT"in c&&(f=c.wrapT,a.parameter(f,T),f=T[f]);d.wrapS=b;d.wrapT=f;"anisotropic"in
c&&(b=c.anisotropic,a("number"===typeof b&&1<=b&&b<=p.maxAnisotropic,"aniso samples must be between 1 and "),d.anisotropic=c.anisotropic);if("mipmap"in c){b=!1;switch(typeof c.mipmap){case "string":a.parameter(c.mipmap,Aa,"invalid mipmap hint");d.mipmapHint=Aa[c.mipmap];b=d.genMipmaps=!0;break;case "boolean":b=d.genMipmaps=c.mipmap;break;case "object":a(Array.isArray(c.mipmap),"invalid mipmap type");d.genMipmaps=!1;b=!0;break;default:a.raise("invalid mipmap type")}!b||"min"in c||(d.minFilter=9984)}}
function ha(a,b){c.texParameteri(b,10241,a.minFilter);c.texParameteri(b,10240,a.magFilter);c.texParameteri(b,10242,a.wrapS);c.texParameteri(b,10243,a.wrapT);e.ext_texture_filter_anisotropic&&c.texParameteri(b,34046,a.anisotropic);a.genMipmaps&&(c.hint(33170,a.mipmapHint),c.generateMipmap(b))}function la(a){Y.call(this);this.mipmask=0;this.internalformat=6408;this.id=Oa++;this.refCount=1;this.target=a;this.texture=c.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new za;ba.profile&&(this.stats=
{size:0})}function ma(a){c.activeTexture(33984);c.bindTexture(a.target,a.texture)}function na(){var a=da[0];a?c.bindTexture(a.target,a.texture):c.bindTexture(3553,null)}function qa(d){var b=d.texture;a(b,"must not double destroy texture");var f=d.unit,e=d.target;0<=f&&(c.activeTexture(33984+f),c.bindTexture(e,null),da[f]=null);c.deleteTexture(b);d.texture=null;d.params=null;d.pixels=null;d.refCount=0;delete xa[d.id];L.textureCount--}var Aa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
T={repeat:10497,clamp:33071,mirror:33648},W={nearest:9728,linear:9729},fa=r({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},W),R={none:0,browser:37444},N={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},X={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ea={};e.ext_srgb&&(X.srgb=35904,X.srgba=35906);e.oes_texture_float&&(N.float32=N["float"]=5126);e.oes_texture_half_float&&
(N.float16=N["half float"]=36193);e.webgl_depth_texture&&(r(X,{depth:6402,"depth stencil":34041}),r(N,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&r(ea,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&r(ea,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&r(ea,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});e.webgl_compressed_texture_etc1&&(ea["rgb etc1"]=36196);var Ba=Array.prototype.slice.call(c.getParameter(34467));Object.keys(ea).forEach(function(a){var c=ea[a];0<=Ba.indexOf(c)&&(X[a]=c)});var ga=Object.keys(X);p.textureFormats=ga;var wa=[];Object.keys(X).forEach(function(a){wa[X[a]]=a});var ra=[];Object.keys(N).forEach(function(a){ra[N[a]]=a});var Ga=[];Object.keys(W).forEach(function(a){Ga[W[a]]=a});var Ja=[];Object.keys(fa).forEach(function(a){Ja[fa[a]]=a});var Fa=
[];Object.keys(T).forEach(function(a){Fa[T[a]]=a});var Ka=ga.reduce(function(a,c){var b=X[c];6409===b||6406===b||6409===b||6410===b||6402===b||34041===b?a[b]=b:32855===b||0<=c.indexOf("rgba")?a[b]=6408:a[b]=6407;return a},{}),La=[],Ma=[],Oa=0,xa={},ua=p.maxTextureUnits,da=Array(ua).map(function(){return null});r(la.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var f=0;f<ua;++f){var e=da[f];if(e){if(0<e.bindCount)continue;e.unit=-1}da[f]=this;b=f;break}b>=ua&&a.raise("insufficient number of texture units");
ba.profile&&L.maxTextureUnits<b+1&&(L.maxTextureUnits=b+1);this.unit=b;c.activeTexture(33984+b);c.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&qa(this)}});ba.profile&&(L.getTotalTextureSize=function(){var a=0;Object.keys(xa).forEach(function(c){a+=xa[c].stats.size});return a});return{create2D:function(b,f){function e(c,b){var d=g.texInfo;za.call(d);var f=Ea();"number"===typeof c?"number"===typeof b?Z(f,c|0,b|0):Z(f,c|0,c|
0):c?(a.type(c,"object","invalid arguments to regl.texture"),aa(d,c),O(f,c)):Z(f,1,1);d.genMipmaps&&(f.mipmask=(f.width<<1)-1);g.mipmask=f.mipmask;H(g,f);a.texture2D(d,f,p);g.internalformat=f.internalformat;e.width=f.width;e.height=f.height;ma(g);M(f,3553);ha(d,3553);na();va(f);ba.profile&&(g.stats.size=h(g.internalformat,g.type,f.width,f.height,d.genMipmaps,!1));e.format=wa[g.internalformat];e.type=ra[g.type];e.mag=Ga[d.magFilter];e.min=Ja[d.minFilter];e.wrapS=Fa[d.wrapS];e.wrapT=Fa[d.wrapT];return e}
var g=new la(3553);xa[g.id]=g;L.textureCount++;e(b,f);e.subimage=function(c,b,d,f){a(!!c,"must specify image data");b|=0;d|=0;f|=0;var k=ja();H(k,g);k.width=0;k.height=0;G(k,c);k.width=k.width||(g.width>>f)-b;k.height=k.height||(g.height>>f)-d;a(g.type===k.type&&g.format===k.format&&g.internalformat===k.internalformat,"incompatible format for texture.subimage");a(0<=b&&0<=d&&b+k.width<=g.width&&d+k.height<=g.height,"texture.subimage write out of bounds");a(g.mipmask&1<<f,"missing mipmap data");a(k.data||
k.element||k.needsCopy,"missing image data");ma(g);ta(k,3553,b,d,f);na();pa(k);return e};e.resize=function(a,b){var d=a|0,f=b|0||d;if(d===g.width&&f===g.height)return e;e.width=g.width=d;e.height=g.height=f;ma(g);for(var l=0;g.mipmask>>l;++l)c.texImage2D(3553,l,g.format,d>>l,f>>l,0,g.format,g.type,null);na();ba.profile&&(g.stats.size=h(g.internalformat,g.type,d,f,!1,!1));return e};e._reglType="texture2d";e._texture=g;ba.profile&&(e.stats=g.stats);e.destroy=function(){g.decRef()};return e},createCube:function(b,
f,e,g,l,r){function n(c,b,d,f,e,k){var g,l=m.texInfo;za.call(l);for(g=0;6>g;++g)q[g]=Ea();if("number"!==typeof c&&c)if("object"===typeof c)if(b)O(q[0],c),O(q[1],b),O(q[2],d),O(q[3],f),O(q[4],e),O(q[5],k);else if(aa(l,c),S(m,c),"faces"in c)for(c=c.faces,a(Array.isArray(c)&&6===c.length,"cube faces must be a length 6 array"),g=0;6>g;++g)a("object"===typeof c[g]&&!!c[g],"invalid input for cube map face"),H(q[g],m),O(q[g],c[g]);else for(g=0;6>g;++g)O(q[g],c);else a.raise("invalid arguments to cube map");
else for(c=c|0||1,g=0;6>g;++g)Z(q[g],c,c);H(m,q[0]);m.mipmask=l.genMipmaps?(q[0].width<<1)-1:q[0].mipmask;a.textureCube(m,l,q,p);m.internalformat=q[0].internalformat;n.width=q[0].width;n.height=q[0].height;ma(m);for(g=0;6>g;++g)M(q[g],34069+g);ha(l,34067);na();ba.profile&&(m.stats.size=h(m.internalformat,m.type,n.width,n.height,l.genMipmaps,!0));n.format=wa[m.internalformat];n.type=ra[m.type];n.mag=Ga[l.magFilter];n.min=Ja[l.minFilter];n.wrapS=Fa[l.wrapS];n.wrapT=Fa[l.wrapT];for(g=0;6>g;++g)va(q[g]);
return n}var m=new la(34067);xa[m.id]=m;L.cubeCount++;var q=Array(6);n(b,f,e,g,l,r);n.subimage=function(c,b,d,f,e){a(!!b,"must specify image data");a("number"===typeof c&&c===(c|0)&&0<=c&&6>c,"invalid face");d|=0;f|=0;e|=0;var g=ja();H(g,m);g.width=0;g.height=0;G(g,b);g.width=g.width||(m.width>>e)-d;g.height=g.height||(m.height>>e)-f;a(m.type===g.type&&m.format===g.format&&m.internalformat===g.internalformat,"incompatible format for texture.subimage");a(0<=d&&0<=f&&d+g.width<=m.width&&f+g.height<=
m.height,"texture.subimage write out of bounds");a(m.mipmask&1<<e,"missing mipmap data");a(g.data||g.element||g.needsCopy,"missing image data");ma(m);ta(g,34069+c,d,f,e);na();pa(g);return n};n.resize=function(a){a|=0;if(a!==m.width){n.width=m.width=a;n.height=m.height=a;ma(m);for(var b=0;6>b;++b)for(var d=0;m.mipmask>>d;++d)c.texImage2D(34069+b,d,m.format,a>>d,a>>d,0,m.format,m.type,null);na();ba.profile&&(m.stats.size=h(m.internalformat,m.type,n.width,n.height,!1,!0));return n}};n._reglType="textureCube";
n._texture=m;ba.profile&&(n.stats=m.stats);n.destroy=function(){m.decRef()};return n},clear:function(){for(var a=0;a<ua;++a)c.activeTexture(33984+a),c.bindTexture(3553,null),da[a]=null;A(xa).forEach(qa);L.cubeCount=0;L.textureCount=0},getTexture:function(a){return null},restore:function(){A(xa).forEach(function(a){a.texture=c.createTexture();c.bindTexture(a.target,a.texture);for(var b=0;32>b;++b)if(0!==(a.mipmask&1<<b))if(3553===a.target)c.texImage2D(3553,b,a.internalformat,a.width>>b,a.height>>b,
0,a.internalformat,a.type,null);else for(var f=0;6>f;++f)c.texImage2D(34069+f,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);ha(a.texInfo,a.target)})}}}},{"./constants/arraytypes.json":5,"./util/check":22,"./util/extend":25,"./util/flatten":26,"./util/is-array-like":27,"./util/is-ndarray":28,"./util/is-typed-array":29,"./util/pool":31,"./util/to-half-float":33,"./util/values":34}],21:[function(e,p,x){p.exports=function(b,f){function e(){this.endQueryIndex=this.startQueryIndex=
-1;this.sum=0;this.stats=null}function n(a,b,f){var g=r.pop()||new e;g.startQueryIndex=a;g.endQueryIndex=b;g.sum=0;g.stats=f;p.push(g)}var g=f.ext_disjoint_timer_query;if(!g)return null;var h=[],a=[],r=[],p=[],m=[],w=[];return{beginQuery:function(b){var f=h.pop()||g.createQueryEXT();g.beginQueryEXT(35007,f);a.push(f);n(a.length-1,a.length,b)},endQuery:function(){g.endQueryEXT(35007)},pushScopeStats:n,update:function(){var b,f;b=a.length;if(0!==b){w.length=Math.max(w.length,b+1);m.length=Math.max(m.length,
b+1);m[0]=0;var e=w[0]=0;for(f=b=0;f<a.length;++f){var l=a[f];g.getQueryObjectEXT(l,34919)?(e+=g.getQueryObjectEXT(l,34918),h.push(l)):a[b++]=l;m[f+1]=e;w[f+1]=b}a.length=b;for(f=b=0;f<p.length;++f){var e=p[f],n=e.startQueryIndex,l=e.endQueryIndex;e.sum+=m[l]-m[n];n=w[n];l=w[l];l===n?(e.stats.gpuTime+=e.sum/1E6,r.push(e)):(e.startQueryIndex=n,e.endQueryIndex=l,p[b++]=e)}p.length=b}},getNumPendingQueries:function(){return a.length},clear:function(){h.push.apply(h,a);for(var b=0;b<h.length;b++)g.deleteQueryEXT(h[b]);
a.length=0;h.length=0},restore:function(){a.length=0;h.length=0}}}},{}],22:[function(e,p,x){function b(a){return"undefined"!==typeof btoa?btoa(a):"base64:"+a}function f(a){a=Error("(regl) "+a);console.error(a);throw a;}function l(a,b){a||f(b)}function n(a){return a?": "+a:""}function g(a,b,e){0>b.indexOf(a)&&f("invalid value"+n(e)+". must be one of: "+b)}function h(a,b){for(a+="";a.length<b;)a=" "+a;return a}function a(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function r(a,
b){this.number=a;this.line=b;this.errors=[]}function A(a,b,f){this.file=a;this.line=b;this.message=f}function m(){var a=Error(),a=(a.stack||a).toString(),b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function w(){var a=Error(),a=(a.stack||a).toString(),b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function q(c,f){var e=c.split("\n"),g=1,h=
0,l={unknown:new a,0:new a};l.unknown.name=l[0].name=f||m();l.unknown.lines.push(new r(0,""));for(var n=0;n<e.length;++n){var q=e[n],t=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(q);if(t)switch(t[1]){case "line":if(t=/(\d+)(\s+\d+)?/.exec(t[2]))g=t[1]|0,t[2]&&(h=t[2]|0,h in l||(l[h]=new a));break;case "define":if(t=/SHADER_NAME(_B64)?\s+(.*)$/.exec(t[2]))l[h].name=t[1]?b(t[2]):t[2]}l[h].lines.push(new r(g++,q))}Object.keys(l).forEach(function(a){var b=l[a];b.lines.forEach(function(a){b.index[a.number]=a})});
return l}function Q(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var c=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(a);c?b.push(new A(c[1]|0,c[2]|0,c[3].trim())):0<a.length&&b.push(new A("unknown",0,a))}});return b}function z(a,b){b.forEach(function(b){var f=a[b.file];if(f){var e=f.index[b.line];if(e){e.errors.push(b);f.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(b)})}function B(a){a._commandRef=m()}function E(a,b){var e=w();f(a+" in command "+(b||m())+
("unknown"===e?"":" called from "+e))}function t(a,b,f,e){typeof a!==b&&E("invalid parameter type"+n(f)+". expected "+b+", got "+typeof a,e||m())}function y(a,b){return 32820===a||32819===a||33635===a?2:34042===a?4:F[a]*b}var K=e("./is-typed-array");e=e("./extend");var L="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),F={};F[5120]=F[5121]=1;F[5122]=F[5123]=F[36193]=F[33635]=F[32819]=F[32820]=2;F[5124]=F[5125]=F[5126]=F[34042]=4;p.exports=e(l,{optional:function(a){a()},
raise:f,commandRaise:E,command:function(a,b,f){a||E(b,f||m())},parameter:function(a,b,e){a in b||f("unknown parameter ("+a+")"+n(e)+". possible values: "+Object.keys(b).join())},commandParameter:function(a,b,f,e){a in b||E("unknown parameter ("+a+")"+n(f)+". possible values: "+Object.keys(b).join(),e||m())},constructor:function(a){Object.keys(a).forEach(function(a){0>L.indexOf(a)&&f('invalid regl constructor argument "'+a+'". must be one of '+L)})},type:function(a,b,e){typeof a!==b&&f("invalid parameter type"+
n(e)+". expected "+b+", got "+typeof a)},commandType:t,isTypedArray:function(a,b){K(a)||f("invalid parameter type"+n(b)+". must be a typed array")},nni:function(a,b){0<=a&&(a|0)===a||f("invalid parameter type, ("+a+")"+n(b)+". must be a nonnegative integer")},oneOf:g,shaderError:function(a,b,f,e,g){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);a=e===a.FRAGMENT_SHADER?"fragment":"vertex";t(f,"string",a+" shader source must be a string",g);var n=q(f,g);f=Q(b);z(n,f);Object.keys(n).forEach(function(a){function b(a,
c){f.push(a);e.push(c||"")}var c=n[a];if(c.hasErrors){var f=[""],e=[""];b("file number "+a+": "+c.name+"\n","color:red;text-decoration:underline;font-weight:bold");c.lines.forEach(function(a){if(0<a.errors.length){b(h(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var c=0;a.errors.forEach(function(f){f=f.message;var e=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(f);if(e){var g=e[1];f=e[2];switch(g){case "assign":g="="}c=Math.max(a.line.indexOf(g,
c),0)}else c=0;b(h("| ",6));b(h("^^^",c+3)+"\n","font-weight:bold");b(h("| ",6));b(f+"\n","font-weight:bold")});b(h("| ",6)+"\n")}else b(h(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"!==typeof document?(e[0]=f.join("%c"),console.log.apply(console,e)):console.log(f.join(""))}});l.raise("Error compiling "+a+" shader, "+n[0].name)}},linkError:function(a,b,f,e,g){a.getProgramParameter(b,a.LINK_STATUS)||(a=a.getProgramInfoLog(b),f=q(f,g),e='Error linking program with vertex shader, "'+q(e,
g)[0].name+'", and fragment shader "'+f[0].name+'"',"undefined"!==typeof document?console.log("%c"+e+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(e+"\n"+a),l.raise(e))},callSite:w,saveCommandRef:B,saveDrawInfo:function(a,b,f,e){function g(a){return a?e.id(a):0}function h(a,b){Object.keys(b).forEach(function(b){a[e.id(b)]=!0})}B(a);a._fragId=g(a["static"].frag);a._vertId=g(a["static"].vert);var l=a._uniformSet={};h(l,b["static"]);h(l,b.dynamic);b=a._attributeSet=
{};h(b,f["static"]);h(b,f.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,b,f){a.texture?g(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):g(a.renderbuffer._renderbuffer.format,f,"unsupported renderbuffer format for attachment")},guessCommand:m,texture2D:function(a,b,f){var e=b.width,g=b.height,h=b.channels;l(0<e&&e<=f.maxTextureSize&&0<g&&g<=f.maxTextureSize,"invalid texture shape");
33071===a.wrapS&&33071===a.wrapT||l(!(e&e-1)&&!!e&&!(g&g-1)&&!!g,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==e&&1!==g&&l(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(l(!(e&e-1)&&!!e&&!(g&g-1)&&!!g,"texture must be a square power of 2 to support mipmapping"),l(b.mipmask===(e<<1)-1,"missing or incomplete mipmap data"));5126===b.type&&(0>f.extensions.indexOf("oes_texture_float_linear")&&
l(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),l(!a.genMipmaps,"mipmap generation not supported with float textures"));var n=b.images;for(f=0;16>f;++f)if(n[f]){var m=e>>f,r=g>>f;l(b.mipmask&1<<f,"missing mipmap data");var q=n[f];l(q.width===m&&q.height===r,"invalid shape for mip images");l(q.format===b.format&&q.internalformat===b.internalformat&&q.type===b.type,"incompatible type for mip image");q.compressed||q.data&&l(q.data.byteLength===m*
r*Math.max(y(q.type,h),q.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}else a.genMipmaps||l(0===(b.mipmask&1<<f),"extra mipmap data");b.compressed&&l(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,f,e){var g=a.width,h=a.height,n=a.channels;l(0<g&&g<=e.maxTextureSize&&0<h&&h<=e.maxTextureSize,"invalid texture shape");l(g===h,"cube map must be square");l(33071===b.wrapS&&33071===b.wrapT,"wrap mode not supported by cube map");
for(e=0;e<f.length;++e){var m=f[e];l(m.width===g&&m.height===h,"inconsistent cube map face shape");b.genMipmaps&&(l(!m.compressed,"can not generate mipmap for compressed textures"),l(1===m.mipmask,"can not specify mipmaps and generate mipmaps"));for(var r=m.images,q=0;16>q;++q){var t=r[q];if(t){var p=g>>q,w=h>>q;l(m.mipmask&1<<q,"missing mipmap data");l(t.width===p&&t.height===w,"invalid shape for mip images");l(t.format===a.format&&t.internalformat===a.internalformat&&t.type===a.type,"incompatible type for mip image");
t.compressed||t.data&&l(t.data.byteLength===p*w*Math.max(y(t.type,n),t.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}})},{"./extend":25,"./is-typed-array":29}],23:[function(e,p,x){p.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],24:[function(e,p,x){function b(b){return Array.prototype.slice.call(b)}function f(f){return b(f).join("")}var l=e("./extend");p.exports=function(){function e(){var a=
[],g=[];return l(function(){a.push.apply(a,b(arguments))},{def:function(){var f="v"+h++;g.push(f);0<arguments.length&&(a.push(f,"="),a.push.apply(a,b(arguments)),a.push(";"));return f},toString:function(){return f([0<g.length?"var "+g+";":"",f(a)])}})}function g(){function a(b,e){g(b,e,"=",f.def(b,e),";")}var f=e(),g=e(),h=f.toString,m=g.toString;return l(function(){f.apply(f,b(arguments))},{def:f.def,entry:f,exit:g,save:a,set:function(b,e,g){a(b,e);f(b,e,"=",g,";")},toString:function(){return h()+
m()}})}var h=0,a=[],r=[],p=e(),m={};return{global:p,link:function(b){for(var f=0;f<r.length;++f)if(r[f]===b)return a[f];f="g"+h++;a.push(f);r.push(b);return f},block:e,proc:function(a,b){function e(){var a="a"+h.length;h.push(a);return a}var h=[];b=b||0;for(var n=0;n<b;++n)e();var n=g(),r=n.toString;return m[a]=l(n,{arg:e,toString:function(){return f(["function(",h.join(),"){",r(),"}"])}})},scope:g,cond:function(){var a=f(arguments),e=g(),h=g(),n=e.toString,m=h.toString;return l(e,{then:function(){e.apply(e,
b(arguments));return this},"else":function(){h.apply(h,b(arguments));return this},toString:function(){var b=m();b&&(b="else{"+b+"}");return f(["if(",a,"){",n(),"}",b])}})},compile:function(){var b=['"use strict";',p,"return {"];Object.keys(m).forEach(function(a){b.push('"',a,'":',m[a].toString(),",")});b.push("}");var e=f(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,a.concat(e)).apply(null,r)}}}},{"./extend":25}],25:[function(e,p,x){p.exports=function(b,
f){for(var e=Object.keys(f),n=0;n<e.length;++n)b[e[n]]=f[e[n]];return b}},{}],26:[function(e,p,x){function b(b,f,e,a,l,p){for(var m=0;m<f;++m)for(var w=b[m],q=0;q<e;++q)for(var x=w[q],z=0;z<a;++z)l[p++]=x[z]}function f(e,g,h,a,l){for(var p=1,m=h+1;m<g.length;++m)p*=g[m];var w=g[h];if(4===g.length-h){var q=g[h+1],x=g[h+2];g=g[h+3];for(m=0;m<w;++m)b(e[m],q,x,g,a,l),l+=p}else for(m=0;m<w;++m)f(e[m],g,h+1,a,l),l+=p}var l=e("./pool");p.exports={shape:function(b){for(var f=[];b.length;b=b[0])f.push(b.length);
return f},flatten:function(e,g,h,a){var r=1;if(g.length)for(var p=0;p<g.length;++p)r*=g[p];else r=0;h=a||l.allocType(h,r);switch(g.length){case 0:break;case 1:a=g[0];for(g=0;g<a;++g)h[g]=e[g];break;case 2:a=g[0];g=g[1];for(p=r=0;p<a;++p)for(var m=e[p],w=0;w<g;++w)h[r++]=m[w];break;case 3:b(e,g[0],g[1],g[2],h,0);break;default:f(e,g,0,h,0)}return h}}},{"./pool":31}],27:[function(e,p,x){var b=e("./is-typed-array");p.exports=function(f){return Array.isArray(f)||b(f)}},{"./is-typed-array":29}],28:[function(e,
p,x){var b=e("./is-typed-array");p.exports=function(f){return!!f&&"object"===typeof f&&Array.isArray(f.shape)&&Array.isArray(f.stride)&&"number"===typeof f.offset&&f.shape.length===f.stride.length&&(Array.isArray(f.data)||b(f.data))}},{"./is-typed-array":29}],29:[function(e,p,x){var b=e("../constants/arraytypes.json");p.exports=function(f){return Object.prototype.toString.call(f)in b}},{"../constants/arraytypes.json":5}],30:[function(e,p,x){p.exports=function(b,f){for(var e=Array(b),n=0;n<b;++n)e[n]=
f(n);return e}},{}],31:[function(e,p,x){function b(b){var f,a;f=(65535<b)<<4;b>>>=f;a=(255<b)<<3;b>>>=a;f|=a;a=(15<b)<<2;b>>>=a;f|=a;a=(3<b)<<1;return f|a|b>>>a>>1}function f(f){a:{for(var e=16;268435456>=e;e*=16)if(f<=e){f=e;break a}f=0}e=n[b(f)>>2];return 0<e.length?e.pop():new ArrayBuffer(f)}function l(f){n[b(f.byteLength)>>2].push(f)}var n=e("./loop")(8,function(){return[]});p.exports={alloc:f,free:l,allocType:function(b,e){var a=null;switch(b){case 5120:a=new Int8Array(f(e),0,e);break;case 5121:a=
new Uint8Array(f(e),0,e);break;case 5122:a=new Int16Array(f(2*e),0,e);break;case 5123:a=new Uint16Array(f(2*e),0,e);break;case 5124:a=new Int32Array(f(4*e),0,e);break;case 5125:a=new Uint32Array(f(4*e),0,e);break;case 5126:a=new Float32Array(f(4*e),0,e);break;default:return null}return a.length!==e?a.subarray(0,e):a},freeType:function(b){l(b.buffer)}}},{"./loop":30}],32:[function(e,p,x){p.exports={next:"function"===typeof requestAnimationFrame?function(b){return requestAnimationFrame(b)}:function(b){return setTimeout(b,
16)},cancel:"function"===typeof cancelAnimationFrame?function(b){return cancelAnimationFrame(b)}:clearTimeout}},{}],33:[function(e,p,x){var b=e("./pool"),f=new Float32Array(1),l=new Uint32Array(f.buffer);p.exports=function(e){for(var g=b.allocType(5123,e.length),h=0;h<e.length;++h)if(isNaN(e[h]))g[h]=65535;else if(Infinity===e[h])g[h]=31744;else if(-Infinity===e[h])g[h]=64512;else{f[0]=e[h];var a=l[0],r=a>>>31<<15,p=(a<<1>>>24)-127,a=a>>13&1023;g[h]=-24>p?r:-14>p?r+(a+1024>>-14-p):15<p?r+31744:r+
(p+15<<10)+a}return g}},{"./pool":31}],34:[function(e,p,x){p.exports=function(b){return Object.keys(b).map(function(f){return b[f]})}},{}],35:[function(e,p,x){function b(a,b,f){function e(){var b=window.innerWidth,l=window.innerHeight;a!==document.body&&(l=a.getBoundingClientRect(),b=l.right-l.left,l=l.bottom-l.top);g.width=f*b;g.height=f*l;h(g.style,{width:b+"px",height:l+"px"})}var g=document.createElement("canvas");h(g.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(g);a===document.body&&
(g.style.position="absolute",h(a.style,{margin:0,padding:0}));window.addEventListener("resize",e,!1);e();return{canvas:g,onDestroy:function(){window.removeEventListener("resize",e);a.removeChild(g)}}}function f(a,b){function f(e){try{return a.getContext(e,b)}catch(g){return null}}return f("webgl")||f("experimental-webgl")||f("webgl-experimental")}function l(a){if("string"===typeof a)return a.split();g(Array.isArray(a),"invalid extension array");return a}function n(a){return"string"===typeof a?(g("undefined"!==
typeof document,"not supported outside of DOM"),document.querySelector(a)):a}var g=e("./util/check"),h=e("./util/extend");p.exports=function(a){var e=a||{},h,m,p,q;a={};var x=[],z=[],B="undefined"===typeof window?1:window.devicePixelRatio,E=!1,t=function(a){a&&g.raise(a)},y=function(){};"string"===typeof e?(g("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),h=document.querySelector(e),g(h,"invalid query string for element")):"object"===typeof e?"string"===typeof e.nodeName&&
"function"===typeof e.appendChild&&"function"===typeof e.getBoundingClientRect?h=e:"function"===typeof e.drawArrays||"function"===typeof e.drawElements?(q=e,p=q.canvas):(g.constructor(e),"gl"in e?q=e.gl:"canvas"in e?p=n(e.canvas):"container"in e&&(m=n(e.container)),"attributes"in e&&(a=e.attributes,g.type(a,"object","invalid context attributes")),"extensions"in e&&(x=l(e.extensions)),"optionalExtensions"in e&&(z=l(e.optionalExtensions)),"onDone"in e&&(g.type(e.onDone,"function","invalid or missing onDone callback"),
t=e.onDone),"profile"in e&&(E=!!e.profile),"pixelRatio"in e&&(B=+e.pixelRatio,g(0<B,"invalid pixel ratio"))):g.raise("invalid arguments to regl");h&&("canvas"===h.nodeName.toLowerCase()?p=h:m=h);if(!q){if(!p){g("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");h=b(m||document.body,t,B);if(!h)return null;p=h.canvas;y=h.onDestroy}q=f(p,a)}return q?{gl:q,canvas:p,container:m,extensions:x,optionalExtensions:z,pixelRatio:B,profile:E,onDone:t,onDestroy:y}:
(y(),t("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/check":22,"./util/extend":25}],36:[function(e,p,x){p.exports=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b}},{}],37:[function(e,p,x){var b=e("./identity");p.exports=function(f,e,n,g){var h,a,r,p,m,w,q,x,z=e[0],B=e[1];e=e[2];r=g[0];p=g[1];a=g[2];q=n[0];g=n[1];h=n[2];if(1E-6>Math.abs(z-q)&&1E-6>
Math.abs(B-g)&&1E-6>Math.abs(e-h))return b(f);n=z-q;g=B-g;q=e-h;x=1/Math.sqrt(n*n+g*g+q*q);n*=x;g*=x;q*=x;h=p*q-a*g;a=a*n-r*q;r=r*g-p*n;(x=Math.sqrt(h*h+a*a+r*r))?(x=1/x,h*=x,a*=x,r*=x):r=a=h=0;p=g*r-q*a;m=q*h-n*r;w=n*a-g*h;(x=Math.sqrt(p*p+m*m+w*w))?(x=1/x,p*=x,m*=x,w*=x):w=m=p=0;f[0]=h;f[1]=p;f[2]=n;f[3]=0;f[4]=a;f[5]=m;f[6]=g;f[7]=0;f[8]=r;f[9]=w;f[10]=q;f[11]=0;f[12]=-(h*z+a*B+r*e);f[13]=-(p*z+m*B+w*e);f[14]=-(n*z+g*B+q*e);f[15]=1;return f}},{"./identity":36}],38:[function(e,p,x){p.exports=function(b,
f,e,n,g){f=1/Math.tan(f/2);var h=1/(n-g);b[0]=f/e;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=f;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=(g+n)*h;b[11]=-1;b[12]=0;b[13]=0;b[14]=2*g*n*h;b[15]=0;return b}},{}],39:[function(e,p,x){p.exports=function(f,e){function n(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==t.alt,t.alt=!!a.altKey);"shiftKey"in a&&(b=b||a.shiftKey!==t.shift,t.shift=!!a.shiftKey);"ctrlKey"in a&&(b=b||a.ctrlKey!==t.control,t.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==t.meta,t.meta=!!a.metaKey);
return b}function g(a,f){var c=b.x(f),g=b.y(f);"buttons"in f&&(a=f.buttons|0);if(a!==z||c!==B||g!==E||n(f))z=a|0,B=c||0,E=g||0,e&&e(z,B,E,t)}function h(a){g(0,a)}function a(){if(z||B||E||t.shift||t.alt||t.meta||t.control)z=B=E=0,t.shift=t.alt=t.control=t.meta=!1,e&&e(0,0,0,t)}function r(a){n(a)&&e&&e(z,B,E,t)}function p(a){0===b.buttons(a)?g(0,a):g(z,a)}function m(a){g(z|b.buttons(a),a)}function w(a){g(z&~b.buttons(a),a)}function q(){y||(y=!0,f.addEventListener("mousemove",p),f.addEventListener("mousedown",
m),f.addEventListener("mouseup",w),f.addEventListener("mouseleave",h),f.addEventListener("mouseenter",h),f.addEventListener("mouseout",h),f.addEventListener("mouseover",h),f.addEventListener("blur",a),f.addEventListener("keyup",r),f.addEventListener("keydown",r),f.addEventListener("keypress",r),f!==window&&(window.addEventListener("blur",a),window.addEventListener("keyup",r),window.addEventListener("keydown",r),window.addEventListener("keypress",r)))}function x(){y&&(y=!1,f.removeEventListener("mousemove",
p),f.removeEventListener("mousedown",m),f.removeEventListener("mouseup",w),f.removeEventListener("mouseleave",h),f.removeEventListener("mouseenter",h),f.removeEventListener("mouseout",h),f.removeEventListener("mouseover",h),f.removeEventListener("blur",a),f.removeEventListener("keyup",r),f.removeEventListener("keydown",r),f.removeEventListener("keypress",r),f!==window&&(window.removeEventListener("blur",a),window.removeEventListener("keyup",r),window.removeEventListener("keydown",r),window.removeEventListener("keypress",
r)))}e||(e=f,f=window);var z=0,B=0,E=0,t={shift:!1,alt:!1,control:!1,meta:!1},y=!1;q();var K={element:f};Object.defineProperties(K,{enabled:{get:function(){return y},set:function(a){a?q():x},enumerable:!0},buttons:{get:function(){return z},enumerable:!0},x:{get:function(){return B},enumerable:!0},y:{get:function(){return E},enumerable:!0},mods:{get:function(){return t},enumerable:!0}});return K};var b=e("mouse-event")},{"mouse-event":40}],40:[function(e,p,x){function b(b){return b.target||b.srcElement||
window}x.buttons=function(b){if("object"===typeof b){if("buttons"in b)return b.buttons;if("which"in b){b=b.which;if(2===b)return 4;if(3===b)return 2;if(0<b)return 1<<b-1}else if("button"in b){b=b.button;if(1===b)return 4;if(2===b)return 2;if(0<=b)return 1<<b}}return 0};x.element=b;x.x=function(f){if("object"===typeof f){if("offsetX"in f)return f.offsetX;var e=b(f).getBoundingClientRect();return f.clientX-e.left}return 0};x.y=function(f){if("object"===typeof f){if("offsetY"in f)return f.offsetY;var e=
b(f).getBoundingClientRect();return f.clientY-e.top}return 0}},{}],41:[function(e,p,x){var b=e("to-px");p.exports=function(f,e,n){"function"===typeof f&&(n=!!e,e=f,f=window);var g=b("ex",f),h=function(a){n&&a.preventDefault();var b=a.deltaX||0,f=a.deltaY||0,h=a.deltaZ||0,p=1;switch(a.deltaMode){case 1:p=g;break;case 2:p=window.innerHeight}b*=p;f*=p;h*=p;if(b||f||h)return e(b,f,h,a)};f.addEventListener("wheel",h);return h}},{"to-px":43}],42:[function(e,p,x){p.exports=function(b,f){f||(f=[0,""]);b=
String(b);var e=parseFloat(b,10);f[0]=e;f[1]=b.match(/[\d.\-\+]*\s*(.*)/)[1]||"";return f}},{}],43:[function(e,p,x){function b(b,e){var a=l(getComputedStyle(b).getPropertyValue(e));return a[0]*f(a[1],b)}function f(f,e){e=e||document.body;f=(f||"px").trim().toLowerCase();if(e===window||e===document)e=document.body;switch(f){case "%":return e.clientHeight/100;case "ch":case "ex":var a=f,l=e,p=document.createElement("div");p.style["font-size"]="128"+a;l.appendChild(p);a=b(p,"font-size")/128;l.removeChild(p);
return a;case "em":return b(e,"font-size");case "rem":return b(document.body,"font-size");case "vw":return window.innerWidth/100;case "vh":return window.innerHeight/100;case "vmin":return Math.min(window.innerWidth,window.innerHeight)/100;case "vmax":return Math.max(window.innerWidth,window.innerHeight)/100;case "in":return n;case "cm":return n/2.54;case "mm":return n/25.4;case "pt":return n/72;case "pc":return n/6}return 1}var l=e("parse-unit");p.exports=f;var n=96},{"parse-unit":42}],44:[function(e,
p,x){function b(a,b){for(var f=0;f<a.length;++f)if(a[f]===b)return f;return-1}var f=e("./lib/util/check"),l=e("./lib/util/extend"),n=e("./lib/dynamic"),g=e("./lib/util/raf"),h=e("./lib/util/clock"),a=e("./lib/strings"),r=e("./lib/webgl"),A=e("./lib/extension"),m=e("./lib/limits"),w=e("./lib/buffer"),q=e("./lib/elements"),Q=e("./lib/texture"),z=e("./lib/renderbuffer"),B=e("./lib/framebuffer"),E=e("./lib/attribute"),t=e("./lib/shader"),y=e("./lib/read"),K=e("./lib/core"),L=e("./lib/stats"),F=e("./lib/timer");
p.exports=function(c){function e(){if(0===N.length)M&&M.update(),ga=null;else{ga=g.next(e);S();for(var a=N.length-1;0<=a;--a){var b=N[a];b&&b(aa,null,0)}G.flush();M&&M.update()}}function p(){!ga&&0<N.length&&(ga=g.next(e))}function x(){ga&&(g.cancel(e),ga=null)}function Pa(a){a.preventDefault();ja=!0;x();X.forEach(function(a){a()})}function sa(a){G.getError();ja=!1;pa.restore();na.restore();la.restore();qa.restore();Aa.restore();T.restore();M&&M.restore();W.procs.refresh();p();ea.forEach(function(a){a()})}
function ia(a){function b(a){var c={},f={};Object.keys(a).forEach(function(b){var e=a[b];n.isDynamic(e)?f[b]=n.unbox(e,b):c[b]=e});return{dynamic:f,"static":c}}function c(a){for(;r.length<a;)r.push(null);return r}f(!!a,"invalid args to regl({...})");f.type(a,"object","invalid args to regl({...})");var e=b(a.context||{}),g=b(a.uniforms||{}),h=b(a.attributes||{}),k=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=l({},a);delete c.uniforms;
delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var e=W.compile(k,h,g,e,a),m=e.draw,p=e.batch,q=e.scope,r=[];return l(function(a,b){var e;ja&&f.raise("context lost");if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(e=0;e<
a;++e)q.call(this,null,b,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)q.call(this,a[e],b,e);else return q.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return m.call(this,a)},{stats:a})}function ba(a,b){var c=0;W.procs.poll();var e=b.color;e&&(G.clearColor(+e[0]||0,+e[1]||0,+e[2]||0,+e[3]||0),c|=16384);"depth"in b&&(G.clearDepth(+b.depth),c|=256);"stencil"in b&&(G.clearStencil(b.stencil|
0),c|=1024);f(!!c,"called regl.clear with no buffer specified");G.clear(c)}function Y(a){f.type(a,"function","regl.frame() callback must be a function");N.push(a);p();return{cancel:function(){function c(){var a=b(N,c);N[a]=N[N.length-1];--N.length;0>=N.length&&x()}var e=b(N,a);f(0<=e,"cannot cancel a frame twice");N[e]=c}}}function H(){var a=fa.viewport,b=fa.scissor_box;a[0]=a[1]=b[0]=b[1]=0;aa.viewportWidth=aa.framebufferWidth=aa.drawingBufferWidth=a[2]=b[2]=G.drawingBufferWidth;aa.viewportHeight=
aa.framebufferHeight=aa.drawingBufferHeight=a[3]=b[3]=G.drawingBufferHeight}function S(){aa.tick+=1;aa.time=V();H();W.procs.poll()}function U(){H();W.procs.refresh();M&&M.update()}function V(){return(h()-Ea)/1E3}c=r(c);if(!c)return null;var G=c.gl,ta=G.getContextAttributes(),ja=G.isContextLost(),pa=A(G,c);if(!pa)return null;var ya=a(),Z=L(),O=pa.extensions,M=F(G,O),Ea=h(),va=G.drawingBufferWidth,za=G.drawingBufferHeight,aa={tick:0,time:0,viewportWidth:va,viewportHeight:za,framebufferWidth:va,framebufferHeight:za,
drawingBufferWidth:va,drawingBufferHeight:za,pixelRatio:c.pixelRatio},ha=m(G,O),la=w(G,Z,c),ma=q(G,O,la,Z),va=E(G,O,ha,la,ya),na=t(G,ya,Z,c),qa=Q(G,O,ha,function(){W.procs.poll()},aa,Z,c),Aa=z(G,O,ha,Z,c),T=B(G,O,ha,qa,Aa,Z),W=K(G,ya,O,ha,la,ma,qa,T,{},va,na,{elements:null,primitive:4,count:-1,offset:0,instances:-1},aa,M,c),ya=y(G,T,W.procs.poll,aa,ta,O),fa=W.next,R=G.canvas,N=[],X=[],ea=[],Ba=[c.onDestroy],ga=null;R&&(R.addEventListener("webglcontextlost",Pa,!1),R.addEventListener("webglcontextrestored",
sa,!1));var wa=T.setFBO=ia({framebuffer:n.define.call(null,1,"framebuffer")});U();ta=l(ia,{clear:function(a){f("object"===typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)wa(l({framebuffer:a.framebuffer.faces[b]},a),ba);else wa(a,ba);else ba(null,a)},prop:n.define.bind(null,1),context:n.define.bind(null,2),"this":n.define.bind(null,3),draw:ia({}),buffer:function(a){return la.create(a,34962,!1,
!1)},elements:function(a){return ma.create(a,!1)},texture:qa.create2D,cube:qa.createCube,renderbuffer:Aa.create,framebuffer:T.create,framebufferCube:T.createCube,attributes:ta,frame:Y,on:function(a,b){f.type(b,"function","listener callback must be a function");var c;switch(a){case "frame":return Y(b);case "lost":c=X;break;case "restore":c=ea;break;case "destroy":c=Ba;break;default:f.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=0;a<
c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:ha,hasExtension:function(a){return 0<=ha.extensions.indexOf(a.toLowerCase())},read:ya,destroy:function(){N.length=0;x();R&&(R.removeEventListener("webglcontextlost",Pa),R.removeEventListener("webglcontextrestored",sa));na.clear();T.clear();Aa.clear();qa.clear();ma.clear();la.clear();M&&M.clear();Ba.forEach(function(a){a()})},_gl:G,_refresh:U,poll:function(){S();M&&M.update()},now:V,stats:Z});c.onDone(null,ta);return ta}},{"./lib/attribute":3,
"./lib/buffer":4,"./lib/core":9,"./lib/dynamic":10,"./lib/elements":11,"./lib/extension":12,"./lib/framebuffer":13,"./lib/limits":14,"./lib/read":15,"./lib/renderbuffer":16,"./lib/shader":17,"./lib/stats":18,"./lib/strings":19,"./lib/texture":20,"./lib/timer":21,"./lib/util/check":22,"./lib/util/clock":23,"./lib/util/extend":25,"./lib/util/raf":32,"./lib/webgl":35}]},{},[1]);
