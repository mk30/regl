<!DOCTYPE html>
      <html>
        <head>
          <title>example/batch.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(q,B,e){function l(g,h){if(!B[g]){if(!q[g]){var a="function"==typeof require&&require;if(!h&&a)return a(g,!0);if(k)return k(g,!0);a=Error("Cannot find module '"+g+"'");throw a.code="MODULE_NOT_FOUND",a;}a=B[g]={exports:{}};q[g][0].call(a.exports,function(a){var e=q[g][1][a];return l(e?e:a)},a,a.exports,e$$0,q,B,e)}return B[g].exports}for(var k="function"==typeof require&&require,m=0;m<e.length;m++)l(e[m]);return l})({1:[function(d,q,B){var e=d("../regl")(),l=e({frag:"\n    precision mediump float;\n    uniform vec4 color;\n    void main() {\n      gl_FragColor = color;\n    }",
vert:"\n    precision mediump float;\n    attribute vec2 position;\n    uniform float angle;\n    uniform vec2 offset;\n    void main() {\n      gl_Position = vec4(\n        cos(angle) * position.x + sin(angle) * position.y + offset.x,\n        -sin(angle) * position.x + cos(angle) * position.y + offset.y, 0, 1);\n    }",attributes:{position:[.5,0,0,.5,1,1]},uniforms:{color:function(e,m,g){e=e.tick;return[Math.sin(.02*((.1+Math.sin(g))*e+3*g)),Math.cos(.02*(.02*e+.1*g)),Math.sin(.02*((.3+Math.cos(2*
g))*e+.8*g)),1]},angle:function(e){return.01*e.tick},offset:e.prop("offset")},depth:{enable:!1},count:3});e.frame(function(){e.clear({color:[0,0,0,1]});l([{offset:[-1,-1]},{offset:[-1,0]},{offset:[-1,1]},{offset:[0,-1]},{offset:[0,0]},{offset:[0,1]},{offset:[1,-1]},{offset:[1,0]},{offset:[1,1]}])})},{"../regl":35}],2:[function(d,q,B){function e(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}q.exports=
function(l,k,m,g,h){l=m.maxAttributes;k=Array(l);for(m=0;m<l;++m)k[m]=new e;return{Record:e,scope:{},state:k}}},{}],3:[function(d,q,B){function e(a){return u[Object.prototype.toString.call(a)]|0}function l(a,g){for(var e=0;e<g.length;++e)a[e]=g[e]}function k(a,g,e,h,k,m,n){for(var b=0,f=0;f<e;++f)for(var D=0;D<h;++D)a[b++]=g[k*f+m*D+n]}var m=d("./util/check"),g=d("./util/is-typed-array"),h=d("./util/is-ndarray"),a=d("./util/values"),p=d("./util/pool");B=d("./util/flatten");var C=B.flatten,E=B.shape,
u=d("./constants/arraytypes.json"),n=d("./constants/dtypes.json"),H=d("./constants/usage.json"),F=[];F[5120]=1;F[5122]=2;F[5124]=4;F[5121]=1;F[5123]=2;F[5125]=4;F[5126]=4;q.exports=function(d,u,z){function t(a){this.id=b++;this.buffer=d.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;z.profile&&(this.stats={size:0})}function Q(a,b,f){a.byteLength=b.byteLength;d.bufferData(a.type,b,f)}function q(a,b,f,n,d,t){a.usage=f;if(Array.isArray(b)){if(a.dtype=
n||5126,0<b.length)if(Array.isArray(b[0])){d=E(b);for(var D=n=1;D<d.length;++D)n*=d[D];a.dimension=n;b=C(b,d,a.dtype);Q(a,b,f);t?a.persistentData=b:p.freeType(b)}else"number"===typeof b[0]?(a.dimension=d,d=p.allocType(a.dtype,b.length),l(d,b),Q(a,d,f),t?a.persistentData=d:p.freeType(d)):g(b[0])?(a.dimension=b[0].length,a.dtype=n||e(b[0])||5126,b=C(b,[b.length,b[0].length],a.dtype),Q(a,b,f),t?a.persistentData=b:p.freeType(b)):m.raise("invalid buffer data")}else if(g(b))a.dtype=n||e(b),a.dimension=
d,Q(a,b,f),t&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(h(b)){d=b.shape;var u=b.stride,D=b.offset,z=0,x=0,I=0,G=0;1===d.length?(z=d[0],x=1,I=u[0],G=0):2===d.length?(z=d[0],x=d[1],I=u[0],G=u[1]):m.raise("invalid shape");a.dtype=n||e(b.data)||5126;a.dimension=x;d=p.allocType(a.dtype,z*x);k(d,b.data,z,x,I,G,D);Q(a,d,f);t?a.persistentData=d:p.freeType(d)}else m.raise("invalid buffer data")}function G(a){u.bufferCount--;var b=a.buffer;m(b,"buffer must not be deleted already");
d.deleteBuffer(b);a.buffer=null;delete f[a.id]}var b=0,f={};t.prototype.bind=function(){d.bindBuffer(this.type,this.buffer)};t.prototype.destroy=function(){G(this)};var D=[];z.profile&&(u.getTotalBufferSize=function(){var a=0;Object.keys(f).forEach(function(b){a+=f[b].stats.size});return a});return{create:function(a,b,D,Q){function L(a){var b=35044,f=null,e=0,k=0,V=1;Array.isArray(a)||g(a)||h(a)?f=a:"number"===typeof a?e=a|0:a&&(m.type(a,"object","buffer arguments must be an object, a number or an array"),
"data"in a&&(m(null===f||Array.isArray(f)||g(f)||h(f),"invalid data for buffer"),f=a.data),"usage"in a&&(m.parameter(a.usage,H,"invalid buffer usage"),b=H[a.usage]),"type"in a&&(m.parameter(a.type,n,"invalid buffer type"),k=n[a.type]),"dimension"in a&&(m.type(a.dimension,"number","invalid dimension"),V=a.dimension|0),"length"in a&&(m.nni(e,"buffer length must be a nonnegative integer"),e=a.length|0));J.bind();f?q(J,f,b,k,V,Q):(d.bufferData(J.type,e,b),J.dtype=k||5121,J.usage=b,J.dimension=V,J.byteLength=
e);z.profile&&(J.stats.size=J.byteLength*F[J.dtype]);return L}function W(a,b){m(b+a.byteLength<=J.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+a.byteLength+" starting from offset "+b+" to a buffer of size "+J.byteLength);d.bufferSubData(J.type,b,a)}u.bufferCount++;var J=new t(b);f[J.id]=J;D||L(a);L._reglType="buffer";L._buffer=J;L.subdata=function(a,b){var f=(b||0)|0,d;J.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var n=p.allocType(J.dtype,
a.length);l(n,a);W(n,f);p.freeType(n)}else Array.isArray(a[0])||g(a[0])?(d=E(a),n=C(a,d,J.dtype),W(n,f),p.freeType(n)):m.raise("invalid buffer data")}else if(g(a))W(a,f);else if(h(a)){d=a.shape;var V=a.stride,t=n=0,D=0,u=0;1===d.length?(n=d[0],t=1,D=V[0],u=0):2===d.length?(n=d[0],t=d[1],D=V[0],u=V[1]):m.raise("invalid shape");d=Array.isArray(a.data)?J.dtype:e(a.data);d=p.allocType(d,n*t);k(d,a.data,n,t,D,u,a.offset);W(d,f);p.freeType(d)}else m.raise("invalid data for buffer subdata");return L};z.profile&&
(L.stats=J.stats);L.destroy=function(){G(J)};return L},createStream:function(a,b){var f=D.pop();f||(f=new t(a));f.bind();q(f,b,35040,0,1,!1);return f},destroyStream:function(a){D.push(a)},clear:function(){a(f).forEach(G);D.forEach(G)},getBuffer:function(a){return a&&a._buffer instanceof t?a._buffer:null},restore:function(){a(f).forEach(function(a){a.buffer=d.createBuffer();d.bindBuffer(a.type,a.buffer);d.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},_initBuffer:q}}},{"./constants/arraytypes.json":4,
"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/check":21,"./util/flatten":25,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/values":33}],4:[function(d,q,B){q.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(d,
q,B){q.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(d,q,B){q.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(d,q,B){q.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(d,q,B){function e(a){return Array.isArray(a)||E(a)||u(a)}function l(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:
a<b?-1:1})}function k(a,b,f,e){this.thisDep=a;this.contextDep=b;this.propDep=f;this.append=e}function m(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function g(a){return new k(!1,!1,!1,a)}function h(a,b){var f=a.type;return 0===f?(f=a.data.length,new k(!0,1<=f,2<=f,b)):4===f?(f=a.data,new k(f.thisDep,f.contextDep,f.propDep,b)):new k(3===f,2===f,1===f,b)}var a=d("./util/check"),p=d("./util/codegen"),C=d("./util/loop"),E=d("./util/is-typed-array"),u=d("./util/is-ndarray"),n=d("./util/is-array-like"),
H=d("./dynamic"),F=d("./constants/primitives.json"),K=d("./constants/dtypes.json"),O=["x","y","z","w"],z="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),t={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,
"one minus constant alpha":32772,"src alpha saturate":776},Q="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),Y={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,
">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},G={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},b={frag:35632,vert:35633},f={cw:2304,ccw:2305},D=new k(!1,!1,!1,function(){});q.exports=function(d,u,E,q,L,W,J,B,aa,x,I,Da,da,pa,va){function ea(a){return a.replace(".","_")}function T(a,c,b){var f=ea(a);Ia.push(a);M[f]=w[f]=!!b;za[f]=c}function N(a,c,b){var f=ea(a);Ia.push(a);Array.isArray(b)?(w[f]=b.slice(),
M[f]=b.slice()):w[f]=M[f]=b;Aa[f]=c}function Ba(){var c=p(),b=c.link,f=c.global;c.id=Qa++;c.batchId="0";var e=b(Oa),g=c.shared={props:"a0"};Object.keys(Oa).forEach(function(a){g[a]=f.def(e,".",a)});a.optional(function(){c.CHECK=b(a);c.commandStr=a.guessCommand();c.command=b(c.commandStr);c.assert=function(a,c,y){a("if(!(",c,"))",this.CHECK,".commandRaise(",b(y),",",this.command,");")};Ja.invalidBlendCombinations=Q});var P=c.next={},Ra=c.current={};Object.keys(Aa).forEach(function(a){Array.isArray(w[a])&&
(P[a]=f.def(g.next,".",a),Ra[a]=f.def(g.current,".",a))});var Sa=c.constants={};Object.keys(Ja).forEach(function(a){Sa[a]=f.def(JSON.stringify(Ja[a]))});c.invoke=function(a,y){switch(y.type){case 0:var f=["this",g.context,g.props,c.batchId];return a.def(b(y.data),".call(",f.slice(0,Math.max(y.data.length+1,4)),")");case 1:return a.def(g.props,y.data);case 2:return a.def(g.context,y.data);case 3:return a.def("this",y.data);case 4:return y.data.append(c,a),y.data.ref}};c.attribCache={};var y={};c.scopeAttrib=
function(a){a=u.id(a);if(a in y)return y[a];var c=x.scope[a];c||(c=x.scope[a]=new ra);return y[a]=b(c)};return c}function sa(a){var c=a["static"];a=a.dynamic;var b;if("profile"in c){var f=!!c.profile;b=g(function(a,c){return f});b.enable=f}else if("profile"in a){var e=a.profile;b=h(e,function(a,c){return a.invoke(c,e)})}return b}function wa(c,b){var f=c["static"],e=c.dynamic;if("framebuffer"in f){var w=f.framebuffer;return w?(w=B.getFramebuffer(w),a.command(w,"invalid framebuffer object"),g(function(a,
c){var y=a.link(w),b=a.shared;c.set(b.framebuffer,".next",y);b=b.context;c.set(b,".framebufferWidth",y+".width");c.set(b,".framebufferHeight",y+".height");return y})):g(function(a,c){var y=a.shared;c.set(y.framebuffer,".next","null");y=y.context;c.set(y,".framebufferWidth",y+".drawingBufferWidth");c.set(y,".framebufferHeight",y+".drawingBufferHeight");return"null"})}if("framebuffer"in e){var P=e.framebuffer;return h(P,function(c,b){var y=c.invoke(b,P),f=c.shared,U=f.framebuffer,A=b.def(U,".getFramebuffer(",
y,")");a.optional(function(){c.assert(b,"!"+y+"||"+A,"invalid framebuffer object")});b.set(U,".next",A);f=f.context;b.set(f,".framebufferWidth",A+"?"+A+".width:"+f+".drawingBufferWidth");b.set(f,".framebufferHeight",A+"?"+A+".height:"+f+".drawingBufferHeight");return A})}return null}function fa(c,b,f){function e(c){if(c in g){var y=g[c];a.commandType(y,"object","invalid "+c,f.commandStr);var r=!0,U=y.x|0,w=y.y|0,d,v;"width"in y?(d=y.width|0,a.command(0<=d,"invalid "+c,f.commandStr)):r=!1;"height"in
y?(v=y.height|0,a.command(0<=v,"invalid "+c,f.commandStr)):r=!1;return new k(!r&&b&&b.thisDep,!r&&b&&b.contextDep,!r&&b&&b.propDep,function(a,c){var b=a.shared.context,f=d;"width"in y||(f=c.def(b,".","framebufferWidth","-",U));var r=v;"height"in y||(r=c.def(b,".","framebufferHeight","-",w));return[U,w,f,r]})}if(c in P){var n=P[c],r=h(n,function(b,y){var f=b.invoke(y,n);a.optional(function(){b.assert(y,f+"&&typeof "+f+'==="object"',"invalid "+c)});var U=b.shared.context,r=y.def(f,".x|0"),A=y.def(f,
".y|0"),e=y.def('"width" in ',f,"?",f,".width|0:","(",U,".","framebufferWidth","-",r,")"),g=y.def('"height" in ',f,"?",f,".height|0:","(",U,".","framebufferHeight","-",A,")");a.optional(function(){b.assert(y,e+">=0&&"+g+">=0","invalid "+c)});return[r,A,e,g]});b&&(r.thisDep=r.thisDep||b.thisDep,r.contextDep=r.contextDep||b.contextDep,r.propDep=r.propDep||b.propDep);return r}return b?new k(b.thisDep,b.contextDep,b.propDep,function(a,c){var b=a.shared.context;return[0,0,c.def(b,".","framebufferWidth"),
c.def(b,".","framebufferHeight")]}):null}var g=c["static"],P=c.dynamic;if(c=e("viewport")){var w=c;c=new k(c.thisDep,c.contextDep,c.propDep,function(a,c){var b=w.append(a,c),f=a.shared.context;c.set(f,".viewportWidth",b[2]);c.set(f,".viewportHeight",b[3]);return b})}return{viewport:c,scissor_box:e("scissor.box")}}function ka(c){function f(c){if(c in e){var y=u.id(e[c]);a.optional(function(){I.shader(b[c],y,a.guessCommand())});var r=g(function(){return y});r.id=y;return r}if(c in w){var U=w[c];return h(U,
function(y,f){var r=y.invoke(f,U),A=f.def(y.shared.strings,".id(",r,")");a.optional(function(){f(y.shared.shader,".shader(",b[c],",",A,",",y.command,");")});return A})}return null}var e=c["static"],w=c.dynamic,d=f("frag"),P=f("vert"),v=null;m(d)&&m(P)?(v=I.program(P.id,d.id),c=g(function(a,c){return a.link(v)})):c=new k(d&&d.thisDep||P&&P.thisDep,d&&d.contextDep||P&&P.contextDep,d&&d.propDep||P&&P.propDep,function(c,b){var f=c.shared.shader,U;U=d?d.append(c,b):b.def(f,".","frag");var r;r=P?P.append(c,
b):b.def(f,".","vert");var A=f+".program("+r+","+U;a.optional(function(){A+=","+c.command});return b.def(A+")")});return{frag:d,vert:P,progVar:c,program:v}}function la(c,b){function f(c,y){if(c in w){var r=w[c]|0;a.command(!y||0<=r,"invalid "+c,b.commandStr);return g(function(a,c){y&&(a.OFFSET=r);return r})}if(c in d){var U=d[c];return h(U,function(b,f){var r=b.invoke(f,U);y&&(b.OFFSET=r,a.optional(function(){b.assert(f,r+">=0","invalid "+c)}));return r})}return y&&P?g(function(a,c){a.OFFSET="0";
return 0}):null}var w=c["static"],d=c.dynamic,P=function(){if("elements"in w){var c=w.elements;e(c)?c=W.getElements(W.create(c,!0)):c&&(c=W.getElements(c),a.command(c,"invalid elements",b.commandStr));var f=g(function(a,b){if(c){var f=a.link(c);return a.ELEMENTS=f}return a.ELEMENTS=null});f.value=c;return f}if("elements"in d){var r=d.elements;return h(r,function(c,b){var f=c.shared,y=f.isBufferArgs,f=f.elements,A=c.invoke(b,r),e=b.def("null"),y=b.def(y,"(",A,")"),g=c.cond(y).then(e,"=",f,".createStream(",
A,");")["else"](e,"=",f,".getElements(",A,");");a.optional(function(){c.assert(g["else"],"!"+A+"||"+e,"invalid elements")});b.entry(g);b.exit(c.cond(y).then(f,".destroyStream(",e,");"));return c.ELEMENTS=e})}return null}(),v=f("offset",!0);return{elements:P,primitive:function(){if("primitive"in w){var c=w.primitive;a.commandParameter(c,F,"invalid primitve",b.commandStr);return g(function(a,b){return F[c]})}if("primitive"in d){var f=d.primitive;return h(f,function(c,b){var r=c.constants.primTypes,
A=c.invoke(b,f);a.optional(function(){c.assert(b,A+" in "+r,"invalid primitive, must be one of "+Object.keys(F))});return b.def(r,"[",A,"]")})}return P?m(P)?P.value?g(function(a,c){return c.def(a.ELEMENTS,".primType")}):g(function(){return 4}):new k(P.thisDep,P.contextDep,P.propDep,function(a,c){var b=a.ELEMENTS;return c.def(b,"?",b,".primType:",4)}):null}(),count:function(){if("count"in w){var c=w.count|0;a.command("number"===typeof c&&0<=c,"invalid vertex count",b.commandStr);return g(function(){return c})}if("count"in
d){var f=d.count;return h(f,function(c,b){var r=c.invoke(b,f);a.optional(function(){c.assert(b,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")});return r})}if(P){if(m(P)){if(P)return v?new k(v.thisDep,v.contextDep,v.propDep,function(c,b){var f=b.def(c.ELEMENTS,".vertCount-",c.OFFSET);a.optional(function(){c.assert(b,f+">=0","invalid vertex offset/element buffer too small")});return f}):g(function(a,c){return c.def(a.ELEMENTS,".vertCount")});var r=g(function(){return-1});
a.optional(function(){r.MISSING=!0});return r}var U=new k(P.thisDep||v.thisDep,P.contextDep||v.contextDep,P.propDep||v.propDep,function(a,c){var b=a.ELEMENTS;return a.OFFSET?c.def(b,"?",b,".vertCount-",a.OFFSET,":-1"):c.def(b,"?",b,".vertCount:-1")});a.optional(function(){U.DYNAMIC=!0});return U}return null}(),instances:f("instances",!1),offset:v}}function ma(c,b){var e=c["static"],w=c.dynamic,d={};Ia.forEach(function(c){function r(a,b){if(c in e){var f=a(e[c]);d[v]=g(function(){return f})}else if(c in
w){var A=w[c];d[v]=h(A,function(a,c){return b(a,c,a.invoke(c,A))})}}var v=ea(c);switch(c){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return r(function(f){a.commandType(f,"boolean",c,b.commandStr);return f},function(b,f,r){a.optional(function(){b.assert(f,"typeof "+r+'==="boolean"',"invalid flag "+c,b.commandStr)});return r});case "depth.func":return r(function(f){a.commandParameter(f,
Y,"invalid "+c,b.commandStr);return Y[f]},function(b,f,r){var A=b.constants.compareFuncs;a.optional(function(){b.assert(f,r+" in "+A,"invalid "+c+", must be one of "+Object.keys(Y))});return f.def(A,"[",r,"]")});case "depth.range":return r(function(c){a.command(n(c)&&2===c.length&&"number"===typeof c[0]&&"number"===typeof c[1]&&c[0]<=c[1],"depth range is 2d array",b.commandStr);return c},function(c,b,f){a.optional(function(){c.assert(b,c.shared.isArrayLike+"("+f+")&&"+f+".length===2&&typeof "+f+'[0]==="number"&&typeof '+
f+'[1]==="number"&&'+f+"[0]<="+f+"[1]","depth range must be a 2d array")});var r=b.def("+",f,"[0]"),A=b.def("+",f,"[1]");return[r,A]});case "blend.func":return r(function(c){a.commandType(c,"object","blend.func",b.commandStr);var f="srcRGB"in c?c.srcRGB:c.src,r="srcAlpha"in c?c.srcAlpha:c.src,e="dstRGB"in c?c.dstRGB:c.dst;c="dstAlpha"in c?c.dstAlpha:c.dst;a.commandParameter(f,t,v+".srcRGB",b.commandStr);a.commandParameter(r,t,v+".srcAlpha",b.commandStr);a.commandParameter(e,t,v+".dstRGB",b.commandStr);
a.commandParameter(c,t,v+".dstAlpha",b.commandStr);a.command(-1===Q.indexOf(f+", "+e),"unallowed blending combination (srcRGB, dstRGB) = ("+f+", "+e+")",b.commandStr);return[t[f],t[e],t[r],t[c]]},function(b,f,r){function A(g,w){var v=f.def('"',g,w,'" in ',r,"?",r,".",g,w,":",r,".",g);a.optional(function(){b.assert(f,v+" in "+e,"invalid "+c+"."+g+w+", must be one of "+Object.keys(t))});return v}var e=b.constants.blendFuncs;a.optional(function(){b.assert(f,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")});
var g=A("src","RGB"),w=A("dst","RGB");a.optional(function(){b.assert(f,b.constants.invalidBlendCombinations+".indexOf("+g+'+", "+'+w+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var v=f.def(e,"[",g,"]"),d=f.def(e,"[",A("src","Alpha"),"]"),h=f.def(e,"[",w,"]"),n=f.def(e,"[",A("dst","Alpha"),"]");return[v,h,d,n]});case "blend.equation":return r(function(f){if("string"===typeof f)return a.commandParameter(f,ga,"invalid "+c,b.commandStr),[ga[f],ga[f]];if("object"===typeof f)return a.commandParameter(f.rgb,
ga,c+".rgb",b.commandStr),a.commandParameter(f.alpha,ga,c+".alpha",b.commandStr),[ga[f.rgb],ga[f.alpha]];a.commandRaise("invalid blend.equation",b.commandStr)},function(b,f,r){var A=b.constants.blendEquations,e=f.def(),g=f.def(),w=b.cond("typeof ",r,'==="string"');a.optional(function(){function a(c,f,r){b.assert(c,r+" in "+A,"invalid "+f+", must be one of "+Object.keys(ga))}a(w.then,c,r);b.assert(w["else"],r+"&&typeof "+r+'==="object"',"invalid "+c);a(w["else"],c+".rgb",r+".rgb");a(w["else"],c+".alpha",
r+".alpha")});w.then(e,"=",g,"=",A,"[",r,"];");w["else"](e,"=",A,"[",r,".rgb];",g,"=",A,"[",r,".alpha];");f(w);return[e,g]});case "blend.color":return r(function(c){a.command(n(c)&&4===c.length,"blend.color must be a 4d array",b.commandStr);return C(4,function(a){return+c[a]})},function(c,b,f){a.optional(function(){c.assert(b,c.shared.isArrayLike+"("+f+")&&"+f+".length===4","blend.color must be a 4d array")});return C(4,function(c){return b.def("+",f,"[",c,"]")})});case "stencil.mask":return r(function(c){a.commandType(c,
"number",v,b.commandStr);return c|0},function(c,b,f){a.optional(function(){c.assert(b,"typeof "+f+'==="number"',"invalid stencil.mask")});return b.def(f,"|0")});case "stencil.func":return r(function(f){a.commandType(f,"object",v,b.commandStr);var r=f.cmp||"keep",e=f.ref||0;f="mask"in f?f.mask:-1;a.commandParameter(r,Y,c+".cmp",b.commandStr);a.commandType(e,"number",c+".ref",b.commandStr);a.commandType(f,"number",c+".mask",b.commandStr);return[Y[r],e,f]},function(c,b,f){var r=c.constants.compareFuncs;
a.optional(function(){function a(){c.assert(b,Array.prototype.join.call(arguments,""),"invalid stencil.func")}a(f+"&&typeof ",f,'==="object"');a('!("cmp" in ',f,")||(",f,".cmp in ",r,")")});var e=b.def('"cmp" in ',f,"?",r,"[",f,".cmp]",":",7680),A=b.def(f,".ref|0"),g=b.def('"mask" in ',f,"?",f,".mask|0:-1");return[e,A,g]});case "stencil.opFront":case "stencil.opBack":return r(function(f){a.commandType(f,"object",v,b.commandStr);var r=f.fail||"keep",e=f.zfail||"keep";f=f.zpass||"keep";a.commandParameter(r,
G,c+".fail",b.commandStr);a.commandParameter(e,G,c+".zfail",b.commandStr);a.commandParameter(f,G,c+".zpass",b.commandStr);return["stencil.opBack"===c?1029:1028,G[r],G[e],G[f]]},function(b,f,r){function e(g){a.optional(function(){b.assert(f,'!("'+g+'" in '+r+")||("+r+"."+g+" in "+A+")","invalid "+c+"."+g+", must be one of "+Object.keys(G))});return f.def('"',g,'" in ',r,"?",A,"[",r,".",g,"]:",7680)}var A=b.constants.stencilOps;a.optional(function(){b.assert(f,r+"&&typeof "+r+'==="object"',"invalid "+
c)});return["stencil.opBack"===c?1029:1028,e("fail"),e("zfail"),e("zpass")]});case "polygonOffset.offset":return r(function(c){a.commandType(c,"object",v,b.commandStr);var f=c.factor|0;c=c.units|0;a.commandType(f,"number",v+".factor",b.commandStr);a.commandType(c,"number",v+".units",b.commandStr);return[f,c]},function(b,f,r){a.optional(function(){b.assert(f,r+"&&typeof "+r+'==="object"',"invalid "+c)});var e=f.def(r,".factor|0"),A=f.def(r,".units|0");return[e,A]});case "cull.face":return r(function(c){var f=
0;"front"===c?f=1028:"back"===c&&(f=1029);a.command(!!f,v,b.commandStr);return f},function(c,b,f){a.optional(function(){c.assert(b,f+'==="front"||'+f+'==="back"',"invalid cull.face")});return b.def(f,'==="front"?',1028,":",1029)});case "lineWidth":return r(function(c){a.command("number"===typeof c&&c>=q.lineWidthDims[0]&&c<=q.lineWidthDims[1],"invalid line width, must positive number between "+q.lineWidthDims[0]+" and "+q.lineWidthDims[1],b.commandStr);return c},function(c,b,f){a.optional(function(){c.assert(b,
"typeof "+f+'==="number"&&'+f+">="+q.lineWidthDims[0]+"&&"+f+"<="+q.lineWidthDims[1],"invalid line width")});return f});case "frontFace":return r(function(c){a.commandParameter(c,f,v,b.commandStr);return f[c]},function(c,b,f){a.optional(function(){c.assert(b,f+'==="cw"||'+f+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return b.def(f+'==="cw"?2304:2305')});case "colorMask":return r(function(c){a.command(n(c)&&4===c.length,"color.mask must be length 4 array",b.commandStr);return c.map(function(c){return!!c})},
function(c,b,f){a.optional(function(){c.assert(b,c.shared.isArrayLike+"("+f+")&&"+f+".length===4","invalid color.mask")});return C(4,function(c){return"!!"+f+"["+c+"]"})});case "sample.coverage":return r(function(c){a.command("object"===typeof c&&c,v,b.commandStr);var f="value"in c?c.value:1;c=!!c.invert;a.command("number"===typeof f&&0<=f&&1>=f,"sample.coverage.value must be a number between 0 and 1",b.commandStr);return[f,c]},function(c,b,f){a.optional(function(){c.assert(b,f+"&&typeof "+f+'==="object"',
"invalid sample.coverage")});var r=b.def('"value" in ',f,"?+",f,".value:1"),e=b.def("!!",f,".invert");return[r,e]})}});return d}function na(c,b){var f=c["static"],e=c.dynamic,w={};Object.keys(f).forEach(function(c){var r=f[c],e;if("number"===typeof r||"boolean"===typeof r)e=g(function(){return r});else if("function"===typeof r){var v=r._reglType;"texture2d"===v||"textureCube"===v?e=g(function(c){return c.link(r)}):"framebuffer"===v||"framebufferCube"===v?(a.command(0<r.color.length,'missing color attachment for framebuffer sent to uniform "'+
c+'"',b.commandStr),e=g(function(c){return c.link(r.color[0])})):a.commandRaise('invalid data for uniform "'+c+'"',b.commandStr)}else n(r)?e=g(function(b){return b.global.def("[",C(r.length,function(f){a.command("number"===typeof r[f]||"boolean"===typeof r[f],"invalid uniform "+c,b.commandStr);return r[f]}),"]")}):a.commandRaise('invalid or missing data for uniform "'+c+'"',b.commandStr);e.value=r;w[c]=e});Object.keys(e).forEach(function(c){var a=e[c];w[c]=h(a,function(c,b){return c.invoke(b,a)})});
return w}function qa(b,f){var w=b["static"],v=b.dynamic,d={};Object.keys(w).forEach(function(b){var r=w[b],v=u.id(b),y=new ra;if(e(r))y.state=1,y.buffer=L.getBuffer(L.create(r,34962,!1,!0)),y.type=0;else{var h=L.getBuffer(r);if(h)y.state=1,y.buffer=h,y.type=0;else if(a.command("object"===typeof r&&r,"invalid data for attribute "+b,f.commandStr),r.constant){var U=r.constant;y.buffer="null";y.state=2;"number"===typeof U?y.x=U:(a.command(n(U)&&0<U.length&&4>=U.length,"invalid constant for attribute "+
b,f.commandStr),O.forEach(function(c,a){a<U.length&&(y[c]=U[a])}))}else{h=e(r.buffer)?L.getBuffer(L.create(r.buffer,34962,!1,!0)):L.getBuffer(r.buffer);a.command(!!h,'missing buffer for attribute "'+b+'"',f.commandStr);var k=r.offset|0;a.command(0<=k,'invalid offset for attribute "'+b+'"',f.commandStr);var m=r.stride|0;a.command(0<=m&&256>m,'invalid stride for attribute "'+b+'", must be integer betweeen [0, 255]',f.commandStr);var t=r.size|0;a.command(!("size"in r)||0<t&&4>=t,'invalid size for attribute "'+
b+'", must be 1,2,3,4',f.commandStr);var D=!!r.normalized,M=0;"type"in r&&(a.commandParameter(r.type,K,"invalid type for attribute "+b,f.commandStr),M=K[r.type]);var l=r.divisor|0;"divisor"in r&&(a.command(0===l||c,'cannot specify divisor for attribute "'+b+'", instancing not supported',f.commandStr),a.command(0<=l,'invalid divisor for attribute "'+b+'"',f.commandStr));a.optional(function(){var c=f.commandStr,e="buffer offset divisor normalized type size stride".split(" ");Object.keys(r).forEach(function(f){a.command(0<=
e.indexOf(f),'unknown parameter "'+f+'" for attribute pointer "'+b+'" (valid parameters are '+e+")",c)})});y.buffer=h;y.state=1;y.size=t;y.normalized=D;y.type=M||h.dtype;y.offset=k;y.stride=m;y.divisor=l}}d[b]=g(function(c,a){var b=c.attribCache;if(v in b)return b[v];var f={isStream:!1};Object.keys(y).forEach(function(c){f[c]=y[c]});y.buffer&&(f.buffer=c.link(y.buffer),f.type=f.type||f.buffer+".dtype");return b[v]=f})});Object.keys(v).forEach(function(c){var b=v[c];d[c]=h(b,function(f,r){function e(c){r(d[c],
"=",A,".",c,"|0;")}var A=f.invoke(r,b),g=f.shared,w=g.isBufferArgs,v=g.buffer;a.optional(function(){f.assert(r,A+"&&(typeof "+A+'==="object"||typeof '+A+'==="function")&&('+w+"("+A+")||"+v+".getBuffer("+A+")||"+v+".getBuffer("+A+".buffer)||"+w+"("+A+'.buffer)||("constant" in '+A+"&&(typeof "+A+'.constant==="number"||'+g.isArrayLike+"("+A+".constant))))",'invalid dynamic attribute "'+c+'"')});var d={isStream:r.def(!1)},h=new ra;h.state=1;Object.keys(h).forEach(function(c){d[c]=r.def(""+h[c])});var n=
d.buffer,k=d.type;r("if(",w,"(",A,")){",d.isStream,"=true;",n,"=",v,".createStream(",34962,",",A,");",k,"=",n,".dtype;","}else{",n,"=",v,".getBuffer(",A,");","if(",n,"){",k,"=",n,".dtype;",'}else if("constant" in ',A,"){",d.state,"=",2,";","if(typeof "+A+'.constant === "number"){',d[O[0]],"=",A,".constant;",O.slice(1).map(function(c){return d[c]}).join("="),"=0;","}else{",O.map(function(c,a){return d[c]+"="+A+".constant.length>="+a+"?"+A+".constant["+a+"]:0;"}).join(""),"}}else{","if(",w,"(",A,".buffer)){",
n,"=",v,".createStream(",34962,",",A,".buffer);","}else{",n,"=",v,".getBuffer(",A,".buffer);","}",k,'="type" in ',A,"?",g.glTypes,"[",A,".type]:",n,".dtype;",d.normalized,"=!!",A,".normalized;");e("size");e("offset");e("stride");e("divisor");r("}}");r.exit("if(",d.isStream,"){",v,".destroyStream(",n,");","}");return d})});return d}function xa(c){var a=c["static"],b=c.dynamic,f={};Object.keys(a).forEach(function(c){var b=a[c];f[c]=g(function(c,a){return"number"===typeof b||"boolean"===typeof b?""+
b:c.link(b)})});Object.keys(b).forEach(function(c){var a=b[c];f[c]=h(a,function(c,b){return c.invoke(b,a)})});return f}function X(c,b,f,e,g){function w(c){var a=n[c];a&&(m[c]=a)}var v=c["static"],d=c.dynamic;a.optional(function(){function c(f){Object.keys(f).forEach(function(c){a.command(0<=b.indexOf(c),'unknown parameter "'+c+'"',g.commandStr)})}var b="framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(Ia);c(v);c(d)});var h=wa(c,g),n=fa(c,h,g),k=la(c,g),m=
ma(c,g),t=ka(c,g);w("viewport");w(ea("scissor.box"));var D=0<Object.keys(m).length,h={framebuffer:h,draw:k,shader:t,state:m,dirty:D};h.profile=sa(c,g);h.uniforms=na(f,g);h.attributes=qa(b,g);h.context=xa(e,g);return h}function R(c,a,b){var f=c.shared.context,e=c.scope();Object.keys(b).forEach(function(g){a.save(f,"."+g);e(f,".",g,"=",b[g].append(c,a),";")});a(e)}function ia(c,a,b,f){var e=c.shared,g=e.gl,w=e.framebuffer,d;v&&(d=a.def(e.extensions,".webgl_draw_buffers"));var h=c.constants,e=h.drawBuffer,
h=h.backBuffer;c=b?b.append(c,a):a.def(w,".next");f||a("if(",c,"!==",w,".cur){");a("if(",c,"){",g,".bindFramebuffer(",36160,",",c,".framebuffer);");v&&a(d,".drawBuffersWEBGL(",e,"[",c,".colorAttachments.length]);");a("}else{",g,".bindFramebuffer(",36160,",null);");v&&a(d,".drawBuffersWEBGL(",h,");");a("}",w,".cur=",c,";");f||a("}")}function oa(c,a,b){var f=c.shared,e=f.gl,g=c.current,v=c.next,d=f.current,h=f.next,n=c.cond(d,".dirty");Ia.forEach(function(a){a=ea(a);if(!(a in b.state)){var f,A;if(a in
v){f=v[a];A=g[a];var k=C(w[a].length,function(c){return n.def(f,"[",c,"]")});n(c.cond(k.map(function(c,a){return c+"!=="+A+"["+a+"]"}).join("||")).then(e,".",Aa[a],"(",k,");",k.map(function(c,a){return A+"["+a+"]="+c}).join(";"),";"))}else f=n.def(h,".",a),k=c.cond(f,"!==",d,".",a),n(k),a in za?k(c.cond(f).then(e,".enable(",za[a],");")["else"](e,".disable(",za[a],");"),d,".",a,"=",f,";"):k(e,".",Aa[a],"(",f,");",d,".",a,"=",f,";")}});0===Object.keys(b.state).length&&n(d,".dirty=false;");a(n)}function S(c,
a,b,f){var e=c.shared,g=c.current,w=e.current,d=e.gl;l(Object.keys(b)).forEach(function(e){var v=b[e];if(!f||f(v)){var h=v.append(c,a);if(za[e]){var k=za[e];m(v)?h?a(d,".enable(",k,");"):a(d,".disable(",k,");"):a(c.cond(h).then(d,".enable(",k,");")["else"](d,".disable(",k,");"));a(w,".",e,"=",h,";")}else if(n(h)){var t=g[e];a(d,".",Aa[e],"(",h,");",h.map(function(c,a){return t+"["+a+"]="+c}).join(";"),";")}else a(d,".",Aa[e],"(",h,");",w,".",e,"=",h,";")}})}function ca(a,b){c&&(a.instancing=b.def(a.shared.extensions,
".angle_instanced_arrays"))}function ha(c,a,b,f,e){function g(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function w(c){D=a.def();c(D,"=",g(),";");"string"===typeof e?c(n,".count+=",e,";"):c(n,".count++;");pa&&(f?(u=a.def(),c(u,"=",t,".getNumPendingQueries();")):c(t,".beginQuery(",n,");"))}function d(c){c(n,".cpuTime+=",g(),"-",D,";");pa&&(f?c(t,".pushScopeStats(",u,",",t,".getNumPendingQueries(),",n,");"):c(t,".endQuery();"))}function v(c){var b=a.def(k,".profile");
a(k,".profile=",c,";");a.exit(k,".profile=",b,";")}var h=c.shared,n=c.stats,k=h.current,t=h.timer;b=b.profile;var D,u;if(b){if(m(b)){b.enable?(w(a),d(a.exit),v("true")):v("false");return}b=b.append(c,a);v(b)}else b=a.def(k,".profile");h=c.block();w(h);a("if(",b,"){",h,"}");c=c.block();d(c);a.exit("if(",b,"){",c,"}")}function ya(b,f,e,g,w){function d(c){switch(c){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}
function v(a,e,g){function w(){f("if(!",m,".buffer){",n,".enableVertexAttribArray(",k,");}");var a=g.type,d;d=g.size?f.def(g.size,"||",e):e;f("if(",m,".type!==",a,"||",m,".size!==",d,"||",u.map(function(c){return m+"."+c+"!=="+g[c]}).join("||"),"){",n,".bindBuffer(",34962,",",t,".buffer);",n,".vertexAttribPointer(",[k,d,a,g.normalized,g.stride,g.offset],");",m,".type=",a,";",m,".size=",d,";",u.map(function(c){return m+"."+c+"="+g[c]+";"}).join(""),"}");c&&(a=g.divisor,f("if(",m,".divisor!==",a,"){",
b.instancing,".vertexAttribDivisorANGLE(",[k,a],");",m,".divisor=",a,";}"))}function d(){f("if(",m,".buffer){",n,".disableVertexAttribArray(",k,");","}if(",O.map(function(c,a){return m+"."+c+"!=="+D[a]}).join("||"),"){",n,".vertexAttrib4f(",k,",",D,");",O.map(function(c,a){return m+"."+c+"="+D[a]+";"}).join(""),"}")}var n=h.gl,k=f.def(a,".location"),m=f.def(h.attributes,"[",k,"]");a=g.state;var t=g.buffer,D=[g.x,g.y,g.z,g.w],u=["buffer","normalized","offset","stride"];1===a?w():2===a?d():(f("if(",
a,"===",1,"){"),w(),f("}else{"),d(),f("}"))}var h=b.shared;g.forEach(function(c){var g=c.name,h=e.attributes[g],n;if(h){if(!w(h))return;n=h.append(b,f)}else{if(!w(D))return;var k=b.scopeAttrib(g);a.optional(function(){b.assert(f,k+".state","missing attribute "+g)});n={};Object.keys(new ra).forEach(function(c){n[c]=f.def(k,".",c)})}v(b.link(c),d(c.info.type),n)})}function ja(c,b,f,e,g){for(var w=c.shared,d=w.gl,v,h=0;h<e.length;++h){var k=e[h],t=k.name,M=k.info.type,l=f.uniforms[t],k=c.link(k)+".location",
p;if(l){if(!g(l))continue;if(m(l)){var x=l.value;a.command(null!==x&&"undefined"!==typeof x,'missing uniform "'+t+'"',c.commandStr);if(35678===M||35680===M)a.command("function"===typeof x&&(35678===M&&("texture2d"===x._reglType||"framebuffer"===x._reglType)||35680===M&&("textureCube"===x._reglType||"framebufferCube"===x._reglType)),"invalid texture for uniform "+t,c.commandStr),l=c.link(x._texture||x.color[0]._texture),b(d,".uniform1i(",k,",",l+".bind());"),b.exit(l,".unbind();");else if(35674===
M||35675===M||35676===M){a.optional(function(){a.command(n(x),"invalid matrix for uniform "+t,c.commandStr);a.command(35674===M&&4===x.length||35675===M&&9===x.length||35676===M&&16===x.length,"invalid length for matrix uniform "+t,c.commandStr)});var l=c.global.def("new Float32Array(["+Array.prototype.slice.call(x)+"])"),z=2;35675===M?z=3:35676===M&&(z=4);b(d,".uniformMatrix",z,"fv(",k,",false,",l,");")}else{switch(M){case 5126:a.commandType(x,"number","uniform "+t,c.commandStr);v="1f";break;case 35664:a.command(n(x)&&
2===x.length,"uniform "+t,c.commandStr);v="2f";break;case 35665:a.command(n(x)&&3===x.length,"uniform "+t,c.commandStr);v="3f";break;case 35666:a.command(n(x)&&4===x.length,"uniform "+t,c.commandStr);v="4f";break;case 35670:a.commandType(x,"boolean","uniform "+t,c.commandStr);v="1i";break;case 5124:a.commandType(x,"number","uniform "+t,c.commandStr);v="1i";break;case 35671:a.command(n(x)&&2===x.length,"uniform "+t,c.commandStr);v="2i";break;case 35667:a.command(n(x)&&2===x.length,"uniform "+t,c.commandStr);
v="2i";break;case 35672:a.command(n(x)&&3===x.length,"uniform "+t,c.commandStr);v="3i";break;case 35668:a.command(n(x)&&3===x.length,"uniform "+t,c.commandStr);v="3i";break;case 35673:a.command(n(x)&&4===x.length,"uniform "+t,c.commandStr);v="4i";break;case 35669:a.command(n(x)&&4===x.length,"uniform "+t,c.commandStr),v="4i"}b(d,".uniform",v,"(",k,",",n(x)?Array.prototype.slice.call(x):x,");")}continue}else p=l.append(c,b)}else{if(!g(D))continue;p=b.def(w.uniforms,"[",u.id(t),"]")}35678===M?b("if(",
p,"&&",p,'._reglType==="framebuffer"){',p,"=",p,".color[0];","}"):35680===M&&b("if(",p,"&&",p,'._reglType==="framebufferCube"){',p,"=",p,".color[0];","}");a.optional(function(){function a(f,e){c.assert(b,f,'bad data or missing for uniform "'+t+'".  '+e)}function f(c){a("typeof "+p+'==="'+c+'"',"invalid type, expected "+c)}function e(b,f){a(w.isArrayLike+"("+p+")&&"+p+".length==="+b,"invalid vector, should have length "+b,c.commandStr)}function g(b){a("typeof "+p+'==="function"&&'+p+'._reglType==="texture'+
(3553===b?"2d":"Cube")+'"',"invalid texture type",c.commandStr)}switch(M){case 5124:f("number");break;case 35667:e(2,"number");break;case 35668:e(3,"number");break;case 35669:e(4,"number");break;case 5126:f("number");break;case 35664:e(2,"number");break;case 35665:e(3,"number");break;case 35666:e(4,"number");break;case 35670:f("boolean");break;case 35671:e(2,"boolean");break;case 35672:e(3,"boolean");break;case 35673:e(4,"boolean");break;case 35674:e(4,"number");break;case 35675:e(9,"number");break;
case 35676:e(16,"number");break;case 35678:g(3553);break;case 35680:g(34067)}});l=1;switch(M){case 35678:case 35680:l=b.def(p,"._texture");b(d,".uniform1i(",k,",",l,".bind());");b.exit(l,".unbind();");continue;case 5124:case 35670:v="1i";break;case 35667:case 35671:v="2i";l=2;break;case 35668:case 35672:v="3i";l=3;break;case 35669:case 35673:v="4i";l=4;break;case 5126:v="1f";break;case 35664:v="2f";l=2;break;case 35665:v="3f";l=3;break;case 35666:v="4f";l=4;break;case 35674:v="Matrix2fv";break;case 35675:v=
"Matrix3fv";break;case 35676:v="Matrix4fv"}b(d,".uniform",v,"(",k,",");if("M"===v.charAt(0)){var k=Math.pow(M-35674+2,2),da=c.global.def("new Float32Array(",k,")");b("false,(Array.isArray(",p,")||",p," instanceof Float32Array)?",p,":(",C(k,function(c){return da+"["+c+"]="+p+"["+c+"]"}),",",da,")")}else 1<l?b(C(l,function(c){return p+"["+c+"]"})):b(p);b(");")}}function ta(b,f,e,g){function w(c){var a=t[c];return a?a.contextDep&&g.contextDynamic||a.propDep?a.append(b,e):a.append(b,f):f.def(n,".",c)}
function v(){function c(){e(u,".drawElementsInstancedANGLE(",[l,M,z,D+"<<(("+z+"-5121)>>1)",p],");")}function a(){e(u,".drawArraysInstancedANGLE(",[l,D,M,p],");")}x?da?c():(e("if(",x,"){"),c(),e("}else{"),a(),e("}")):a()}function d(){function c(){e(k+".drawElements("+[l,M,z,D+"<<(("+z+"-5121)>>1)"]+");")}function a(){e(k+".drawArrays("+[l,D,M]+");")}x?da?c():(e("if(",x,"){"),c(),e("}else{"),a(),e("}")):a()}var h=b.shared,k=h.gl,n=h.draw,t=g.draw,x=function(){var c=t.elements,a=f;if(c){if(c.contextDep&&
g.contextDynamic||c.propDep)a=e;c=c.append(b,a)}else c=a.def(n,".","elements");c&&a("if("+c+")"+k+".bindBuffer(34963,"+c+".buffer.buffer);");return c}(),l=w("primitive"),D=w("offset"),M=function(){var c=t.count,w,v=f;if(c){if(c.contextDep&&g.contextDynamic||c.propDep)v=e;w=c.append(b,v);a.optional(function(){c.MISSING&&b.assert(f,"false","missing vertex count");c.DYNAMIC&&b.assert(v,w+">=0","missing vertex count")})}else w=v.def(n,".","count"),a.optional(function(){b.assert(v,w+">=0","missing vertex count")});
return w}();if("number"===typeof M){if(0===M)return}else e("if(",M,"){"),e.exit("}");var p,u;c&&(p=w("instances"),u=b.instancing);var z=x+".type",da=t.elements&&m(t.elements);c&&("number"!==typeof p||0<=p)?"string"===typeof p?(e("if(",p,">0){"),v(),e("}else if(",p,"<0){"),d(),e("}")):v():d()}function Ea(b,f,e,g,w){var v=Ba();w=v.proc("body",w);a.optional(function(){v.commandStr=f.commandStr;v.command=v.link(f.commandStr)});c&&(v.instancing=w.def(v.shared.extensions,".angle_instanced_arrays"));b(v,
w,e,g);return v.compile().body}function Ha(c,a,b,f){ca(c,a);ya(c,a,b,f.attributes,function(){return!0});ja(c,a,b,f.uniforms,function(){return!0});ta(c,a,a,b)}function Ka(c,a){var b=c.proc("draw",1);ca(c,b);R(c,b,a.context);ia(c,b,a.framebuffer);oa(c,b,a);S(c,b,a.state);ha(c,b,a,!1,!0);var f=a.shader.progVar.append(c,b);b(c.shared.gl,".useProgram(",f,".program);");if(a.shader.program)Ha(c,b,a,a.shader.program);else{var e=c.global.def("{}"),g=b.def(f,".id"),w=b.def(e,"[",g,"]");b(c.cond(w).then(w,".call(this,a0);")["else"](w,
"=",e,"[",g,"]=",c.link(function(b){return Ea(Ha,c,a,b,1)}),"(",f,");",w,".call(this,a0);"))}0<Object.keys(a.state).length&&b(c.shared.current,".dirty=true;")}function Fa(c,a,b,f){function e(){return!0}c.batchId="a1";ca(c,a);ya(c,a,b,f.attributes,e);ja(c,a,b,f.uniforms,e);ta(c,a,a,b)}function La(c,a,b,f){function e(c){return c.contextDep&&w||c.propDep}function g(c){return!e(c)}ca(c,a);var w=b.contextDep,v=a.def(),d=a.def();c.shared.props=d;c.batchId=v;var h=c.scope(),k=c.scope();a(h.entry,"for(",
v,"=0;",v,"<","a1",";++",v,"){",d,"=","a0","[",v,"];",k,"}",h.exit);b.needsContext&&R(c,k,b.context);b.needsFramebuffer&&ia(c,k,b.framebuffer);S(c,k,b.state,e);b.profile&&e(b.profile)&&ha(c,k,b,!1,!0);f?(ya(c,h,b,f.attributes,g),ya(c,k,b,f.attributes,e),ja(c,h,b,f.uniforms,g),ja(c,k,b,f.uniforms,e),ta(c,h,k,b)):(a=c.global.def("{}"),f=b.shader.progVar.append(c,k),d=k.def(f,".id"),h=k.def(a,"[",d,"]"),k(c.shared.gl,".useProgram(",f,".program);","if(!",h,"){",h,"=",a,"[",d,"]=",c.link(function(a){return Ea(Fa,
c,b,a,2)}),"(",f,");}",h,".call(this,a0[",v,"],",v,");"))}function Ma(c,a){function b(c){return c.contextDep&&e||c.propDep}var f=c.proc("batch",2);c.batchId="0";ca(c,f);var e=!1,g=!0;Object.keys(a.context).forEach(function(c){e=e||a.context[c].propDep});e||(R(c,f,a.context),g=!1);var w=a.framebuffer,v=!1;w?(w.propDep?e=v=!0:w.contextDep&&e&&(v=!0),v||ia(c,f,w)):ia(c,f,null);a.state.viewport&&a.state.viewport.propDep&&(e=!0);oa(c,f,a);S(c,f,a.state,function(c){return!b(c)});a.profile&&b(a.profile)||
ha(c,f,a,!1,"a1");a.contextDep=e;a.needsContext=g;a.needsFramebuffer=v;g=a.shader.progVar;if(g.contextDep&&e||g.propDep)La(c,f,a,null);else if(g=g.append(c,f),f(c.shared.gl,".useProgram(",g,".program);"),a.shader.program)La(c,f,a,a.shader.program);else{var w=c.global.def("{}"),v=f.def(g,".id"),d=f.def(w,"[",v,"]");f(c.cond(d).then(d,".call(this,a0,a1);")["else"](d,"=",w,"[",v,"]=",c.link(function(b){return Ea(La,c,a,b,2)}),"(",g,");",d,".call(this,a0,a1);"))}0<Object.keys(a.state).length&&f(c.shared.current,
".dirty=true;")}function Na(c,a){function b(g){var w=a.shader[g];w&&f.set(e.shader,"."+g,w.append(c,f))}var f=c.proc("scope",3);c.batchId="a2";var e=c.shared,g=e.current;R(c,f,a.context);a.framebuffer&&a.framebuffer.append(c,f);l(Object.keys(a.state)).forEach(function(b){var g=a.state[b].append(c,f);n(g)?g.forEach(function(a,e){f.set(c.next[b],"["+e+"]",a)}):f.set(e.next,"."+b,g)});ha(c,f,a,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var g=a.draw[b];g&&f.set(e.draw,
"."+b,""+g.append(c,f))});Object.keys(a.uniforms).forEach(function(b){f.set(e.uniforms,"["+u.id(b)+"]",a.uniforms[b].append(c,f))});Object.keys(a.attributes).forEach(function(b){var e=a.attributes[b].append(c,f),g=c.scopeAttrib(b);Object.keys(new ra).forEach(function(c){f.set(g,"."+c,e[c])})});b("vert");b("frag");0<Object.keys(a.state).length&&(f(g,".dirty=true;"),f.exit(g,".dirty=true;"));f("a1(",c.shared.context,",a0,",c.batchId,");")}function Pa(c){if("object"===typeof c&&!n(c)){for(var a=Object.keys(c),
b=0;b<a.length;++b)if(H.isDynamic(c[a[b]]))return!0;return!1}}function ua(c,a,b){function f(c,a){w.forEach(function(b){var f=e[b];H.isDynamic(f)&&(f=c.invoke(a,f),a(n,".",b,"=",f,";"))})}var e=a["static"][b];if(e&&Pa(e)){var g=c.global,w=Object.keys(e),v=!1,d=!1,k=!1,n=c.global.def("{}");w.forEach(function(a){var b=e[a];if(H.isDynamic(b))"function"===typeof b&&(b=e[a]=H.unbox(b)),a=h(b,null),v=v||a.thisDep,k=k||a.propDep,d=d||a.contextDep;else{g(n,".",a,"=");switch(typeof b){case "number":g(b);break;
case "string":g('"',b,'"');break;case "object":Array.isArray(b)&&g("[",b.join(),"]");break;default:g(c.link(b))}g(";")}});a.dynamic[b]=new H.DynamicVariable(4,{thisDep:v,contextDep:d,propDep:k,ref:n,append:f});delete a["static"][b]}}var ra=x.Record,ga={add:32774,subtract:32778,"reverse subtract":32779};E.ext_blend_minmax&&(ga.min=32775,ga.max=32776);var c=E.angle_instanced_arrays,v=E.webgl_draw_buffers,w={dirty:!0,profile:va.profile},M={},Ia=[],za={},Aa={};T("dither",3024);T("blend.enable",3042);
N("blend.color","blendColor",[0,0,0,0]);N("blend.equation","blendEquationSeparate",[32774,32774]);N("blend.func","blendFuncSeparate",[1,0,1,0]);T("depth.enable",2929,!0);N("depth.func","depthFunc",513);N("depth.range","depthRange",[0,1]);N("depth.mask","depthMask",!0);N("colorMask","colorMask",[!0,!0,!0,!0]);T("cull.enable",2884);N("cull.face","cullFace",1029);N("frontFace","frontFace",2305);N("lineWidth","lineWidth",1);T("polygonOffset.enable",32823);N("polygonOffset.offset","polygonOffset",[0,0]);
T("sample.alpha",32926);T("sample.enable",32928);N("sample.coverage","sampleCoverage",[1,!1]);T("stencil.enable",2960);N("stencil.mask","stencilMask",-1);N("stencil.func","stencilFunc",[519,0,-1]);N("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);N("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);T("scissor.enable",3089);N("scissor.box","scissor",[0,0,d.drawingBufferWidth,d.drawingBufferHeight]);N("viewport","viewport",[0,0,d.drawingBufferWidth,d.drawingBufferHeight]);var Oa=
{gl:d,context:da,strings:u,next:M,current:w,draw:Da,elements:W,buffer:L,shader:I,attributes:x.state,uniforms:aa,framebuffer:B,extensions:E,timer:pa,isBufferArgs:e},Ja={primTypes:F,compareFuncs:Y,blendFuncs:t,blendEquations:ga,stencilOps:G,glTypes:K,orientationType:f};a.optional(function(){Oa.isArrayLike=n});v&&(Ja.backBuffer=[1029],Ja.drawBuffer=C(q.maxDrawbuffers,function(c){return 0===c?[0]:C(c,function(c){return 36064+c})}));var Qa=0;return{next:M,current:w,procs:function(){var c=Ba(),a=c.proc("poll"),
b=c.proc("refresh"),f=c.block();a(f);b(f);var e=c.shared,g=e.gl,v=e.next,h=e.current;f(h,".dirty=false;");ia(c,a);ia(c,b,null,!0);var k=d.getExtension("angle_instanced_arrays"),t;k&&(t=c.link(k));for(var m=0;m<q.maxAttributes;++m){var x=b.def(e.attributes,"[",m,"]"),l=c.cond(x,".buffer");l.then(g,".enableVertexAttribArray(",m,");",g,".bindBuffer(",34962,",",x,".buffer.buffer);",g,".vertexAttribPointer(",m,",",x,".size,",x,".type,",x,".normalized,",x,".stride,",x,".offset);")["else"](g,".disableVertexAttribArray(",
m,");",g,".vertexAttrib4f(",m,",",x,".x,",x,".y,",x,".z,",x,".w);",x,".buffer=null;");b(l);k&&b(t,".vertexAttribDivisorANGLE(",m,",",x,".divisor);")}Object.keys(za).forEach(function(e){var w=za[e],d=f.def(v,".",e),k=c.block();k("if(",d,"){",g,".enable(",w,")}else{",g,".disable(",w,")}",h,".",e,"=",d,";");b(k);a("if(",d,"!==",h,".",e,"){",k,"}")});Object.keys(Aa).forEach(function(e){var d=Aa[e],k=w[e],t,m,x=c.block();x(g,".",d,"(");n(k)?(d=k.length,t=c.global.def(v,".",e),m=c.global.def(h,".",e),x(C(d,
function(c){return t+"["+c+"]"}),");",C(d,function(c){return m+"["+c+"]="+t+"["+c+"];"}).join("")),a("if(",C(d,function(c){return t+"["+c+"]!=="+m+"["+c+"]"}).join("||"),"){",x,"}")):(t=f.def(v,".",e),m=f.def(h,".",e),x(t,");",h,".",e,"=",t,";"),a("if(",t,"!==",m,"){",x,"}"));b(x)});return c.compile()}(),compile:function(c,a,b,f,e){var g=Ba();g.stats=g.link(e);Object.keys(a["static"]).forEach(function(c){ua(g,a,c)});z.forEach(function(a){ua(g,c,a)});b=X(c,a,b,f,g);Ka(g,b);Na(g,b);Ma(g,b);return g.compile()}}}},
{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/check":21,"./util/codegen":23,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/loop":29}],9:[function(d,q,B){function e(e,d){this.id=m++;this.type=e;this.data=d}function l(e){if(0===e.length)return[];var d=e.charAt(0),a=e.charAt(e.length-1);if(1<e.length&&d===a&&('"'===d||"'"===d))return['"'+e.substr(1,e.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(d=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e))return l(e.substr(0,
d.index)).concat(l(d[1])).concat(l(e.substr(d.index+d[0].length)));d=e.split(".");if(1===d.length)return['"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];e=[];for(a=0;a<d.length;++a)e=e.concat(l(d[a]));return e}function k(e){return"["+l(e).join("][")+"]"}var m=0;q.exports={DynamicVariable:e,define:function(g,d){return new e(g,k(d+""))},isDynamic:function(g){return"function"===typeof g&&!g._reglType||g instanceof e},unbox:function(g,d){return"function"===typeof g?new e(0,g):g},accessor:k}},{}],
10:[function(d,q,B){var e=d("./util/check"),l=d("./util/is-typed-array"),k=d("./util/is-ndarray"),m=d("./util/values"),g=d("./constants/primitives.json"),h=d("./constants/usage.json");q.exports=function(a,d,C,q){function u(a){this.id=K++;F[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function n(g,h,n,m,b,f,D){g.buffer.bind();if(h){var u=D;D||l(h)&&(!k(h)||l(h.data))||(u=d.oes_element_index_uint?5125:5123);C._initBuffer(g.buffer,h,n,u,3)}else a.bufferData(34963,f,n),g.buffer.dtype=
u||5121,g.buffer.usage=n,g.buffer.dimension=3,g.buffer.byteLength=f;u=D;if(!D){switch(g.buffer.dtype){case 5121:case 5120:u=5121;break;case 5123:case 5122:u=5123;break;case 5125:case 5124:u=5125;break;default:e.raise("unsupported type for element array")}g.buffer.dtype=u}g.type=u;e(5125!==u||!!d.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");h=b;0>h&&(h=g.buffer.byteLength,5123===u?h>>=1:5125===u&&(h>>=2));g.vertCount=h;h=m;0>m&&(h=4,m=g.buffer.dimension,
1===m&&(h=0),2===m&&(h=1),3===m&&(h=4));g.primType=h}function H(a){q.elementsCount--;e(null!==a.buffer,"must not double destroy elements");delete F[a.id];a.buffer.destroy();a.buffer=null}var F={},K=0,O={uint8:5121,uint16:5123};d.oes_element_index_uint&&(O.uint32=5125);u.prototype.bind=function(){this.buffer.bind()};var z=[];return{create:function(a,d){function m(a){if(a)if("number"===typeof a)p(a),b.primType=4,b.vertCount=a|0,b.type=5121;else{var d=null,t=35044,u=-1,z=-1,C=0,q=0;if(Array.isArray(a)||
l(a)||k(a))d=a;else if(e.type(a,"object","invalid arguments for elements"),"data"in a&&(d=a.data,e(Array.isArray(d)||l(d)||k(d),"invalid data for element buffer")),"usage"in a&&(e.parameter(a.usage,h,"invalid element buffer usage"),t=h[a.usage]),"primitive"in a&&(e.parameter(a.primitive,g,"invalid element buffer primitive"),u=g[a.primitive]),"count"in a&&(e("number"===typeof a.count&&0<=a.count,"invalid vertex count for elements"),z=a.count|0),"type"in a&&(e.parameter(a.type,O,"invalid buffer type"),
q=O[a.type]),"length"in a)C=a.length|0;else if(C=z,5123===q||5122===q)C*=2;else if(5125===q||5124===q)C*=4;n(b,d,t,u,z,C,q)}else p(),b.primType=4,b.vertCount=0,b.type=5121;return m}var p=C.create(null,34963,!0),b=new u(p._buffer);q.elementsCount++;m(a);m._reglType="elements";m._elements=b;m.subdata=function(a,b){p.subdata(a,b);return m};m.destroy=function(){H(b)};return m},createStream:function(a){var e=z.pop();e||(e=new u(C.create(null,34963,!0,!1)._buffer));n(e,a,35040,-1,-1,0,0);return e},destroyStream:function(a){z.push(a)},
getElements:function(a){return"function"===typeof a&&a._elements instanceof u?a._elements:null},clear:function(){m(F).forEach(H)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/check":21,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/values":33}],11:[function(d,q,B){var e=d("./util/check");q.exports=function(d,k){function m(a){e.type(a,"string","extension name must be string");a=a.toLowerCase();var h;try{h=g[a]=d.getExtension(a)}catch(k){}return!!h}for(var g={},
h=0;h<k.extensions.length;++h){var a=k.extensions[h];if(!m(a))return k.onDestroy(),k.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}k.optionalExtensions.forEach(m);return{extensions:g,restore:function(){Object.keys(g).forEach(function(a){if(!m(a))throw Error("(regl): error restoring extension "+a);})}}}},{"./util/check":21}],12:[function(d,q,B){var e=d("./util/check"),l=d("./util/values"),k=d("./util/extend"),m=[6408],
g=[];g[6408]=4;var h=[];h[5121]=1;h[5126]=4;h[36193]=2;var a=[32854,32855,36194,35907,34842,34843,34836],p={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"};q.exports=function(d,q,u,n,H,F){function K(a,b,f){this.target=a;this.texture=b;this.renderbuffer=f;var e=a=0;b?(a=b.width,e=b.height):f&&(a=f.width,e=f.height);this.width=a;this.height=e}function O(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&
a.renderbuffer._renderbuffer.decRef())}function z(a,b,f){if(a){if(a.texture){a=a.texture._texture;var g=Math.max(1,a.height);e(Math.max(1,a.width)===b&&g===f,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,e(a.width===b&&a.height===f,"inconsistent width/height for renderbuffer");a.refCount+=1}}function t(a,b){b&&(b.texture?d.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,0):d.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer))}
function Q(a){var b=3553,f=null,g=null,d=a;"object"===typeof a&&(d=a.data,"target"in a&&(b=a.target|0));e.type(d,"function","invalid attachment data");a=d._reglType;"texture2d"===a?(f=d,e(3553===b)):"textureCube"===a?(f=d,e(34069<=b&&34075>b,"invalid cube map target")):"renderbuffer"===a?(g=d,b=36161):e.raise("invalid regl object for attachment");return new K(b,f,g)}function Y(a,b,f,e,g){if(f)return a=n.create2D({width:a,height:b,format:e,type:g}),a._texture.refCount=0,new K(3553,a,null);a=H.create({width:a,
height:b,format:e});a._renderbuffer.refCount=0;return new K(36161,null,a)}function G(a){return a&&(a.texture||a.renderbuffer)}function b(a,b,f){a&&(a.texture?a.texture.resize(b,f):a.renderbuffer&&a.renderbuffer.resize(b,f))}function f(){this.id=ba++;aa[this.id]=this;this.framebuffer=d.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function D(a){a.colorAttachments.forEach(O);O(a.depthAttachment);O(a.stencilAttachment);
O(a.depthStencilAttachment)}function V(a){var b=a.framebuffer;e(b,"must not double destroy framebuffer");d.deleteFramebuffer(b);a.framebuffer=null;F.framebufferCount--;delete aa[a.id]}function Ga(a){var b;d.bindFramebuffer(36160,a.framebuffer);var f=a.colorAttachments;for(b=0;b<f.length;++b)t(36064+b,f[b]);for(b=f.length;b<u.maxColorAttachments;++b)d.framebufferTexture2D(36160,36064+b,3553,null,0);d.framebufferTexture2D(36160,33306,3553,null,0);d.framebufferTexture2D(36160,36096,3553,null,0);d.framebufferTexture2D(36160,
36128,3553,null,0);t(36096,a.depthAttachment);t(36128,a.stencilAttachment);t(33306,a.depthStencilAttachment);a=d.checkFramebufferStatus(36160);36053!==a&&e.raise("framebuffer configuration not supported, status = "+p[a]);d.bindFramebuffer(36160,Z.next);Z.cur=Z.next;d.getError()}function B(d,n){function t(b,f){var d;e(Z.next!==l,"can not update framebuffer which is currently in use");var k=q.webgl_draw_buffers,n=0,p=0,x=!0,C=!0;d=null;var K=!0,H="rgba",V="uint8",F=1,O=null,I=null,B=null,Ca=!1;if("number"===
typeof b)n=b|0,p=f|0||n;else if(b){e.type(b,"object","invalid arguments for framebuffer");"shape"in b?(p=b.shape,e(Array.isArray(p)&&2<=p.length,"invalid shape for framebuffer"),n=p[0],p=p[1]):("radius"in b&&(n=p=b.radius),"width"in b&&(n=b.width),"height"in b&&(p=b.height));if("color"in b||"colors"in b)d=b.color||b.colors,Array.isArray(d)&&e(1===d.length||k,"multiple render targets not supported");if(!d){"colorCount"in b&&(F=b.colorCount|0,e(0<F,"invalid color buffer count"));"colorTexture"in b&&
(K=!!b.colorTexture,H="rgba4");if("colorType"in b){V=b.colorType;if(K)e(q.oes_texture_float||!("float"===V||"float32"===V),"you must enable OES_texture_float in order to use floating point framebuffer objects"),e(q.oes_texture_half_float||!("half float"===V||"float16"===V),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===V||"float16"===V)e(q.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),
H="rgba16f";else if("float"===V||"float32"===V)e(q.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),H="rgba32f";e.oneOf(V,J,"invalid color type")}if("colorFormat"in b)if(H=b.colorFormat,0<=L.indexOf(H))K=!0;else if(0<=W.indexOf(H))K=!1;else if(K)e.oneOf(b.colorFormat,L,"invalid color format for texture");else e.oneOf(b.colorFormat,W,"invalid color format for renderbuffer")}if("depthTexture"in b||"depthStencilTexture"in b)Ca=!(!b.depthTexture&&
!b.depthStencilTexture),e(!Ca||q.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in b&&("boolean"===typeof b.depth?x=b.depth:(O=b.depth,C=!1));"stencil"in b&&("boolean"===typeof b.stencil?C=b.stencil:(I=b.stencil,x=!1));"depthStencil"in b&&("boolean"===typeof b.depthStencil?x=C=b.depthStencil:(B=b.depthStencil,C=x=!1))}else n=p=1;var R=k=null,aa=null,ba=null;if(Array.isArray(d))k=d.map(Q);else if(d)k=[Q(d)];else for(k=Array(F),d=0;d<F;++d)k[d]=Y(n,p,K,H,V);e(q.webgl_draw_buffers||
1>=k.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");e(k.length<=u.maxColorAttachments,"too many color attachments, not supported");n=n||k[0].width;p=p||k[0].height;O?R=Q(O):x&&!C&&(R=Y(n,p,Ca,"depth","uint32"));I?aa=Q(I):C&&!x&&(aa=Y(n,p,!1,"stencil","uint8"));B?ba=Q(B):!O&&!I&&C&&x&&(ba=Y(n,p,Ca,"depth stencil","depth stencil"));e(1>=!!O+!!I+!!B,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");x=null;for(d=
0;d<k.length;++d)z(k[d],n,p),e(!k[d]||k[d].texture&&0<=m.indexOf(k[d].texture._texture.format)||k[d].renderbuffer&&0<=a.indexOf(k[d].renderbuffer._renderbuffer.format),"framebuffer color attachment "+d+" is invalid"),k[d]&&k[d].texture&&(C=g[k[d].texture._texture.format]*h[k[d].texture._texture.type],null===x?x=C:e(x===C,"all color attachments much have the same number of bits per pixel."));z(R,n,p);e(!R||R.texture&&6402===R.texture._texture.format||R.renderbuffer&&33189===R.renderbuffer._renderbuffer.format,
"invalid depth attachment for framebuffer object");z(aa,n,p);e(!aa||aa.renderbuffer&&36168===aa.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");z(ba,n,p);e(!ba||ba.texture&&34041===ba.texture._texture.format||ba.renderbuffer&&34041===ba.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");D(l);l.width=n;l.height=p;l.colorAttachments=k;l.depthAttachment=R;l.stencilAttachment=aa;l.depthStencilAttachment=ba;t.color=k.map(G);
t.depth=G(R);t.stencil=G(aa);t.depthStencil=G(ba);t.width=l.width;t.height=l.height;Ga(l);return t}var l=new f;F.framebufferCount++;t(d,n);return k(t,{resize:function(a,f){e(Z.next!==l,"can not resize a framebuffer which is currently in use");var g=a|0,d=f|0||g;if(g===l.width&&d===l.height)return t;for(var k=l.colorAttachments,h=0;h<k.length;++h)b(k[h],g,d);b(l.depthAttachment,g,d);b(l.stencilAttachment,g,d);b(l.depthStencilAttachment,g,d);l.width=t.width=g;l.height=t.height=d;Ga(l);return t},_reglType:"framebuffer",
_framebuffer:l,destroy:function(){V(l);D(l)},bind:function(a){Z.setFBO({framebuffer:t},a)}})}var Z={cur:null,next:null,dirty:!1,setFBO:null},L=["rgba"],W=["rgba4","rgb565","rgb5 a1"];q.ext_srgb&&W.push("srgba");q.ext_color_buffer_half_float&&W.push("rgba16f","rgb16f");q.webgl_color_buffer_float&&W.push("rgba32f");var J=["uint8"];q.oes_texture_half_float&&J.push("half float","float16");q.oes_texture_float&&J.push("float","float32");var ba=0,aa={};return k(Z,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof f)?a:null},create:B,createCube:function(a){function b(a){var g;e(0>f.indexOf(Z.next),"can not update framebuffer which is currently in use");var d=q.webgl_draw_buffers,h={color:null},m=0,l=null;g="rgba";var t="uint8",p=1;if("number"===typeof a)m=a|0;else if(a){e.type(a,"object","invalid arguments for framebuffer");"shape"in a?(m=a.shape,e(Array.isArray(m)&&2<=m.length,"invalid shape for framebuffer"),e(m[0]===m[1],"cube framebuffer must be square"),
m=m[0]):("radius"in a&&(m=a.radius|0),"width"in a?(m=a.width|0,"height"in a&&e(a.height===m,"must be square")):"height"in a&&(m=a.height|0));if("color"in a||"colors"in a)l=a.color||a.colors,Array.isArray(l)&&e(1===l.length||d,"multiple render targets not supported");l||("colorCount"in a&&(p=a.colorCount|0,e(0<p,"invalid color buffer count")),"colorType"in a&&(e.oneOf(a.colorType,J,"invalid color type"),t=a.colorType),"colorFormat"in a&&(g=a.colorFormat,e.oneOf(a.colorFormat,L,"invalid color format for texture")));
"depth"in a&&(h.depth=a.depth);"stencil"in a&&(h.stencil=a.stencil);"depthStencil"in a&&(h.depthStencil=a.depthStencil)}else m=1;if(l)if(Array.isArray(l))for(a=[],g=0;g<l.length;++g)a[g]=l[g];else a=[l];else for(a=Array(p),l={radius:m,format:g,type:t},g=0;g<p;++g)a[g]=n.createCube(l);h.color=Array(a.length);for(g=0;g<a.length;++g)p=a[g],e("function"===typeof p&&"textureCube"===p._reglType,"invalid cube map"),m=m||p.width,e(p.width===m&&p.height===m,"invalid cube map shape"),h.color[g]={target:34069,
data:a[g]};for(g=0;6>g;++g){for(p=0;p<a.length;++p)h.color[p].target=34069+g;0<g&&(h.depth=f[0].depth,h.stencil=f[0].stencil,h.depthStencil=f[0].depthStencil);if(f[g])f[g](h);else f[g]=B(h)}return k(b,{width:m,height:m,color:a})}var f=Array(6);b(a);return k(b,{faces:f,resize:function(a){var g=a|0;e(0<g&&g<=u.maxCubeMapSize,"invalid radius for cube fbo");if(g===b.width)return b;var d=b.color;for(a=0;a<d.length;++a)d[a].resize(g);for(a=0;6>a;++a)f[a].resize(g);b.width=b.height=g;return b},_reglType:"framebufferCube",
destroy:function(){f.forEach(function(a){a.destroy()})}})},clear:function(){l(aa).forEach(V)},restore:function(){l(aa).forEach(function(a){a.framebuffer=d.createFramebuffer();Ga(a)})}})}},{"./util/check":21,"./util/extend":24,"./util/values":33}],13:[function(d,q,B){q.exports=function(e,d){var k=1;d.ext_texture_filter_anisotropic&&(k=e.getParameter(34047));var m=1,g=1;d.webgl_draw_buffers&&(m=e.getParameter(34852),g=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),
e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(d).filter(function(e){return!!d[e]}),maxAnisotropic:k,maxDrawbuffers:m,maxColorAttachments:g,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),
maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}}},{}],14:[function(d,q,B){var e=d("./util/check"),l=d("./util/is-typed-array");q.exports=function(d,m,g,h,a,p){function q(u){var n;null===m.next?(e(a.preserveDrawingBuffer,
'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),n=5121):(e(null!==m.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),n=m.next.colorAttachments[0].texture._texture.type,p.oes_texture_float?e(5121===n||5126===n,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):e(5121===n,"Reading from a framebuffer is only allowed for the type 'uint8'"));var C=0,F=0,K=h.framebufferWidth,E=h.framebufferHeight,
z=null;l(u)?z=u:u&&(e.type(u,"object","invalid arguments to regl.read()"),C=u.x|0,F=u.y|0,e(0<=C&&C<h.framebufferWidth,"invalid x offset for regl.read"),e(0<=F&&F<h.framebufferHeight,"invalid y offset for regl.read"),K=(u.width||h.framebufferWidth-C)|0,E=(u.height||h.framebufferHeight-F)|0,z=u.data||null);z&&(5121===n?e(z instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===n&&e(z instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));
e(0<K&&K+C<=h.framebufferWidth,"invalid width for read pixels");e(0<E&&E+F<=h.framebufferHeight,"invalid height for read pixels");g();u=K*E*4;z||(5121===n?z=new Uint8Array(u):5126===n&&(z=z||new Float32Array(u)));e.isTypedArray(z,"data buffer for regl.read() must be a typedarray");e(z.byteLength>=u,"data buffer for regl.read() too small");d.pixelStorei(3333,4);d.readPixels(C,F,K,E,6408,n,z);return z}function E(a){var e;m.setFBO({framebuffer:a.framebuffer},function(){e=q(a)});return e}return function(a){return a&&
"framebuffer"in a?E(a):q(a)}}},{"./util/check":21,"./util/is-typed-array":28}],15:[function(d,q,B){var e=d("./util/check"),l=d("./util/values"),k=[];k[32854]=2;k[32855]=2;k[36194]=2;k[33189]=2;k[36168]=1;k[34041]=4;k[35907]=4;k[34836]=16;k[34842]=8;k[34843]=6;q.exports=function(d,g,h,a,p){function q(a){this.id=H++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;p.profile&&(this.stats={size:0})}function E(g){var h=g.renderbuffer;e(h,"must not double destroy renderbuffer");
d.bindRenderbuffer(36161,null);d.deleteRenderbuffer(h);g.renderbuffer=null;g.refCount=0;delete F[g.id];a.renderbufferCount--}var u={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};g.ext_srgb&&(u.srgba=35907);g.ext_color_buffer_half_float&&(u.rgba16f=34842,u.rgb16f=34843);g.webgl_color_buffer_float&&(u.rgba32f=34836);var n=[];Object.keys(u).forEach(function(a){n[u[a]]=a});var H=0,F={};q.prototype.decRef=function(){0>=--this.refCount&&E(this)};p.profile&&(a.getTotalRenderbufferSize=
function(){var a=0;Object.keys(F).forEach(function(e){a+=F[e].stats.size});return a});return{create:function(g,l){function z(a,g){var l=0,b=0,f=32854;"object"===typeof a&&a?("shape"in a?(b=a.shape,e(Array.isArray(b)&&2<=b.length,"invalid renderbuffer shape"),l=b[0]|0,b=b[1]|0):("radius"in a&&(l=b=a.radius|0),"width"in a&&(l=a.width|0),"height"in a&&(b=a.height|0)),"format"in a&&(e.parameter(a.format,u,"invalid renderbuffer format"),f=u[a.format])):"number"===typeof a?(l=a|0,b="number"===typeof g?
g|0:l):a?e.raise("invalid arguments to renderbuffer constructor"):l=b=1;e(0<l&&0<b&&l<=h.maxRenderbufferSize&&b<=h.maxRenderbufferSize,"invalid renderbuffer size");if(l!==t.width||b!==t.height||f!==t.format)return z.width=t.width=l,z.height=t.height=b,t.format=f,d.bindRenderbuffer(36161,t.renderbuffer),d.renderbufferStorage(36161,f,l,b),p.profile&&(t.stats.size=k[t.format]*t.width*t.height),z.format=n[t.format],z}var t=new q(d.createRenderbuffer());F[t.id]=t;a.renderbufferCount++;z(g,l);z.resize=
function(a,g){var n=a|0,b=g|0||n;if(n===t.width&&b===t.height)return z;e(0<n&&0<b&&n<=h.maxRenderbufferSize&&b<=h.maxRenderbufferSize,"invalid renderbuffer size");z.width=t.width=n;z.height=t.height=b;d.bindRenderbuffer(36161,t.renderbuffer);d.renderbufferStorage(36161,t.format,n,b);p.profile&&(t.stats.size=k[t.format]*t.width*t.height);return z};z._reglType="renderbuffer";z._renderbuffer=t;p.profile&&(z.stats=t.stats);z.destroy=function(){t.decRef()};return z},clear:function(){l(F).forEach(E)},restore:function(){l(F).forEach(function(a){a.renderbuffer=
d.createRenderbuffer();d.bindRenderbuffer(36161,a.renderbuffer);d.renderbufferStorage(36161,a.format,a.width,a.height)});d.bindRenderbuffer(36161,null)}}}},{"./util/check":21,"./util/values":33}],16:[function(d,q,B){var e=d("./util/check"),l=d("./util/values");q.exports=function(d,m,g,h){function a(a,e,g,d){this.name=a;this.id=e;this.location=g;this.info=d}function p(a,e){for(var g=0;g<a.length;++g)if(a[g].id===e.id){a[g].location=e.location;return}a.push(e)}function q(a,g,h){var l=35632===a?n:H,
p=l[g];if(!p){var b=m.str(g),p=d.createShader(a);d.shaderSource(p,b);d.compileShader(p);e.shaderError(d,p,b,a,h);l[g]=p}return p}function E(a,e){this.id=B++;this.fragId=a;this.vertId=e;this.program=null;this.uniforms=[];this.attributes=[];h.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function u(g,n){var l,u;l=q(35632,g.fragId);u=q(35633,g.vertId);var H=g.program=d.createProgram();d.attachShader(H,l);d.attachShader(H,u);d.linkProgram(H);e.linkError(d,H,m.str(g.fragId),m.str(g.vertId),
n);var b=d.getProgramParameter(H,35718);h.profile&&(g.stats.uniformsCount=b);var f=g.uniforms;for(l=0;l<b;++l)if(u=d.getActiveUniform(H,l))if(1<u.size)for(var D=0;D<u.size;++D){var V=u.name.replace("[0]","["+D+"]");p(f,new a(V,m.id(V),d.getUniformLocation(H,V),u))}else p(f,new a(u.name,m.id(u.name),d.getUniformLocation(H,u.name),u));b=d.getProgramParameter(H,35721);h.profile&&(g.stats.attributesCount=b);f=g.attributes;for(l=0;l<b;++l)(u=d.getActiveAttrib(H,l))&&p(f,new a(u.name,m.id(u.name),d.getAttribLocation(H,
u.name),u))}var n={},H={},F={},K=[],B=0;h.profile&&(g.getMaxUniformsCount=function(){var a=0;K.forEach(function(e){e.stats.uniformsCount>a&&(a=e.stats.uniformsCount)});return a},g.getMaxAttributesCount=function(){var a=0;K.forEach(function(e){e.stats.attributesCount>a&&(a=e.stats.attributesCount)});return a});return{clear:function(){var a=d.deleteShader.bind(d);l(n).forEach(a);n={};l(H).forEach(a);H={};K.forEach(function(a){d.deleteProgram(a.program)});K.length=0;F={};g.shaderCount=0},program:function(a,
d,h){e.command(0<=a,"missing vertex shader",h);e.command(0<=d,"missing fragment shader",h);var k=F[d];k||(k=F[d]={});var n=k[a];n||(n=new E(d,a),g.shaderCount++,u(n,h),k[a]=n,K.push(n));return n},restore:function(){n={};H={};for(var a=0;a<K.length;++a)u(K[a])},shader:q,frag:-1,vert:-1}}},{"./util/check":21,"./util/values":33}],17:[function(d,q,B){q.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},
{}],18:[function(d,q,B){q.exports=function(){var e={"":0},d=[""];return{id:function(k){var m=e[k];if(m)return m;m=e[k]=d.length;d.push(k);return m},str:function(e){return d[e]}}}},{}],19:[function(d,q,B){function e(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function l(a){return Array.isArray(a)&&0!==a.length&&F(a[0])?!0:!1}function k(a){return Object.prototype.toString.call(a)}function m(a){if(!a)return!1;var b=k(a);return 0<=Y.indexOf(b)?!0:e(a)||l(a)||u(a)}function g(a,b){36193===
a.type?(a.data=H(b),n.freeType(b)):a.data=b}function h(a,e,g,d,h,k){a="undefined"!==typeof b[a]?b[a]:Q[a]*G[e];k&&(a*=6);if(h){for(d=0;1<=g;)d+=a*g*g,g/=2;return d}return a*g*d}var a=d("./util/check"),p=d("./util/extend"),C=d("./util/values"),E=d("./util/is-typed-array"),u=d("./util/is-ndarray"),n=d("./util/pool"),H=d("./util/to-half-float"),F=d("./util/is-array-like"),K=d("./util/flatten");B=d("./constants/arraytypes.json");var O=d("./constants/arraytypes.json"),z=[9984,9986,9985,9987],t=[0,6409,
6410,6407,6408],Q={};Q[6409]=Q[6406]=Q[6402]=1;Q[34041]=Q[6410]=2;Q[6407]=Q[35904]=3;Q[6408]=Q[35906]=4;var Y=Object.keys(B).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),G=[];G[5121]=1;G[5126]=4;G[36193]=2;G[5123]=2;G[5125]=4;var b=[];b[32854]=2;b[32855]=2;b[36194]=2;b[34041]=4;b[33776]=.5;b[33777]=.5;b[33778]=1;b[33779]=1;b[35986]=.5;b[35987]=1;b[34798]=1;b[35840]=.5;b[35841]=.25;b[35842]=.5;b[35843]=.25;b[36196]=
.5;q.exports=function(b,d,q,B,G,Z,L){function W(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function J(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=
b.channels}function ba(c,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(a.type(b.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),c.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(a.type(b.flipY,"boolean","invalid texture flip"),c.flipY=b.flipY);"alignment"in b&&(a.oneOf(b.alignment,[1,2,4,8],"invalid texture unpack alignment"),c.unpackAlignment=b.alignment);"colorSpace"in b&&(a.parameter(b.colorSpace,oa,"invalid colorSpace"),c.colorSpace=oa[b.colorSpace]);if("type"in b){var f=b.type;
a(d.oes_texture_float||!("float"===f||"float32"===f),"you must enable the OES_texture_float extension in order to use floating point textures.");a(d.oes_texture_half_float||!("half float"===f||"float16"===f),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");a(d.webgl_depth_texture||!("uint16"===f||"uint32"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");a.parameter(f,S,"invalid texture type");
c.type=S[f]}var e=c.width,g=c.height,h=c.channels,f=!1;"shape"in b?(a(Array.isArray(b.shape)&&2<=b.shape.length,"shape must be an array"),e=b.shape[0],g=b.shape[1],3===b.shape.length&&(h=b.shape[2],a(0<h&&4>=h,"invalid number of channels"),f=!0),a(0<=e&&e<=q.maxTextureSize,"invalid width"),a(0<=g&&g<=q.maxTextureSize,"invalid height")):("radius"in b&&(e=g=b.radius,a(0<=e&&e<=q.maxTextureSize,"invalid radius")),"width"in b&&(e=b.width,a(0<=e&&e<=q.maxTextureSize,"invalid width")),"height"in b&&(g=
b.height,a(0<=g&&g<=q.maxTextureSize,"invalid height")),"channels"in b&&(h=b.channels,a(0<h&&4>=h,"invalid number of channels"),f=!0));c.width=e|0;c.height=g|0;c.channels=h|0;e=!1;"format"in b&&(e=b.format,a(d.webgl_depth_texture||!("depth"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),a.parameter(e,ca,"invalid texture format"),g=c.internalformat=ca[e],c.format=La[g],e in S&&!("type"in b)&&(c.type=S[e]),e in ha&&(c.compressed=
!0),e=!0);!f&&e?c.channels=Q[c.format]:f&&!e?c.channels!==t[c.format]&&(c.format=c.internalformat=t[c.channels]):e&&f&&a(c.channels===Q[c.format],"number of channels inconsistent with specified format")}}function aa(a){b.pixelStorei(37440,a.flipY);b.pixelStorei(37441,a.premultiplyAlpha);b.pixelStorei(37443,a.colorSpace);b.pixelStorei(3317,a.unpackAlignment)}function x(){W.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function I(c,b){var f=
null;m(b)?f=b:b&&(a.type(b,"object","invalid pixel data type"),ba(c,b),"x"in b&&(c.xOffset=b.x|0),"y"in b&&(c.yOffset=b.y|0),m(b.data)&&(f=b.data));a(!c.compressed||f instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(b.copy){a(!f,"can not specify copy and data field for the same texture");var d=G.viewportWidth,h=G.viewportHeight;c.width=c.width||d-c.xOffset;c.height=c.height||h-c.yOffset;c.needsCopy=!0;a(0<=c.xOffset&&c.xOffset<d&&0<=c.yOffset&&c.yOffset<h&&0<c.width&&
c.width<=d&&0<c.height&&c.height<=h,"copy texture read out of bounds")}else if(!f)c.width=c.width||1,c.height=c.height||1,c.channels=c.channels||4;else if(E(f))c.channels=c.channels||4,c.data=f,"type"in b||5121!==c.type||(c.type=O[Object.prototype.toString.call(f)]|0);else if(e(f)){c.channels=c.channels||4;d=f;h=d.length;switch(c.type){case 5121:case 5123:case 5125:case 5126:h=n.allocType(c.type,h);h.set(d);c.data=h;break;case 36193:c.data=H(d);break;default:a.raise("unsupported texture type, must specify a typed array")}c.alignment=
1;c.needsFree=!0}else if(u(f)){d=f.data;Array.isArray(d)||5121!==c.type||(c.type=O[Object.prototype.toString.call(d)]|0);var h=f.shape,p=f.stride,D,x,C,z;3===h.length?(C=h[2],z=p[2]):(a(2===h.length,"invalid ndarray pixel data, must be 2 or 3D"),z=C=1);D=h[0];x=h[1];h=p[0];p=p[1];c.alignment=1;c.width=D;c.height=x;c.channels=C;c.format=c.internalformat=t[C];c.needsFree=!0;D=z;f=f.offset;C=c.width;z=c.height;x=c.channels;for(var r=n.allocType(36193===c.type?5126:c.type,C*z*x),A=0,J=0;J<z;++J)for(var L=
0;L<C;++L)for(var B=0;B<x;++B)r[A++]=d[h*L+p*J+D*B+f];g(c,r)}else if("[object HTMLCanvasElement]"===k(f)||"[object CanvasRenderingContext2D]"===k(f))"[object HTMLCanvasElement]"===k(f)?c.element=f:c.element=f.canvas,c.width=c.element.width,c.height=c.element.height,c.channels=4;else if("[object HTMLImageElement]"===k(f))c.element=f,c.width=f.naturalWidth,c.height=f.naturalHeight,c.channels=4;else if("[object HTMLVideoElement]"===k(f))c.element=f,c.width=f.videoWidth,c.height=f.videoHeight,c.channels=
4;else if(l(f)){d=c.width||f[0].length;h=c.height||f.length;p=c.channels;p=F(f[0][0])?p||f[0][0].length:p||1;D=K.shape(f);C=1;for(z=0;z<D.length;++z)C*=D[z];C=n.allocType(36193===c.type?5126:c.type,C);K.flatten(f,D,"",C);g(c,C);c.alignment=1;c.width=d;c.height=h;c.channels=p;c.format=c.internalformat=t[p];c.needsFree=!0}5126===c.type?a(0<=q.extensions.indexOf("oes_texture_float"),"oes_texture_float extension not enabled"):36193===c.type&&a(0<=q.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}
function Y(a,e,d,g,h){var k=a.element,n=a.data,l=a.internalformat,m=a.format,p=a.type,r=a.width,u=a.height;aa(a);k?b.texSubImage2D(e,h,d,g,m,p,k):a.compressed?b.compressedTexSubImage2D(e,h,d,g,l,r,u,n):a.needsCopy?(B(),b.copyTexSubImage2D(e,h,d,g,a.xOffset,a.yOffset,r,u)):b.texSubImage2D(e,h,d,g,r,u,m,p,n)}function da(){return Ma.pop()||new x}function pa(a){a.needsFree&&n.freeType(a.data);x.call(a);Ma.push(a)}function va(){W.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=
Array(16)}function ea(a,b,f){var e=a.images[0]=da();a.mipmask=1;e.width=a.width=b;e.height=a.height=f;e.channels=a.channels=4}function T(c,b){var f=null;if(m(b))f=c.images[0]=da(),J(f,c),I(f,b),c.mipmask=1;else if(ba(c,b),Array.isArray(b.mipmap))for(var e=b.mipmap,d=0;d<e.length;++d)f=c.images[d]=da(),J(f,c),f.width>>=d,f.height>>=d,I(f,e[d]),c.mipmask|=1<<d;else f=c.images[0]=da(),J(f,c),I(f,b),c.mipmask=1;J(c,c.images[0]);(c.compressed&&33776===c.internalformat||33777===c.internalformat||33778===
c.internalformat||33779===c.internalformat)&&a(0===c.width%4&&0===c.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function N(a,e){for(var d=a.images,g=0;g<d.length&&d[g];++g){var h=d[g],k=e,n=g,m=h.element,l=h.data,p=h.internalformat,r=h.format,u=h.type,t=h.width,q=h.height;aa(h);m?b.texImage2D(k,n,r,r,u,m):h.compressed?b.compressedTexImage2D(k,n,p,t,q,0,l):h.needsCopy?(B(),b.copyTexImage2D(k,n,r,h.xOffset,h.yOffset,t,q,0)):b.texImage2D(k,
n,r,t,q,0,r,u,l)}}function Ba(){var a=Na.pop()||new va;W.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function sa(a){for(var b=a.images,f=0;f<b.length;++f)b[f]&&pa(b[f]),b[f]=null;Na.push(a)}function wa(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function fa(b,f){if("min"in f){var e=f.min;a.parameter(e,ia);b.minFilter=ia[e];0<=z.indexOf(b.minFilter)&&(b.genMipmaps=!0)}"mag"in f&&(e=f.mag,a.parameter(e,
R),b.magFilter=R[e]);var e=b.wrapS,d=b.wrapT;if("wrap"in f){var g=f.wrap;"string"===typeof g?(a.parameter(g,X),e=d=X[g]):Array.isArray(g)&&(a.parameter(g[0],X),a.parameter(g[1],X),e=X[g[0]],d=X[g[1]])}else"wrapS"in f&&(e=f.wrapS,a.parameter(e,X),e=X[e]),"wrapT"in f&&(d=f.wrapT,a.parameter(d,X),d=X[d]);b.wrapS=e;b.wrapT=d;"anisotropic"in f&&(e=f.anisotropic,a("number"===typeof e&&1<=e&&e<=q.maxAnisotropic,"aniso samples must be between 1 and "),b.anisotropic=f.anisotropic);if("mipmap"in f){e=!1;switch(typeof f.mipmap){case "string":a.parameter(f.mipmap,
xa,"invalid mipmap hint");b.mipmapHint=xa[f.mipmap];e=b.genMipmaps=!0;break;case "boolean":e=b.genMipmaps=f.mipmap;break;case "object":a(Array.isArray(f.mipmap),"invalid mipmap type");b.genMipmaps=!1;e=!0;break;default:a.raise("invalid mipmap type")}!e||"min"in f||(b.minFilter=9984)}}function ka(a,e){b.texParameteri(e,10241,a.minFilter);b.texParameteri(e,10240,a.magFilter);b.texParameteri(e,10242,a.wrapS);b.texParameteri(e,10243,a.wrapT);d.ext_texture_filter_anisotropic&&b.texParameteri(e,34046,a.anisotropic);
a.genMipmaps&&(b.hint(33170,a.mipmapHint),b.generateMipmap(e))}function la(a){W.call(this);this.mipmask=0;this.internalformat=6408;this.id=Pa++;this.refCount=1;this.target=a;this.texture=b.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new wa;L.profile&&(this.stats={size:0})}function ma(a){b.activeTexture(33984);b.bindTexture(a.target,a.texture)}function na(){var a=ga[0];a?b.bindTexture(a.target,a.texture):b.bindTexture(3553,null)}function qa(c){var e=c.texture;a(e,"must not double destroy texture");
var d=c.unit,g=c.target;0<=d&&(b.activeTexture(33984+d),b.bindTexture(g,null),ga[d]=null);b.deleteTexture(e);c.texture=null;c.params=null;c.pixels=null;c.refCount=0;delete ua[c.id];Z.textureCount--}var xa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},X={repeat:10497,clamp:33071,mirror:33648},R={nearest:9728,linear:9729},ia=p({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},R),oa={none:0,browser:37444},S={uint8:5121,
rgba4:32819,rgb565:33635,"rgb5 a1":32820},ca={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ha={};d.ext_srgb&&(ca.srgb=35904,ca.srgba=35906);d.oes_texture_float&&(S.float32=S["float"]=5126);d.oes_texture_half_float&&(S.float16=S["half float"]=36193);d.webgl_depth_texture&&(p(ca,{depth:6402,"depth stencil":34041}),p(S,{uint16:5123,uint32:5125,"depth stencil":34042}));d.webgl_compressed_texture_s3tc&&p(ha,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,
"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});d.webgl_compressed_texture_atc&&p(ha,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});d.webgl_compressed_texture_pvrtc&&p(ha,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});d.webgl_compressed_texture_etc1&&(ha["rgb etc1"]=36196);var ya=Array.prototype.slice.call(b.getParameter(34467));Object.keys(ha).forEach(function(a){var b=ha[a];0<=ya.indexOf(b)&&(ca[a]=
b)});var ja=Object.keys(ca);q.textureFormats=ja;var ta=[];Object.keys(ca).forEach(function(a){ta[ca[a]]=a});var Ea=[];Object.keys(S).forEach(function(a){Ea[S[a]]=a});var Ha=[];Object.keys(R).forEach(function(a){Ha[R[a]]=a});var Ka=[];Object.keys(ia).forEach(function(a){Ka[ia[a]]=a});var Fa=[];Object.keys(X).forEach(function(a){Fa[X[a]]=a});var La=ja.reduce(function(a,b){var f=ca[b];6409===f||6406===f||6409===f||6410===f||6402===f||34041===f?a[f]=f:32855===f||0<=b.indexOf("rgba")?a[f]=6408:a[f]=6407;
return a},{}),Ma=[],Na=[],Pa=0,ua={},ra=q.maxTextureUnits,ga=Array(ra).map(function(){return null});p(la.prototype,{bind:function(){this.bindCount+=1;var c=this.unit;if(0>c){for(var e=0;e<ra;++e){var d=ga[e];if(d){if(0<d.bindCount)continue;d.unit=-1}ga[e]=this;c=e;break}c>=ra&&a.raise("insufficient number of texture units");L.profile&&Z.maxTextureUnits<c+1&&(Z.maxTextureUnits=c+1);this.unit=c;b.activeTexture(33984+c);b.bindTexture(this.target,this.texture)}return c},unbind:function(){--this.bindCount},
decRef:function(){0>=--this.refCount&&qa(this)}});L.profile&&(Z.getTotalTextureSize=function(){var a=0;Object.keys(ua).forEach(function(b){a+=ua[b].stats.size});return a});return{create2D:function(c,e){function d(b,c){var f=g.texInfo;wa.call(f);var e=Ba();"number"===typeof b?"number"===typeof c?ea(e,b|0,c|0):ea(e,b|0,b|0):b?(a.type(b,"object","invalid arguments to regl.texture"),fa(f,b),T(e,b)):ea(e,1,1);f.genMipmaps&&(e.mipmask=(e.width<<1)-1);g.mipmask=e.mipmask;J(g,e);a.texture2D(f,e,q);g.internalformat=
e.internalformat;d.width=e.width;d.height=e.height;ma(g);N(e,3553);ka(f,3553);na();sa(e);L.profile&&(g.stats.size=h(g.internalformat,g.type,e.width,e.height,f.genMipmaps,!1));d.format=ta[g.internalformat];d.type=Ea[g.type];d.mag=Ha[f.magFilter];d.min=Ka[f.minFilter];d.wrapS=Fa[f.wrapS];d.wrapT=Fa[f.wrapT];return d}var g=new la(3553);ua[g.id]=g;Z.textureCount++;d(c,e);d.subimage=function(b,c,f,e){a(!!b,"must specify image data");c|=0;f|=0;e|=0;var h=da();J(h,g);h.width=0;h.height=0;I(h,b);h.width=
h.width||(g.width>>e)-c;h.height=h.height||(g.height>>e)-f;a(g.type===h.type&&g.format===h.format&&g.internalformat===h.internalformat,"incompatible format for texture.subimage");a(0<=c&&0<=f&&c+h.width<=g.width&&f+h.height<=g.height,"texture.subimage write out of bounds");a(g.mipmask&1<<e,"missing mipmap data");a(h.data||h.element||h.needsCopy,"missing image data");ma(g);Y(h,3553,c,f,e);na();pa(h);return d};d.resize=function(a,c){var e=a|0,k=c|0||e;if(e===g.width&&k===g.height)return d;d.width=g.width=
e;d.height=g.height=k;ma(g);for(var n=0;g.mipmask>>n;++n)b.texImage2D(3553,n,g.format,e>>n,k>>n,0,g.format,g.type,null);na();L.profile&&(g.stats.size=h(g.internalformat,g.type,e,k,!1,!1));return d};d._reglType="texture2d";d._texture=g;L.profile&&(d.stats=g.stats);d.destroy=function(){g.decRef()};return d},createCube:function(c,e,g,d,k,n){function m(b,c,f,e,g,d){var k,n=l.texInfo;wa.call(n);for(k=0;6>k;++k)p[k]=Ba();if("number"!==typeof b&&b)if("object"===typeof b)if(c)T(p[0],b),T(p[1],c),T(p[2],f),
T(p[3],e),T(p[4],g),T(p[5],d);else if(fa(n,b),ba(l,b),"faces"in b)for(b=b.faces,a(Array.isArray(b)&&6===b.length,"cube faces must be a length 6 array"),k=0;6>k;++k)a("object"===typeof b[k]&&!!b[k],"invalid input for cube map face"),J(p[k],l),T(p[k],b[k]);else for(k=0;6>k;++k)T(p[k],b);else a.raise("invalid arguments to cube map");else for(b=b|0||1,k=0;6>k;++k)ea(p[k],b,b);J(l,p[0]);l.mipmask=n.genMipmaps?(p[0].width<<1)-1:p[0].mipmask;a.textureCube(l,n,p,q);l.internalformat=p[0].internalformat;m.width=
p[0].width;m.height=p[0].height;ma(l);for(k=0;6>k;++k)N(p[k],34069+k);ka(n,34067);na();L.profile&&(l.stats.size=h(l.internalformat,l.type,m.width,m.height,n.genMipmaps,!0));m.format=ta[l.internalformat];m.type=Ea[l.type];m.mag=Ha[n.magFilter];m.min=Ka[n.minFilter];m.wrapS=Fa[n.wrapS];m.wrapT=Fa[n.wrapT];for(k=0;6>k;++k)sa(p[k]);return m}var l=new la(34067);ua[l.id]=l;Z.cubeCount++;var p=Array(6);m(c,e,g,d,k,n);m.subimage=function(b,c,f,e,g){a(!!c,"must specify image data");a("number"===typeof b&&
b===(b|0)&&0<=b&&6>b,"invalid face");f|=0;e|=0;g|=0;var d=da();J(d,l);d.width=0;d.height=0;I(d,c);d.width=d.width||(l.width>>g)-f;d.height=d.height||(l.height>>g)-e;a(l.type===d.type&&l.format===d.format&&l.internalformat===d.internalformat,"incompatible format for texture.subimage");a(0<=f&&0<=e&&f+d.width<=l.width&&e+d.height<=l.height,"texture.subimage write out of bounds");a(l.mipmask&1<<g,"missing mipmap data");a(d.data||d.element||d.needsCopy,"missing image data");ma(l);Y(d,34069+b,f,e,g);na();
pa(d);return m};m.resize=function(a){a|=0;if(a!==l.width){m.width=l.width=a;m.height=l.height=a;ma(l);for(var c=0;6>c;++c)for(var e=0;l.mipmask>>e;++e)b.texImage2D(34069+c,e,l.format,a>>e,a>>e,0,l.format,l.type,null);na();L.profile&&(l.stats.size=h(l.internalformat,l.type,m.width,m.height,!1,!0));return m}};m._reglType="textureCube";m._texture=l;L.profile&&(m.stats=l.stats);m.destroy=function(){l.decRef()};return m},clear:function(){for(var a=0;a<ra;++a)b.activeTexture(33984+a),b.bindTexture(3553,
null),ga[a]=null;C(ua).forEach(qa);Z.cubeCount=0;Z.textureCount=0},getTexture:function(a){return null},restore:function(){C(ua).forEach(function(a){a.texture=b.createTexture();b.bindTexture(a.target,a.texture);for(var e=0;32>e;++e)if(0!==(a.mipmask&1<<e))if(3553===a.target)b.texImage2D(3553,e,a.internalformat,a.width>>e,a.height>>e,0,a.internalformat,a.type,null);else for(var d=0;6>d;++d)b.texImage2D(34069+d,e,a.internalformat,a.width>>e,a.height>>e,0,a.internalformat,a.type,null);ka(a.texInfo,a.target)})}}}},
{"./constants/arraytypes.json":4,"./util/check":21,"./util/extend":24,"./util/flatten":25,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/to-half-float":32,"./util/values":33}],20:[function(d,q,B){q.exports=function(e,d){function k(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function m(a,e,d){var g=p.pop()||new k;g.startQueryIndex=a;g.endQueryIndex=e;g.sum=0;g.stats=d;q.push(g)}var g=d.ext_disjoint_timer_query;if(!g)return null;
var h=[],a=[],p=[],q=[],E=[],u=[];return{beginQuery:function(e){var d=h.pop()||g.createQueryEXT();g.beginQueryEXT(35007,d);a.push(d);m(a.length-1,a.length,e)},endQuery:function(){g.endQueryEXT(35007)},pushScopeStats:m,update:function(){var e,d;e=a.length;if(0!==e){u.length=Math.max(u.length,e+1);E.length=Math.max(E.length,e+1);E[0]=0;var k=u[0]=0;for(d=e=0;d<a.length;++d){var l=a[d];g.getQueryObjectEXT(l,34919)?(k+=g.getQueryObjectEXT(l,34918),h.push(l)):a[e++]=l;E[d+1]=k;u[d+1]=e}a.length=e;for(d=
e=0;d<q.length;++d){var k=q[d],m=k.startQueryIndex,l=k.endQueryIndex;k.sum+=E[l]-E[m];m=u[m];l=u[l];l===m?(k.stats.gpuTime+=k.sum/1E6,p.push(k)):(k.startQueryIndex=m,k.endQueryIndex=l,q[e++]=k)}q.length=e}},getNumPendingQueries:function(){return a.length},clear:function(){h.push.apply(h,a);for(var e=0;e<h.length;e++)g.deleteQueryEXT(h[e]);a.length=0;h.length=0},restore:function(){a.length=0;h.length=0}}}},{}],21:[function(d,q,B){function e(a){return"undefined"!==typeof btoa?btoa(a):"base64:"+a}function l(a){a=
Error("(regl) "+a);console.error(a);throw a;}function k(a,f){a||l(f)}function m(a){return a?": "+a:""}function g(a,f,e){0>f.indexOf(a)&&l("invalid value"+m(e)+". must be one of: "+f)}function h(a,f){for(a+="";a.length<f;)a=" "+a;return a}function a(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function p(a,f){this.number=a;this.line=f;this.errors=[]}function C(a,f,e){this.file=a;this.line=f;this.message=e}function E(){var a=Error(),a=(a.stack||a).toString(),f=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);
return f?f[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function u(){var a=Error(),a=(a.stack||a).toString(),f=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return f?f[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function n(b,f){var d=b.split("\n"),g=1,h=0,k={unknown:new a,0:new a};k.unknown.name=k[0].name=f||E();k.unknown.lines.push(new p(0,""));for(var l=0;l<d.length;++l){var n=d[l],m=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(n);if(m)switch(m[1]){case "line":if(m=
/(\d+)(\s+\d+)?/.exec(m[2]))g=m[1]|0,m[2]&&(h=m[2]|0,h in k||(k[h]=new a));break;case "define":if(m=/SHADER_NAME(_B64)?\s+(.*)$/.exec(m[2]))k[h].name=m[1]?e(m[2]):m[2]}k[h].lines.push(new p(g++,n))}Object.keys(k).forEach(function(a){var b=k[a];b.lines.forEach(function(a){b.index[a.number]=a})});return k}function H(a){var f=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var b=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(a);b?f.push(new C(b[1]|0,b[2]|0,b[3].trim())):0<a.length&&f.push(new C("unknown",
0,a))}});return f}function F(a,f){f.forEach(function(f){var e=a[f.file];if(e){var d=e.index[f.line];if(d){d.errors.push(f);e.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(f)})}function K(a){a._commandRef=E()}function O(a,f){var e=u();l(a+" in command "+(f||E())+("unknown"===e?"":" called from "+e))}function z(a,f,e,d){typeof a!==f&&O("invalid parameter type"+m(e)+". expected "+f+", got "+typeof a,d||E())}function t(a,f){return 32820===a||32819===a||33635===a?2:34042===
a?4:G[a]*f}var Q=d("./is-typed-array");d=d("./extend");var Y="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),G={};G[5120]=G[5121]=1;G[5122]=G[5123]=G[36193]=G[33635]=G[32819]=G[32820]=2;G[5124]=G[5125]=G[5126]=G[34042]=4;q.exports=d(k,{optional:function(a){a()},raise:l,commandRaise:O,command:function(a,f,e){a||O(f,e||E())},parameter:function(a,f,e){a in f||l("unknown parameter ("+a+")"+m(e)+". possible values: "+Object.keys(f).join())},commandParameter:function(a,
f,e,d){a in f||O("unknown parameter ("+a+")"+m(e)+". possible values: "+Object.keys(f).join(),d||E())},constructor:function(a){Object.keys(a).forEach(function(a){0>Y.indexOf(a)&&l('invalid regl constructor argument "'+a+'". must be one of '+Y)})},type:function(a,f,e){typeof a!==f&&l("invalid parameter type"+m(e)+". expected "+f+", got "+typeof a)},commandType:z,isTypedArray:function(a,f){Q(a)||l("invalid parameter type"+m(f)+". must be a typed array")},nni:function(a,f){0<=a&&(a|0)===a||l("invalid parameter type, ("+
a+")"+m(f)+". must be a nonnegative integer")},oneOf:g,shaderError:function(a,f,e,d,g){if(!a.getShaderParameter(f,a.COMPILE_STATUS)){f=a.getShaderInfoLog(f);a=d===a.FRAGMENT_SHADER?"fragment":"vertex";z(e,"string",a+" shader source must be a string",g);var l=n(e,g);e=H(f);F(l,e);Object.keys(l).forEach(function(a){function b(a,f){e.push(a);d.push(f||"")}var f=l[a];if(f.hasErrors){var e=[""],d=[""];b("file number "+a+": "+f.name+"\n","color:red;text-decoration:underline;font-weight:bold");f.lines.forEach(function(a){if(0<
a.errors.length){b(h(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var f=0;a.errors.forEach(function(e){e=e.message;var d=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(e);if(d){var g=d[1];e=d[2];switch(g){case "assign":g="="}f=Math.max(a.line.indexOf(g,f),0)}else f=0;b(h("| ",6));b(h("^^^",f+3)+"\n","font-weight:bold");b(h("| ",6));b(e+"\n","font-weight:bold")});b(h("| ",6)+"\n")}else b(h(a.number,4)+"|  "),b(a.line+"\n","color:red")});
"undefined"!==typeof document?(d[0]=e.join("%c"),console.log.apply(console,d)):console.log(e.join(""))}});k.raise("Error compiling "+a+" shader, "+l[0].name)}},linkError:function(a,f,e,d,g){a.getProgramParameter(f,a.LINK_STATUS)||(a=a.getProgramInfoLog(f),e=n(e,g),d='Error linking program with vertex shader, "'+n(d,g)[0].name+'", and fragment shader "'+e[0].name+'"',"undefined"!==typeof document?console.log("%c"+d+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(d+
"\n"+a),k.raise(d))},callSite:u,saveCommandRef:K,saveDrawInfo:function(a,f,e,d){function g(a){return a?d.id(a):0}function h(a,b){Object.keys(b).forEach(function(b){a[d.id(b)]=!0})}K(a);a._fragId=g(a["static"].frag);a._vertId=g(a["static"].vert);var k=a._uniformSet={};h(k,f["static"]);h(k,f.dynamic);f=a._attributeSet={};h(f,e["static"]);h(f,e.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,f,e){a.texture?
g(a.texture._texture.internalformat,f,"unsupported texture format for attachment"):g(a.renderbuffer._renderbuffer.format,e,"unsupported renderbuffer format for attachment")},guessCommand:E,texture2D:function(a,f,e){var d=f.width,g=f.height,h=f.channels;k(0<d&&d<=e.maxTextureSize&&0<g&&g<=e.maxTextureSize,"invalid texture shape");33071===a.wrapS&&33071===a.wrapT||k(!(d&d-1)&&!!d&&!(g&g-1)&&!!g,"incompatible wrap mode for texture, both width and height must be power of 2");1===f.mipmask?1!==d&&1!==
g&&k(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(k(!(d&d-1)&&!!d&&!(g&g-1)&&!!g,"texture must be a square power of 2 to support mipmapping"),k(f.mipmask===(d<<1)-1,"missing or incomplete mipmap data"));5126===f.type&&(0>e.extensions.indexOf("oes_texture_float_linear")&&k(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),k(!a.genMipmaps,"mipmap generation not supported with float textures"));
var l=f.images;for(e=0;16>e;++e)if(l[e]){var m=d>>e,n=g>>e;k(f.mipmask&1<<e,"missing mipmap data");var p=l[e];k(p.width===m&&p.height===n,"invalid shape for mip images");k(p.format===f.format&&p.internalformat===f.internalformat&&p.type===f.type,"incompatible type for mip image");p.compressed||p.data&&k(p.data.byteLength===m*n*Math.max(t(p.type,h),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}else a.genMipmaps||k(0===(f.mipmask&1<<e),"extra mipmap data");
f.compressed&&k(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,f,e,d){var g=a.width,h=a.height,l=a.channels;k(0<g&&g<=d.maxTextureSize&&0<h&&h<=d.maxTextureSize,"invalid texture shape");k(g===h,"cube map must be square");k(33071===f.wrapS&&33071===f.wrapT,"wrap mode not supported by cube map");for(d=0;d<e.length;++d){var m=e[d];k(m.width===g&&m.height===h,"inconsistent cube map face shape");f.genMipmaps&&(k(!m.compressed,"can not generate mipmap for compressed textures"),
k(1===m.mipmask,"can not specify mipmaps and generate mipmaps"));for(var n=m.images,p=0;16>p;++p){var u=n[p];if(u){var q=g>>p,C=h>>p;k(m.mipmask&1<<p,"missing mipmap data");k(u.width===q&&u.height===C,"invalid shape for mip images");k(u.format===a.format&&u.internalformat===a.internalformat&&u.type===a.type,"incompatible type for mip image");u.compressed||u.data&&k(u.data.byteLength===q*C*Math.max(t(u.type,l),u.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}})},
{"./extend":24,"./is-typed-array":28}],22:[function(d,q,B){q.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],23:[function(d,q,B){function e(e){return Array.prototype.slice.call(e)}function l(d){return e(d).join("")}var k=d("./extend");q.exports=function(){function d(){var a=[],g=[];return k(function(){a.push.apply(a,e(arguments))},{def:function(){var d="v"+h++;g.push(d);0<arguments.length&&(a.push(d,"="),a.push.apply(a,
e(arguments)),a.push(";"));return d},toString:function(){return l([0<g.length?"var "+g+";":"",l(a)])}})}function g(){function a(e,d){h(e,d,"=",g.def(e,d),";")}var g=d(),h=d(),l=g.toString,p=h.toString;return k(function(){g.apply(g,e(arguments))},{def:g.def,entry:g,exit:h,save:a,set:function(e,d,h){a(e,d);g(e,d,"=",h,";")},toString:function(){return l()+p()}})}var h=0,a=[],p=[],q=d(),E={};return{global:q,link:function(e){for(var d=0;d<p.length;++d)if(p[d]===e)return a[d];d="g"+h++;a.push(d);p.push(e);
return d},block:d,proc:function(a,e){function d(){var a="a"+h.length;h.push(a);return a}var h=[];e=e||0;for(var m=0;m<e;++m)d();var m=g(),p=m.toString;return E[a]=k(m,{arg:d,toString:function(){return l(["function(",h.join(),"){",p(),"}"])}})},scope:g,cond:function(){var a=l(arguments),d=g(),h=g(),m=d.toString,p=h.toString;return k(d,{then:function(){d.apply(d,e(arguments));return this},"else":function(){h.apply(h,e(arguments));return this},toString:function(){var e=p();e&&(e="else{"+e+"}");return l(["if(",
a,"){",m(),"}",e])}})},compile:function(){var e=['"use strict";',q,"return {"];Object.keys(E).forEach(function(a){e.push('"',a,'":',E[a].toString(),",")});e.push("}");var d=l(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,a.concat(d)).apply(null,p)}}}},{"./extend":24}],24:[function(d,q,B){q.exports=function(e,d){for(var k=Object.keys(d),m=0;m<k.length;++m)e[k[m]]=d[k[m]];return e}},{}],25:[function(d,q,B){function e(e,d,h,a,k,l){for(var q=0;q<d;++q)for(var u=
e[q],n=0;n<h;++n)for(var B=u[n],F=0;F<a;++F)k[l++]=B[F]}function l(d,g,h,a,k){for(var q=1,E=h+1;E<g.length;++E)q*=g[E];var u=g[h];if(4===g.length-h){var n=g[h+1],B=g[h+2];g=g[h+3];for(E=0;E<u;++E)e(d[E],n,B,g,a,k),k+=q}else for(E=0;E<u;++E)l(d[E],g,h+1,a,k),k+=q}var k=d("./pool");q.exports={shape:function(e){for(var d=[];e.length;e=e[0])d.push(e.length);return d},flatten:function(d,g,h,a){var p=1;if(g.length)for(var q=0;q<g.length;++q)p*=g[q];else p=0;h=a||k.allocType(h,p);switch(g.length){case 0:break;
case 1:a=g[0];for(g=0;g<a;++g)h[g]=d[g];break;case 2:a=g[0];g=g[1];for(q=p=0;q<a;++q)for(var E=d[q],u=0;u<g;++u)h[p++]=E[u];break;case 3:e(d,g[0],g[1],g[2],h,0);break;default:l(d,g,0,h,0)}return h}}},{"./pool":30}],26:[function(d,q,B){var e=d("./is-typed-array");q.exports=function(d){return Array.isArray(d)||e(d)}},{"./is-typed-array":28}],27:[function(d,q,B){var e=d("./is-typed-array");q.exports=function(d){return!!d&&"object"===typeof d&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&"number"===
typeof d.offset&&d.shape.length===d.stride.length&&(Array.isArray(d.data)||e(d.data))}},{"./is-typed-array":28}],28:[function(d,q,B){var e=d("../constants/arraytypes.json");q.exports=function(d){return Object.prototype.toString.call(d)in e}},{"../constants/arraytypes.json":4}],29:[function(d,q,B){q.exports=function(e,d){for(var k=Array(e),m=0;m<e;++m)k[m]=d(m);return k}},{}],30:[function(d,q,B){function e(e){var d,a;d=(65535<e)<<4;e>>>=d;a=(255<e)<<3;e>>>=a;d|=a;a=(15<e)<<2;e>>>=a;d|=a;a=(3<e)<<1;
return d|a|e>>>a>>1}function l(d){a:{for(var h=16;268435456>=h;h*=16)if(d<=h){d=h;break a}d=0}h=m[e(d)>>2];return 0<h.length?h.pop():new ArrayBuffer(d)}function k(d){m[e(d.byteLength)>>2].push(d)}var m=d("./loop")(8,function(){return[]});q.exports={alloc:l,free:k,allocType:function(e,d){var a=null;switch(e){case 5120:a=new Int8Array(l(d),0,d);break;case 5121:a=new Uint8Array(l(d),0,d);break;case 5122:a=new Int16Array(l(2*d),0,d);break;case 5123:a=new Uint16Array(l(2*d),0,d);break;case 5124:a=new Int32Array(l(4*
d),0,d);break;case 5125:a=new Uint32Array(l(4*d),0,d);break;case 5126:a=new Float32Array(l(4*d),0,d);break;default:return null}return a.length!==d?a.subarray(0,d):a},freeType:function(e){k(e.buffer)}}},{"./loop":29}],31:[function(d,q,B){q.exports={next:"function"===typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"===typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout}},{}],32:[function(d,
q,B){var e=d("./pool"),l=new Float32Array(1),k=new Uint32Array(l.buffer);q.exports=function(d){for(var g=e.allocType(5123,d.length),h=0;h<d.length;++h)if(isNaN(d[h]))g[h]=65535;else if(Infinity===d[h])g[h]=31744;else if(-Infinity===d[h])g[h]=64512;else{l[0]=d[h];var a=k[0],p=a>>>31<<15,q=(a<<1>>>24)-127,a=a>>13&1023;g[h]=-24>q?p:-14>q?p+(a+1024>>-14-q):15<q?p+31744:p+(q+15<<10)+a}return g}},{"./pool":30}],33:[function(d,q,B){q.exports=function(e){return Object.keys(e).map(function(d){return e[d]})}},
{}],34:[function(d,q,B){function e(a,e,d){function g(){var e=window.innerWidth,l=window.innerHeight;a!==document.body&&(l=a.getBoundingClientRect(),e=l.right-l.left,l=l.bottom-l.top);k.width=d*e;k.height=d*l;h(k.style,{width:e+"px",height:l+"px"})}var k=document.createElement("canvas");h(k.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(k);a===document.body&&(k.style.position="absolute",h(a.style,{margin:0,padding:0}));window.addEventListener("resize",g,!1);g();return{canvas:k,onDestroy:function(){window.removeEventListener("resize",
g);a.removeChild(k)}}}function l(a,e){function d(g){try{return a.getContext(g,e)}catch(h){return null}}return d("webgl")||d("experimental-webgl")||d("webgl-experimental")}function k(a){if("string"===typeof a)return a.split();g(Array.isArray(a),"invalid extension array");return a}function m(a){return"string"===typeof a?(g("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(a)):a}var g=d("./util/check"),h=d("./util/extend");q.exports=function(a){var d=a||{},h,q,u,n;
a={};var B=[],F=[],K="undefined"===typeof window?1:window.devicePixelRatio,O=!1,z=function(a){a&&g.raise(a)},t=function(){};"string"===typeof d?(g("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),h=document.querySelector(d),g(h,"invalid query string for element")):"object"===typeof d?"string"===typeof d.nodeName&&"function"===typeof d.appendChild&&"function"===typeof d.getBoundingClientRect?h=d:"function"===typeof d.drawArrays||"function"===typeof d.drawElements?
(n=d,u=n.canvas):(g.constructor(d),"gl"in d?n=d.gl:"canvas"in d?u=m(d.canvas):"container"in d&&(q=m(d.container)),"attributes"in d&&(a=d.attributes,g.type(a,"object","invalid context attributes")),"extensions"in d&&(B=k(d.extensions)),"optionalExtensions"in d&&(F=k(d.optionalExtensions)),"onDone"in d&&(g.type(d.onDone,"function","invalid or missing onDone callback"),z=d.onDone),"profile"in d&&(O=!!d.profile),"pixelRatio"in d&&(K=+d.pixelRatio,g(0<K,"invalid pixel ratio"))):g.raise("invalid arguments to regl");
h&&("canvas"===h.nodeName.toLowerCase()?u=h:q=h);if(!n){if(!u){g("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");h=e(q||document.body,z,K);if(!h)return null;u=h.canvas;t=h.onDestroy}n=l(u,a)}return n?{gl:n,canvas:u,container:q,extensions:B,optionalExtensions:F,pixelRatio:K,profile:O,onDone:z,onDestroy:t}:(t(),z("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/check":21,"./util/extend":24}],
35:[function(d,q,B){function e(a,d){for(var e=0;e<a.length;++e)if(a[e]===d)return e;return-1}var l=d("./lib/util/check"),k=d("./lib/util/extend"),m=d("./lib/dynamic"),g=d("./lib/util/raf"),h=d("./lib/util/clock"),a=d("./lib/strings"),p=d("./lib/webgl"),C=d("./lib/extension"),E=d("./lib/limits"),u=d("./lib/buffer"),n=d("./lib/elements"),H=d("./lib/texture"),F=d("./lib/renderbuffer"),K=d("./lib/framebuffer"),O=d("./lib/attribute"),z=d("./lib/shader"),t=d("./lib/read"),Q=d("./lib/core"),Y=d("./lib/stats"),
G=d("./lib/timer");q.exports=function(b){function d(){if(0===S.length)N&&N.update(),ja=null;else{ja=g.next(d);ba();for(var a=S.length-1;0<=a;--a){var b=S[a];b&&b(fa,null,0)}I.flush();N&&N.update()}}function q(){!ja&&0<S.length&&(ja=g.next(d))}function B(){ja&&(g.cancel(d),ja=null)}function Ga(a){a.preventDefault();da=!0;B();ca.forEach(function(a){a()})}function Ca(a){I.getError();da=!1;pa.restore();na.restore();la.restore();qa.restore();xa.restore();X.restore();N&&N.restore();R.procs.refresh();q();
ha.forEach(function(a){a()})}function Z(a){function b(a){var d={},e={};Object.keys(a).forEach(function(b){var f=a[b];m.isDynamic(f)?e[b]=m.unbox(f,b):d[b]=f});return{dynamic:e,"static":d}}function d(a){for(;t.length<a;)t.push(null);return t}l(!!a,"invalid args to regl({...})");l.type(a,"object","invalid args to regl({...})");var e=b(a.context||{}),f=b(a.uniforms||{}),g=b(a.attributes||{}),h=b(function(a){function b(a){if(a in d){var c=d[a];delete d[a];Object.keys(c).forEach(function(b){d[a+"."+b]=
c[b]})}}var d=k({},a);delete d.uniforms;delete d.attributes;delete d.context;"stencil"in d&&d.stencil.op&&(d.stencil.opBack=d.stencil.opFront=d.stencil.op,delete d.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return d}(a));a={gpuTime:0,cpuTime:0,count:0};var e=R.compile(h,g,f,e,a),n=e.draw,p=e.batch,q=e.scope,t=[];return k(function(a,b){var e;da&&l.raise("context lost");if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof b)if("number"===
typeof a)for(e=0;e<a;++e)q.call(this,null,b,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)q.call(this,a[e],b,e);else return q.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return n.call(this,a)},{stats:a})}function L(a,b){var d=0;R.procs.poll();var e=b.color;e&&(I.clearColor(+e[0]||0,+e[1]||0,+e[2]||0,+e[3]||0),d|=16384);"depth"in b&&(I.clearDepth(+b.depth),d|=256);"stencil"in b&&(I.clearStencil(b.stencil|
0),d|=1024);l(!!d,"called regl.clear with no buffer specified");I.clear(d)}function W(a){l.type(a,"function","regl.frame() callback must be a function");S.push(a);q();return{cancel:function(){function b(){var a=e(S,b);S[a]=S[S.length-1];--S.length;0>=S.length&&B()}var d=e(S,a);l(0<=d,"cannot cancel a frame twice");S[d]=b}}}function J(){var a=ia.viewport,b=ia.scissor_box;a[0]=a[1]=b[0]=b[1]=0;fa.viewportWidth=fa.framebufferWidth=fa.drawingBufferWidth=a[2]=b[2]=I.drawingBufferWidth;fa.viewportHeight=
fa.framebufferHeight=fa.drawingBufferHeight=a[3]=b[3]=I.drawingBufferHeight}function ba(){fa.tick+=1;fa.time=x();J();R.procs.poll()}function aa(){J();R.procs.refresh();N&&N.update()}function x(){return(h()-Ba)/1E3}b=p(b);if(!b)return null;var I=b.gl,Da=I.getContextAttributes(),da=I.isContextLost(),pa=C(I,b);if(!pa)return null;var va=a(),ea=Y(),T=pa.extensions,N=G(I,T),Ba=h(),sa=I.drawingBufferWidth,wa=I.drawingBufferHeight,fa={tick:0,time:0,viewportWidth:sa,viewportHeight:wa,framebufferWidth:sa,framebufferHeight:wa,
drawingBufferWidth:sa,drawingBufferHeight:wa,pixelRatio:b.pixelRatio},ka=E(I,T),la=u(I,ea,b),ma=n(I,T,la,ea),sa=O(I,T,ka,la,va),na=z(I,va,ea,b),qa=H(I,T,ka,function(){R.procs.poll()},fa,ea,b),xa=F(I,T,ka,ea,b),X=K(I,T,ka,qa,xa,ea),R=Q(I,va,T,ka,la,ma,qa,X,{},sa,na,{elements:null,primitive:4,count:-1,offset:0,instances:-1},fa,N,b),va=t(I,X,R.procs.poll,fa,Da,T),ia=R.next,oa=I.canvas,S=[],ca=[],ha=[],ya=[b.onDestroy],ja=null;oa&&(oa.addEventListener("webglcontextlost",Ga,!1),oa.addEventListener("webglcontextrestored",
Ca,!1));var ta=X.setFBO=Z({framebuffer:m.define.call(null,1,"framebuffer")});aa();Da=k(Z,{clear:function(a){l("object"===typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)ta(k({framebuffer:a.framebuffer.faces[b]},a),L);else ta(a,L);else L(null,a)},prop:m.define.bind(null,1),context:m.define.bind(null,2),"this":m.define.bind(null,3),draw:Z({}),buffer:function(a){return la.create(a,34962,!1,!1)},
elements:function(a){return ma.create(a,!1)},texture:qa.create2D,cube:qa.createCube,renderbuffer:xa.create,framebuffer:X.create,framebufferCube:X.createCube,attributes:Da,frame:W,on:function(a,b){l.type(b,"function","listener callback must be a function");var d;switch(a){case "frame":return W(b);case "lost":d=ca;break;case "restore":d=ha;break;case "destroy":d=ya;break;default:l.raise("invalid event, must be one of frame,lost,restore,destroy")}d.push(b);return{cancel:function(){for(var a=0;a<d.length;++a)if(d[a]===
b){d[a]=d[d.length-1];d.pop();break}}}},limits:ka,hasExtension:function(a){return 0<=ka.extensions.indexOf(a.toLowerCase())},read:va,destroy:function(){S.length=0;B();oa&&(oa.removeEventListener("webglcontextlost",Ga),oa.removeEventListener("webglcontextrestored",Ca));na.clear();X.clear();xa.clear();qa.clear();ma.clear();la.clear();N&&N.clear();ya.forEach(function(a){a()})},_gl:I,_refresh:aa,poll:function(){ba();N&&N.update()},now:x,stats:ea});b.onDone(null,Da);return Da}},{"./lib/attribute":2,"./lib/buffer":3,
"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/check":21,"./lib/util/clock":22,"./lib/util/extend":24,"./lib/util/raf":31,"./lib/webgl":34}]},{},[1]);

        </script>
        </body>
      </html>