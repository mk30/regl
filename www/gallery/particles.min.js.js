(function e$$0(q,x,a){function b(c,f){if(!x[c]){if(!q[c]){var d="function"==typeof require&&require;if(!f&&d)return d(c,!0);if(e)return e(c,!0);d=Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d;}d=x[c]={exports:{}};q[c][0].call(d.exports,function(a){var d=q[c][1][a];return b(d?d:a)},d,d.exports,e$$0,q,x,a)}return x[c].exports}for(var e="function"==typeof require&&require,f=0;f<a.length;f++)b(a[f]);return b})({1:[function(g,q,x){var a=g("../regl")(),b=g("gl-mat4"),e=g("hsv2rgb");
g=a.buffer(Array(1E4).fill().map(function(){var a=e(360*Math.random(),.6,1);return[10*Math.random(),10*Math.random(),10*Math.random(),10*Math.random(),2*Math.PI*Math.random(),2*Math.PI*Math.random(),2*Math.PI*Math.random(),2*Math.PI*Math.random(),a[0]/255,a[1]/255,a[2]/255]}));var f=a({vert:"\n  precision mediump float;\n  attribute vec4 freq, phase;\n  attribute vec3 color;\n  uniform float time;\n  uniform mat4 view, projection;\n  varying vec3 fragColor;\n  void main() {\n    vec3 position = 8.0 * cos(freq.xyz * time + phase.xyz);\n    gl_PointSize = 5.0 * (1.0 + cos(freq.w * time + phase.w));\n    gl_Position = projection * view * vec4(position, 1);\n    fragColor = color;\n  }",
frag:"\n  precision lowp float;\n  varying vec3 fragColor;\n  void main() {\n    if (length(gl_PointCoord.xy - 0.5) > 0.5) {\n      discard;\n    }\n    gl_FragColor = vec4(fragColor, 1);\n  }",attributes:{freq:{buffer:g,stride:44,offset:0},phase:{buffer:g,stride:44,offset:16},color:{buffer:g,stride:44,offset:32}},uniforms:{view:function(a){a=.01*a.tick;return b.lookAt([],[30*Math.cos(a),2.5,30*Math.sin(a)],[0,0,0],[0,1,0])},projection:function(a){return b.perspective([],Math.PI/4,a.viewportWidth/
a.viewportHeight,.01,1E3)},time:function(a){return.001*a.tick}},count:1E4,primitive:"points"});a.frame(function(){a.clear({depth:1,color:[0,0,0,1]});f()})},{"../regl":60,"gl-mat4":44,hsv2rgb:59}],2:[function(g,q,x){function a(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}q.exports=function(b,e,f,c,h){b=f.maxAttributes;e=Array(b);for(f=0;f<b;++f)e[f]=new a;return{Record:a,scope:{},state:e}}},{}],3:[function(g,
q,x){function a(a){return k[Object.prototype.toString.call(a)]|0}function b(a,b){for(var d=0;d<b.length;++d)a[d]=b[d]}function e(a,b,d,c,e,f,h){for(var l=0,t=0;t<d;++t)for(var p=0;p<c;++p)a[l++]=b[e*t+f*p+h]}var f=g("./util/check"),c=g("./util/is-typed-array"),h=g("./util/is-ndarray"),d=g("./util/values"),p=g("./util/pool");x=g("./util/flatten");var u=x.flatten,r=x.shape,k=g("./constants/arraytypes.json"),n=g("./constants/dtypes.json"),F=g("./constants/usage.json"),A=[];A[5120]=1;A[5122]=2;A[5124]=
4;A[5121]=1;A[5123]=2;A[5125]=4;A[5126]=4;q.exports=function(k,g,w){function v(a){this.id=l++;this.buffer=k.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;w.profile&&(this.stats={size:0})}function B(a,b,d){a.byteLength=b.byteLength;k.bufferData(a.type,b,d)}function q(d,l,t,n,k,g){d.usage=t;if(Array.isArray(l)){if(d.dtype=n||5126,0<l.length)if(Array.isArray(l[0])){k=r(l);for(var v=n=1;v<k.length;++v)n*=k[v];d.dimension=n;l=u(l,
k,d.dtype);B(d,l,t);g?d.persistentData=l:p.freeType(l)}else"number"===typeof l[0]?(d.dimension=k,k=p.allocType(d.dtype,l.length),b(k,l),B(d,k,t),g?d.persistentData=k:p.freeType(k)):c(l[0])?(d.dimension=l[0].length,d.dtype=n||a(l[0])||5126,l=u(l,[l.length,l[0].length],d.dtype),B(d,l,t),g?d.persistentData=l:p.freeType(l)):f.raise("invalid buffer data")}else if(c(l))d.dtype=n||a(l),d.dimension=k,B(d,l,t),g&&(d.persistentData=new Uint8Array(new Uint8Array(l.buffer)));else if(h(l)){k=l.shape;var w=l.stride,
v=l.offset,F=0,y=0,I=0,A=0;1===k.length?(F=k[0],y=1,I=w[0],A=0):2===k.length?(F=k[0],y=k[1],I=w[0],A=w[1]):f.raise("invalid shape");d.dtype=n||a(l.data)||5126;d.dimension=y;k=p.allocType(d.dtype,F*y);e(k,l.data,F,y,I,A,v);B(d,k,t);g?d.persistentData=k:p.freeType(k)}else f.raise("invalid buffer data")}function y(a){g.bufferCount--;var d=a.buffer;f(d,"buffer must not be deleted already");k.deleteBuffer(d);a.buffer=null;delete t[a.id]}var l=0,t={};v.prototype.bind=function(){k.bindBuffer(this.type,this.buffer)};
v.prototype.destroy=function(){y(this)};var I=[];w.profile&&(g.getTotalBufferSize=function(){var a=0;Object.keys(t).forEach(function(d){a+=t[d].stats.size});return a});return{create:function(d,l,B,I){function H(a){var d=35044,b=null,e=0,l=0,t=1;Array.isArray(a)||c(a)||h(a)?b=a:"number"===typeof a?e=a|0:a&&(f.type(a,"object","buffer arguments must be an object, a number or an array"),"data"in a&&(f(null===b||Array.isArray(b)||c(b)||h(b),"invalid data for buffer"),b=a.data),"usage"in a&&(f.parameter(a.usage,
F,"invalid buffer usage"),d=F[a.usage]),"type"in a&&(f.parameter(a.type,n,"invalid buffer type"),l=n[a.type]),"dimension"in a&&(f.type(a.dimension,"number","invalid dimension"),t=a.dimension|0),"length"in a&&(f.nni(e,"buffer length must be a nonnegative integer"),e=a.length|0));D.bind();b?q(D,b,d,l,t,I):(k.bufferData(D.type,e,d),D.dtype=l||5121,D.usage=d,D.dimension=t,D.byteLength=e);w.profile&&(D.stats.size=D.byteLength*A[D.dtype]);return H}function x(a,d){f(d+a.byteLength<=D.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+
a.byteLength+" starting from offset "+d+" to a buffer of size "+D.byteLength);k.bufferSubData(D.type,d,a)}g.bufferCount++;var D=new v(l);t[D.id]=D;B||H(d);H._reglType="buffer";H._buffer=D;H.subdata=function(d,l){var t=(l||0)|0,n;D.bind();if(Array.isArray(d)){if(0<d.length)if("number"===typeof d[0]){var k=p.allocType(D.dtype,d.length);b(k,d);x(k,t);p.freeType(k)}else Array.isArray(d[0])||c(d[0])?(n=r(d),k=u(d,n,D.dtype),x(k,t),p.freeType(k)):f.raise("invalid buffer data")}else if(c(d))x(d,t);else if(h(d)){n=
d.shape;var g=d.stride,v=k=0,w=0,F=0;1===n.length?(k=n[0],v=1,w=g[0],F=0):2===n.length?(k=n[0],v=n[1],w=g[0],F=g[1]):f.raise("invalid shape");n=Array.isArray(d.data)?D.dtype:a(d.data);n=p.allocType(n,k*v);e(n,d.data,k,v,w,F,d.offset);x(n,t);p.freeType(n)}else f.raise("invalid data for buffer subdata");return H};w.profile&&(H.stats=D.stats);H.destroy=function(){y(D)};return H},createStream:function(a,d){var b=I.pop();b||(b=new v(a));b.bind();q(b,d,35040,0,1,!1);return b},destroyStream:function(a){I.push(a)},
clear:function(){d(t).forEach(y);I.forEach(y)},getBuffer:function(a){return a&&a._buffer instanceof v?a._buffer:null},restore:function(){d(t).forEach(function(a){a.buffer=k.createBuffer();k.bindBuffer(a.type,a.buffer);k.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},_initBuffer:q}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/check":21,"./util/flatten":25,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/values":33}],
4:[function(g,q,x){q.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(g,q,x){q.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(g,q,x){q.exports={points:0,point:0,lines:1,
line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(g,q,x){q.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(g,q,x){function a(a){return Array.isArray(a)||r(a)||k(a)}function b(a){return a.sort(function(a,d){return"viewport"===a?-1:"viewport"===d?1:a<d?-1:1})}function e(a,d,b,c){this.thisDep=a;this.contextDep=d;this.propDep=b;this.append=c}function f(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function c(a){return new e(!1,
!1,!1,a)}function h(a,d){var b=a.type;return 0===b?(b=a.data.length,new e(!0,1<=b,2<=b,d)):4===b?(b=a.data,new e(b.thisDep,b.contextDep,b.propDep,d)):new e(3===b,2===b,1===b,d)}var d=g("./util/check"),p=g("./util/codegen"),u=g("./util/loop"),r=g("./util/is-typed-array"),k=g("./util/is-ndarray"),n=g("./util/is-array-like"),F=g("./dynamic"),A=g("./constants/primitives.json"),C=g("./constants/dtypes.json"),z=["x","y","z","w"],w="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),
v={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},B="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
E={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},y={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},l={frag:35632,vert:35633},t={cw:2304,ccw:2305},I=new e(!1,!1,!1,function(){});q.exports=function(k,g,r,q,H,x,D,R,T,ca,J,qa,ja,na,va){function Y(a){return a.replace(".","_")}function N(a,d,b){var c=Y(a);Fa.push(a);
Ga[c]=G[c]=!!b;za[c]=d}function K(a,d,b){var c=Y(a);Fa.push(a);Array.isArray(b)?(G[c]=b.slice(),Ga[c]=b.slice()):G[c]=Ga[c]=b;Aa[c]=d}function Ba(){var a=p(),b=a.link,c=a.global;a.id=Oa++;a.batchId="0";var m=b(Ma),e=a.shared={props:"a0"};Object.keys(Ma).forEach(function(a){e[a]=c.def(m,".",a)});d.optional(function(){a.CHECK=b(d);a.commandStr=d.guessCommand();a.command=b(a.commandStr);a.assert=function(a,d,c){a("if(!(",d,"))",this.CHECK,".commandRaise(",b(c),",",this.command,");")};Ha.invalidBlendCombinations=
B});var l=a.next={},f=a.current={};Object.keys(Aa).forEach(function(a){Array.isArray(G[a])&&(l[a]=c.def(e.next,".",a),f[a]=c.def(e.current,".",a))});var h=a.constants={};Object.keys(Ha).forEach(function(a){h[a]=c.def(JSON.stringify(Ha[a]))});a.invoke=function(d,c){switch(c.type){case 0:var m=["this",e.context,e.props,a.batchId];return d.def(b(c.data),".call(",m.slice(0,Math.max(c.data.length+1,4)),")");case 1:return d.def(e.props,c.data);case 2:return d.def(e.context,c.data);case 3:return d.def("this",
c.data);case 4:return c.data.append(a,d),c.data.ref}};a.attribCache={};var ba={};a.scopeAttrib=function(a){a=g.id(a);if(a in ba)return ba[a];var d=ca.scope[a];d||(d=ca.scope[a]=new ra);return ba[a]=b(d)};return a}function sa(a){var d=a["static"];a=a.dynamic;var b;if("profile"in d){var m=!!d.profile;b=c(function(a,d){return m});b.enable=m}else if("profile"in a){var e=a.profile;b=h(e,function(a,d){return a.invoke(d,e)})}return b}function wa(a,b){var m=a["static"],e=a.dynamic;if("framebuffer"in m){var l=
m.framebuffer;return l?(l=R.getFramebuffer(l),d.command(l,"invalid framebuffer object"),c(function(a,d){var b=a.link(l),c=a.shared;d.set(c.framebuffer,".next",b);c=c.context;d.set(c,".framebufferWidth",b+".width");d.set(c,".framebufferHeight",b+".height");return b})):c(function(a,d){var b=a.shared;d.set(b.framebuffer,".next","null");b=b.context;d.set(b,".framebufferWidth",b+".drawingBufferWidth");d.set(b,".framebufferHeight",b+".drawingBufferHeight");return"null"})}if("framebuffer"in e){var f=e.framebuffer;
return h(f,function(a,b){var c=a.invoke(b,f),m=a.shared,e=m.framebuffer,l=b.def(e,".getFramebuffer(",c,")");d.optional(function(){a.assert(b,"!"+c+"||"+l,"invalid framebuffer object")});b.set(e,".next",l);m=m.context;b.set(m,".framebufferWidth",l+"?"+l+".width:"+m+".drawingBufferWidth");b.set(m,".framebufferHeight",l+"?"+l+".height:"+m+".drawingBufferHeight");return l})}return null}function Z(a,b,c){function m(a){if(a in l){var ba=l[a];d.commandType(ba,"object","invalid "+a,c.commandStr);var t=!0,
Ca=ba.x|0,fa=ba.y|0,n,k;"width"in ba?(n=ba.width|0,d.command(0<=n,"invalid "+a,c.commandStr)):t=!1;"height"in ba?(k=ba.height|0,d.command(0<=k,"invalid "+a,c.commandStr)):t=!1;return new e(!t&&b&&b.thisDep,!t&&b&&b.contextDep,!t&&b&&b.propDep,function(a,d){var b=a.shared.context,c=n;"width"in ba||(c=d.def(b,".","framebufferWidth","-",Ca));var m=k;"height"in ba||(m=d.def(b,".","framebufferHeight","-",fa));return[Ca,fa,c,m]})}if(a in f){var p=f[a],t=h(p,function(b,c){var m=b.invoke(c,p);d.optional(function(){b.assert(c,
m+"&&typeof "+m+'==="object"',"invalid "+a)});var l=b.shared.context,e=c.def(m,".x|0"),f=c.def(m,".y|0"),ba=c.def('"width" in ',m,"?",m,".width|0:","(",l,".","framebufferWidth","-",e,")"),h=c.def('"height" in ',m,"?",m,".height|0:","(",l,".","framebufferHeight","-",f,")");d.optional(function(){b.assert(c,ba+">=0&&"+h+">=0","invalid "+a)});return[e,f,ba,h]});b&&(t.thisDep=t.thisDep||b.thisDep,t.contextDep=t.contextDep||b.contextDep,t.propDep=t.propDep||b.propDep);return t}return b?new e(b.thisDep,
b.contextDep,b.propDep,function(a,d){var b=a.shared.context;return[0,0,d.def(b,".","framebufferWidth"),d.def(b,".","framebufferHeight")]}):null}var l=a["static"],f=a.dynamic;if(a=m("viewport")){var t=a;a=new e(a.thisDep,a.contextDep,a.propDep,function(a,d){var b=t.append(a,d),c=a.shared.context;d.set(c,".viewportWidth",b[2]);d.set(c,".viewportHeight",b[3]);return b})}return{viewport:a,scissor_box:m("scissor.box")}}function ia(a){function b(a){if(a in m){var e=g.id(m[a]);d.optional(function(){J.shader(l[a],
e,d.guessCommand())});var f=c(function(){return e});f.id=e;return f}if(a in t){var Ca=t[a];return h(Ca,function(b,c){var m=b.invoke(c,Ca),e=c.def(b.shared.strings,".id(",m,")");d.optional(function(){c(b.shared.shader,".shader(",l[a],",",e,",",b.command,");")});return e})}return null}var m=a["static"],t=a.dynamic,n=b("frag"),k=b("vert"),p=null;f(n)&&f(k)?(p=J.program(k.id,n.id),a=c(function(a,b){return a.link(p)})):a=new e(n&&n.thisDep||k&&k.thisDep,n&&n.contextDep||k&&k.contextDep,n&&n.propDep||k&&
k.propDep,function(a,b){var c=a.shared.shader,m;m=n?n.append(a,b):b.def(c,".","frag");var e;e=k?k.append(a,b):b.def(c,".","vert");var l=c+".program("+e+","+m;d.optional(function(){l+=","+a.command});return b.def(l+")")});return{frag:n,vert:k,progVar:a,program:p}}function ka(b,m){function l(a,b){if(a in t){var e=t[a]|0;d.command(!b||0<=e,"invalid "+a,m.commandStr);return c(function(a,d){b&&(a.OFFSET=e);return e})}if(a in n){var f=n[a];return h(f,function(c,m){var e=c.invoke(m,f);b&&(c.OFFSET=e,d.optional(function(){c.assert(m,
e+">=0","invalid "+a)}));return e})}return b&&k?c(function(a,b){a.OFFSET="0";return 0}):null}var t=b["static"],n=b.dynamic,k=function(){if("elements"in t){var b=t.elements;a(b)?b=x.getElements(x.create(b,!0)):b&&(b=x.getElements(b),d.command(b,"invalid elements",m.commandStr));var e=c(function(a,d){if(b){var c=a.link(b);return a.ELEMENTS=c}return a.ELEMENTS=null});e.value=b;return e}if("elements"in n){var l=n.elements;return h(l,function(a,b){var c=a.shared,m=c.isBufferArgs,c=c.elements,e=a.invoke(b,
l),f=b.def("null"),m=b.def(m,"(",e,")"),h=a.cond(m).then(f,"=",c,".createStream(",e,");")["else"](f,"=",c,".getElements(",e,");");d.optional(function(){a.assert(h["else"],"!"+e+"||"+f,"invalid elements")});b.entry(h);b.exit(a.cond(m).then(c,".destroyStream(",f,");"));return a.ELEMENTS=f})}return null}(),p=l("offset",!0);return{elements:k,primitive:function(){if("primitive"in t){var a=t.primitive;d.commandParameter(a,A,"invalid primitve",m.commandStr);return c(function(b,d){return A[a]})}if("primitive"in
n){var b=n.primitive;return h(b,function(a,c){var m=a.constants.primTypes,e=a.invoke(c,b);d.optional(function(){a.assert(c,e+" in "+m,"invalid primitive, must be one of "+Object.keys(A))});return c.def(m,"[",e,"]")})}return k?f(k)?k.value?c(function(a,b){return b.def(a.ELEMENTS,".primType")}):c(function(){return 4}):new e(k.thisDep,k.contextDep,k.propDep,function(a,b){var d=a.ELEMENTS;return b.def(d,"?",d,".primType:",4)}):null}(),count:function(){if("count"in t){var a=t.count|0;d.command("number"===
typeof a&&0<=a,"invalid vertex count",m.commandStr);return c(function(){return a})}if("count"in n){var b=n.count;return h(b,function(a,c){var m=a.invoke(c,b);d.optional(function(){a.assert(c,"typeof "+m+'==="number"&&'+m+">=0&&"+m+"===("+m+"|0)","invalid vertex count")});return m})}if(k){if(f(k)){if(k)return p?new e(p.thisDep,p.contextDep,p.propDep,function(a,b){var c=b.def(a.ELEMENTS,".vertCount-",a.OFFSET);d.optional(function(){a.assert(b,c+">=0","invalid vertex offset/element buffer too small")});
return c}):c(function(a,b){return b.def(a.ELEMENTS,".vertCount")});var l=c(function(){return-1});d.optional(function(){l.MISSING=!0});return l}var Ca=new e(k.thisDep||p.thisDep,k.contextDep||p.contextDep,k.propDep||p.propDep,function(a,b){var d=a.ELEMENTS;return a.OFFSET?b.def(d,"?",d,".vertCount-",a.OFFSET,":-1"):b.def(d,"?",d,".vertCount:-1")});d.optional(function(){Ca.DYNAMIC=!0});return Ca}return null}(),instances:l("instances",!1),offset:p}}function la(a,b){var m=a["static"],e=a.dynamic,l={};
Fa.forEach(function(a){function f(b,d){if(a in m){var t=b(m[a]);l[k]=c(function(){return t})}else if(a in e){var n=e[a];l[k]=h(n,function(a,b){return d(a,b,a.invoke(b,n))})}}var k=Y(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return f(function(c){d.commandType(c,"boolean",a,b.commandStr);return c},function(b,c,m){d.optional(function(){b.assert(c,
"typeof "+m+'==="boolean"',"invalid flag "+a,b.commandStr)});return m});case "depth.func":return f(function(c){d.commandParameter(c,E,"invalid "+a,b.commandStr);return E[c]},function(b,c,m){var e=b.constants.compareFuncs;d.optional(function(){b.assert(c,m+" in "+e,"invalid "+a+", must be one of "+Object.keys(E))});return c.def(e,"[",m,"]")});case "depth.range":return f(function(a){d.command(n(a)&&2===a.length&&"number"===typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",b.commandStr);
return a},function(a,b,c){d.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===2&&typeof "+c+'[0]==="number"&&typeof '+c+'[1]==="number"&&'+c+"[0]<="+c+"[1]","depth range must be a 2d array")});var m=b.def("+",c,"[0]"),e=b.def("+",c,"[1]");return[m,e]});case "blend.func":return f(function(a){d.commandType(a,"object","blend.func",b.commandStr);var c="srcRGB"in a?a.srcRGB:a.src,m="srcAlpha"in a?a.srcAlpha:a.src,e="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;
d.commandParameter(c,v,k+".srcRGB",b.commandStr);d.commandParameter(m,v,k+".srcAlpha",b.commandStr);d.commandParameter(e,v,k+".dstRGB",b.commandStr);d.commandParameter(a,v,k+".dstAlpha",b.commandStr);d.command(-1===B.indexOf(c+", "+e),"unallowed blending combination (srcRGB, dstRGB) = ("+c+", "+e+")",b.commandStr);return[v[c],v[e],v[m],v[a]]},function(b,c,m){function e(f,h){var t=c.def('"',f,h,'" in ',m,"?",m,".",f,h,":",m,".",f);d.optional(function(){b.assert(c,t+" in "+l,"invalid "+a+"."+f+h+", must be one of "+
Object.keys(v))});return t}var l=b.constants.blendFuncs;d.optional(function(){b.assert(c,m+"&&typeof "+m+'==="object"',"invalid blend func, must be an object")});var f=e("src","RGB"),h=e("dst","RGB");d.optional(function(){b.assert(c,b.constants.invalidBlendCombinations+".indexOf("+f+'+", "+'+h+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var t=c.def(l,"[",f,"]"),k=c.def(l,"[",e("src","Alpha"),"]"),n=c.def(l,"[",h,"]"),p=c.def(l,"[",e("dst","Alpha"),"]");return[t,n,k,p]});case "blend.equation":return f(function(c){if("string"===
typeof c)return d.commandParameter(c,aa,"invalid "+a,b.commandStr),[aa[c],aa[c]];if("object"===typeof c)return d.commandParameter(c.rgb,aa,a+".rgb",b.commandStr),d.commandParameter(c.alpha,aa,a+".alpha",b.commandStr),[aa[c.rgb],aa[c.alpha]];d.commandRaise("invalid blend.equation",b.commandStr)},function(b,c,m){var e=b.constants.blendEquations,l=c.def(),f=c.def(),h=b.cond("typeof ",m,'==="string"');d.optional(function(){function d(a,c,m){b.assert(a,m+" in "+e,"invalid "+c+", must be one of "+Object.keys(aa))}
d(h.then,a,m);b.assert(h["else"],m+"&&typeof "+m+'==="object"',"invalid "+a);d(h["else"],a+".rgb",m+".rgb");d(h["else"],a+".alpha",m+".alpha")});h.then(l,"=",f,"=",e,"[",m,"];");h["else"](l,"=",e,"[",m,".rgb];",f,"=",e,"[",m,".alpha];");c(h);return[l,f]});case "blend.color":return f(function(a){d.command(n(a)&&4===a.length,"blend.color must be a 4d array",b.commandStr);return u(4,function(b){return+a[b]})},function(a,b,c){d.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===4",
"blend.color must be a 4d array")});return u(4,function(a){return b.def("+",c,"[",a,"]")})});case "stencil.mask":return f(function(a){d.commandType(a,"number",k,b.commandStr);return a|0},function(a,b,c){d.optional(function(){a.assert(b,"typeof "+c+'==="number"',"invalid stencil.mask")});return b.def(c,"|0")});case "stencil.func":return f(function(c){d.commandType(c,"object",k,b.commandStr);var m=c.cmp||"keep",e=c.ref||0;c="mask"in c?c.mask:-1;d.commandParameter(m,E,a+".cmp",b.commandStr);d.commandType(e,
"number",a+".ref",b.commandStr);d.commandType(c,"number",a+".mask",b.commandStr);return[E[m],e,c]},function(a,b,c){var m=a.constants.compareFuncs;d.optional(function(){function d(){a.assert(b,Array.prototype.join.call(arguments,""),"invalid stencil.func")}d(c+"&&typeof ",c,'==="object"');d('!("cmp" in ',c,")||(",c,".cmp in ",m,")")});var e=b.def('"cmp" in ',c,"?",m,"[",c,".cmp]",":",7680),l=b.def(c,".ref|0"),f=b.def('"mask" in ',c,"?",c,".mask|0:-1");return[e,l,f]});case "stencil.opFront":case "stencil.opBack":return f(function(c){d.commandType(c,
"object",k,b.commandStr);var m=c.fail||"keep",e=c.zfail||"keep";c=c.zpass||"keep";d.commandParameter(m,y,a+".fail",b.commandStr);d.commandParameter(e,y,a+".zfail",b.commandStr);d.commandParameter(c,y,a+".zpass",b.commandStr);return["stencil.opBack"===a?1029:1028,y[m],y[e],y[c]]},function(b,c,m){function e(f){d.optional(function(){b.assert(c,'!("'+f+'" in '+m+")||("+m+"."+f+" in "+l+")","invalid "+a+"."+f+", must be one of "+Object.keys(y))});return c.def('"',f,'" in ',m,"?",l,"[",m,".",f,"]:",7680)}
var l=b.constants.stencilOps;d.optional(function(){b.assert(c,m+"&&typeof "+m+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,e("fail"),e("zfail"),e("zpass")]});case "polygonOffset.offset":return f(function(a){d.commandType(a,"object",k,b.commandStr);var c=a.factor|0;a=a.units|0;d.commandType(c,"number",k+".factor",b.commandStr);d.commandType(a,"number",k+".units",b.commandStr);return[c,a]},function(b,c,m){d.optional(function(){b.assert(c,m+"&&typeof "+m+'==="object"',"invalid "+
a)});var e=c.def(m,".factor|0"),l=c.def(m,".units|0");return[e,l]});case "cull.face":return f(function(a){var c=0;"front"===a?c=1028:"back"===a&&(c=1029);d.command(!!c,k,b.commandStr);return c},function(a,b,c){d.optional(function(){a.assert(b,c+'==="front"||'+c+'==="back"',"invalid cull.face")});return b.def(c,'==="front"?',1028,":",1029)});case "lineWidth":return f(function(a){d.command("number"===typeof a&&a>=q.lineWidthDims[0]&&a<=q.lineWidthDims[1],"invalid line width, must positive number between "+
q.lineWidthDims[0]+" and "+q.lineWidthDims[1],b.commandStr);return a},function(a,b,c){d.optional(function(){a.assert(b,"typeof "+c+'==="number"&&'+c+">="+q.lineWidthDims[0]+"&&"+c+"<="+q.lineWidthDims[1],"invalid line width")});return c});case "frontFace":return f(function(a){d.commandParameter(a,t,k,b.commandStr);return t[a]},function(a,b,c){d.optional(function(){a.assert(b,c+'==="cw"||'+c+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return b.def(c+'==="cw"?2304:2305')});case "colorMask":return f(function(a){d.command(n(a)&&
4===a.length,"color.mask must be length 4 array",b.commandStr);return a.map(function(a){return!!a})},function(a,b,c){d.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===4","invalid color.mask")});return u(4,function(a){return"!!"+c+"["+a+"]"})});case "sample.coverage":return f(function(a){d.command("object"===typeof a&&a,k,b.commandStr);var c="value"in a?a.value:1;a=!!a.invert;d.command("number"===typeof c&&0<=c&&1>=c,"sample.coverage.value must be a number between 0 and 1",
b.commandStr);return[c,a]},function(a,b,c){d.optional(function(){a.assert(b,c+"&&typeof "+c+'==="object"',"invalid sample.coverage")});var m=b.def('"value" in ',c,"?+",c,".value:1"),e=b.def("!!",c,".invert");return[m,e]})}});return l}function ma(a,b){var m=a["static"],e=a.dynamic,l={};Object.keys(m).forEach(function(a){var e=m[a],f;if("number"===typeof e||"boolean"===typeof e)f=c(function(){return e});else if("function"===typeof e){var h=e._reglType;"texture2d"===h||"textureCube"===h?f=c(function(a){return a.link(e)}):
"framebuffer"===h||"framebufferCube"===h?(d.command(0<e.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',b.commandStr),f=c(function(a){return a.link(e.color[0])})):d.commandRaise('invalid data for uniform "'+a+'"',b.commandStr)}else n(e)?f=c(function(b){return b.global.def("[",u(e.length,function(c){d.command("number"===typeof e[c]||"boolean"===typeof e[c],"invalid uniform "+a,b.commandStr);return e[c]}),"]")}):d.commandRaise('invalid or missing data for uniform "'+
a+'"',b.commandStr);f.value=e;l[a]=f});Object.keys(e).forEach(function(a){var b=e[a];l[a]=h(b,function(a,d){return a.invoke(d,b)})});return l}function oa(b,e){var l=b["static"],f=b.dynamic,t={};Object.keys(l).forEach(function(b){var f=l[b],h=g.id(b),k=new ra;if(a(f))k.state=1,k.buffer=H.getBuffer(H.create(f,34962,!1,!0)),k.type=0;else{var p=H.getBuffer(f);if(p)k.state=1,k.buffer=p,k.type=0;else if(d.command("object"===typeof f&&f,"invalid data for attribute "+b,e.commandStr),f.constant){var fa=f.constant;
k.buffer="null";k.state=2;"number"===typeof fa?k.x=fa:(d.command(n(fa)&&0<fa.length&&4>=fa.length,"invalid constant for attribute "+b,e.commandStr),z.forEach(function(a,b){b<fa.length&&(k[a]=fa[b])}))}else{p=a(f.buffer)?H.getBuffer(H.create(f.buffer,34962,!1,!0)):H.getBuffer(f.buffer);d.command(!!p,'missing buffer for attribute "'+b+'"',e.commandStr);var u=f.offset|0;d.command(0<=u,'invalid offset for attribute "'+b+'"',e.commandStr);var G=f.stride|0;d.command(0<=G&&256>G,'invalid stride for attribute "'+
b+'", must be integer betweeen [0, 255]',e.commandStr);var r=f.size|0;d.command(!("size"in f)||0<r&&4>=r,'invalid size for attribute "'+b+'", must be 1,2,3,4',e.commandStr);var v=!!f.normalized,L=0;"type"in f&&(d.commandParameter(f.type,C,"invalid type for attribute "+b,e.commandStr),L=C[f.type]);var w=f.divisor|0;"divisor"in f&&(d.command(0===w||m,'cannot specify divisor for attribute "'+b+'", instancing not supported',e.commandStr),d.command(0<=w,'invalid divisor for attribute "'+b+'"',e.commandStr));
d.optional(function(){var a=e.commandStr,c="buffer offset divisor normalized type size stride".split(" ");Object.keys(f).forEach(function(m){d.command(0<=c.indexOf(m),'unknown parameter "'+m+'" for attribute pointer "'+b+'" (valid parameters are '+c+")",a)})});k.buffer=p;k.state=1;k.size=r;k.normalized=v;k.type=L||p.dtype;k.offset=u;k.stride=G;k.divisor=w}}t[b]=c(function(a,b){var d=a.attribCache;if(h in d)return d[h];var c={isStream:!1};Object.keys(k).forEach(function(a){c[a]=k[a]});k.buffer&&(c.buffer=
a.link(k.buffer),c.type=c.type||c.buffer+".dtype");return d[h]=c})});Object.keys(f).forEach(function(a){var b=f[a];t[a]=h(b,function(c,m){function e(a){m(t[a],"=",f,".",a,"|0;")}var f=c.invoke(m,b),l=c.shared,h=l.isBufferArgs,k=l.buffer;d.optional(function(){c.assert(m,f+"&&(typeof "+f+'==="object"||typeof '+f+'==="function")&&('+h+"("+f+")||"+k+".getBuffer("+f+")||"+k+".getBuffer("+f+".buffer)||"+h+"("+f+'.buffer)||("constant" in '+f+"&&(typeof "+f+'.constant==="number"||'+l.isArrayLike+"("+f+".constant))))",
'invalid dynamic attribute "'+a+'"')});var t={isStream:m.def(!1)},n=new ra;n.state=1;Object.keys(n).forEach(function(a){t[a]=m.def(""+n[a])});var p=t.buffer,fa=t.type;m("if(",h,"(",f,")){",t.isStream,"=true;",p,"=",k,".createStream(",34962,",",f,");",fa,"=",p,".dtype;","}else{",p,"=",k,".getBuffer(",f,");","if(",p,"){",fa,"=",p,".dtype;",'}else if("constant" in ',f,"){",t.state,"=",2,";","if(typeof "+f+'.constant === "number"){',t[z[0]],"=",f,".constant;",z.slice(1).map(function(a){return t[a]}).join("="),
"=0;","}else{",z.map(function(a,b){return t[a]+"="+f+".constant.length>="+b+"?"+f+".constant["+b+"]:0;"}).join(""),"}}else{","if(",h,"(",f,".buffer)){",p,"=",k,".createStream(",34962,",",f,".buffer);","}else{",p,"=",k,".getBuffer(",f,".buffer);","}",fa,'="type" in ',f,"?",l.glTypes,"[",f,".type]:",p,".dtype;",t.normalized,"=!!",f,".normalized;");e("size");e("offset");e("stride");e("divisor");m("}}");m.exit("if(",t.isStream,"){",k,".destroyStream(",p,");","}");return t})});return t}function xa(a){var b=
a["static"],d=a.dynamic,m={};Object.keys(b).forEach(function(a){var d=b[a];m[a]=c(function(a,b){return"number"===typeof d||"boolean"===typeof d?""+d:a.link(d)})});Object.keys(d).forEach(function(a){var b=d[a];m[a]=h(b,function(a,d){return a.invoke(d,b)})});return m}function S(a,b,c,m,e){function f(a){var b=t[a];b&&(p[a]=b)}var l=a["static"],h=a.dynamic;d.optional(function(){function a(c){Object.keys(c).forEach(function(a){d.command(0<=b.indexOf(a),'unknown parameter "'+a+'"',e.commandStr)})}var b=
"framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(Fa);a(l);a(h)});var k=wa(a,e),t=Z(a,k,e),n=ka(a,e),p=la(a,e),u=ia(a,e);f("viewport");f(Y("scissor.box"));var G=0<Object.keys(p).length,k={framebuffer:k,draw:n,shader:u,state:p,dirty:G};k.profile=sa(a,e);k.uniforms=ma(c,e);k.attributes=oa(b,e);k.context=xa(m,e);return k}function V(a,b,d){var c=a.shared.context,m=a.scope();Object.keys(d).forEach(function(e){b.save(c,"."+e);m(c,".",e,"=",d[e].append(a,b),";")});
b(m)}function ga(a,b,d,c){var m=a.shared,e=m.gl,f=m.framebuffer,l;L&&(l=b.def(m.extensions,".webgl_draw_buffers"));var h=a.constants,m=h.drawBuffer,h=h.backBuffer;a=d?d.append(a,b):b.def(f,".next");c||b("if(",a,"!==",f,".cur){");b("if(",a,"){",e,".bindFramebuffer(",36160,",",a,".framebuffer);");L&&b(l,".drawBuffersWEBGL(",m,"[",a,".colorAttachments.length]);");b("}else{",e,".bindFramebuffer(",36160,",null);");L&&b(l,".drawBuffersWEBGL(",h,");");b("}",f,".cur=",a,";");c||b("}")}function P(a,b,d){var c=
a.shared,m=c.gl,e=a.current,f=a.next,l=c.current,h=c.next,k=a.cond(l,".dirty");Fa.forEach(function(b){b=Y(b);if(!(b in d.state)){var c,t;if(b in f){c=f[b];t=e[b];var p=u(G[b].length,function(a){return k.def(c,"[",a,"]")});k(a.cond(p.map(function(a,b){return a+"!=="+t+"["+b+"]"}).join("||")).then(m,".",Aa[b],"(",p,");",p.map(function(a,b){return t+"["+b+"]="+a}).join(";"),";"))}else c=k.def(h,".",b),p=a.cond(c,"!==",l,".",b),k(p),b in za?p(a.cond(c).then(m,".enable(",za[b],");")["else"](m,".disable(",
za[b],");"),l,".",b,"=",c,";"):p(m,".",Aa[b],"(",c,");",l,".",b,"=",c,";")}});0===Object.keys(d.state).length&&k(l,".dirty=false;");b(k)}function M(a,c,d,m){var e=a.shared,l=a.current,h=e.current,k=e.gl;b(Object.keys(d)).forEach(function(b){var e=d[b];if(!m||m(e)){var t=e.append(a,c);if(za[b]){var p=za[b];f(e)?t?c(k,".enable(",p,");"):c(k,".disable(",p,");"):c(a.cond(t).then(k,".enable(",p,");")["else"](k,".disable(",p,");"));c(h,".",b,"=",t,";")}else if(n(t)){var u=l[b];c(k,".",Aa[b],"(",t,");",
t.map(function(a,b){return u+"["+b+"]="+a}).join(";"),";")}else c(k,".",Aa[b],"(",t,");",h,".",b,"=",t,";")}})}function W(a,b){m&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function da(a,b,c,d,m){function e(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function l(a){G=b.def();a(G,"=",e(),";");"string"===typeof m?a(p,".count+=",m,";"):a(p,".count++;");na&&(d?(g=b.def(),a(g,"=",u,".getNumPendingQueries();")):a(u,".beginQuery(",p,");"))}function h(a){a(p,
".cpuTime+=",e(),"-",G,";");na&&(d?a(u,".pushScopeStats(",g,",",u,".getNumPendingQueries(),",p,");"):a(u,".endQuery();"))}function k(a){var c=b.def(n,".profile");b(n,".profile=",a,";");b.exit(n,".profile=",c,";")}var t=a.shared,p=a.stats,n=t.current,u=t.timer;c=c.profile;var G,g;if(c){if(f(c)){c.enable?(l(b),h(b.exit),k("true")):k("false");return}c=c.append(a,b);k(c)}else c=b.def(n,".profile");t=a.block();l(t);b("if(",c,"){",t,"}");a=a.block();h(a);b.exit("if(",c,"){",a,"}")}function ya(a,b,c,e,f){function l(a){switch(a){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function h(c,d,e){function f(){b("if(!",n,".buffer){",t,".enableVertexAttribArray(",p,");}");var c=e.type,l;l=e.size?b.def(e.size,"||",d):d;b("if(",n,".type!==",c,"||",n,".size!==",l,"||",g.map(function(a){return n+"."+a+"!=="+e[a]}).join("||"),"){",t,".bindBuffer(",34962,",",u,".buffer);",t,".vertexAttribPointer(",[p,l,c,e.normalized,e.stride,e.offset],");",n,".type=",c,";",n,".size=",l,";",g.map(function(a){return n+
"."+a+"="+e[a]+";"}).join(""),"}");m&&(c=e.divisor,b("if(",n,".divisor!==",c,"){",a.instancing,".vertexAttribDivisorANGLE(",[p,c],");",n,".divisor=",c,";}"))}function l(){b("if(",n,".buffer){",t,".disableVertexAttribArray(",p,");","}if(",z.map(function(a,b){return n+"."+a+"!=="+G[b]}).join("||"),"){",t,".vertexAttrib4f(",p,",",G,");",z.map(function(a,b){return n+"."+a+"="+G[b]+";"}).join(""),"}")}var t=k.gl,p=b.def(c,".location"),n=b.def(k.attributes,"[",p,"]");c=e.state;var u=e.buffer,G=[e.x,e.y,
e.z,e.w],g=["buffer","normalized","offset","stride"];1===c?f():2===c?l():(b("if(",c,"===",1,"){"),f(),b("}else{"),l(),b("}"))}var k=a.shared;e.forEach(function(m){var e=m.name,k=c.attributes[e],t;if(k){if(!f(k))return;t=k.append(a,b)}else{if(!f(I))return;var p=a.scopeAttrib(e);d.optional(function(){a.assert(b,p+".state","missing attribute "+e)});t={};Object.keys(new ra).forEach(function(a){t[a]=b.def(p,".",a)})}h(a.link(m),l(m.info.type),t)})}function ha(a,b,c,m,e){for(var l=a.shared,k=l.gl,h,t=0;t<
m.length;++t){var p=m[t],G=p.name,r=p.info.type,v=c.uniforms[G],p=a.link(p)+".location",L;if(v){if(!e(v))continue;if(f(v)){var w=v.value;d.command(null!==w&&"undefined"!==typeof w,'missing uniform "'+G+'"',a.commandStr);if(35678===r||35680===r)d.command("function"===typeof w&&(35678===r&&("texture2d"===w._reglType||"framebuffer"===w._reglType)||35680===r&&("textureCube"===w._reglType||"framebufferCube"===w._reglType)),"invalid texture for uniform "+G,a.commandStr),v=a.link(w._texture||w.color[0]._texture),
b(k,".uniform1i(",p,",",v+".bind());"),b.exit(v,".unbind();");else if(35674===r||35675===r||35676===r){d.optional(function(){d.command(n(w),"invalid matrix for uniform "+G,a.commandStr);d.command(35674===r&&4===w.length||35675===r&&9===w.length||35676===r&&16===w.length,"invalid length for matrix uniform "+G,a.commandStr)});var v=a.global.def("new Float32Array(["+Array.prototype.slice.call(w)+"])"),F=2;35675===r?F=3:35676===r&&(F=4);b(k,".uniformMatrix",F,"fv(",p,",false,",v,");")}else{switch(r){case 5126:d.commandType(w,
"number","uniform "+G,a.commandStr);h="1f";break;case 35664:d.command(n(w)&&2===w.length,"uniform "+G,a.commandStr);h="2f";break;case 35665:d.command(n(w)&&3===w.length,"uniform "+G,a.commandStr);h="3f";break;case 35666:d.command(n(w)&&4===w.length,"uniform "+G,a.commandStr);h="4f";break;case 35670:d.commandType(w,"boolean","uniform "+G,a.commandStr);h="1i";break;case 5124:d.commandType(w,"number","uniform "+G,a.commandStr);h="1i";break;case 35671:d.command(n(w)&&2===w.length,"uniform "+G,a.commandStr);
h="2i";break;case 35667:d.command(n(w)&&2===w.length,"uniform "+G,a.commandStr);h="2i";break;case 35672:d.command(n(w)&&3===w.length,"uniform "+G,a.commandStr);h="3i";break;case 35668:d.command(n(w)&&3===w.length,"uniform "+G,a.commandStr);h="3i";break;case 35673:d.command(n(w)&&4===w.length,"uniform "+G,a.commandStr);h="4i";break;case 35669:d.command(n(w)&&4===w.length,"uniform "+G,a.commandStr),h="4i"}b(k,".uniform",h,"(",p,",",n(w)?Array.prototype.slice.call(w):w,");")}continue}else L=v.append(a,
b)}else{if(!e(I))continue;L=b.def(l.uniforms,"[",g.id(G),"]")}35678===r?b("if(",L,"&&",L,'._reglType==="framebuffer"){',L,"=",L,".color[0];","}"):35680===r&&b("if(",L,"&&",L,'._reglType==="framebufferCube"){',L,"=",L,".color[0];","}");d.optional(function(){function c(d,m){a.assert(b,d,'bad data or missing for uniform "'+G+'".  '+m)}function d(a){c("typeof "+L+'==="'+a+'"',"invalid type, expected "+a)}function m(b,d){c(l.isArrayLike+"("+L+")&&"+L+".length==="+b,"invalid vector, should have length "+
b,a.commandStr)}function e(b){c("typeof "+L+'==="function"&&'+L+'._reglType==="texture'+(3553===b?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(r){case 5124:d("number");break;case 35667:m(2,"number");break;case 35668:m(3,"number");break;case 35669:m(4,"number");break;case 5126:d("number");break;case 35664:m(2,"number");break;case 35665:m(3,"number");break;case 35666:m(4,"number");break;case 35670:d("boolean");break;case 35671:m(2,"boolean");break;case 35672:m(3,"boolean");break;case 35673:m(4,
"boolean");break;case 35674:m(4,"number");break;case 35675:m(9,"number");break;case 35676:m(16,"number");break;case 35678:e(3553);break;case 35680:e(34067)}});v=1;switch(r){case 35678:case 35680:v=b.def(L,"._texture");b(k,".uniform1i(",p,",",v,".bind());");b.exit(v,".unbind();");continue;case 5124:case 35670:h="1i";break;case 35667:case 35671:h="2i";v=2;break;case 35668:case 35672:h="3i";v=3;break;case 35669:case 35673:h="4i";v=4;break;case 5126:h="1f";break;case 35664:h="2f";v=2;break;case 35665:h=
"3f";v=3;break;case 35666:h="4f";v=4;break;case 35674:h="Matrix2fv";break;case 35675:h="Matrix3fv";break;case 35676:h="Matrix4fv"}b(k,".uniform",h,"(",p,",");if("M"===h.charAt(0)){var p=Math.pow(r-35674+2,2),y=a.global.def("new Float32Array(",p,")");b("false,(Array.isArray(",L,")||",L," instanceof Float32Array)?",L,":(",u(p,function(a){return y+"["+a+"]="+L+"["+a+"]"}),",",y,")")}else 1<v?b(u(v,function(a){return L+"["+a+"]"})):b(L);b(");")}}function ta(a,b,c,e){function l(d){var m=G[d];return m?
m.contextDep&&e.contextDynamic||m.propDep?m.append(a,c):m.append(a,b):b.def(n,".",d)}function h(){function a(){c(L,".drawElementsInstancedANGLE(",[w,g,F,r+"<<(("+F+"-5121)>>1)",v],");")}function b(){c(L,".drawArraysInstancedANGLE(",[w,r,g,v],");")}u?y?a():(c("if(",u,"){"),a(),c("}else{"),b(),c("}")):b()}function k(){function a(){c(p+".drawElements("+[w,g,F,r+"<<(("+F+"-5121)>>1)"]+");")}function b(){c(p+".drawArrays("+[w,r,g]+");")}u?y?a():(c("if(",u,"){"),a(),c("}else{"),b(),c("}")):b()}var t=a.shared,
p=t.gl,n=t.draw,G=e.draw,u=function(){var d=G.elements,m=b;if(d){if(d.contextDep&&e.contextDynamic||d.propDep)m=c;d=d.append(a,m)}else d=m.def(n,".","elements");d&&m("if("+d+")"+p+".bindBuffer(34963,"+d+".buffer.buffer);");return d}(),w=l("primitive"),r=l("offset"),g=function(){var m=G.count,f,l=b;if(m){if(m.contextDep&&e.contextDynamic||m.propDep)l=c;f=m.append(a,l);d.optional(function(){m.MISSING&&a.assert(b,"false","missing vertex count");m.DYNAMIC&&a.assert(l,f+">=0","missing vertex count")})}else f=
l.def(n,".","count"),d.optional(function(){a.assert(l,f+">=0","missing vertex count")});return f}();if("number"===typeof g){if(0===g)return}else c("if(",g,"){"),c.exit("}");var v,L;m&&(v=l("instances"),L=a.instancing);var F=u+".type",y=G.elements&&f(G.elements);m&&("number"!==typeof v||0<=v)?"string"===typeof v?(c("if(",v,">0){"),h(),c("}else if(",v,"<0){"),k(),c("}")):h():k()}function pa(a,b,c,e,f){var l=Ba();f=l.proc("body",f);d.optional(function(){l.commandStr=b.commandStr;l.command=l.link(b.commandStr)});
m&&(l.instancing=f.def(l.shared.extensions,".angle_instanced_arrays"));a(l,f,c,e);return l.compile().body}function Ea(a,b,c,d){W(a,b);ya(a,b,c,d.attributes,function(){return!0});ha(a,b,c,d.uniforms,function(){return!0});ta(a,b,b,c)}function Ia(a,b){var c=a.proc("draw",1);W(a,c);V(a,c,b.context);ga(a,c,b.framebuffer);P(a,c,b);M(a,c,b.state);da(a,c,b,!1,!0);var d=b.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",d,".program);");if(b.shader.program)Ea(a,c,b,b.shader.program);else{var m=a.global.def("{}"),
e=c.def(d,".id"),f=c.def(m,"[",e,"]");c(a.cond(f).then(f,".call(this,a0);")["else"](f,"=",m,"[",e,"]=",a.link(function(c){return pa(Ea,a,b,c,1)}),"(",d,");",f,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Da(a,b,c,d){function m(){return!0}a.batchId="a1";W(a,b);ya(a,b,c,d.attributes,m);ha(a,b,c,d.uniforms,m);ta(a,b,b,c)}function Ja(a,b,c,d){function m(a){return a.contextDep&&f||a.propDep}function e(a){return!m(a)}W(a,b);var f=c.contextDep,l=b.def(),
h=b.def();a.shared.props=h;a.batchId=l;var k=a.scope(),t=a.scope();b(k.entry,"for(",l,"=0;",l,"<","a1",";++",l,"){",h,"=","a0","[",l,"];",t,"}",k.exit);c.needsContext&&V(a,t,c.context);c.needsFramebuffer&&ga(a,t,c.framebuffer);M(a,t,c.state,m);c.profile&&m(c.profile)&&da(a,t,c,!1,!0);d?(ya(a,k,c,d.attributes,e),ya(a,t,c,d.attributes,m),ha(a,k,c,d.uniforms,e),ha(a,t,c,d.uniforms,m),ta(a,k,t,c)):(b=a.global.def("{}"),d=c.shader.progVar.append(a,t),h=t.def(d,".id"),k=t.def(b,"[",h,"]"),t(a.shared.gl,
".useProgram(",d,".program);","if(!",k,"){",k,"=",b,"[",h,"]=",a.link(function(b){return pa(Da,a,c,b,2)}),"(",d,");}",k,".call(this,a0[",l,"],",l,");"))}function Ka(a,b){function c(a){return a.contextDep&&m||a.propDep}var d=a.proc("batch",2);a.batchId="0";W(a,d);var m=!1,e=!0;Object.keys(b.context).forEach(function(a){m=m||b.context[a].propDep});m||(V(a,d,b.context),e=!1);var f=b.framebuffer,l=!1;f?(f.propDep?m=l=!0:f.contextDep&&m&&(l=!0),l||ga(a,d,f)):ga(a,d,null);b.state.viewport&&b.state.viewport.propDep&&
(m=!0);P(a,d,b);M(a,d,b.state,function(a){return!c(a)});b.profile&&c(b.profile)||da(a,d,b,!1,"a1");b.contextDep=m;b.needsContext=e;b.needsFramebuffer=l;e=b.shader.progVar;if(e.contextDep&&m||e.propDep)Ja(a,d,b,null);else if(e=e.append(a,d),d(a.shared.gl,".useProgram(",e,".program);"),b.shader.program)Ja(a,d,b,b.shader.program);else{var f=a.global.def("{}"),l=d.def(e,".id"),h=d.def(f,"[",l,"]");d(a.cond(h).then(h,".call(this,a0,a1);")["else"](h,"=",f,"[",l,"]=",a.link(function(c){return pa(Ja,a,b,
c,2)}),"(",e,");",h,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function La(a,c){function d(b){var f=c.shader[b];f&&m.set(e.shader,"."+b,f.append(a,m))}var m=a.proc("scope",3);a.batchId="a2";var e=a.shared,f=e.current;V(a,m,c.context);c.framebuffer&&c.framebuffer.append(a,m);b(Object.keys(c.state)).forEach(function(b){var d=c.state[b].append(a,m);n(d)?d.forEach(function(c,d){m.set(a.next[b],"["+d+"]",c)}):m.set(e.next,"."+b,d)});da(a,m,c,!0,!0);["elements",
"offset","count","instances","primitive"].forEach(function(b){var d=c.draw[b];d&&m.set(e.draw,"."+b,""+d.append(a,m))});Object.keys(c.uniforms).forEach(function(b){m.set(e.uniforms,"["+g.id(b)+"]",c.uniforms[b].append(a,m))});Object.keys(c.attributes).forEach(function(b){var d=c.attributes[b].append(a,m),e=a.scopeAttrib(b);Object.keys(new ra).forEach(function(a){m.set(e,"."+a,d[a])})});d("vert");d("frag");0<Object.keys(c.state).length&&(m(f,".dirty=true;"),m.exit(f,".dirty=true;"));m("a1(",a.shared.context,
",a0,",a.batchId,");")}function Na(a){if("object"===typeof a&&!n(a)){for(var b=Object.keys(a),c=0;c<b.length;++c)if(F.isDynamic(a[b[c]]))return!0;return!1}}function ua(a,b,c){function d(a,b){f.forEach(function(c){var d=m[c];F.isDynamic(d)&&(d=a.invoke(b,d),b(p,".",c,"=",d,";"))})}var m=b["static"][c];if(m&&Na(m)){var e=a.global,f=Object.keys(m),l=!1,k=!1,t=!1,p=a.global.def("{}");f.forEach(function(b){var c=m[b];if(F.isDynamic(c))"function"===typeof c&&(c=m[b]=F.unbox(c)),b=h(c,null),l=l||b.thisDep,
t=t||b.propDep,k=k||b.contextDep;else{e(p,".",b,"=");switch(typeof c){case "number":e(c);break;case "string":e('"',c,'"');break;case "object":Array.isArray(c)&&e("[",c.join(),"]");break;default:e(a.link(c))}e(";")}});b.dynamic[c]=new F.DynamicVariable(4,{thisDep:l,contextDep:k,propDep:t,ref:p,append:d});delete b["static"][c]}}var ra=ca.Record,aa={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(aa.min=32775,aa.max=32776);var m=r.angle_instanced_arrays,L=r.webgl_draw_buffers,
G={dirty:!0,profile:va.profile},Ga={},Fa=[],za={},Aa={};N("dither",3024);N("blend.enable",3042);K("blend.color","blendColor",[0,0,0,0]);K("blend.equation","blendEquationSeparate",[32774,32774]);K("blend.func","blendFuncSeparate",[1,0,1,0]);N("depth.enable",2929,!0);K("depth.func","depthFunc",513);K("depth.range","depthRange",[0,1]);K("depth.mask","depthMask",!0);K("colorMask","colorMask",[!0,!0,!0,!0]);N("cull.enable",2884);K("cull.face","cullFace",1029);K("frontFace","frontFace",2305);K("lineWidth",
"lineWidth",1);N("polygonOffset.enable",32823);K("polygonOffset.offset","polygonOffset",[0,0]);N("sample.alpha",32926);N("sample.enable",32928);K("sample.coverage","sampleCoverage",[1,!1]);N("stencil.enable",2960);K("stencil.mask","stencilMask",-1);K("stencil.func","stencilFunc",[519,0,-1]);K("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);K("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);N("scissor.enable",3089);K("scissor.box","scissor",[0,0,k.drawingBufferWidth,k.drawingBufferHeight]);
K("viewport","viewport",[0,0,k.drawingBufferWidth,k.drawingBufferHeight]);var Ma={gl:k,context:ja,strings:g,next:Ga,current:G,draw:qa,elements:x,buffer:H,shader:J,attributes:ca.state,uniforms:T,framebuffer:R,extensions:r,timer:na,isBufferArgs:a},Ha={primTypes:A,compareFuncs:E,blendFuncs:v,blendEquations:aa,stencilOps:y,glTypes:C,orientationType:t};d.optional(function(){Ma.isArrayLike=n});L&&(Ha.backBuffer=[1029],Ha.drawBuffer=u(q.maxDrawbuffers,function(a){return 0===a?[0]:u(a,function(a){return 36064+
a})}));var Oa=0;return{next:Ga,current:G,procs:function(){var a=Ba(),b=a.proc("poll"),c=a.proc("refresh"),d=a.block();b(d);c(d);var m=a.shared,e=m.gl,f=m.next,l=m.current;d(l,".dirty=false;");ga(a,b);ga(a,c,null,!0);var h=k.getExtension("angle_instanced_arrays"),t;h&&(t=a.link(h));for(var p=0;p<q.maxAttributes;++p){var g=c.def(m.attributes,"[",p,"]"),w=a.cond(g,".buffer");w.then(e,".enableVertexAttribArray(",p,");",e,".bindBuffer(",34962,",",g,".buffer.buffer);",e,".vertexAttribPointer(",p,",",g,
".size,",g,".type,",g,".normalized,",g,".stride,",g,".offset);")["else"](e,".disableVertexAttribArray(",p,");",e,".vertexAttrib4f(",p,",",g,".x,",g,".y,",g,".z,",g,".w);",g,".buffer=null;");c(w);h&&c(t,".vertexAttribDivisorANGLE(",p,",",g,".divisor);")}Object.keys(za).forEach(function(m){var h=za[m],k=d.def(f,".",m),t=a.block();t("if(",k,"){",e,".enable(",h,")}else{",e,".disable(",h,")}",l,".",m,"=",k,";");c(t);b("if(",k,"!==",l,".",m,"){",t,"}")});Object.keys(Aa).forEach(function(m){var h=Aa[m],
k=G[m],t,p,g=a.block();g(e,".",h,"(");n(k)?(h=k.length,t=a.global.def(f,".",m),p=a.global.def(l,".",m),g(u(h,function(a){return t+"["+a+"]"}),");",u(h,function(a){return p+"["+a+"]="+t+"["+a+"];"}).join("")),b("if(",u(h,function(a){return t+"["+a+"]!=="+p+"["+a+"]"}).join("||"),"){",g,"}")):(t=d.def(f,".",m),p=d.def(l,".",m),g(t,");",l,".",m,"=",t,";"),b("if(",t,"!==",p,"){",g,"}"));c(g)});return a.compile()}(),compile:function(a,b,c,d,m){var e=Ba();e.stats=e.link(m);Object.keys(b["static"]).forEach(function(a){ua(e,
b,a)});w.forEach(function(b){ua(e,a,b)});c=S(a,b,c,d,e);Ia(e,c);La(e,c);Ka(e,c);return e.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/check":21,"./util/codegen":23,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/loop":29}],9:[function(g,q,x){function a(a,b){this.id=f++;this.type=a;this.data=b}function b(a){if(0===a.length)return[];var e=a.charAt(0),d=a.charAt(a.length-1);if(1<a.length&&e===d&&('"'===e||"'"===e))return['"'+
a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(e=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return b(a.substr(0,e.index)).concat(b(e[1])).concat(b(a.substr(e.index+e[0].length)));e=a.split(".");if(1===e.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(d=0;d<e.length;++d)a=a.concat(b(e[d]));return a}function e(a){return"["+b(a).join("][")+"]"}var f=0;q.exports={DynamicVariable:a,define:function(b,f){return new a(b,e(f+""))},isDynamic:function(b){return"function"===
typeof b&&!b._reglType||b instanceof a},unbox:function(b,e){return"function"===typeof b?new a(0,b):b},accessor:e}},{}],10:[function(g,q,x){var a=g("./util/check"),b=g("./util/is-typed-array"),e=g("./util/is-ndarray"),f=g("./util/values"),c=g("./constants/primitives.json"),h=g("./constants/usage.json");q.exports=function(d,p,u,g){function k(a){this.id=C++;q[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function n(c,f,h,k,l,t,n){c.buffer.bind();if(f){var g=n;n||b(f)&&(!e(f)||
b(f.data))||(g=p.oes_element_index_uint?5125:5123);u._initBuffer(c.buffer,f,h,g,3)}else d.bufferData(34963,t,h),c.buffer.dtype=g||5121,c.buffer.usage=h,c.buffer.dimension=3,c.buffer.byteLength=t;g=n;if(!n){switch(c.buffer.dtype){case 5121:case 5120:g=5121;break;case 5123:case 5122:g=5123;break;case 5125:case 5124:g=5125;break;default:a.raise("unsupported type for element array")}c.buffer.dtype=g}c.type=g;a(5125!==g||!!p.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");
f=l;0>f&&(f=c.buffer.byteLength,5123===g?f>>=1:5125===g&&(f>>=2));c.vertCount=f;f=k;0>k&&(f=4,k=c.buffer.dimension,1===k&&(f=0),2===k&&(f=1),3===k&&(f=4));c.primType=f}function F(b){g.elementsCount--;a(null!==b.buffer,"must not double destroy elements");delete q[b.id];b.buffer.destroy();b.buffer=null}var q={},C=0,z={uint8:5121,uint16:5123};p.oes_element_index_uint&&(z.uint32=5125);k.prototype.bind=function(){this.buffer.bind()};var w=[];return{create:function(d,f){function p(d){if(d)if("number"===
typeof d)w(d),l.primType=4,l.vertCount=d|0,l.type=5121;else{var f=null,k=35044,g=-1,u=-1,r=0,v=0;if(Array.isArray(d)||b(d)||e(d))f=d;else if(a.type(d,"object","invalid arguments for elements"),"data"in d&&(f=d.data,a(Array.isArray(f)||b(f)||e(f),"invalid data for element buffer")),"usage"in d&&(a.parameter(d.usage,h,"invalid element buffer usage"),k=h[d.usage]),"primitive"in d&&(a.parameter(d.primitive,c,"invalid element buffer primitive"),g=c[d.primitive]),"count"in d&&(a("number"===typeof d.count&&
0<=d.count,"invalid vertex count for elements"),u=d.count|0),"type"in d&&(a.parameter(d.type,z,"invalid buffer type"),v=z[d.type]),"length"in d)r=d.length|0;else if(r=u,5123===v||5122===v)r*=2;else if(5125===v||5124===v)r*=4;n(l,f,k,g,u,r,v)}else w(),l.primType=4,l.vertCount=0,l.type=5121;return p}var w=u.create(null,34963,!0),l=new k(w._buffer);g.elementsCount++;p(d);p._reglType="elements";p._elements=l;p.subdata=function(a,b){w.subdata(a,b);return p};p.destroy=function(){F(l)};return p},createStream:function(a){var b=
w.pop();b||(b=new k(u.create(null,34963,!0,!1)._buffer));n(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){w.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof k?a._elements:null},clear:function(){f(q).forEach(F)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/check":21,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/values":33}],11:[function(g,q,x){var a=g("./util/check");q.exports=function(b,e){function f(d){a.type(d,"string",
"extension name must be string");d=d.toLowerCase();var e;try{e=c[d]=b.getExtension(d)}catch(f){}return!!e}for(var c={},h=0;h<e.extensions.length;++h){var d=e.extensions[h];if(!f(d))return e.onDestroy(),e.onDone('"'+d+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}e.optionalExtensions.forEach(f);return{extensions:c,restore:function(){Object.keys(c).forEach(function(a){if(!f(a))throw Error("(regl): error restoring extension "+a);})}}}},
{"./util/check":21}],12:[function(g,q,x){var a=g("./util/check"),b=g("./util/values"),e=g("./util/extend"),f=[6408],c=[];c[6408]=4;var h=[];h[5121]=1;h[5126]=4;h[36193]=2;var d=[32854,32855,36194,35907,34842,34843,34836],p={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"};q.exports=function(g,r,k,n,F,q){function C(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var d=a=0;b?(a=b.width,d=b.height):c&&(a=
c.width,d=c.height);this.width=a;this.height=d}function z(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function w(b,c,d){if(b){if(b.texture){b=b.texture._texture;var e=Math.max(1,b.height);a(Math.max(1,b.width)===c&&e===d,"inconsistent width/height for supplied texture")}else b=b.renderbuffer._renderbuffer,a(b.width===c&&b.height===d,"inconsistent width/height for renderbuffer");b.refCount+=1}}function v(a,b){b&&(b.texture?g.framebufferTexture2D(36160,
a,b.target,b.texture._texture.texture,0):g.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer))}function B(b){var c=3553,d=null,e=null,f=b;"object"===typeof b&&(f=b.data,"target"in b&&(c=b.target|0));a.type(f,"function","invalid attachment data");b=f._reglType;"texture2d"===b?(d=f,a(3553===c)):"textureCube"===b?(d=f,a(34069<=c&&34075>c,"invalid cube map target")):"renderbuffer"===b?(e=f,c=36161):a.raise("invalid regl object for attachment");return new C(c,d,e)}function E(a,
b,c,d,e){if(c)return a=n.create2D({width:a,height:b,format:d,type:e}),a._texture.refCount=0,new C(3553,a,null);a=F.create({width:a,height:b,format:d});a._renderbuffer.refCount=0;return new C(36161,null,a)}function y(a){return a&&(a.texture||a.renderbuffer)}function l(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c))}function t(){this.id=R++;T[this.id]=this;this.framebuffer=g.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=
this.stencilAttachment=this.depthAttachment=null}function I(a){a.colorAttachments.forEach(z);z(a.depthAttachment);z(a.stencilAttachment);z(a.depthStencilAttachment)}function O(b){var c=b.framebuffer;a(c,"must not double destroy framebuffer");g.deleteFramebuffer(c);b.framebuffer=null;q.framebufferCount--;delete T[b.id]}function x(b){var c;g.bindFramebuffer(36160,b.framebuffer);var d=b.colorAttachments;for(c=0;c<d.length;++c)v(36064+c,d[c]);for(c=d.length;c<k.maxColorAttachments;++c)g.framebufferTexture2D(36160,
36064+c,3553,null,0);g.framebufferTexture2D(36160,33306,3553,null,0);g.framebufferTexture2D(36160,36096,3553,null,0);g.framebufferTexture2D(36160,36128,3553,null,0);v(36096,b.depthAttachment);v(36128,b.stencilAttachment);v(33306,b.depthStencilAttachment);b=g.checkFramebufferStatus(36160);36053!==b&&a.raise("framebuffer configuration not supported, status = "+p[b]);g.bindFramebuffer(36160,X.next);X.cur=X.next;g.getError()}function Q(b,p){function n(b,e){var l;a(X.next!==g,"can not update framebuffer which is currently in use");
var t=r.webgl_draw_buffers,p=0,u=0,v=!0,F=!0;l=null;var q=!0,C="rgba",A="uint8",z=1,O=null,J=null,Q=null,ca=!1;if("number"===typeof b)p=b|0,u=e|0||p;else if(b){a.type(b,"object","invalid arguments for framebuffer");"shape"in b?(u=b.shape,a(Array.isArray(u)&&2<=u.length,"invalid shape for framebuffer"),p=u[0],u=u[1]):("radius"in b&&(p=u=b.radius),"width"in b&&(p=b.width),"height"in b&&(u=b.height));if("color"in b||"colors"in b)l=b.color||b.colors,Array.isArray(l)&&a(1===l.length||t,"multiple render targets not supported");
if(!l){"colorCount"in b&&(z=b.colorCount|0,a(0<z,"invalid color buffer count"));"colorTexture"in b&&(q=!!b.colorTexture,C="rgba4");if("colorType"in b){A=b.colorType;if(q)a(r.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),a(r.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===A||"float16"===
A)a(r.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),C="rgba16f";else if("float"===A||"float32"===A)a(r.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),C="rgba32f";a.oneOf(A,D,"invalid color type")}if("colorFormat"in b)if(C=b.colorFormat,0<=H.indexOf(C))q=!0;else if(0<=U.indexOf(C))q=!1;else if(q)a.oneOf(b.colorFormat,H,"invalid color format for texture");else a.oneOf(b.colorFormat,
U,"invalid color format for renderbuffer")}if("depthTexture"in b||"depthStencilTexture"in b)ca=!(!b.depthTexture&&!b.depthStencilTexture),a(!ca||r.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in b&&("boolean"===typeof b.depth?v=b.depth:(O=b.depth,F=!1));"stencil"in b&&("boolean"===typeof b.stencil?F=b.stencil:(J=b.stencil,v=!1));"depthStencil"in b&&("boolean"===typeof b.depthStencil?v=F=b.depthStencil:(Q=b.depthStencil,F=v=!1))}else p=u=1;var R=t=null,T=null,P=null;if(Array.isArray(l))t=
l.map(B);else if(l)t=[B(l)];else for(t=Array(z),l=0;l<z;++l)t[l]=E(p,u,q,C,A);a(r.webgl_draw_buffers||1>=t.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");a(t.length<=k.maxColorAttachments,"too many color attachments, not supported");p=p||t[0].width;u=u||t[0].height;O?R=B(O):v&&!F&&(R=E(p,u,ca,"depth","uint32"));J?T=B(J):F&&!v&&(T=E(p,u,!1,"stencil","uint8"));Q?P=B(Q):!O&&!J&&F&&v&&(P=E(p,u,ca,"depth stencil","depth stencil"));a(1>=!!O+!!J+!!Q,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");
v=null;for(l=0;l<t.length;++l)w(t[l],p,u),a(!t[l]||t[l].texture&&0<=f.indexOf(t[l].texture._texture.format)||t[l].renderbuffer&&0<=d.indexOf(t[l].renderbuffer._renderbuffer.format),"framebuffer color attachment "+l+" is invalid"),t[l]&&t[l].texture&&(F=c[t[l].texture._texture.format]*h[t[l].texture._texture.type],null===v?v=F:a(v===F,"all color attachments much have the same number of bits per pixel."));w(R,p,u);a(!R||R.texture&&6402===R.texture._texture.format||R.renderbuffer&&33189===R.renderbuffer._renderbuffer.format,
"invalid depth attachment for framebuffer object");w(T,p,u);a(!T||T.renderbuffer&&36168===T.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");w(P,p,u);a(!P||P.texture&&34041===P.texture._texture.format||P.renderbuffer&&34041===P.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");I(g);g.width=p;g.height=u;g.colorAttachments=t;g.depthAttachment=R;g.stencilAttachment=T;g.depthStencilAttachment=P;n.color=t.map(y);n.depth=y(R);
n.stencil=y(T);n.depthStencil=y(P);n.width=g.width;n.height=g.height;x(g);return n}var g=new t;q.framebufferCount++;n(b,p);return e(n,{resize:function(b,c){a(X.next!==g,"can not resize a framebuffer which is currently in use");var d=b|0,e=c|0||d;if(d===g.width&&e===g.height)return n;for(var f=g.colorAttachments,k=0;k<f.length;++k)l(f[k],d,e);l(g.depthAttachment,d,e);l(g.stencilAttachment,d,e);l(g.depthStencilAttachment,d,e);g.width=n.width=d;g.height=n.height=e;x(g);return n},_reglType:"framebuffer",
_framebuffer:g,destroy:function(){O(g);I(g)},bind:function(a){X.setFBO({framebuffer:n},a)}})}var X={cur:null,next:null,dirty:!1,setFBO:null},H=["rgba"],U=["rgba4","rgb565","rgb5 a1"];r.ext_srgb&&U.push("srgba");r.ext_color_buffer_half_float&&U.push("rgba16f","rgb16f");r.webgl_color_buffer_float&&U.push("rgba32f");var D=["uint8"];r.oes_texture_half_float&&D.push("half float","float16");r.oes_texture_float&&D.push("float","float32");var R=0,T={};return e(X,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof t)?a:null},create:Q,createCube:function(b){function c(b){var f;a(0>d.indexOf(X.next),"can not update framebuffer which is currently in use");var l=r.webgl_draw_buffers,k={color:null},h=0,t=null;f="rgba";var p="uint8",g=1;if("number"===typeof b)h=b|0;else if(b){a.type(b,"object","invalid arguments for framebuffer");"shape"in b?(h=b.shape,a(Array.isArray(h)&&2<=h.length,"invalid shape for framebuffer"),a(h[0]===h[1],"cube framebuffer must be square"),
h=h[0]):("radius"in b&&(h=b.radius|0),"width"in b?(h=b.width|0,"height"in b&&a(b.height===h,"must be square")):"height"in b&&(h=b.height|0));if("color"in b||"colors"in b)t=b.color||b.colors,Array.isArray(t)&&a(1===t.length||l,"multiple render targets not supported");t||("colorCount"in b&&(g=b.colorCount|0,a(0<g,"invalid color buffer count")),"colorType"in b&&(a.oneOf(b.colorType,D,"invalid color type"),p=b.colorType),"colorFormat"in b&&(f=b.colorFormat,a.oneOf(b.colorFormat,H,"invalid color format for texture")));
"depth"in b&&(k.depth=b.depth);"stencil"in b&&(k.stencil=b.stencil);"depthStencil"in b&&(k.depthStencil=b.depthStencil)}else h=1;if(t)if(Array.isArray(t))for(b=[],f=0;f<t.length;++f)b[f]=t[f];else b=[t];else for(b=Array(g),t={radius:h,format:f,type:p},f=0;f<g;++f)b[f]=n.createCube(t);k.color=Array(b.length);for(f=0;f<b.length;++f)g=b[f],a("function"===typeof g&&"textureCube"===g._reglType,"invalid cube map"),h=h||g.width,a(g.width===h&&g.height===h,"invalid cube map shape"),k.color[f]={target:34069,
data:b[f]};for(f=0;6>f;++f){for(g=0;g<b.length;++g)k.color[g].target=34069+f;0<f&&(k.depth=d[0].depth,k.stencil=d[0].stencil,k.depthStencil=d[0].depthStencil);if(d[f])d[f](k);else d[f]=Q(k)}return e(c,{width:h,height:h,color:b})}var d=Array(6);c(b);return e(c,{faces:d,resize:function(b){var e=b|0;a(0<e&&e<=k.maxCubeMapSize,"invalid radius for cube fbo");if(e===c.width)return c;var f=c.color;for(b=0;b<f.length;++b)f[b].resize(e);for(b=0;6>b;++b)d[b].resize(e);c.width=c.height=e;return c},_reglType:"framebufferCube",
destroy:function(){d.forEach(function(a){a.destroy()})}})},clear:function(){b(T).forEach(O)},restore:function(){b(T).forEach(function(a){a.framebuffer=g.createFramebuffer();x(a)})}})}},{"./util/check":21,"./util/extend":24,"./util/values":33}],13:[function(g,q,x){q.exports=function(a,b){var e=1;b.ext_texture_filter_anisotropic&&(e=a.getParameter(34047));var f=1,c=1;b.webgl_draw_buffers&&(f=a.getParameter(34852),c=a.getParameter(36063));return{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),
a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),maxAnisotropic:e,maxDrawbuffers:f,maxColorAttachments:c,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),
maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938)}}},{}],14:[function(g,q,x){var a=g("./util/check"),b=g("./util/is-typed-array");q.exports=function(e,f,c,h,d,p){function g(k){var n;null===f.next?(a(d.preserveDrawingBuffer,
'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),n=5121):(a(null!==f.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),n=f.next.colorAttachments[0].texture._texture.type,p.oes_texture_float?a(5121===n||5126===n,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):a(5121===n,"Reading from a framebuffer is only allowed for the type 'uint8'"));var u=0,r=0,q=h.framebufferWidth,z=h.framebufferHeight,
w=null;b(k)?w=k:k&&(a.type(k,"object","invalid arguments to regl.read()"),u=k.x|0,r=k.y|0,a(0<=u&&u<h.framebufferWidth,"invalid x offset for regl.read"),a(0<=r&&r<h.framebufferHeight,"invalid y offset for regl.read"),q=(k.width||h.framebufferWidth-u)|0,z=(k.height||h.framebufferHeight-r)|0,w=k.data||null);w&&(5121===n?a(w instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===n&&a(w instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));
a(0<q&&q+u<=h.framebufferWidth,"invalid width for read pixels");a(0<z&&z+r<=h.framebufferHeight,"invalid height for read pixels");c();k=q*z*4;w||(5121===n?w=new Uint8Array(k):5126===n&&(w=w||new Float32Array(k)));a.isTypedArray(w,"data buffer for regl.read() must be a typedarray");a(w.byteLength>=k,"data buffer for regl.read() too small");e.pixelStorei(3333,4);e.readPixels(u,r,q,z,6408,n,w);return w}function r(a){var b;f.setFBO({framebuffer:a.framebuffer},function(){b=g(a)});return b}return function(a){return a&&
"framebuffer"in a?r(a):g(a)}}},{"./util/check":21,"./util/is-typed-array":28}],15:[function(g,q,x){var a=g("./util/check"),b=g("./util/values"),e=[];e[32854]=2;e[32855]=2;e[36194]=2;e[33189]=2;e[36168]=1;e[34041]=4;e[35907]=4;e[34836]=16;e[34842]=8;e[34843]=6;q.exports=function(f,c,h,d,p){function g(a){this.id=F++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;p.profile&&(this.stats={size:0})}function r(b){var c=b.renderbuffer;a(c,"must not double destroy renderbuffer");
f.bindRenderbuffer(36161,null);f.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete q[b.id];d.renderbufferCount--}var k={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};c.ext_srgb&&(k.srgba=35907);c.ext_color_buffer_half_float&&(k.rgba16f=34842,k.rgb16f=34843);c.webgl_color_buffer_float&&(k.rgba32f=34836);var n=[];Object.keys(k).forEach(function(a){n[k[a]]=a});var F=0,q={};g.prototype.decRef=function(){0>=--this.refCount&&r(this)};p.profile&&(d.getTotalRenderbufferSize=
function(){var a=0;Object.keys(q).forEach(function(b){a+=q[b].stats.size});return a});return{create:function(b,c){function r(b,c){var d=0,l=0,t=32854;"object"===typeof b&&b?("shape"in b?(l=b.shape,a(Array.isArray(l)&&2<=l.length,"invalid renderbuffer shape"),d=l[0]|0,l=l[1]|0):("radius"in b&&(d=l=b.radius|0),"width"in b&&(d=b.width|0),"height"in b&&(l=b.height|0)),"format"in b&&(a.parameter(b.format,k,"invalid renderbuffer format"),t=k[b.format])):"number"===typeof b?(d=b|0,l="number"===typeof c?
c|0:d):b?a.raise("invalid arguments to renderbuffer constructor"):d=l=1;a(0<d&&0<l&&d<=h.maxRenderbufferSize&&l<=h.maxRenderbufferSize,"invalid renderbuffer size");if(d!==v.width||l!==v.height||t!==v.format)return r.width=v.width=d,r.height=v.height=l,v.format=t,f.bindRenderbuffer(36161,v.renderbuffer),f.renderbufferStorage(36161,t,d,l),p.profile&&(v.stats.size=e[v.format]*v.width*v.height),r.format=n[v.format],r}var v=new g(f.createRenderbuffer());q[v.id]=v;d.renderbufferCount++;r(b,c);r.resize=
function(b,c){var d=b|0,l=c|0||d;if(d===v.width&&l===v.height)return r;a(0<d&&0<l&&d<=h.maxRenderbufferSize&&l<=h.maxRenderbufferSize,"invalid renderbuffer size");r.width=v.width=d;r.height=v.height=l;f.bindRenderbuffer(36161,v.renderbuffer);f.renderbufferStorage(36161,v.format,d,l);p.profile&&(v.stats.size=e[v.format]*v.width*v.height);return r};r._reglType="renderbuffer";r._renderbuffer=v;p.profile&&(r.stats=v.stats);r.destroy=function(){v.decRef()};return r},clear:function(){b(q).forEach(r)},restore:function(){b(q).forEach(function(a){a.renderbuffer=
f.createRenderbuffer();f.bindRenderbuffer(36161,a.renderbuffer);f.renderbufferStorage(36161,a.format,a.width,a.height)});f.bindRenderbuffer(36161,null)}}}},{"./util/check":21,"./util/values":33}],16:[function(g,q,x){var a=g("./util/check"),b=g("./util/values");q.exports=function(e,f,c,h){function d(a,b,c,d){this.name=a;this.id=b;this.location=c;this.info=d}function p(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function g(b,c,d){var h=35632===b?n:F,
k=h[c];if(!k){var l=f.str(c),k=e.createShader(b);e.shaderSource(k,l);e.compileShader(k);a.shaderError(e,k,l,b,d);h[c]=k}return k}function r(a,b){this.id=z++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];h.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function k(b,c){var k,n;k=g(35632,b.fragId);n=g(35633,b.vertId);var r=b.program=e.createProgram();e.attachShader(r,k);e.attachShader(r,n);e.linkProgram(r);a.linkError(e,r,f.str(b.fragId),f.str(b.vertId),
c);var l=e.getProgramParameter(r,35718);h.profile&&(b.stats.uniformsCount=l);var t=b.uniforms;for(k=0;k<l;++k)if(n=e.getActiveUniform(r,k))if(1<n.size)for(var q=0;q<n.size;++q){var F=n.name.replace("[0]","["+q+"]");p(t,new d(F,f.id(F),e.getUniformLocation(r,F),n))}else p(t,new d(n.name,f.id(n.name),e.getUniformLocation(r,n.name),n));l=e.getProgramParameter(r,35721);h.profile&&(b.stats.attributesCount=l);t=b.attributes;for(k=0;k<l;++k)(n=e.getActiveAttrib(r,k))&&p(t,new d(n.name,f.id(n.name),e.getAttribLocation(r,
n.name),n))}var n={},F={},q={},C=[],z=0;h.profile&&(c.getMaxUniformsCount=function(){var a=0;C.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)});return a},c.getMaxAttributesCount=function(){var a=0;C.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var a=e.deleteShader.bind(e);b(n).forEach(a);n={};b(F).forEach(a);F={};C.forEach(function(a){e.deleteProgram(a.program)});C.length=0;q={};c.shaderCount=0},program:function(b,
d,e){a.command(0<=b,"missing vertex shader",e);a.command(0<=d,"missing fragment shader",e);var f=q[d];f||(f=q[d]={});var h=f[b];h||(h=new r(d,b),c.shaderCount++,k(h,e),f[b]=h,C.push(h));return h},restore:function(){n={};F={};for(var a=0;a<C.length;++a)k(C[a])},shader:g,frag:-1,vert:-1}}},{"./util/check":21,"./util/values":33}],17:[function(g,q,x){q.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},
{}],18:[function(g,q,x){q.exports=function(){var a={"":0},b=[""];return{id:function(e){var f=a[e];if(f)return f;f=a[e]=b.length;b.push(e);return f},str:function(a){return b[a]}}}},{}],19:[function(g,q,x){function a(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function b(a){return Array.isArray(a)&&0!==a.length&&A(a[0])?!0:!1}function e(a){return Object.prototype.toString.call(a)}function f(c){if(!c)return!1;var d=e(c);return 0<=E.indexOf(d)?!0:a(c)||b(c)||k(c)}function c(a,b){36193===
a.type?(a.data=F(b),n.freeType(b)):a.data=b}function h(a,b,c,d,e,f){a="undefined"!==typeof l[a]?l[a]:B[a]*y[b];f&&(a*=6);if(e){for(d=0;1<=c;)d+=a*c*c,c/=2;return d}return a*c*d}var d=g("./util/check"),p=g("./util/extend"),u=g("./util/values"),r=g("./util/is-typed-array"),k=g("./util/is-ndarray"),n=g("./util/pool"),F=g("./util/to-half-float"),A=g("./util/is-array-like"),C=g("./util/flatten");x=g("./constants/arraytypes.json");var z=g("./constants/arraytypes.json"),w=[9984,9986,9985,9987],v=[0,6409,
6410,6407,6408],B={};B[6409]=B[6406]=B[6402]=1;B[34041]=B[6410]=2;B[6407]=B[35904]=3;B[6408]=B[35906]=4;var E=Object.keys(x).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),y=[];y[5121]=1;y[5126]=4;y[36193]=2;y[5123]=2;y[5125]=4;var l=[];l[32854]=2;l[32855]=2;l[36194]=2;l[34041]=4;l[33776]=.5;l[33777]=.5;l[33778]=1;l[33779]=1;l[35986]=.5;l[35987]=1;l[34798]=1;l[35840]=.5;l[35841]=.25;l[35842]=.5;l[35843]=.25;l[36196]=
.5;q.exports=function(l,g,q,y,x,E,H){function U(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function D(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=
b.channels}function R(a,b){if("object"===typeof b&&b){"premultiplyAlpha"in b&&(d.type(b.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=b.premultiplyAlpha);"flipY"in b&&(d.type(b.flipY,"boolean","invalid texture flip"),a.flipY=b.flipY);"alignment"in b&&(d.oneOf(b.alignment,[1,2,4,8],"invalid texture unpack alignment"),a.unpackAlignment=b.alignment);"colorSpace"in b&&(d.parameter(b.colorSpace,P,"invalid colorSpace"),a.colorSpace=P[b.colorSpace]);if("type"in b){var c=b.type;
d(g.oes_texture_float||!("float"===c||"float32"===c),"you must enable the OES_texture_float extension in order to use floating point textures.");d(g.oes_texture_half_float||!("half float"===c||"float16"===c),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");d(g.webgl_depth_texture||!("uint16"===c||"uint32"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");d.parameter(c,M,"invalid texture type");
a.type=M[c]}var e=a.width,f=a.height,l=a.channels,c=!1;"shape"in b?(d(Array.isArray(b.shape)&&2<=b.shape.length,"shape must be an array"),e=b.shape[0],f=b.shape[1],3===b.shape.length&&(l=b.shape[2],d(0<l&&4>=l,"invalid number of channels"),c=!0),d(0<=e&&e<=q.maxTextureSize,"invalid width"),d(0<=f&&f<=q.maxTextureSize,"invalid height")):("radius"in b&&(e=f=b.radius,d(0<=e&&e<=q.maxTextureSize,"invalid radius")),"width"in b&&(e=b.width,d(0<=e&&e<=q.maxTextureSize,"invalid width")),"height"in b&&(f=
b.height,d(0<=f&&f<=q.maxTextureSize,"invalid height")),"channels"in b&&(l=b.channels,d(0<l&&4>=l,"invalid number of channels"),c=!0));a.width=e|0;a.height=f|0;a.channels=l|0;e=!1;"format"in b&&(e=b.format,d(g.webgl_depth_texture||!("depth"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),d.parameter(e,W,"invalid texture format"),f=a.internalformat=W[e],a.format=Ja[f],e in M&&!("type"in b)&&(a.type=M[e]),e in da&&(a.compressed=
!0),e=!0);!c&&e?a.channels=B[a.format]:c&&!e?a.channels!==v[a.format]&&(a.format=a.internalformat=v[a.channels]):e&&c&&d(a.channels===B[a.format],"number of channels inconsistent with specified format")}}function T(a){l.pixelStorei(37440,a.flipY);l.pixelStorei(37441,a.premultiplyAlpha);l.pixelStorei(37443,a.colorSpace);l.pixelStorei(3317,a.unpackAlignment)}function ca(){U.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function J(m,l){var h=
null;f(l)?h=l:l&&(d.type(l,"object","invalid pixel data type"),R(m,l),"x"in l&&(m.xOffset=l.x|0),"y"in l&&(m.yOffset=l.y|0),f(l.data)&&(h=l.data));d(!m.compressed||h instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(l.copy){d(!h,"can not specify copy and data field for the same texture");var p=x.viewportWidth,g=x.viewportHeight;m.width=m.width||p-m.xOffset;m.height=m.height||g-m.yOffset;m.needsCopy=!0;d(0<=m.xOffset&&m.xOffset<p&&0<=m.yOffset&&m.yOffset<g&&0<m.width&&
m.width<=p&&0<m.height&&m.height<=g,"copy texture read out of bounds")}else if(!h)m.width=m.width||1,m.height=m.height||1,m.channels=m.channels||4;else if(r(h))m.channels=m.channels||4,m.data=h,"type"in l||5121!==m.type||(m.type=z[Object.prototype.toString.call(h)]|0);else if(a(h)){m.channels=m.channels||4;p=h;g=p.length;switch(m.type){case 5121:case 5123:case 5125:case 5126:g=n.allocType(m.type,g);g.set(p);m.data=g;break;case 36193:m.data=F(p);break;default:d.raise("unsupported texture type, must specify a typed array")}m.alignment=
1;m.needsFree=!0}else if(k(h)){p=h.data;Array.isArray(p)||5121!==m.type||(m.type=z[Object.prototype.toString.call(p)]|0);var g=h.shape,t=h.stride,u,w,I,y;3===g.length?(I=g[2],y=t[2]):(d(2===g.length,"invalid ndarray pixel data, must be 2 or 3D"),y=I=1);u=g[0];w=g[1];g=t[0];t=t[1];m.alignment=1;m.width=u;m.height=w;m.channels=I;m.format=m.internalformat=v[I];m.needsFree=!0;u=y;h=h.offset;I=m.width;y=m.height;w=m.channels;for(var D=n.allocType(36193===m.type?5126:m.type,I*y*w),H=0,B=0;B<y;++B)for(var E=
0;E<I;++E)for(var pa=0;pa<w;++pa)D[H++]=p[g*E+t*B+u*pa+h];c(m,D)}else if("[object HTMLCanvasElement]"===e(h)||"[object CanvasRenderingContext2D]"===e(h))"[object HTMLCanvasElement]"===e(h)?m.element=h:m.element=h.canvas,m.width=m.element.width,m.height=m.element.height,m.channels=4;else if("[object HTMLImageElement]"===e(h))m.element=h,m.width=h.naturalWidth,m.height=h.naturalHeight,m.channels=4;else if("[object HTMLVideoElement]"===e(h))m.element=h,m.width=h.videoWidth,m.height=h.videoHeight,m.channels=
4;else if(b(h)){p=m.width||h[0].length;g=m.height||h.length;t=m.channels;t=A(h[0][0])?t||h[0][0].length:t||1;u=C.shape(h);I=1;for(y=0;y<u.length;++y)I*=u[y];I=n.allocType(36193===m.type?5126:m.type,I);C.flatten(h,u,"",I);c(m,I);m.alignment=1;m.width=p;m.height=g;m.channels=t;m.format=m.internalformat=v[t];m.needsFree=!0}5126===m.type?d(0<=q.extensions.indexOf("oes_texture_float"),"oes_texture_float extension not enabled"):36193===m.type&&d(0<=q.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}
function qa(a,b,c,d,e){var f=a.element,h=a.data,k=a.internalformat,p=a.format,g=a.type,n=a.width,u=a.height;T(a);f?l.texSubImage2D(b,e,c,d,p,g,f):a.compressed?l.compressedTexSubImage2D(b,e,c,d,k,n,u,h):a.needsCopy?(y(),l.copyTexSubImage2D(b,e,c,d,a.xOffset,a.yOffset,n,u)):l.texSubImage2D(b,e,c,d,n,u,p,g,h)}function ja(){return Ka.pop()||new ca}function na(a){a.needsFree&&n.freeType(a.data);ca.call(a);Ka.push(a)}function va(){U.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=
Array(16)}function Y(a,b,c){var d=a.images[0]=ja();a.mipmask=1;d.width=a.width=b;d.height=a.height=c;d.channels=a.channels=4}function N(a,b){var c=null;if(f(b))c=a.images[0]=ja(),D(c,a),J(c,b),a.mipmask=1;else if(R(a,b),Array.isArray(b.mipmap))for(var e=b.mipmap,l=0;l<e.length;++l)c=a.images[l]=ja(),D(c,a),c.width>>=l,c.height>>=l,J(c,e[l]),a.mipmask|=1<<l;else c=a.images[0]=ja(),D(c,a),J(c,b),a.mipmask=1;D(a,a.images[0]);(a.compressed&&33776===a.internalformat||33777===a.internalformat||33778===
a.internalformat||33779===a.internalformat)&&d(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function K(a,b){for(var c=a.images,d=0;d<c.length&&c[d];++d){var e=c[d],f=b,h=d,k=e.element,p=e.data,g=e.internalformat,n=e.format,u=e.type,r=e.width,q=e.height;T(e);k?l.texImage2D(f,h,n,n,u,k):e.compressed?l.compressedTexImage2D(f,h,g,r,q,0,p):e.needsCopy?(y(),l.copyTexImage2D(f,h,n,e.xOffset,e.yOffset,r,q,0)):l.texImage2D(f,
h,n,r,q,0,n,u,p)}}function Ba(){var a=La.pop()||new va;U.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function sa(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&na(b[c]),b[c]=null;La.push(a)}function wa(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function Z(a,b){if("min"in b){var c=b.min;d.parameter(c,ga);a.minFilter=ga[c];0<=w.indexOf(a.minFilter)&&(a.genMipmaps=!0)}"mag"in b&&(c=b.mag,d.parameter(c,
V),a.magFilter=V[c]);var c=a.wrapS,e=a.wrapT;if("wrap"in b){var f=b.wrap;"string"===typeof f?(d.parameter(f,S),c=e=S[f]):Array.isArray(f)&&(d.parameter(f[0],S),d.parameter(f[1],S),c=S[f[0]],e=S[f[1]])}else"wrapS"in b&&(c=b.wrapS,d.parameter(c,S),c=S[c]),"wrapT"in b&&(e=b.wrapT,d.parameter(e,S),e=S[e]);a.wrapS=c;a.wrapT=e;"anisotropic"in b&&(c=b.anisotropic,d("number"===typeof c&&1<=c&&c<=q.maxAnisotropic,"aniso samples must be between 1 and "),a.anisotropic=b.anisotropic);if("mipmap"in b){c=!1;switch(typeof b.mipmap){case "string":d.parameter(b.mipmap,
xa,"invalid mipmap hint");a.mipmapHint=xa[b.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=b.mipmap;break;case "object":d(Array.isArray(b.mipmap),"invalid mipmap type");a.genMipmaps=!1;c=!0;break;default:d.raise("invalid mipmap type")}!c||"min"in b||(a.minFilter=9984)}}function ia(a,b){l.texParameteri(b,10241,a.minFilter);l.texParameteri(b,10240,a.magFilter);l.texParameteri(b,10242,a.wrapS);l.texParameteri(b,10243,a.wrapT);g.ext_texture_filter_anisotropic&&l.texParameteri(b,34046,a.anisotropic);
a.genMipmaps&&(l.hint(33170,a.mipmapHint),l.generateMipmap(b))}function ka(a){U.call(this);this.mipmask=0;this.internalformat=6408;this.id=Na++;this.refCount=1;this.target=a;this.texture=l.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new wa;H.profile&&(this.stats={size:0})}function la(a){l.activeTexture(33984);l.bindTexture(a.target,a.texture)}function ma(){var a=aa[0];a?l.bindTexture(a.target,a.texture):l.bindTexture(3553,null)}function oa(a){var b=a.texture;d(b,"must not double destroy texture");
var c=a.unit,e=a.target;0<=c&&(l.activeTexture(33984+c),l.bindTexture(e,null),aa[c]=null);l.deleteTexture(b);a.texture=null;a.params=null;a.pixels=null;a.refCount=0;delete ua[a.id];E.textureCount--}var xa={"don't care":4352,"dont care":4352,nice:4354,fast:4353},S={repeat:10497,clamp:33071,mirror:33648},V={nearest:9728,linear:9729},ga=p({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},V),P={none:0,browser:37444},M={uint8:5121,
rgba4:32819,rgb565:33635,"rgb5 a1":32820},W={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},da={};g.ext_srgb&&(W.srgb=35904,W.srgba=35906);g.oes_texture_float&&(M.float32=M["float"]=5126);g.oes_texture_half_float&&(M.float16=M["half float"]=36193);g.webgl_depth_texture&&(p(W,{depth:6402,"depth stencil":34041}),p(M,{uint16:5123,uint32:5125,"depth stencil":34042}));g.webgl_compressed_texture_s3tc&&p(da,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,
"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});g.webgl_compressed_texture_atc&&p(da,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});g.webgl_compressed_texture_pvrtc&&p(da,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});g.webgl_compressed_texture_etc1&&(da["rgb etc1"]=36196);var ya=Array.prototype.slice.call(l.getParameter(34467));Object.keys(da).forEach(function(a){var b=da[a];0<=ya.indexOf(b)&&(W[a]=
b)});var ha=Object.keys(W);q.textureFormats=ha;var ta=[];Object.keys(W).forEach(function(a){ta[W[a]]=a});var pa=[];Object.keys(M).forEach(function(a){pa[M[a]]=a});var Ea=[];Object.keys(V).forEach(function(a){Ea[V[a]]=a});var Ia=[];Object.keys(ga).forEach(function(a){Ia[ga[a]]=a});var Da=[];Object.keys(S).forEach(function(a){Da[S[a]]=a});var Ja=ha.reduce(function(a,b){var c=W[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},
{}),Ka=[],La=[],Na=0,ua={},ra=q.maxTextureUnits,aa=Array(ra).map(function(){return null});p(ka.prototype,{bind:function(){this.bindCount+=1;var a=this.unit;if(0>a){for(var b=0;b<ra;++b){var c=aa[b];if(c){if(0<c.bindCount)continue;c.unit=-1}aa[b]=this;a=b;break}a>=ra&&d.raise("insufficient number of texture units");H.profile&&E.maxTextureUnits<a+1&&(E.maxTextureUnits=a+1);this.unit=a;l.activeTexture(33984+a);l.bindTexture(this.target,this.texture)}return a},unbind:function(){--this.bindCount},decRef:function(){0>=
--this.refCount&&oa(this)}});H.profile&&(E.getTotalTextureSize=function(){var a=0;Object.keys(ua).forEach(function(b){a+=ua[b].stats.size});return a});return{create2D:function(a,b){function c(a,b){var f=e.texInfo;wa.call(f);var l=Ba();"number"===typeof a?"number"===typeof b?Y(l,a|0,b|0):Y(l,a|0,a|0):a?(d.type(a,"object","invalid arguments to regl.texture"),Z(f,a),N(l,a)):Y(l,1,1);f.genMipmaps&&(l.mipmask=(l.width<<1)-1);e.mipmask=l.mipmask;D(e,l);d.texture2D(f,l,q);e.internalformat=l.internalformat;
c.width=l.width;c.height=l.height;la(e);K(l,3553);ia(f,3553);ma();sa(l);H.profile&&(e.stats.size=h(e.internalformat,e.type,l.width,l.height,f.genMipmaps,!1));c.format=ta[e.internalformat];c.type=pa[e.type];c.mag=Ea[f.magFilter];c.min=Ia[f.minFilter];c.wrapS=Da[f.wrapS];c.wrapT=Da[f.wrapT];return c}var e=new ka(3553);ua[e.id]=e;E.textureCount++;c(a,b);c.subimage=function(a,b,f,l){d(!!a,"must specify image data");b|=0;f|=0;l|=0;var h=ja();D(h,e);h.width=0;h.height=0;J(h,a);h.width=h.width||(e.width>>
l)-b;h.height=h.height||(e.height>>l)-f;d(e.type===h.type&&e.format===h.format&&e.internalformat===h.internalformat,"incompatible format for texture.subimage");d(0<=b&&0<=f&&b+h.width<=e.width&&f+h.height<=e.height,"texture.subimage write out of bounds");d(e.mipmask&1<<l,"missing mipmap data");d(h.data||h.element||h.needsCopy,"missing image data");la(e);qa(h,3553,b,f,l);ma();na(h);return c};c.resize=function(a,b){var d=a|0,f=b|0||d;if(d===e.width&&f===e.height)return c;c.width=e.width=d;c.height=
e.height=f;la(e);for(var k=0;e.mipmask>>k;++k)l.texImage2D(3553,k,e.format,d>>k,f>>k,0,e.format,e.type,null);ma();H.profile&&(e.stats.size=h(e.internalformat,e.type,d,f,!1,!1));return c};c._reglType="texture2d";c._texture=e;H.profile&&(c.stats=e.stats);c.destroy=function(){e.decRef()};return c},createCube:function(a,b,c,e,f,k){function p(a,b,c,e,f,l){var k,m=g.texInfo;wa.call(m);for(k=0;6>k;++k)n[k]=Ba();if("number"!==typeof a&&a)if("object"===typeof a)if(b)N(n[0],a),N(n[1],b),N(n[2],c),N(n[3],e),
N(n[4],f),N(n[5],l);else if(Z(m,a),R(g,a),"faces"in a)for(a=a.faces,d(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),k=0;6>k;++k)d("object"===typeof a[k]&&!!a[k],"invalid input for cube map face"),D(n[k],g),N(n[k],a[k]);else for(k=0;6>k;++k)N(n[k],a);else d.raise("invalid arguments to cube map");else for(a=a|0||1,k=0;6>k;++k)Y(n[k],a,a);D(g,n[0]);g.mipmask=m.genMipmaps?(n[0].width<<1)-1:n[0].mipmask;d.textureCube(g,m,n,q);g.internalformat=n[0].internalformat;p.width=n[0].width;
p.height=n[0].height;la(g);for(k=0;6>k;++k)K(n[k],34069+k);ia(m,34067);ma();H.profile&&(g.stats.size=h(g.internalformat,g.type,p.width,p.height,m.genMipmaps,!0));p.format=ta[g.internalformat];p.type=pa[g.type];p.mag=Ea[m.magFilter];p.min=Ia[m.minFilter];p.wrapS=Da[m.wrapS];p.wrapT=Da[m.wrapT];for(k=0;6>k;++k)sa(n[k]);return p}var g=new ka(34067);ua[g.id]=g;E.cubeCount++;var n=Array(6);p(a,b,c,e,f,k);p.subimage=function(a,b,c,e,f){d(!!b,"must specify image data");d("number"===typeof a&&a===(a|0)&&
0<=a&&6>a,"invalid face");c|=0;e|=0;f|=0;var l=ja();D(l,g);l.width=0;l.height=0;J(l,b);l.width=l.width||(g.width>>f)-c;l.height=l.height||(g.height>>f)-e;d(g.type===l.type&&g.format===l.format&&g.internalformat===l.internalformat,"incompatible format for texture.subimage");d(0<=c&&0<=e&&c+l.width<=g.width&&e+l.height<=g.height,"texture.subimage write out of bounds");d(g.mipmask&1<<f,"missing mipmap data");d(l.data||l.element||l.needsCopy,"missing image data");la(g);qa(l,34069+a,c,e,f);ma();na(l);
return p};p.resize=function(a){a|=0;if(a!==g.width){p.width=g.width=a;p.height=g.height=a;la(g);for(var b=0;6>b;++b)for(var c=0;g.mipmask>>c;++c)l.texImage2D(34069+b,c,g.format,a>>c,a>>c,0,g.format,g.type,null);ma();H.profile&&(g.stats.size=h(g.internalformat,g.type,p.width,p.height,!1,!0));return p}};p._reglType="textureCube";p._texture=g;H.profile&&(p.stats=g.stats);p.destroy=function(){g.decRef()};return p},clear:function(){for(var a=0;a<ra;++a)l.activeTexture(33984+a),l.bindTexture(3553,null),
aa[a]=null;u(ua).forEach(oa);E.cubeCount=0;E.textureCount=0},getTexture:function(a){return null},restore:function(){u(ua).forEach(function(a){a.texture=l.createTexture();l.bindTexture(a.target,a.texture);for(var b=0;32>b;++b)if(0!==(a.mipmask&1<<b))if(3553===a.target)l.texImage2D(3553,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);else for(var c=0;6>c;++c)l.texImage2D(34069+c,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);ia(a.texInfo,a.target)})}}}},
{"./constants/arraytypes.json":4,"./util/check":21,"./util/extend":24,"./util/flatten":25,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/to-half-float":32,"./util/values":33}],20:[function(g,q,x){q.exports=function(a,b){function e(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function f(a,b,c){var d=p.pop()||new e;d.startQueryIndex=a;d.endQueryIndex=b;d.sum=0;d.stats=c;g.push(d)}var c=b.ext_disjoint_timer_query;if(!c)return null;
var h=[],d=[],p=[],g=[],r=[],k=[];return{beginQuery:function(a){var b=h.pop()||c.createQueryEXT();c.beginQueryEXT(35007,b);d.push(b);f(d.length-1,d.length,a)},endQuery:function(){c.endQueryEXT(35007)},pushScopeStats:f,update:function(){var a,b;a=d.length;if(0!==a){k.length=Math.max(k.length,a+1);r.length=Math.max(r.length,a+1);r[0]=0;var e=k[0]=0;for(b=a=0;b<d.length;++b){var f=d[b];c.getQueryObjectEXT(f,34919)?(e+=c.getQueryObjectEXT(f,34918),h.push(f)):d[a++]=f;r[b+1]=e;k[b+1]=a}d.length=a;for(b=
a=0;b<g.length;++b){var e=g[b],q=e.startQueryIndex,f=e.endQueryIndex;e.sum+=r[f]-r[q];q=k[q];f=k[f];f===q?(e.stats.gpuTime+=e.sum/1E6,p.push(e)):(e.startQueryIndex=q,e.endQueryIndex=f,g[a++]=e)}g.length=a}},getNumPendingQueries:function(){return d.length},clear:function(){h.push.apply(h,d);for(var a=0;a<h.length;a++)c.deleteQueryEXT(h[a]);d.length=0;h.length=0},restore:function(){d.length=0;h.length=0}}}},{}],21:[function(g,q,x){function a(a){return"undefined"!==typeof btoa?btoa(a):"base64:"+a}function b(a){a=
Error("(regl) "+a);console.error(a);throw a;}function e(a,c){a||b(c)}function f(a){return a?": "+a:""}function c(a,c,d){0>c.indexOf(a)&&b("invalid value"+f(d)+". must be one of: "+c)}function h(a,b){for(a+="";a.length<b;)a=" "+a;return a}function d(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function p(a,b){this.number=a;this.line=b;this.errors=[]}function u(a,b,c){this.file=a;this.line=b;this.message=c}function r(){var a=Error(),a=(a.stack||a).toString(),b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);
return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function k(){var a=Error(),a=(a.stack||a).toString(),b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function n(b,c){var e=b.split("\n"),f=1,h=0,k={unknown:new d,0:new d};k.unknown.name=k[0].name=c||r();k.unknown.lines.push(new p(0,""));for(var g=0;g<e.length;++g){var n=e[g],u=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(n);if(u)switch(u[1]){case "line":if(u=
/(\d+)(\s+\d+)?/.exec(u[2]))f=u[1]|0,u[2]&&(h=u[2]|0,h in k||(k[h]=new d));break;case "define":if(u=/SHADER_NAME(_B64)?\s+(.*)$/.exec(u[2]))k[h].name=u[1]?a(u[2]):u[2]}k[h].lines.push(new p(f++,n))}Object.keys(k).forEach(function(a){var b=k[a];b.lines.forEach(function(a){b.index[a.number]=a})});return k}function F(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var c=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(a);c?b.push(new u(c[1]|0,c[2]|0,c[3].trim())):0<a.length&&b.push(new u("unknown",
0,a))}});return b}function A(a,b){b.forEach(function(b){var c=a[b.file];if(c){var d=c.index[b.line];if(d){d.errors.push(b);c.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(b)})}function C(a){a._commandRef=r()}function z(a,c){var d=k();b(a+" in command "+(c||r())+("unknown"===d?"":" called from "+d))}function w(a,b,c,d){typeof a!==b&&z("invalid parameter type"+f(c)+". expected "+b+", got "+typeof a,d||r())}function v(a,b){return 32820===a||32819===a||33635===a?2:34042===
a?4:y[a]*b}var B=g("./is-typed-array");g=g("./extend");var E="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),y={};y[5120]=y[5121]=1;y[5122]=y[5123]=y[36193]=y[33635]=y[32819]=y[32820]=2;y[5124]=y[5125]=y[5126]=y[34042]=4;q.exports=g(e,{optional:function(a){a()},raise:b,commandRaise:z,command:function(a,b,c){a||z(b,c||r())},parameter:function(a,c,d){a in c||b("unknown parameter ("+a+")"+f(d)+". possible values: "+Object.keys(c).join())},commandParameter:function(a,
b,c,d){a in b||z("unknown parameter ("+a+")"+f(c)+". possible values: "+Object.keys(b).join(),d||r())},constructor:function(a){Object.keys(a).forEach(function(a){0>E.indexOf(a)&&b('invalid regl constructor argument "'+a+'". must be one of '+E)})},type:function(a,c,d){typeof a!==c&&b("invalid parameter type"+f(d)+". expected "+c+", got "+typeof a)},commandType:w,isTypedArray:function(a,c){B(a)||b("invalid parameter type"+f(c)+". must be a typed array")},nni:function(a,c){0<=a&&(a|0)===a||b("invalid parameter type, ("+
a+")"+f(c)+". must be a nonnegative integer")},oneOf:c,shaderError:function(a,b,c,d,f){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);a=d===a.FRAGMENT_SHADER?"fragment":"vertex";w(c,"string",a+" shader source must be a string",f);var k=n(c,f);c=F(b);A(k,c);Object.keys(k).forEach(function(a){function b(a,c){d.push(a);e.push(c||"")}var c=k[a];if(c.hasErrors){var d=[""],e=[""];b("file number "+a+": "+c.name+"\n","color:red;text-decoration:underline;font-weight:bold");c.lines.forEach(function(a){if(0<
a.errors.length){b(h(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var c=0;a.errors.forEach(function(d){d=d.message;var e=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(d);if(e){var f=e[1];d=e[2];switch(f){case "assign":f="="}c=Math.max(a.line.indexOf(f,c),0)}else c=0;b(h("| ",6));b(h("^^^",c+3)+"\n","font-weight:bold");b(h("| ",6));b(d+"\n","font-weight:bold")});b(h("| ",6)+"\n")}else b(h(a.number,4)+"|  "),b(a.line+"\n","color:red")});
"undefined"!==typeof document?(e[0]=d.join("%c"),console.log.apply(console,e)):console.log(d.join(""))}});e.raise("Error compiling "+a+" shader, "+k[0].name)}},linkError:function(a,b,c,d,f){a.getProgramParameter(b,a.LINK_STATUS)||(a=a.getProgramInfoLog(b),c=n(c,f),d='Error linking program with vertex shader, "'+n(d,f)[0].name+'", and fragment shader "'+c[0].name+'"',"undefined"!==typeof document?console.log("%c"+d+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(d+
"\n"+a),e.raise(d))},callSite:k,saveCommandRef:C,saveDrawInfo:function(a,b,c,d){function e(a){return a?d.id(a):0}function f(a,b){Object.keys(b).forEach(function(b){a[d.id(b)]=!0})}C(a);a._fragId=e(a["static"].frag);a._vertId=e(a["static"].vert);var h=a._uniformSet={};f(h,b["static"]);f(h,b.dynamic);b=a._attributeSet={};f(b,c["static"]);f(b,c.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,b,d){a.texture?
c(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):c(a.renderbuffer._renderbuffer.format,d,"unsupported renderbuffer format for attachment")},guessCommand:r,texture2D:function(a,b,c){var d=b.width,f=b.height,h=b.channels;e(0<d&&d<=c.maxTextureSize&&0<f&&f<=c.maxTextureSize,"invalid texture shape");33071===a.wrapS&&33071===a.wrapT||e(!(d&d-1)&&!!d&&!(f&f-1)&&!!f,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==d&&1!==
f&&e(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(e(!(d&d-1)&&!!d&&!(f&f-1)&&!!f,"texture must be a square power of 2 to support mipmapping"),e(b.mipmask===(d<<1)-1,"missing or incomplete mipmap data"));5126===b.type&&(0>c.extensions.indexOf("oes_texture_float_linear")&&e(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),e(!a.genMipmaps,"mipmap generation not supported with float textures"));
var k=b.images;for(c=0;16>c;++c)if(k[c]){var p=d>>c,g=f>>c;e(b.mipmask&1<<c,"missing mipmap data");var n=k[c];e(n.width===p&&n.height===g,"invalid shape for mip images");e(n.format===b.format&&n.internalformat===b.internalformat&&n.type===b.type,"incompatible type for mip image");n.compressed||n.data&&e(n.data.byteLength===p*g*Math.max(v(n.type,h),n.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}else a.genMipmaps||e(0===(b.mipmask&1<<c),"extra mipmap data");
b.compressed&&e(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,c,d){var f=a.width,h=a.height,k=a.channels;e(0<f&&f<=d.maxTextureSize&&0<h&&h<=d.maxTextureSize,"invalid texture shape");e(f===h,"cube map must be square");e(33071===b.wrapS&&33071===b.wrapT,"wrap mode not supported by cube map");for(d=0;d<c.length;++d){var p=c[d];e(p.width===f&&p.height===h,"inconsistent cube map face shape");b.genMipmaps&&(e(!p.compressed,"can not generate mipmap for compressed textures"),
e(1===p.mipmask,"can not specify mipmaps and generate mipmaps"));for(var g=p.images,n=0;16>n;++n){var u=g[n];if(u){var r=f>>n,q=h>>n;e(p.mipmask&1<<n,"missing mipmap data");e(u.width===r&&u.height===q,"invalid shape for mip images");e(u.format===a.format&&u.internalformat===a.internalformat&&u.type===a.type,"incompatible type for mip image");u.compressed||u.data&&e(u.data.byteLength===r*q*Math.max(v(u.type,k),u.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}})},
{"./extend":24,"./is-typed-array":28}],22:[function(g,q,x){q.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],23:[function(g,q,x){function a(a){return Array.prototype.slice.call(a)}function b(b){return a(b).join("")}var e=g("./extend");q.exports=function(){function f(){var c=[],d=[];return e(function(){c.push.apply(c,a(arguments))},{def:function(){var b="v"+h++;d.push(b);0<arguments.length&&(c.push(b,"="),c.push.apply(c,
a(arguments)),c.push(";"));return b},toString:function(){return b([0<d.length?"var "+d+";":"",b(c)])}})}function c(){function b(a,e){d(a,e,"=",c.def(a,e),";")}var c=f(),d=f(),h=c.toString,p=d.toString;return e(function(){c.apply(c,a(arguments))},{def:c.def,entry:c,exit:d,save:b,set:function(a,d,e){b(a,d);c(a,d,"=",e,";")},toString:function(){return h()+p()}})}var h=0,d=[],p=[],g=f(),r={};return{global:g,link:function(a){for(var b=0;b<p.length;++b)if(p[b]===a)return d[b];b="g"+h++;d.push(b);p.push(a);
return b},block:f,proc:function(a,d){function f(){var a="a"+h.length;h.push(a);return a}var h=[];d=d||0;for(var p=0;p<d;++p)f();var p=c(),g=p.toString;return r[a]=e(p,{arg:f,toString:function(){return b(["function(",h.join(),"){",g(),"}"])}})},scope:c,cond:function(){var d=b(arguments),f=c(),h=c(),p=f.toString,g=h.toString;return e(f,{then:function(){f.apply(f,a(arguments));return this},"else":function(){h.apply(h,a(arguments));return this},toString:function(){var a=g();a&&(a="else{"+a+"}");return b(["if(",
d,"){",p(),"}",a])}})},compile:function(){var a=['"use strict";',g,"return {"];Object.keys(r).forEach(function(b){a.push('"',b,'":',r[b].toString(),",")});a.push("}");var c=b(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,d.concat(c)).apply(null,p)}}}},{"./extend":24}],24:[function(g,q,x){q.exports=function(a,b){for(var e=Object.keys(b),f=0;f<e.length;++f)a[e[f]]=b[e[f]];return a}},{}],25:[function(g,q,x){function a(a,b,e,d,p,g){for(var r=0;r<b;++r)for(var k=
a[r],n=0;n<e;++n)for(var q=k[n],A=0;A<d;++A)p[g++]=q[A]}function b(e,c,h,d,p){for(var g=1,r=h+1;r<c.length;++r)g*=c[r];var k=c[h];if(4===c.length-h){var n=c[h+1],q=c[h+2];c=c[h+3];for(r=0;r<k;++r)a(e[r],n,q,c,d,p),p+=g}else for(r=0;r<k;++r)b(e[r],c,h+1,d,p),p+=g}var e=g("./pool");q.exports={shape:function(a){for(var b=[];a.length;a=a[0])b.push(a.length);return b},flatten:function(f,c,h,d){var p=1;if(c.length)for(var g=0;g<c.length;++g)p*=c[g];else p=0;h=d||e.allocType(h,p);switch(c.length){case 0:break;
case 1:d=c[0];for(c=0;c<d;++c)h[c]=f[c];break;case 2:d=c[0];c=c[1];for(g=p=0;g<d;++g)for(var r=f[g],k=0;k<c;++k)h[p++]=r[k];break;case 3:a(f,c[0],c[1],c[2],h,0);break;default:b(f,c,0,h,0)}return h}}},{"./pool":30}],26:[function(g,q,x){var a=g("./is-typed-array");q.exports=function(b){return Array.isArray(b)||a(b)}},{"./is-typed-array":28}],27:[function(g,q,x){var a=g("./is-typed-array");q.exports=function(b){return!!b&&"object"===typeof b&&Array.isArray(b.shape)&&Array.isArray(b.stride)&&"number"===
typeof b.offset&&b.shape.length===b.stride.length&&(Array.isArray(b.data)||a(b.data))}},{"./is-typed-array":28}],28:[function(g,q,x){var a=g("../constants/arraytypes.json");q.exports=function(b){return Object.prototype.toString.call(b)in a}},{"../constants/arraytypes.json":4}],29:[function(g,q,x){q.exports=function(a,b){for(var e=Array(a),f=0;f<a;++f)e[f]=b(f);return e}},{}],30:[function(g,q,x){function a(a){var b,d;b=(65535<a)<<4;a>>>=b;d=(255<a)<<3;a>>>=d;b|=d;d=(15<a)<<2;a>>>=d;b|=d;d=(3<a)<<1;
return b|d|a>>>d>>1}function b(b){a:{for(var e=16;268435456>=e;e*=16)if(b<=e){b=e;break a}b=0}e=f[a(b)>>2];return 0<e.length?e.pop():new ArrayBuffer(b)}function e(b){f[a(b.byteLength)>>2].push(b)}var f=g("./loop")(8,function(){return[]});q.exports={alloc:b,free:e,allocType:function(a,e){var d=null;switch(a){case 5120:d=new Int8Array(b(e),0,e);break;case 5121:d=new Uint8Array(b(e),0,e);break;case 5122:d=new Int16Array(b(2*e),0,e);break;case 5123:d=new Uint16Array(b(2*e),0,e);break;case 5124:d=new Int32Array(b(4*
e),0,e);break;case 5125:d=new Uint32Array(b(4*e),0,e);break;case 5126:d=new Float32Array(b(4*e),0,e);break;default:return null}return d.length!==e?d.subarray(0,e):d},freeType:function(a){e(a.buffer)}}},{"./loop":29}],31:[function(g,q,x){q.exports={next:"function"===typeof requestAnimationFrame?function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"===typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout}},{}],32:[function(g,
q,x){var a=g("./pool"),b=new Float32Array(1),e=new Uint32Array(b.buffer);q.exports=function(f){for(var c=a.allocType(5123,f.length),h=0;h<f.length;++h)if(isNaN(f[h]))c[h]=65535;else if(Infinity===f[h])c[h]=31744;else if(-Infinity===f[h])c[h]=64512;else{b[0]=f[h];var d=e[0],g=d>>>31<<15,u=(d<<1>>>24)-127,d=d>>13&1023;c[h]=-24>u?g:-14>u?g+(d+1024>>-14-u):15<u?g+31744:g+(u+15<<10)+d}return c}},{"./pool":30}],33:[function(g,q,x){q.exports=function(a){return Object.keys(a).map(function(b){return a[b]})}},
{}],34:[function(g,q,x){function a(a,b,c){function e(){var b=window.innerWidth,g=window.innerHeight;a!==document.body&&(g=a.getBoundingClientRect(),b=g.right-g.left,g=g.bottom-g.top);f.width=c*b;f.height=c*g;h(f.style,{width:b+"px",height:g+"px"})}var f=document.createElement("canvas");h(f.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(f);a===document.body&&(f.style.position="absolute",h(a.style,{margin:0,padding:0}));window.addEventListener("resize",e,!1);e();return{canvas:f,onDestroy:function(){window.removeEventListener("resize",
e);a.removeChild(f)}}}function b(a,b){function c(e){try{return a.getContext(e,b)}catch(f){return null}}return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}function e(a){if("string"===typeof a)return a.split();c(Array.isArray(a),"invalid extension array");return a}function f(a){return"string"===typeof a?(c("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(a)):a}var c=g("./util/check"),h=g("./util/extend");q.exports=function(d){var h=d||{},g,r,k,n;
d={};var q=[],A=[],x="undefined"===typeof window?1:window.devicePixelRatio,z=!1,w=function(a){a&&c.raise(a)},v=function(){};"string"===typeof h?(c("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),g=document.querySelector(h),c(g,"invalid query string for element")):"object"===typeof h?"string"===typeof h.nodeName&&"function"===typeof h.appendChild&&"function"===typeof h.getBoundingClientRect?g=h:"function"===typeof h.drawArrays||"function"===typeof h.drawElements?
(n=h,k=n.canvas):(c.constructor(h),"gl"in h?n=h.gl:"canvas"in h?k=f(h.canvas):"container"in h&&(r=f(h.container)),"attributes"in h&&(d=h.attributes,c.type(d,"object","invalid context attributes")),"extensions"in h&&(q=e(h.extensions)),"optionalExtensions"in h&&(A=e(h.optionalExtensions)),"onDone"in h&&(c.type(h.onDone,"function","invalid or missing onDone callback"),w=h.onDone),"profile"in h&&(z=!!h.profile),"pixelRatio"in h&&(x=+h.pixelRatio,c(0<x,"invalid pixel ratio"))):c.raise("invalid arguments to regl");
g&&("canvas"===g.nodeName.toLowerCase()?k=g:r=g);if(!n){if(!k){c("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");g=a(r||document.body,w,x);if(!g)return null;k=g.canvas;v=g.onDestroy}n=b(k,d)}return n?{gl:n,canvas:k,container:r,extensions:q,optionalExtensions:A,pixelRatio:x,profile:z,onDone:w,onDestroy:v}:(v(),w("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/check":21,"./util/extend":24}],
35:[function(g,q,x){q.exports=function(a,b){var e=b[0],f=b[1],c=b[2],h=b[3],d=b[4],g=b[5],u=b[6],r=b[7],k=b[8],n=b[9],q=b[10],A=b[11],x=b[12],z=b[13],w=b[14],v=b[15];a[0]=g*(q*v-A*w)-n*(u*v-r*w)+z*(u*A-r*q);a[1]=-(f*(q*v-A*w)-n*(c*v-h*w)+z*(c*A-h*q));a[2]=f*(u*v-r*w)-g*(c*v-h*w)+z*(c*r-h*u);a[3]=-(f*(u*A-r*q)-g*(c*A-h*q)+n*(c*r-h*u));a[4]=-(d*(q*v-A*w)-k*(u*v-r*w)+x*(u*A-r*q));a[5]=e*(q*v-A*w)-k*(c*v-h*w)+x*(c*A-h*q);a[6]=-(e*(u*v-r*w)-d*(c*v-h*w)+x*(c*r-h*u));a[7]=e*(u*A-r*q)-d*(c*A-h*q)+k*(c*r-
h*u);a[8]=d*(n*v-A*z)-k*(g*v-r*z)+x*(g*A-r*n);a[9]=-(e*(n*v-A*z)-k*(f*v-h*z)+x*(f*A-h*n));a[10]=e*(g*v-r*z)-d*(f*v-h*z)+x*(f*r-h*g);a[11]=-(e*(g*A-r*n)-d*(f*A-h*n)+k*(f*r-h*g));a[12]=-(d*(n*w-q*z)-k*(g*w-u*z)+x*(g*q-u*n));a[13]=e*(n*w-q*z)-k*(f*w-c*z)+x*(f*q-c*n);a[14]=-(e*(g*w-u*z)-d*(f*w-c*z)+x*(f*u-c*g));a[15]=e*(g*q-u*n)-d*(f*q-c*n)+k*(f*u-c*g);return a}},{}],36:[function(g,q,x){q.exports=function(a){var b=new Float32Array(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];
b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b}},{}],37:[function(g,q,x){q.exports=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a}},{}],38:[function(g,q,x){q.exports=function(){var a=new Float32Array(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;
a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}},{}],39:[function(g,q,x){q.exports=function(a){var b=a[0],e=a[1],f=a[2],c=a[3],h=a[4],d=a[5],g=a[6],u=a[7],r=a[8],k=a[9],n=a[10],q=a[11],x=a[12],C=a[13],z=a[14];a=a[15];return(b*d-e*h)*(n*a-q*z)-(b*g-f*h)*(k*a-q*C)+(b*u-c*h)*(k*z-n*C)+(e*g-f*d)*(r*a-q*x)-(e*u-c*d)*(r*z-n*x)+(f*u-c*g)*(r*C-k*x)}},{}],40:[function(g,q,x){q.exports=function(a,b){var e=b[0],f=b[1],c=b[2],h=b[3],d=e+e,g=f+f,u=c+c,e=e*d,r=f*d,f=f*g,k=c*d,n=c*g,c=c*u,d=h*d,g=h*g,h=h*u;a[0]=1-f-c;
a[1]=r+h;a[2]=k-g;a[3]=0;a[4]=r-h;a[5]=1-e-c;a[6]=n+d;a[7]=0;a[8]=k+g;a[9]=n-d;a[10]=1-e-f;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}},{}],41:[function(g,q,x){q.exports=function(a,b,e){var f=b[0],c=b[1],h=b[2],d=b[3],g=f+f,u=c+c,r=h+h;b=f*g;var k=f*u,f=f*r,n=c*u,c=c*r,h=h*r,g=d*g,u=d*u,d=d*r;a[0]=1-(n+h);a[1]=k+d;a[2]=f-u;a[3]=0;a[4]=k-d;a[5]=1-(b+h);a[6]=c+g;a[7]=0;a[8]=f+u;a[9]=c-g;a[10]=1-(b+n);a[11]=0;a[12]=e[0];a[13]=e[1];a[14]=e[2];a[15]=1;return a}},{}],42:[function(g,q,x){q.exports=
function(a,b,e,f,c,h,d){var g=1/(e-b),u=1/(c-f),r=1/(h-d);a[0]=2*h*g;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*h*u;a[6]=0;a[7]=0;a[8]=(e+b)*g;a[9]=(c+f)*u;a[10]=(d+h)*r;a[11]=-1;a[12]=0;a[13]=0;a[14]=d*h*2*r;a[15]=0;return a}},{}],43:[function(g,q,x){q.exports=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}},{}],44:[function(g,q,x){q.exports={create:g("./create"),clone:g("./clone"),copy:g("./copy"),identity:g("./identity"),
transpose:g("./transpose"),invert:g("./invert"),adjoint:g("./adjoint"),determinant:g("./determinant"),multiply:g("./multiply"),translate:g("./translate"),scale:g("./scale"),rotate:g("./rotate"),rotateX:g("./rotateX"),rotateY:g("./rotateY"),rotateZ:g("./rotateZ"),fromRotationTranslation:g("./fromRotationTranslation"),fromQuat:g("./fromQuat"),frustum:g("./frustum"),perspective:g("./perspective"),perspectiveFromFieldOfView:g("./perspectiveFromFieldOfView"),ortho:g("./ortho"),lookAt:g("./lookAt"),str:g("./str")}},
{"./adjoint":35,"./clone":36,"./copy":37,"./create":38,"./determinant":39,"./fromQuat":40,"./fromRotationTranslation":41,"./frustum":42,"./identity":43,"./invert":45,"./lookAt":46,"./multiply":47,"./ortho":48,"./perspective":49,"./perspectiveFromFieldOfView":50,"./rotate":51,"./rotateX":52,"./rotateY":53,"./rotateZ":54,"./scale":55,"./str":56,"./translate":57,"./transpose":58}],45:[function(g,q,x){q.exports=function(a,b){var e=b[0],f=b[1],c=b[2],h=b[3],d=b[4],g=b[5],u=b[6],r=b[7],k=b[8],n=b[9],q=
b[10],x=b[11],C=b[12],z=b[13],w=b[14],v=b[15],B=e*g-f*d,E=e*u-c*d,y=e*r-h*d,l=f*u-c*g,t=f*r-h*g,I=c*r-h*u,O=k*z-n*C,ea=k*w-q*C,Q=k*v-x*C,X=n*w-q*z,H=n*v-x*z,U=q*v-x*w,D=B*U-E*H+y*X+l*Q-t*ea+I*O;if(!D)return null;D=1/D;a[0]=(g*U-u*H+r*X)*D;a[1]=(c*H-f*U-h*X)*D;a[2]=(z*I-w*t+v*l)*D;a[3]=(q*t-n*I-x*l)*D;a[4]=(u*Q-d*U-r*ea)*D;a[5]=(e*U-c*Q+h*ea)*D;a[6]=(w*y-C*I-v*E)*D;a[7]=(k*I-q*y+x*E)*D;a[8]=(d*H-g*Q+r*O)*D;a[9]=(f*Q-e*H-h*O)*D;a[10]=(C*t-z*y+v*B)*D;a[11]=(n*y-k*t-x*B)*D;a[12]=(g*ea-d*X-u*O)*D;a[13]=
(e*X-f*ea+c*O)*D;a[14]=(z*E-C*l-w*B)*D;a[15]=(k*l-n*E+q*B)*D;return a}},{}],46:[function(g,q,x){var a=g("./identity");q.exports=function(b,e,f,c){var h,d,g,q,r,k,n,x,A=e[0],C=e[1];e=e[2];g=c[0];q=c[1];d=c[2];n=f[0];c=f[1];h=f[2];if(1E-6>Math.abs(A-n)&&1E-6>Math.abs(C-c)&&1E-6>Math.abs(e-h))return a(b);f=A-n;c=C-c;n=e-h;x=1/Math.sqrt(f*f+c*c+n*n);f*=x;c*=x;n*=x;h=q*n-d*c;d=d*f-g*n;g=g*c-q*f;(x=Math.sqrt(h*h+d*d+g*g))?(x=1/x,h*=x,d*=x,g*=x):g=d=h=0;q=c*g-n*d;r=n*h-f*g;k=f*d-c*h;(x=Math.sqrt(q*q+r*r+
k*k))?(x=1/x,q*=x,r*=x,k*=x):k=r=q=0;b[0]=h;b[1]=q;b[2]=f;b[3]=0;b[4]=d;b[5]=r;b[6]=c;b[7]=0;b[8]=g;b[9]=k;b[10]=n;b[11]=0;b[12]=-(h*A+d*C+g*e);b[13]=-(q*A+r*C+k*e);b[14]=-(f*A+c*C+n*e);b[15]=1;return b}},{"./identity":43}],47:[function(g,q,x){q.exports=function(a,b,e){var f=b[0],c=b[1],g=b[2],d=b[3],p=b[4],q=b[5],r=b[6],k=b[7],n=b[8],x=b[9],A=b[10],C=b[11],z=b[12],w=b[13],v=b[14];b=b[15];var B=e[0],E=e[1],y=e[2],l=e[3];a[0]=B*f+E*p+y*n+l*z;a[1]=B*c+E*q+y*x+l*w;a[2]=B*g+E*r+y*A+l*v;a[3]=B*d+E*k+y*
C+l*b;B=e[4];E=e[5];y=e[6];l=e[7];a[4]=B*f+E*p+y*n+l*z;a[5]=B*c+E*q+y*x+l*w;a[6]=B*g+E*r+y*A+l*v;a[7]=B*d+E*k+y*C+l*b;B=e[8];E=e[9];y=e[10];l=e[11];a[8]=B*f+E*p+y*n+l*z;a[9]=B*c+E*q+y*x+l*w;a[10]=B*g+E*r+y*A+l*v;a[11]=B*d+E*k+y*C+l*b;B=e[12];E=e[13];y=e[14];l=e[15];a[12]=B*f+E*p+y*n+l*z;a[13]=B*c+E*q+y*x+l*w;a[14]=B*g+E*r+y*A+l*v;a[15]=B*d+E*k+y*C+l*b;return a}},{}],48:[function(g,q,x){q.exports=function(a,b,e,f,c,g,d){var p=1/(b-e),q=1/(f-c),r=1/(g-d);a[0]=-2*p;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*
q;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*r;a[11]=0;a[12]=(b+e)*p;a[13]=(c+f)*q;a[14]=(d+g)*r;a[15]=1;return a}},{}],49:[function(g,q,x){q.exports=function(a,b,e,f,c){b=1/Math.tan(b/2);var g=1/(f-c);a[0]=b/e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(c+f)*g;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*c*f*g;a[15]=0;return a}},{}],50:[function(g,q,x){q.exports=function(a,b,e,f){var c=Math.tan(b.upDegrees*Math.PI/180),g=Math.tan(b.downDegrees*Math.PI/180),d=Math.tan(b.leftDegrees*Math.PI/
180);b=Math.tan(b.rightDegrees*Math.PI/180);var p=2/(d+b),q=2/(c+g);a[0]=p;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=q;a[6]=0;a[7]=0;a[8]=-((d-b)*p*.5);a[9]=(c-g)*q*.5;a[10]=f/(e-f);a[11]=-1;a[12]=0;a[13]=0;a[14]=f*e/(e-f);a[15]=0;return a}},{}],51:[function(g,q,x){q.exports=function(a,b,e,f){var c=f[0],g=f[1];f=f[2];var d=Math.sqrt(c*c+g*g+f*f),p,q,r,k,n,x,A,C,z,w,v,B,E,y,l,t,I,O,ea,Q;if(1E-6>Math.abs(d))return null;d=1/d;c*=d;g*=d;f*=d;p=Math.sin(e);q=Math.cos(e);r=1-q;e=b[0];d=b[1];k=b[2];n=b[3];x=b[4];
A=b[5];C=b[6];z=b[7];w=b[8];v=b[9];B=b[10];E=b[11];y=c*c*r+q;l=g*c*r+f*p;t=f*c*r-g*p;I=c*g*r-f*p;O=g*g*r+q;ea=f*g*r+c*p;Q=c*f*r+g*p;c=g*f*r-c*p;g=f*f*r+q;a[0]=e*y+x*l+w*t;a[1]=d*y+A*l+v*t;a[2]=k*y+C*l+B*t;a[3]=n*y+z*l+E*t;a[4]=e*I+x*O+w*ea;a[5]=d*I+A*O+v*ea;a[6]=k*I+C*O+B*ea;a[7]=n*I+z*O+E*ea;a[8]=e*Q+x*c+w*g;a[9]=d*Q+A*c+v*g;a[10]=k*Q+C*c+B*g;a[11]=n*Q+z*c+E*g;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a}},{}],52:[function(g,q,x){q.exports=function(a,b,e){var f=Math.sin(e);e=
Math.cos(e);var c=b[4],g=b[5],d=b[6],p=b[7],q=b[8],r=b[9],k=b[10],n=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=c*e+q*f;a[5]=g*e+r*f;a[6]=d*e+k*f;a[7]=p*e+n*f;a[8]=q*e-c*f;a[9]=r*e-g*f;a[10]=k*e-d*f;a[11]=n*e-p*f;return a}},{}],53:[function(g,q,x){q.exports=function(a,b,e){var f=Math.sin(e);e=Math.cos(e);var c=b[0],g=b[1],d=b[2],p=b[3],q=b[8],r=b[9],k=b[10],n=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],
a[14]=b[14],a[15]=b[15]);a[0]=c*e-q*f;a[1]=g*e-r*f;a[2]=d*e-k*f;a[3]=p*e-n*f;a[8]=c*f+q*e;a[9]=g*f+r*e;a[10]=d*f+k*e;a[11]=p*f+n*e;return a}},{}],54:[function(g,q,x){q.exports=function(a,b,e){var f=Math.sin(e);e=Math.cos(e);var c=b[0],g=b[1],d=b[2],p=b[3],q=b[4],r=b[5],k=b[6],n=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=c*e+q*f;a[1]=g*e+r*f;a[2]=d*e+k*f;a[3]=p*e+n*f;a[4]=q*e-c*f;a[5]=r*e-g*f;a[6]=k*e-d*f;a[7]=n*e-p*f;return a}},{}],
55:[function(g,q,x){q.exports=function(a,b,e){var f=e[0],c=e[1];e=e[2];a[0]=b[0]*f;a[1]=b[1]*f;a[2]=b[2]*f;a[3]=b[3]*f;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*e;a[9]=b[9]*e;a[10]=b[10]*e;a[11]=b[11]*e;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a}},{}],56:[function(g,q,x){q.exports=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"}},
{}],57:[function(g,q,x){q.exports=function(a,b,e){var f=e[0],c=e[1];e=e[2];var g,d,p,q,r,k,n,x,A,C,z,w;b===a?(a[12]=b[0]*f+b[4]*c+b[8]*e+b[12],a[13]=b[1]*f+b[5]*c+b[9]*e+b[13],a[14]=b[2]*f+b[6]*c+b[10]*e+b[14],a[15]=b[3]*f+b[7]*c+b[11]*e+b[15]):(g=b[0],d=b[1],p=b[2],q=b[3],r=b[4],k=b[5],n=b[6],x=b[7],A=b[8],C=b[9],z=b[10],w=b[11],a[0]=g,a[1]=d,a[2]=p,a[3]=q,a[4]=r,a[5]=k,a[6]=n,a[7]=x,a[8]=A,a[9]=C,a[10]=z,a[11]=w,a[12]=g*f+r*c+A*e+b[12],a[13]=d*f+k*c+C*e+b[13],a[14]=p*f+n*c+z*e+b[14],a[15]=q*f+x*
c+w*e+b[15]);return a}},{}],58:[function(g,q,x){q.exports=function(a,b){if(a===b){var e=b[1],f=b[2],c=b[3],g=b[6],d=b[7],p=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=e;a[6]=b[9];a[7]=b[13];a[8]=f;a[9]=g;a[11]=b[14];a[12]=c;a[13]=d;a[14]=p}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a}},{}],59:[function(g,q,x){function a(a,c,e,f){f[0]=b(255*a);f[1]=b(255*c);f[2]=
b(255*e)}var b=Math.round,e=Math.min,f=Math.max,c=Math.ceil;q.exports=function(b,d,g,q){q=q||[0,0,0];b%=360;d=f(0,e(d,1));g=f(0,e(g,1));if(d){d=(1-d)*g;var r=g-d,k=b%60;switch(b/60|0){case 0:a(g,r*b/60+d,d,q);break;case 1:a(r*(60-k)/60+d,g,d,q);break;case 2:a(d,g,r*k/60+d,q);break;case 3:a(d,r*(60-k)/60+d,g,q);break;case 4:a(r*k/60+d,d,g,q);break;case 5:a(g,d,r*(60-k)/60+d,q)}}else q[0]=q[1]=q[2]=c(255*g);return q}},{}],60:[function(g,q,x){function a(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;
return-1}var b=g("./lib/util/check"),e=g("./lib/util/extend"),f=g("./lib/dynamic"),c=g("./lib/util/raf"),h=g("./lib/util/clock"),d=g("./lib/strings"),p=g("./lib/webgl"),u=g("./lib/extension"),r=g("./lib/limits"),k=g("./lib/buffer"),n=g("./lib/elements"),F=g("./lib/texture"),A=g("./lib/renderbuffer"),C=g("./lib/framebuffer"),z=g("./lib/attribute"),w=g("./lib/shader"),v=g("./lib/read"),B=g("./lib/core"),E=g("./lib/stats"),y=g("./lib/timer");q.exports=function(g){function q(){if(0===M.length)K&&K.update(),
ha=null;else{ha=c.next(q);R();for(var a=M.length-1;0<=a;--a){var b=M[a];b&&b(Z,null,0)}J.flush();K&&K.update()}}function x(){!ha&&0<M.length&&(ha=c.next(q))}function O(){ha&&(c.cancel(q),ha=null)}function ea(a){a.preventDefault();ja=!0;O();W.forEach(function(a){a()})}function Q(a){J.getError();ja=!1;na.restore();ma.restore();ka.restore();oa.restore();xa.restore();S.restore();K&&K.restore();V.procs.refresh();x();da.forEach(function(a){a()})}function X(a){function c(a){var b={},d={};Object.keys(a).forEach(function(c){var e=
a[c];f.isDynamic(e)?d[c]=f.unbox(e,c):b[c]=e});return{dynamic:d,"static":b}}function d(a){for(;r.length<a;)r.push(null);return r}b(!!a,"invalid args to regl({...})");b.type(a,"object","invalid args to regl({...})");var g=c(a.context||{}),h=c(a.uniforms||{}),k=c(a.attributes||{}),l=c(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=e({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=
c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var g=V.compile(l,k,h,g,a),n=g.draw,p=g.batch,q=g.scope,r=[];return e(function(a,c){var e;ja&&b.raise("context lost");if("function"===typeof a)return q.call(this,null,a,0);if("function"===typeof c)if("number"===typeof a)for(e=0;e<a;++e)q.call(this,null,c,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)q.call(this,
a[e],c,e);else return q.call(this,a,c,0);else if("number"===typeof a){if(0<a)return p.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return n.call(this,a)},{stats:a})}function H(a,c){var d=0;V.procs.poll();var e=c.color;e&&(J.clearColor(+e[0]||0,+e[1]||0,+e[2]||0,+e[3]||0),d|=16384);"depth"in c&&(J.clearDepth(+c.depth),d|=256);"stencil"in c&&(J.clearStencil(c.stencil|0),d|=1024);b(!!d,"called regl.clear with no buffer specified");J.clear(d)}function U(c){b.type(c,
"function","regl.frame() callback must be a function");M.push(c);x();return{cancel:function(){function d(){var b=a(M,d);M[b]=M[M.length-1];--M.length;0>=M.length&&O()}var e=a(M,c);b(0<=e,"cannot cancel a frame twice");M[e]=d}}}function D(){var a=ga.viewport,b=ga.scissor_box;a[0]=a[1]=b[0]=b[1]=0;Z.viewportWidth=Z.framebufferWidth=Z.drawingBufferWidth=a[2]=b[2]=J.drawingBufferWidth;Z.viewportHeight=Z.framebufferHeight=Z.drawingBufferHeight=a[3]=b[3]=J.drawingBufferHeight}function R(){Z.tick+=1;Z.time=
ca();D();V.procs.poll()}function T(){D();V.procs.refresh();K&&K.update()}function ca(){return(h()-Ba)/1E3}g=p(g);if(!g)return null;var J=g.gl,qa=J.getContextAttributes(),ja=J.isContextLost(),na=u(J,g);if(!na)return null;var va=d(),Y=E(),N=na.extensions,K=y(J,N),Ba=h(),sa=J.drawingBufferWidth,wa=J.drawingBufferHeight,Z={tick:0,time:0,viewportWidth:sa,viewportHeight:wa,framebufferWidth:sa,framebufferHeight:wa,drawingBufferWidth:sa,drawingBufferHeight:wa,pixelRatio:g.pixelRatio},ia=r(J,N),ka=k(J,Y,g),
la=n(J,N,ka,Y),sa=z(J,N,ia,ka,va),ma=w(J,va,Y,g),oa=F(J,N,ia,function(){V.procs.poll()},Z,Y,g),xa=A(J,N,ia,Y,g),S=C(J,N,ia,oa,xa,Y),V=B(J,va,N,ia,ka,la,oa,S,{},sa,ma,{elements:null,primitive:4,count:-1,offset:0,instances:-1},Z,K,g),va=v(J,S,V.procs.poll,Z,qa,N),ga=V.next,P=J.canvas,M=[],W=[],da=[],ya=[g.onDestroy],ha=null;P&&(P.addEventListener("webglcontextlost",ea,!1),P.addEventListener("webglcontextrestored",Q,!1));var ta=S.setFBO=X({framebuffer:f.define.call(null,1,"framebuffer")});T();qa=e(X,
{clear:function(a){b("object"===typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var c=0;6>c;++c)ta(e({framebuffer:a.framebuffer.faces[c]},a),H);else ta(a,H);else H(null,a)},prop:f.define.bind(null,1),context:f.define.bind(null,2),"this":f.define.bind(null,3),draw:X({}),buffer:function(a){return ka.create(a,34962,!1,!1)},elements:function(a){return la.create(a,!1)},texture:oa.create2D,cube:oa.createCube,renderbuffer:xa.create,
framebuffer:S.create,framebufferCube:S.createCube,attributes:qa,frame:U,on:function(a,c){b.type(c,"function","listener callback must be a function");var d;switch(a){case "frame":return U(c);case "lost":d=W;break;case "restore":d=da;break;case "destroy":d=ya;break;default:b.raise("invalid event, must be one of frame,lost,restore,destroy")}d.push(c);return{cancel:function(){for(var a=0;a<d.length;++a)if(d[a]===c){d[a]=d[d.length-1];d.pop();break}}}},limits:ia,hasExtension:function(a){return 0<=ia.extensions.indexOf(a.toLowerCase())},
read:va,destroy:function(){M.length=0;O();P&&(P.removeEventListener("webglcontextlost",ea),P.removeEventListener("webglcontextrestored",Q));ma.clear();S.clear();xa.clear();oa.clear();la.clear();ka.clear();K&&K.clear();ya.forEach(function(a){a()})},_gl:J,_refresh:T,poll:function(){R();K&&K.update()},now:ca,stats:Y});g.onDone(null,qa);return qa}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,
"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/check":21,"./lib/util/clock":22,"./lib/util/extend":24,"./lib/util/raf":31,"./lib/webgl":34}]},{},[1]);
