<!DOCTYPE html>
      <html>
        <head>
          <title>example/dds.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(r,x,c){function n(e,f){if(!x[e]){if(!r[e]){var b="function"==typeof require&&require;if(!f&&b)return b(e,!0);if(l)return l(e,!0);b=Error("Cannot find module '"+e+"'");throw b.code="MODULE_NOT_FOUND",b;}b=x[e]={exports:{}};r[e][0].call(b.exports,function(b){var c=r[e][1][b];return n(c?c:b)},b,b.exports,e$$0,r,x,c)}return x[e].exports}for(var l="function"==typeof require&&require,p=0;p<c.length;p++)n(c[p]);return n})({1:[function(m,r,x){var c=m("../regl")({extensions:"WEBGL_compressed_texture_s3tc"}),
n=m("parse-dds");m("resl")({manifest:{diffuse:{type:"binary",src:"assets/alpine_cliff_a.dds",parser:function(l){var p=n(l),e=p.images[0];return c.texture({format:"rgba s3tc "+p.format,shape:p.shape,mag:"linear",data:new Uint8Array(l,e.offset,e.length)})}},specular:{type:"image",src:"assets/alpine_cliff_a_spec.png",parser:function(l){return c.texture({mag:"linear",data:l})}},normals:{type:"image",src:"assets/alpine_cliff_a_norm.png",parser:function(l){return c.texture({mag:"linear",data:l})}}},onDone:function(l){var p=
c({frag:"\n      precision mediump float;\n      uniform sampler2D specular, normals, diffuse;\n      varying vec3 lightDir, eyeDir;\n      varying vec2 uv;\n      void main () {\n        float d = length(lightDir);\n        vec3 L = normalize(lightDir);\n        vec3 E = normalize(eyeDir);\n        vec3 N = normalize(2.0 * texture2D(normals, uv).rgb - 1.0);\n        N = vec3(-N.x, N.yz);\n        vec3 D = texture2D(diffuse, uv).rgb;\n        vec3 kD = D * (0.01 +\n          max(0.0, dot(L, N) * (0.6 + 0.8 / d) ));\n        vec3 S = texture2D(specular, uv).rgb;\n        vec3 kS = 2.0 * pow(max(0.0, dot(normalize(N + L), -E)), 10.0) * S;\n        gl_FragColor = vec4(kD + kS, 1);\n      }",
vert:"\n      precision mediump float;\n      attribute vec2 position;\n      uniform vec2 lightPosition;\n      varying vec3 lightDir, eyeDir;\n      varying vec2 uv;\n      void main () {\n        vec2 P = 1.0 - 2.0 * position;\n        uv = vec2(position.x, 1.0 - position.y);\n        eyeDir = -vec3(P, 1);\n        lightDir = vec3(lightPosition - P, 1);\n        gl_Position = vec4(P, 0, 1);\n      }",attributes:{position:[-2,0,0,-2,2,2]},uniforms:{specular:l.specular,normals:l.normals,diffuse:l.diffuse,
lightPosition:function(e){e=.025*e.tick;return[2*Math.cos(e),2*Math.sin(e)]}},count:3});c.frame(function(){p()})}})},{"../regl":37,"parse-dds":35,resl:36}],2:[function(m,r,x){function c(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}r.exports=function(n,l,p,e,f){n=p.maxAttributes;l=Array(n);for(p=0;p<n;++p)l[p]=new c;return{Record:c,scope:{},state:l}}},{}],3:[function(m,r,x){function c(b){return q[Object.prototype.toString.call(b)]|
0}function n(b,e){for(var c=0;c<e.length;++c)b[c]=e[c]}function l(b,c,e,f,l,p,h){for(var a=0,d=0;d<e;++d)for(var k=0;k<f;++k)b[a++]=c[l*d+p*k+h]}var p=m("./util/check"),e=m("./util/is-typed-array"),f=m("./util/is-ndarray"),b=m("./util/values"),v=m("./util/pool");x=m("./util/flatten");var A=x.flatten,K=x.shape,q=m("./constants/arraytypes.json"),k=m("./constants/dtypes.json"),E=m("./constants/usage.json"),C=[];C[5120]=1;C[5122]=2;C[5124]=4;C[5121]=1;C[5123]=2;C[5125]=4;C[5126]=4;r.exports=function(q,
m,z){function t(b){this.id=a++;this.buffer=q.createBuffer();this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;z.profile&&(this.stats={size:0})}function L(b,a,d){b.byteLength=a.byteLength;q.bufferData(b.type,a,d)}function r(b,a,d,h,k,t){b.usage=d;if(Array.isArray(a)){if(b.dtype=h||5126,0<a.length)if(Array.isArray(a[0])){k=K(a);for(var q=h=1;q<k.length;++q)h*=k[q];b.dimension=h;a=A(a,k,b.dtype);L(b,a,d);t?b.persistentData=a:v.freeType(a)}else"number"===
typeof a[0]?(b.dimension=k,k=v.allocType(b.dtype,a.length),n(k,a),L(b,k,d),t?b.persistentData=k:v.freeType(k)):e(a[0])?(b.dimension=a[0].length,b.dtype=h||c(a[0])||5126,a=A(a,[a.length,a[0].length],b.dtype),L(b,a,d),t?b.persistentData=a:v.freeType(a)):p.raise("invalid buffer data")}else if(e(a))b.dtype=h||c(a),b.dimension=k,L(b,a,d),t&&(b.persistentData=new Uint8Array(new Uint8Array(a.buffer)));else if(f(a)){k=a.shape;var G=a.stride,q=a.offset,m=0,B=0,I=0,z=0;1===k.length?(m=k[0],B=1,I=G[0],z=0):
2===k.length?(m=k[0],B=k[1],I=G[0],z=G[1]):p.raise("invalid shape");b.dtype=h||c(a.data)||5126;b.dimension=B;k=v.allocType(b.dtype,m*B);l(k,a.data,m,B,I,z,q);L(b,k,d);t?b.persistentData=k:v.freeType(k)}else p.raise("invalid buffer data")}function h(b){m.bufferCount--;var a=b.buffer;p(a,"buffer must not be deleted already");q.deleteBuffer(a);b.buffer=null;delete d[b.id]}var a=0,d={};t.prototype.bind=function(){q.bindBuffer(this.type,this.buffer)};t.prototype.destroy=function(){h(this)};var G=[];z.profile&&
(m.getTotalBufferSize=function(){var b=0;Object.keys(d).forEach(function(a){b+=d[a].stats.size});return b});return{create:function(b,a,G,L){function N(b){var a=35044,d=null,c=0,l=0,h=1;Array.isArray(b)||e(b)||f(b)?d=b:"number"===typeof b?c=b|0:b&&(p.type(b,"object","buffer arguments must be an object, a number or an array"),"data"in b&&(p(null===d||Array.isArray(d)||e(d)||f(d),"invalid data for buffer"),d=b.data),"usage"in b&&(p.parameter(b.usage,E,"invalid buffer usage"),a=E[b.usage]),"type"in b&&
(p.parameter(b.type,k,"invalid buffer type"),l=k[b.type]),"dimension"in b&&(p.type(b.dimension,"number","invalid dimension"),h=b.dimension|0),"length"in b&&(p.nni(c,"buffer length must be a nonnegative integer"),c=b.length|0));H.bind();d?r(H,d,a,l,h,L):(q.bufferData(H.type,c,a),H.dtype=l||5121,H.usage=a,H.dimension=h,H.byteLength=c);z.profile&&(H.stats.size=H.byteLength*C[H.dtype]);return N}function U(b,a){p(a+b.byteLength<=H.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+
b.byteLength+" starting from offset "+a+" to a buffer of size "+H.byteLength);q.bufferSubData(H.type,a,b)}m.bufferCount++;var H=new t(a);d[H.id]=H;G||N(b);N._reglType="buffer";N._buffer=H;N.subdata=function(b,a){var d=(a||0)|0,k;H.bind();if(Array.isArray(b)){if(0<b.length)if("number"===typeof b[0]){var h=v.allocType(H.dtype,b.length);n(h,b);U(h,d);v.freeType(h)}else Array.isArray(b[0])||e(b[0])?(k=K(b),h=A(b,k,H.dtype),U(h,d),v.freeType(h)):p.raise("invalid buffer data")}else if(e(b))U(b,d);else if(f(b)){k=
b.shape;var ba=b.stride,t=h=0,q=0,G=0;1===k.length?(h=k[0],t=1,q=ba[0],G=0):2===k.length?(h=k[0],t=k[1],q=ba[0],G=ba[1]):p.raise("invalid shape");k=Array.isArray(b.data)?H.dtype:c(b.data);k=v.allocType(k,h*t);l(k,b.data,h,t,q,G,b.offset);U(k,d);v.freeType(k)}else p.raise("invalid data for buffer subdata");return N};z.profile&&(N.stats=H.stats);N.destroy=function(){h(H)};return N},createStream:function(b,a){var d=G.pop();d||(d=new t(b));d.bind();r(d,a,35040,0,1,!1);return d},destroyStream:function(b){G.push(b)},
clear:function(){b(d).forEach(h);G.forEach(h)},getBuffer:function(b){return b&&b._buffer instanceof t?b._buffer:null},restore:function(){b(d).forEach(function(b){b.buffer=q.createBuffer();q.bindBuffer(b.type,b.buffer);q.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:r}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/check":21,"./util/flatten":25,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/values":33}],
4:[function(m,r,x){r.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(m,r,x){r.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(m,r,x){r.exports={points:0,point:0,lines:1,
line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(m,r,x){r.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(m,r,x){function c(b){return Array.isArray(b)||K(b)||q(b)}function n(b){return b.sort(function(b,a){return"viewport"===b?-1:"viewport"===a?1:b<a?-1:1})}function l(b,a,d,c){this.thisDep=b;this.contextDep=a;this.propDep=d;this.append=c}function p(b){return b&&!(b.thisDep||b.contextDep||b.propDep)}function e(b){return new l(!1,
!1,!1,b)}function f(b,a){var d=b.type;return 0===d?(d=b.data.length,new l(!0,1<=d,2<=d,a)):4===d?(d=b.data,new l(d.thisDep,d.contextDep,d.propDep,a)):new l(3===d,2===d,1===d,a)}var b=m("./util/check"),v=m("./util/codegen"),A=m("./util/loop"),K=m("./util/is-typed-array"),q=m("./util/is-ndarray"),k=m("./util/is-array-like"),E=m("./dynamic"),C=m("./constants/primitives.json"),M=m("./constants/dtypes.json"),J=["x","y","z","w"],z="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),
t={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},L="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
T={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},h={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},a={frag:35632,vert:35633},d={cw:2304,ccw:2305},G=new l(!1,!1,!1,function(){});r.exports=function(q,m,K,r,N,U,H,x,W,B,I,Da,ka,pa,wa){function Z(b){return b.replace(".","_")}function R(b,a,g){var d=Z(b);Ha.push(b);
qa[d]=w[d]=!!g;Aa[d]=a}function O(b,a,g){var d=Z(b);Ha.push(b);Array.isArray(g)?(w[d]=g.slice(),qa[d]=g.slice()):w[d]=qa[d]=g;Ba[d]=a}function Ca(){var a=v(),g=a.link,d=a.global;a.id=Qa++;a.batchId="0";var c=g(Oa),e=a.shared={props:"a0"};Object.keys(Oa).forEach(function(b){e[b]=d.def(c,".",b)});b.optional(function(){a.CHECK=g(b);a.commandStr=b.guessCommand();a.command=g(a.commandStr);a.assert=function(b,a,F){b("if(!(",a,"))",this.CHECK,".commandRaise(",g(F),",",this.command,");")};Ia.invalidBlendCombinations=
L});var P=a.next={},f=a.current={};Object.keys(Ba).forEach(function(b){Array.isArray(w[b])&&(P[b]=d.def(e.next,".",b),f[b]=d.def(e.current,".",b))});var Ra=a.constants={};Object.keys(Ia).forEach(function(b){Ra[b]=d.def(JSON.stringify(Ia[b]))});a.invoke=function(b,F){switch(F.type){case 0:var d=["this",e.context,e.props,a.batchId];return b.def(g(F.data),".call(",d.slice(0,Math.max(F.data.length+1,4)),")");case 1:return b.def(e.props,F.data);case 2:return b.def(e.context,F.data);case 3:return b.def("this",
F.data);case 4:return F.data.append(a,b),F.data.ref}};a.attribCache={};var F={};a.scopeAttrib=function(b){b=m.id(b);if(b in F)return F[b];var a=B.scope[b];a||(a=B.scope[b]=new sa);return F[b]=g(a)};return a}function ta(b){var a=b["static"];b=b.dynamic;var g;if("profile"in a){var d=!!a.profile;g=e(function(b,a){return d});g.enable=d}else if("profile"in b){var c=b.profile;g=f(c,function(b,a){return b.invoke(a,c)})}return g}function xa(a,g){var d=a["static"],c=a.dynamic;if("framebuffer"in d){var w=d.framebuffer;
return w?(w=x.getFramebuffer(w),b.command(w,"invalid framebuffer object"),e(function(b,a){var g=b.link(w),d=b.shared;a.set(d.framebuffer,".next",g);d=d.context;a.set(d,".framebufferWidth",g+".width");a.set(d,".framebufferHeight",g+".height");return g})):e(function(b,a){var g=b.shared;a.set(g.framebuffer,".next","null");g=g.context;a.set(g,".framebufferWidth",g+".drawingBufferWidth");a.set(g,".framebufferHeight",g+".drawingBufferHeight");return"null"})}if("framebuffer"in c){var P=c.framebuffer;return f(P,
function(a,g){var d=a.invoke(g,P),D=a.shared,S=D.framebuffer,u=g.def(S,".getFramebuffer(",d,")");b.optional(function(){a.assert(g,"!"+d+"||"+u,"invalid framebuffer object")});g.set(S,".next",u);D=D.context;g.set(D,".framebufferWidth",u+"?"+u+".width:"+D+".drawingBufferWidth");g.set(D,".framebufferHeight",u+"?"+u+".height:"+D+".drawingBufferHeight");return u})}return null}function aa(a,g,d){function c(a){if(a in e){var F=e[a];b.commandType(F,"object","invalid "+a,d.commandStr);var u=!0,S=F.x|0,w=F.y|
0,k,h;"width"in F?(k=F.width|0,b.command(0<=k,"invalid "+a,d.commandStr)):u=!1;"height"in F?(h=F.height|0,b.command(0<=h,"invalid "+a,d.commandStr)):u=!1;return new l(!u&&g&&g.thisDep,!u&&g&&g.contextDep,!u&&g&&g.propDep,function(b,a){var g=b.shared.context,d=k;"width"in F||(d=a.def(g,".","framebufferWidth","-",S));var u=h;"height"in F||(u=a.def(g,".","framebufferHeight","-",w));return[S,w,d,u]})}if(a in P){var y=P[a],u=f(y,function(g,d){var F=g.invoke(d,y);b.optional(function(){g.assert(d,F+"&&typeof "+
F+'==="object"',"invalid "+a)});var S=g.shared.context,u=d.def(F,".x|0"),D=d.def(F,".y|0"),c=d.def('"width" in ',F,"?",F,".width|0:","(",S,".","framebufferWidth","-",u,")"),e=d.def('"height" in ',F,"?",F,".height|0:","(",S,".","framebufferHeight","-",D,")");b.optional(function(){g.assert(d,c+">=0&&"+e+">=0","invalid "+a)});return[u,D,c,e]});g&&(u.thisDep=u.thisDep||g.thisDep,u.contextDep=u.contextDep||g.contextDep,u.propDep=u.propDep||g.propDep);return u}return g?new l(g.thisDep,g.contextDep,g.propDep,
function(b,a){var g=b.shared.context;return[0,0,a.def(g,".","framebufferWidth"),a.def(g,".","framebufferHeight")]}):null}var e=a["static"],P=a.dynamic;if(a=c("viewport")){var w=a;a=new l(a.thisDep,a.contextDep,a.propDep,function(b,a){var g=w.append(b,a),d=b.shared.context;a.set(d,".viewportWidth",g[2]);a.set(d,".viewportHeight",g[3]);return g})}return{viewport:a,scissor_box:c("scissor.box")}}function ia(g){function d(g){if(g in c){var F=m.id(c[g]);b.optional(function(){I.shader(a[g],F,b.guessCommand())});
var u=e(function(){return F});u.id=F;return u}if(g in w){var S=w[g];return f(S,function(d,F){var u=d.invoke(F,S),D=F.def(d.shared.strings,".id(",u,")");b.optional(function(){F(d.shared.shader,".shader(",a[g],",",D,",",d.command,");")});return D})}return null}var c=g["static"],w=g.dynamic,k=d("frag"),P=d("vert"),h=null;p(k)&&p(P)?(h=I.program(P.id,k.id),g=e(function(b,a){return b.link(h)})):g=new l(k&&k.thisDep||P&&P.thisDep,k&&k.contextDep||P&&P.contextDep,k&&k.propDep||P&&P.propDep,function(a,g){var d=
a.shared.shader,S;S=k?k.append(a,g):g.def(d,".","frag");var u;u=P?P.append(a,g):g.def(d,".","vert");var D=d+".program("+u+","+S;b.optional(function(){D+=","+a.command});return g.def(D+")")});return{frag:k,vert:P,progVar:g,program:h}}function la(a,g){function d(a,F){if(a in w){var u=w[a]|0;b.command(!F||0<=u,"invalid "+a,g.commandStr);return e(function(b,a){F&&(b.OFFSET=u);return u})}if(a in k){var S=k[a];return f(S,function(g,d){var u=g.invoke(d,S);F&&(g.OFFSET=u,b.optional(function(){g.assert(d,
u+">=0","invalid "+a)}));return u})}return F&&P?e(function(b,a){b.OFFSET="0";return 0}):null}var w=a["static"],k=a.dynamic,P=function(){if("elements"in w){var a=w.elements;c(a)?a=U.getElements(U.create(a,!0)):a&&(a=U.getElements(a),b.command(a,"invalid elements",g.commandStr));var d=e(function(b,g){if(a){var d=b.link(a);return b.ELEMENTS=d}return b.ELEMENTS=null});d.value=a;return d}if("elements"in k){var u=k.elements;return f(u,function(a,g){var d=a.shared,F=d.isBufferArgs,d=d.elements,D=a.invoke(g,
u),c=g.def("null"),F=g.def(F,"(",D,")"),e=a.cond(F).then(c,"=",d,".createStream(",D,");")["else"](c,"=",d,".getElements(",D,");");b.optional(function(){a.assert(e["else"],"!"+D+"||"+c,"invalid elements")});g.entry(e);g.exit(a.cond(F).then(d,".destroyStream(",c,");"));return a.ELEMENTS=c})}return null}(),h=d("offset",!0);return{elements:P,primitive:function(){if("primitive"in w){var a=w.primitive;b.commandParameter(a,C,"invalid primitve",g.commandStr);return e(function(b,g){return C[a]})}if("primitive"in
k){var d=k.primitive;return f(d,function(a,g){var u=a.constants.primTypes,D=a.invoke(g,d);b.optional(function(){a.assert(g,D+" in "+u,"invalid primitive, must be one of "+Object.keys(C))});return g.def(u,"[",D,"]")})}return P?p(P)?P.value?e(function(b,a){return a.def(b.ELEMENTS,".primType")}):e(function(){return 4}):new l(P.thisDep,P.contextDep,P.propDep,function(b,a){var g=b.ELEMENTS;return a.def(g,"?",g,".primType:",4)}):null}(),count:function(){if("count"in w){var a=w.count|0;b.command("number"===
typeof a&&0<=a,"invalid vertex count",g.commandStr);return e(function(){return a})}if("count"in k){var d=k.count;return f(d,function(a,g){var u=a.invoke(g,d);b.optional(function(){a.assert(g,"typeof "+u+'==="number"&&'+u+">=0&&"+u+"===("+u+"|0)","invalid vertex count")});return u})}if(P){if(p(P)){if(P)return h?new l(h.thisDep,h.contextDep,h.propDep,function(a,g){var d=g.def(a.ELEMENTS,".vertCount-",a.OFFSET);b.optional(function(){a.assert(g,d+">=0","invalid vertex offset/element buffer too small")});
return d}):e(function(b,a){return a.def(b.ELEMENTS,".vertCount")});var u=e(function(){return-1});b.optional(function(){u.MISSING=!0});return u}var S=new l(P.thisDep||h.thisDep,P.contextDep||h.contextDep,P.propDep||h.propDep,function(b,a){var g=b.ELEMENTS;return b.OFFSET?a.def(g,"?",g,".vertCount-",b.OFFSET,":-1"):a.def(g,"?",g,".vertCount:-1")});b.optional(function(){S.DYNAMIC=!0});return S}return null}(),instances:d("instances",!1),offset:h}}function ma(a,g){var c=a["static"],w=a.dynamic,l={};Ha.forEach(function(a){function u(b,
g){if(a in c){var d=b(c[a]);l[y]=e(function(){return d})}else if(a in w){var D=w[a];l[y]=f(D,function(b,a){return g(b,a,b.invoke(a,D))})}}var y=Z(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return u(function(d){b.commandType(d,"boolean",a,g.commandStr);return d},function(g,d,u){b.optional(function(){g.assert(d,"typeof "+u+'==="boolean"',
"invalid flag "+a,g.commandStr)});return u});case "depth.func":return u(function(d){b.commandParameter(d,T,"invalid "+a,g.commandStr);return T[d]},function(g,d,u){var c=g.constants.compareFuncs;b.optional(function(){g.assert(d,u+" in "+c,"invalid "+a+", must be one of "+Object.keys(T))});return d.def(c,"[",u,"]")});case "depth.range":return u(function(a){b.command(k(a)&&2===a.length&&"number"===typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",g.commandStr);return a},function(a,
g,d){b.optional(function(){a.assert(g,a.shared.isArrayLike+"("+d+")&&"+d+".length===2&&typeof "+d+'[0]==="number"&&typeof '+d+'[1]==="number"&&'+d+"[0]<="+d+"[1]","depth range must be a 2d array")});var u=g.def("+",d,"[0]"),c=g.def("+",d,"[1]");return[u,c]});case "blend.func":return u(function(a){b.commandType(a,"object","blend.func",g.commandStr);var d="srcRGB"in a?a.srcRGB:a.src,u="srcAlpha"in a?a.srcAlpha:a.src,c="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;b.commandParameter(d,
t,y+".srcRGB",g.commandStr);b.commandParameter(u,t,y+".srcAlpha",g.commandStr);b.commandParameter(c,t,y+".dstRGB",g.commandStr);b.commandParameter(a,t,y+".dstAlpha",g.commandStr);b.command(-1===L.indexOf(d+", "+c),"unallowed blending combination (srcRGB, dstRGB) = ("+d+", "+c+")",g.commandStr);return[t[d],t[c],t[u],t[a]]},function(g,d,u){function c(e,w){var k=d.def('"',e,w,'" in ',u,"?",u,".",e,w,":",u,".",e);b.optional(function(){g.assert(d,k+" in "+D,"invalid "+a+"."+e+w+", must be one of "+Object.keys(t))});
return k}var D=g.constants.blendFuncs;b.optional(function(){g.assert(d,u+"&&typeof "+u+'==="object"',"invalid blend func, must be an object")});var e=c("src","RGB"),w=c("dst","RGB");b.optional(function(){g.assert(d,g.constants.invalidBlendCombinations+".indexOf("+e+'+", "+'+w+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var k=d.def(D,"[",e,"]"),h=d.def(D,"[",c("src","Alpha"),"]"),f=d.def(D,"[",w,"]"),y=d.def(D,"[",c("dst","Alpha"),"]");return[k,f,h,y]});case "blend.equation":return u(function(d){if("string"===
typeof d)return b.commandParameter(d,da,"invalid "+a,g.commandStr),[da[d],da[d]];if("object"===typeof d)return b.commandParameter(d.rgb,da,a+".rgb",g.commandStr),b.commandParameter(d.alpha,da,a+".alpha",g.commandStr),[da[d.rgb],da[d.alpha]];b.commandRaise("invalid blend.equation",g.commandStr)},function(g,d,u){var c=g.constants.blendEquations,D=d.def(),e=d.def(),w=g.cond("typeof ",u,'==="string"');b.optional(function(){function b(a,d,u){g.assert(a,u+" in "+c,"invalid "+d+", must be one of "+Object.keys(da))}
b(w.then,a,u);g.assert(w["else"],u+"&&typeof "+u+'==="object"',"invalid "+a);b(w["else"],a+".rgb",u+".rgb");b(w["else"],a+".alpha",u+".alpha")});w.then(D,"=",e,"=",c,"[",u,"];");w["else"](D,"=",c,"[",u,".rgb];",e,"=",c,"[",u,".alpha];");d(w);return[D,e]});case "blend.color":return u(function(a){b.command(k(a)&&4===a.length,"blend.color must be a 4d array",g.commandStr);return A(4,function(b){return+a[b]})},function(a,g,d){b.optional(function(){a.assert(g,a.shared.isArrayLike+"("+d+")&&"+d+".length===4",
"blend.color must be a 4d array")});return A(4,function(b){return g.def("+",d,"[",b,"]")})});case "stencil.mask":return u(function(a){b.commandType(a,"number",y,g.commandStr);return a|0},function(a,g,d){b.optional(function(){a.assert(g,"typeof "+d+'==="number"',"invalid stencil.mask")});return g.def(d,"|0")});case "stencil.func":return u(function(d){b.commandType(d,"object",y,g.commandStr);var u=d.cmp||"keep",c=d.ref||0;d="mask"in d?d.mask:-1;b.commandParameter(u,T,a+".cmp",g.commandStr);b.commandType(c,
"number",a+".ref",g.commandStr);b.commandType(d,"number",a+".mask",g.commandStr);return[T[u],c,d]},function(a,g,d){var u=a.constants.compareFuncs;b.optional(function(){function b(){a.assert(g,Array.prototype.join.call(arguments,""),"invalid stencil.func")}b(d+"&&typeof ",d,'==="object"');b('!("cmp" in ',d,")||(",d,".cmp in ",u,")")});var c=g.def('"cmp" in ',d,"?",u,"[",d,".cmp]",":",7680),D=g.def(d,".ref|0"),e=g.def('"mask" in ',d,"?",d,".mask|0:-1");return[c,D,e]});case "stencil.opFront":case "stencil.opBack":return u(function(d){b.commandType(d,
"object",y,g.commandStr);var u=d.fail||"keep",c=d.zfail||"keep";d=d.zpass||"keep";b.commandParameter(u,h,a+".fail",g.commandStr);b.commandParameter(c,h,a+".zfail",g.commandStr);b.commandParameter(d,h,a+".zpass",g.commandStr);return["stencil.opBack"===a?1029:1028,h[u],h[c],h[d]]},function(g,d,u){function c(e){b.optional(function(){g.assert(d,'!("'+e+'" in '+u+")||("+u+"."+e+" in "+D+")","invalid "+a+"."+e+", must be one of "+Object.keys(h))});return d.def('"',e,'" in ',u,"?",D,"[",u,".",e,"]:",7680)}
var D=g.constants.stencilOps;b.optional(function(){g.assert(d,u+"&&typeof "+u+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,c("fail"),c("zfail"),c("zpass")]});case "polygonOffset.offset":return u(function(a){b.commandType(a,"object",y,g.commandStr);var d=a.factor|0;a=a.units|0;b.commandType(d,"number",y+".factor",g.commandStr);b.commandType(a,"number",y+".units",g.commandStr);return[d,a]},function(g,d,u){b.optional(function(){g.assert(d,u+"&&typeof "+u+'==="object"',"invalid "+
a)});var c=d.def(u,".factor|0"),D=d.def(u,".units|0");return[c,D]});case "cull.face":return u(function(a){var d=0;"front"===a?d=1028:"back"===a&&(d=1029);b.command(!!d,y,g.commandStr);return d},function(a,g,d){b.optional(function(){a.assert(g,d+'==="front"||'+d+'==="back"',"invalid cull.face")});return g.def(d,'==="front"?',1028,":",1029)});case "lineWidth":return u(function(a){b.command("number"===typeof a&&a>=r.lineWidthDims[0]&&a<=r.lineWidthDims[1],"invalid line width, must positive number between "+
r.lineWidthDims[0]+" and "+r.lineWidthDims[1],g.commandStr);return a},function(a,g,d){b.optional(function(){a.assert(g,"typeof "+d+'==="number"&&'+d+">="+r.lineWidthDims[0]+"&&"+d+"<="+r.lineWidthDims[1],"invalid line width")});return d});case "frontFace":return u(function(a){b.commandParameter(a,d,y,g.commandStr);return d[a]},function(a,g,d){b.optional(function(){a.assert(g,d+'==="cw"||'+d+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return g.def(d+'==="cw"?2304:2305')});case "colorMask":return u(function(a){b.command(k(a)&&
4===a.length,"color.mask must be length 4 array",g.commandStr);return a.map(function(a){return!!a})},function(a,g,d){b.optional(function(){a.assert(g,a.shared.isArrayLike+"("+d+")&&"+d+".length===4","invalid color.mask")});return A(4,function(a){return"!!"+d+"["+a+"]"})});case "sample.coverage":return u(function(a){b.command("object"===typeof a&&a,y,g.commandStr);var d="value"in a?a.value:1;a=!!a.invert;b.command("number"===typeof d&&0<=d&&1>=d,"sample.coverage.value must be a number between 0 and 1",
g.commandStr);return[d,a]},function(a,g,d){b.optional(function(){a.assert(g,d+"&&typeof "+d+'==="object"',"invalid sample.coverage")});var u=g.def('"value" in ',d,"?+",d,".value:1"),c=g.def("!!",d,".invert");return[u,c]})}});return l}function na(a,g){var d=a["static"],c=a.dynamic,w={};Object.keys(d).forEach(function(a){var u=d[a],c;if("number"===typeof u||"boolean"===typeof u)c=e(function(){return u});else if("function"===typeof u){var h=u._reglType;"texture2d"===h||"textureCube"===h?c=e(function(a){return a.link(u)}):
"framebuffer"===h||"framebufferCube"===h?(b.command(0<u.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',g.commandStr),c=e(function(a){return a.link(u.color[0])})):b.commandRaise('invalid data for uniform "'+a+'"',g.commandStr)}else k(u)?c=e(function(g){return g.global.def("[",A(u.length,function(d){b.command("number"===typeof u[d]||"boolean"===typeof u[d],"invalid uniform "+a,g.commandStr);return u[d]}),"]")}):b.commandRaise('invalid or missing data for uniform "'+
a+'"',g.commandStr);c.value=u;w[a]=c});Object.keys(c).forEach(function(a){var b=c[a];w[a]=f(b,function(a,g){return a.invoke(g,b)})});return w}function ra(a,d){var w=a["static"],h=a.dynamic,y={};Object.keys(w).forEach(function(a){var u=w[a],h=m.id(a),f=new sa;if(c(u))f.state=1,f.buffer=N.getBuffer(N.create(u,34962,!1,!0)),f.type=0;else{var l=N.getBuffer(u);if(l)f.state=1,f.buffer=l,f.type=0;else if(b.command("object"===typeof u&&u,"invalid data for attribute "+a,d.commandStr),u.constant){var S=u.constant;
f.buffer="null";f.state=2;"number"===typeof S?f.x=S:(b.command(k(S)&&0<S.length&&4>=S.length,"invalid constant for attribute "+a,d.commandStr),J.forEach(function(a,b){b<S.length&&(f[a]=S[b])}))}else{l=c(u.buffer)?N.getBuffer(N.create(u.buffer,34962,!1,!0)):N.getBuffer(u.buffer);b.command(!!l,'missing buffer for attribute "'+a+'"',d.commandStr);var p=u.offset|0;b.command(0<=p,'invalid offset for attribute "'+a+'"',d.commandStr);var q=u.stride|0;b.command(0<=q&&256>q,'invalid stride for attribute "'+
a+'", must be integer betweeen [0, 255]',d.commandStr);var t=u.size|0;b.command(!("size"in u)||0<t&&4>=t,'invalid size for attribute "'+a+'", must be 1,2,3,4',d.commandStr);var G=!!u.normalized,v=0;"type"in u&&(b.commandParameter(u.type,M,"invalid type for attribute "+a,d.commandStr),v=M[u.type]);var n=u.divisor|0;"divisor"in u&&(b.command(0===n||g,'cannot specify divisor for attribute "'+a+'", instancing not supported',d.commandStr),b.command(0<=n,'invalid divisor for attribute "'+a+'"',d.commandStr));
b.optional(function(){var g=d.commandStr,c="buffer offset divisor normalized type size stride".split(" ");Object.keys(u).forEach(function(d){b.command(0<=c.indexOf(d),'unknown parameter "'+d+'" for attribute pointer "'+a+'" (valid parameters are '+c+")",g)})});f.buffer=l;f.state=1;f.size=t;f.normalized=G;f.type=v||l.dtype;f.offset=p;f.stride=q;f.divisor=n}}y[a]=e(function(a,b){var g=a.attribCache;if(h in g)return g[h];var d={isStream:!1};Object.keys(f).forEach(function(a){d[a]=f[a]});f.buffer&&(d.buffer=
a.link(f.buffer),d.type=d.type||d.buffer+".dtype");return g[h]=d})});Object.keys(h).forEach(function(a){var g=h[a];y[a]=f(g,function(d,u){function c(a){u(k[a],"=",e,".",a,"|0;")}var e=d.invoke(u,g),D=d.shared,w=D.isBufferArgs,f=D.buffer;b.optional(function(){d.assert(u,e+"&&(typeof "+e+'==="object"||typeof '+e+'==="function")&&('+w+"("+e+")||"+f+".getBuffer("+e+")||"+f+".getBuffer("+e+".buffer)||"+w+"("+e+'.buffer)||("constant" in '+e+"&&(typeof "+e+'.constant==="number"||'+D.isArrayLike+"("+e+".constant))))",
'invalid dynamic attribute "'+a+'"')});var k={isStream:u.def(!1)},h=new sa;h.state=1;Object.keys(h).forEach(function(a){k[a]=u.def(""+h[a])});var y=k.buffer,l=k.type;u("if(",w,"(",e,")){",k.isStream,"=true;",y,"=",f,".createStream(",34962,",",e,");",l,"=",y,".dtype;","}else{",y,"=",f,".getBuffer(",e,");","if(",y,"){",l,"=",y,".dtype;",'}else if("constant" in ',e,"){",k.state,"=",2,";","if(typeof "+e+'.constant === "number"){',k[J[0]],"=",e,".constant;",J.slice(1).map(function(a){return k[a]}).join("="),
"=0;","}else{",J.map(function(a,b){return k[a]+"="+e+".constant.length>="+b+"?"+e+".constant["+b+"]:0;"}).join(""),"}}else{","if(",w,"(",e,".buffer)){",y,"=",f,".createStream(",34962,",",e,".buffer);","}else{",y,"=",f,".getBuffer(",e,".buffer);","}",l,'="type" in ',e,"?",D.glTypes,"[",e,".type]:",y,".dtype;",k.normalized,"=!!",e,".normalized;");c("size");c("offset");c("stride");c("divisor");u("}}");u.exit("if(",k.isStream,"){",f,".destroyStream(",y,");","}");return k})});return y}function ya(a){var b=
a["static"],g=a.dynamic,d={};Object.keys(b).forEach(function(a){var g=b[a];d[a]=e(function(a,b){return"number"===typeof g||"boolean"===typeof g?""+g:a.link(g)})});Object.keys(g).forEach(function(a){var b=g[a];d[a]=f(b,function(a,g){return a.invoke(g,b)})});return d}function V(a,g,d,c,e){function w(a){var b=y[a];b&&(p[a]=b)}var k=a["static"],f=a.dynamic;b.optional(function(){function a(d){Object.keys(d).forEach(function(a){b.command(0<=g.indexOf(a),'unknown parameter "'+a+'"',e.commandStr)})}var g=
"framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(Ha);a(k);a(f)});var h=xa(a,e),y=aa(a,h,e),l=la(a,e),p=ma(a,e),q=ia(a,e);w("viewport");w(Z("scissor.box"));var t=0<Object.keys(p).length,h={framebuffer:h,draw:l,shader:q,state:p,dirty:t};h.profile=ta(a,e);h.uniforms=na(d,e);h.attributes=ra(g,e);h.context=ya(c,e);return h}function X(a,b,g){var d=a.shared.context,c=a.scope();Object.keys(g).forEach(function(e){b.save(d,"."+e);c(d,".",e,"=",g[e].append(a,b),";")});
b(c)}function ga(a,b,g,d){var c=a.shared,e=c.gl,w=c.framebuffer,k;y&&(k=b.def(c.extensions,".webgl_draw_buffers"));var f=a.constants,c=f.drawBuffer,f=f.backBuffer;a=g?g.append(a,b):b.def(w,".next");d||b("if(",a,"!==",w,".cur){");b("if(",a,"){",e,".bindFramebuffer(",36160,",",a,".framebuffer);");y&&b(k,".drawBuffersWEBGL(",c,"[",a,".colorAttachments.length]);");b("}else{",e,".bindFramebuffer(",36160,",null);");y&&b(k,".drawBuffersWEBGL(",f,");");b("}",w,".cur=",a,";");d||b("}")}function oa(a,b,g){var d=
a.shared,c=d.gl,e=a.current,k=a.next,f=d.current,h=d.next,y=a.cond(f,".dirty");Ha.forEach(function(b){b=Z(b);if(!(b in g.state)){var d,D;if(b in k){d=k[b];D=e[b];var l=A(w[b].length,function(a){return y.def(d,"[",a,"]")});y(a.cond(l.map(function(a,b){return a+"!=="+D+"["+b+"]"}).join("||")).then(c,".",Ba[b],"(",l,");",l.map(function(a,b){return D+"["+b+"]="+a}).join(";"),";"))}else d=y.def(h,".",b),l=a.cond(d,"!==",f,".",b),y(l),b in Aa?l(a.cond(d).then(c,".enable(",Aa[b],");")["else"](c,".disable(",
Aa[b],");"),f,".",b,"=",d,";"):l(c,".",Ba[b],"(",d,");",f,".",b,"=",d,";")}});0===Object.keys(g.state).length&&y(f,".dirty=false;");b(y)}function Q(a,b,d,g){var c=a.shared,e=a.current,w=c.current,f=c.gl;n(Object.keys(d)).forEach(function(c){var h=d[c];if(!g||g(h)){var y=h.append(a,b);if(Aa[c]){var l=Aa[c];p(h)?y?b(f,".enable(",l,");"):b(f,".disable(",l,");"):b(a.cond(y).then(f,".enable(",l,");")["else"](f,".disable(",l,");"));b(w,".",c,"=",y,";")}else if(k(y)){var q=e[c];b(f,".",Ba[c],"(",y,");",
y.map(function(a,b){return q+"["+b+"]="+a}).join(";"),";")}else b(f,".",Ba[c],"(",y,");",w,".",c,"=",y,";")}})}function Y(a,b){g&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function ea(a,b,d,g,c){function e(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function w(a){t=b.def();a(t,"=",e(),";");"string"===typeof c?a(y,".count+=",c,";"):a(y,".count++;");pa&&(g?(G=b.def(),a(G,"=",q,".getNumPendingQueries();")):a(q,".beginQuery(",y,");"))}function f(a){a(y,
".cpuTime+=",e(),"-",t,";");pa&&(g?a(q,".pushScopeStats(",G,",",q,".getNumPendingQueries(),",y,");"):a(q,".endQuery();"))}function k(a){var d=b.def(l,".profile");b(l,".profile=",a,";");b.exit(l,".profile=",d,";")}var h=a.shared,y=a.stats,l=h.current,q=h.timer;d=d.profile;var t,G;if(d){if(p(d)){d.enable?(w(b),f(b.exit),k("true")):k("false");return}d=d.append(a,b);k(d)}else d=b.def(l,".profile");h=a.block();w(h);b("if(",d,"){",h,"}");a=a.block();f(a);b.exit("if(",d,"){",a,"}")}function za(a,d,c,e,w){function f(a){switch(a){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function k(b,c,e){function w(){d("if(!",p,".buffer){",y,".enableVertexAttribArray(",l,");}");var b=e.type,f;f=e.size?d.def(e.size,"||",c):c;d("if(",p,".type!==",b,"||",p,".size!==",f,"||",G.map(function(a){return p+"."+a+"!=="+e[a]}).join("||"),"){",y,".bindBuffer(",34962,",",q,".buffer);",y,".vertexAttribPointer(",[l,f,b,e.normalized,e.stride,e.offset],");",p,".type=",b,";",p,".size=",f,";",G.map(function(a){return p+
"."+a+"="+e[a]+";"}).join(""),"}");g&&(b=e.divisor,d("if(",p,".divisor!==",b,"){",a.instancing,".vertexAttribDivisorANGLE(",[l,b],");",p,".divisor=",b,";}"))}function f(){d("if(",p,".buffer){",y,".disableVertexAttribArray(",l,");","}if(",J.map(function(a,b){return p+"."+a+"!=="+t[b]}).join("||"),"){",y,".vertexAttrib4f(",l,",",t,");",J.map(function(a,b){return p+"."+a+"="+t[b]+";"}).join(""),"}")}var y=h.gl,l=d.def(b,".location"),p=d.def(h.attributes,"[",l,"]");b=e.state;var q=e.buffer,t=[e.x,e.y,
e.z,e.w],G=["buffer","normalized","offset","stride"];1===b?w():2===b?f():(d("if(",b,"===",1,"){"),w(),d("}else{"),f(),d("}"))}var h=a.shared;e.forEach(function(g){var e=g.name,h=c.attributes[e],y;if(h){if(!w(h))return;y=h.append(a,d)}else{if(!w(G))return;var l=a.scopeAttrib(e);b.optional(function(){a.assert(d,l+".state","missing attribute "+e)});y={};Object.keys(new sa).forEach(function(a){y[a]=d.def(l,".",a)})}k(a.link(g),f(g.info.type),y)})}function ha(a,d,g,c,e){for(var w=a.shared,f=w.gl,h,y=0;y<
c.length;++y){var l=c[y],q=l.name,t=l.info.type,v=g.uniforms[q],l=a.link(l)+".location",n;if(v){if(!e(v))continue;if(p(v)){var B=v.value;b.command(null!==B&&"undefined"!==typeof B,'missing uniform "'+q+'"',a.commandStr);if(35678===t||35680===t)b.command("function"===typeof B&&(35678===t&&("texture2d"===B._reglType||"framebuffer"===B._reglType)||35680===t&&("textureCube"===B._reglType||"framebufferCube"===B._reglType)),"invalid texture for uniform "+q,a.commandStr),v=a.link(B._texture||B.color[0]._texture),
d(f,".uniform1i(",l,",",v+".bind());"),d.exit(v,".unbind();");else if(35674===t||35675===t||35676===t){b.optional(function(){b.command(k(B),"invalid matrix for uniform "+q,a.commandStr);b.command(35674===t&&4===B.length||35675===t&&9===B.length||35676===t&&16===B.length,"invalid length for matrix uniform "+q,a.commandStr)});var v=a.global.def("new Float32Array(["+Array.prototype.slice.call(B)+"])"),z=2;35675===t?z=3:35676===t&&(z=4);d(f,".uniformMatrix",z,"fv(",l,",false,",v,");")}else{switch(t){case 5126:b.commandType(B,
"number","uniform "+q,a.commandStr);h="1f";break;case 35664:b.command(k(B)&&2===B.length,"uniform "+q,a.commandStr);h="2f";break;case 35665:b.command(k(B)&&3===B.length,"uniform "+q,a.commandStr);h="3f";break;case 35666:b.command(k(B)&&4===B.length,"uniform "+q,a.commandStr);h="4f";break;case 35670:b.commandType(B,"boolean","uniform "+q,a.commandStr);h="1i";break;case 5124:b.commandType(B,"number","uniform "+q,a.commandStr);h="1i";break;case 35671:b.command(k(B)&&2===B.length,"uniform "+q,a.commandStr);
h="2i";break;case 35667:b.command(k(B)&&2===B.length,"uniform "+q,a.commandStr);h="2i";break;case 35672:b.command(k(B)&&3===B.length,"uniform "+q,a.commandStr);h="3i";break;case 35668:b.command(k(B)&&3===B.length,"uniform "+q,a.commandStr);h="3i";break;case 35673:b.command(k(B)&&4===B.length,"uniform "+q,a.commandStr);h="4i";break;case 35669:b.command(k(B)&&4===B.length,"uniform "+q,a.commandStr),h="4i"}d(f,".uniform",h,"(",l,",",k(B)?Array.prototype.slice.call(B):B,");")}continue}else n=v.append(a,
d)}else{if(!e(G))continue;n=d.def(w.uniforms,"[",m.id(q),"]")}35678===t?d("if(",n,"&&",n,'._reglType==="framebuffer"){',n,"=",n,".color[0];","}"):35680===t&&d("if(",n,"&&",n,'._reglType==="framebufferCube"){',n,"=",n,".color[0];","}");b.optional(function(){function b(g,c){a.assert(d,g,'bad data or missing for uniform "'+q+'".  '+c)}function g(a){b("typeof "+n+'==="'+a+'"',"invalid type, expected "+a)}function c(d,g){b(w.isArrayLike+"("+n+")&&"+n+".length==="+d,"invalid vector, should have length "+
d,a.commandStr)}function e(d){b("typeof "+n+'==="function"&&'+n+'._reglType==="texture'+(3553===d?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(t){case 5124:g("number");break;case 35667:c(2,"number");break;case 35668:c(3,"number");break;case 35669:c(4,"number");break;case 5126:g("number");break;case 35664:c(2,"number");break;case 35665:c(3,"number");break;case 35666:c(4,"number");break;case 35670:g("boolean");break;case 35671:c(2,"boolean");break;case 35672:c(3,"boolean");break;case 35673:c(4,
"boolean");break;case 35674:c(4,"number");break;case 35675:c(9,"number");break;case 35676:c(16,"number");break;case 35678:e(3553);break;case 35680:e(34067)}});v=1;switch(t){case 35678:case 35680:v=d.def(n,"._texture");d(f,".uniform1i(",l,",",v,".bind());");d.exit(v,".unbind();");continue;case 5124:case 35670:h="1i";break;case 35667:case 35671:h="2i";v=2;break;case 35668:case 35672:h="3i";v=3;break;case 35669:case 35673:h="4i";v=4;break;case 5126:h="1f";break;case 35664:h="2f";v=2;break;case 35665:h=
"3f";v=3;break;case 35666:h="4f";v=4;break;case 35674:h="Matrix2fv";break;case 35675:h="Matrix3fv";break;case 35676:h="Matrix4fv"}d(f,".uniform",h,"(",l,",");if("M"===h.charAt(0)){var l=Math.pow(t-35674+2,2),qa=a.global.def("new Float32Array(",l,")");d("false,(Array.isArray(",n,")||",n," instanceof Float32Array)?",n,":(",A(l,function(a){return qa+"["+a+"]="+n+"["+a+"]"}),",",qa,")")}else 1<v?d(A(v,function(a){return n+"["+a+"]"})):d(n);d(");")}}function ua(a,d,c,e){function w(b){var g=q[b];return g?
g.contextDep&&e.contextDynamic||g.propDep?g.append(a,c):g.append(a,d):d.def(l,".",b)}function h(){function a(){c(m,".drawElementsInstancedANGLE(",[B,n,z,v+"<<(("+z+"-5121)>>1)",G],");")}function b(){c(m,".drawArraysInstancedANGLE(",[B,v,n,G],");")}t?qa?a():(c("if(",t,"){"),a(),c("}else{"),b(),c("}")):b()}function f(){function a(){c(y+".drawElements("+[B,n,z,v+"<<(("+z+"-5121)>>1)"]+");")}function b(){c(y+".drawArrays("+[B,v,n]+");")}t?qa?a():(c("if(",t,"){"),a(),c("}else{"),b(),c("}")):b()}var k=
a.shared,y=k.gl,l=k.draw,q=e.draw,t=function(){var b=q.elements,g=d;if(b){if(b.contextDep&&e.contextDynamic||b.propDep)g=c;b=b.append(a,g)}else b=g.def(l,".","elements");b&&g("if("+b+")"+y+".bindBuffer(34963,"+b+".buffer.buffer);");return b}(),B=w("primitive"),v=w("offset"),n=function(){var g=q.count,w,h=d;if(g){if(g.contextDep&&e.contextDynamic||g.propDep)h=c;w=g.append(a,h);b.optional(function(){g.MISSING&&a.assert(d,"false","missing vertex count");g.DYNAMIC&&a.assert(h,w+">=0","missing vertex count")})}else w=
h.def(l,".","count"),b.optional(function(){a.assert(h,w+">=0","missing vertex count")});return w}();if("number"===typeof n){if(0===n)return}else c("if(",n,"){"),c.exit("}");var G,m;g&&(G=w("instances"),m=a.instancing);var z=t+".type",qa=q.elements&&p(q.elements);g&&("number"!==typeof G||0<=G)?"string"===typeof G?(c("if(",G,">0){"),h(),c("}else if(",G,"<0){"),f(),c("}")):h():f()}function Ea(a,d,c,e,w){var h=Ca();w=h.proc("body",w);b.optional(function(){h.commandStr=d.commandStr;h.command=h.link(d.commandStr)});
g&&(h.instancing=w.def(h.shared.extensions,".angle_instanced_arrays"));a(h,w,c,e);return h.compile().body}function Ga(a,b,d,g){Y(a,b);za(a,b,d,g.attributes,function(){return!0});ha(a,b,d,g.uniforms,function(){return!0});ua(a,b,b,d)}function Ja(a,b){var d=a.proc("draw",1);Y(a,d);X(a,d,b.context);ga(a,d,b.framebuffer);oa(a,d,b);Q(a,d,b.state);ea(a,d,b,!1,!0);var g=b.shader.progVar.append(a,d);d(a.shared.gl,".useProgram(",g,".program);");if(b.shader.program)Ga(a,d,b,b.shader.program);else{var c=a.global.def("{}"),
e=d.def(g,".id"),h=d.def(c,"[",e,"]");d(a.cond(h).then(h,".call(this,a0);")["else"](h,"=",c,"[",e,"]=",a.link(function(d){return Ea(Ga,a,b,d,1)}),"(",g,");",h,".call(this,a0);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function Fa(a,b,d,g){function c(){return!0}a.batchId="a1";Y(a,b);za(a,b,d,g.attributes,c);ha(a,b,d,g.uniforms,c);ua(a,b,b,d)}function Ka(a,b,d,g){function c(a){return a.contextDep&&h||a.propDep}function e(a){return!c(a)}Y(a,b);var h=d.contextDep,w=b.def(),
f=b.def();a.shared.props=f;a.batchId=w;var k=a.scope(),y=a.scope();b(k.entry,"for(",w,"=0;",w,"<","a1",";++",w,"){",f,"=","a0","[",w,"];",y,"}",k.exit);d.needsContext&&X(a,y,d.context);d.needsFramebuffer&&ga(a,y,d.framebuffer);Q(a,y,d.state,c);d.profile&&c(d.profile)&&ea(a,y,d,!1,!0);g?(za(a,k,d,g.attributes,e),za(a,y,d,g.attributes,c),ha(a,k,d,g.uniforms,e),ha(a,y,d,g.uniforms,c),ua(a,k,y,d)):(b=a.global.def("{}"),g=d.shader.progVar.append(a,y),f=y.def(g,".id"),k=y.def(b,"[",f,"]"),y(a.shared.gl,
".useProgram(",g,".program);","if(!",k,"){",k,"=",b,"[",f,"]=",a.link(function(b){return Ea(Fa,a,d,b,2)}),"(",g,");}",k,".call(this,a0[",w,"],",w,");"))}function La(a,b){function d(a){return a.contextDep&&c||a.propDep}var g=a.proc("batch",2);a.batchId="0";Y(a,g);var c=!1,e=!0;Object.keys(b.context).forEach(function(a){c=c||b.context[a].propDep});c||(X(a,g,b.context),e=!1);var h=b.framebuffer,w=!1;h?(h.propDep?c=w=!0:h.contextDep&&c&&(w=!0),w||ga(a,g,h)):ga(a,g,null);b.state.viewport&&b.state.viewport.propDep&&
(c=!0);oa(a,g,b);Q(a,g,b.state,function(a){return!d(a)});b.profile&&d(b.profile)||ea(a,g,b,!1,"a1");b.contextDep=c;b.needsContext=e;b.needsFramebuffer=w;e=b.shader.progVar;if(e.contextDep&&c||e.propDep)Ka(a,g,b,null);else if(e=e.append(a,g),g(a.shared.gl,".useProgram(",e,".program);"),b.shader.program)Ka(a,g,b,b.shader.program);else{var h=a.global.def("{}"),w=g.def(e,".id"),f=g.def(h,"[",w,"]");g(a.cond(f).then(f,".call(this,a0,a1);")["else"](f,"=",h,"[",w,"]=",a.link(function(d){return Ea(Ka,a,b,
d,2)}),"(",e,");",f,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&g(a.shared.current,".dirty=true;")}function Ma(a,b){function d(e){var h=b.shader[e];h&&g.set(c.shader,"."+e,h.append(a,g))}var g=a.proc("scope",3);a.batchId="a2";var c=a.shared,e=c.current;X(a,g,b.context);b.framebuffer&&b.framebuffer.append(a,g);n(Object.keys(b.state)).forEach(function(d){var e=b.state[d].append(a,g);k(e)?e.forEach(function(b,c){g.set(a.next[d],"["+c+"]",b)}):g.set(c.next,"."+d,e)});ea(a,g,b,!0,!0);["elements",
"offset","count","instances","primitive"].forEach(function(d){var e=b.draw[d];e&&g.set(c.draw,"."+d,""+e.append(a,g))});Object.keys(b.uniforms).forEach(function(d){g.set(c.uniforms,"["+m.id(d)+"]",b.uniforms[d].append(a,g))});Object.keys(b.attributes).forEach(function(d){var c=b.attributes[d].append(a,g),e=a.scopeAttrib(d);Object.keys(new sa).forEach(function(a){g.set(e,"."+a,c[a])})});d("vert");d("frag");0<Object.keys(b.state).length&&(g(e,".dirty=true;"),g.exit(e,".dirty=true;"));g("a1(",a.shared.context,
",a0,",a.batchId,");")}function Pa(a){if("object"===typeof a&&!k(a)){for(var b=Object.keys(a),d=0;d<b.length;++d)if(E.isDynamic(a[b[d]]))return!0;return!1}}function va(a,b,d){function g(a,b){h.forEach(function(d){var g=c[d];E.isDynamic(g)&&(g=a.invoke(b,g),b(l,".",d,"=",g,";"))})}var c=b["static"][d];if(c&&Pa(c)){var e=a.global,h=Object.keys(c),w=!1,y=!1,k=!1,l=a.global.def("{}");h.forEach(function(b){var d=c[b];if(E.isDynamic(d))"function"===typeof d&&(d=c[b]=E.unbox(d)),b=f(d,null),w=w||b.thisDep,
k=k||b.propDep,y=y||b.contextDep;else{e(l,".",b,"=");switch(typeof d){case "number":e(d);break;case "string":e('"',d,'"');break;case "object":Array.isArray(d)&&e("[",d.join(),"]");break;default:e(a.link(d))}e(";")}});b.dynamic[d]=new E.DynamicVariable(4,{thisDep:w,contextDep:y,propDep:k,ref:l,append:g});delete b["static"][d]}}var sa=B.Record,da={add:32774,subtract:32778,"reverse subtract":32779};K.ext_blend_minmax&&(da.min=32775,da.max=32776);var g=K.angle_instanced_arrays,y=K.webgl_draw_buffers,
w={dirty:!0,profile:wa.profile},qa={},Ha=[],Aa={},Ba={};R("dither",3024);R("blend.enable",3042);O("blend.color","blendColor",[0,0,0,0]);O("blend.equation","blendEquationSeparate",[32774,32774]);O("blend.func","blendFuncSeparate",[1,0,1,0]);R("depth.enable",2929,!0);O("depth.func","depthFunc",513);O("depth.range","depthRange",[0,1]);O("depth.mask","depthMask",!0);O("colorMask","colorMask",[!0,!0,!0,!0]);R("cull.enable",2884);O("cull.face","cullFace",1029);O("frontFace","frontFace",2305);O("lineWidth",
"lineWidth",1);R("polygonOffset.enable",32823);O("polygonOffset.offset","polygonOffset",[0,0]);R("sample.alpha",32926);R("sample.enable",32928);O("sample.coverage","sampleCoverage",[1,!1]);R("stencil.enable",2960);O("stencil.mask","stencilMask",-1);O("stencil.func","stencilFunc",[519,0,-1]);O("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);O("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);R("scissor.enable",3089);O("scissor.box","scissor",[0,0,q.drawingBufferWidth,q.drawingBufferHeight]);
O("viewport","viewport",[0,0,q.drawingBufferWidth,q.drawingBufferHeight]);var Oa={gl:q,context:ka,strings:m,next:qa,current:w,draw:Da,elements:U,buffer:N,shader:I,attributes:B.state,uniforms:W,framebuffer:x,extensions:K,timer:pa,isBufferArgs:c},Ia={primTypes:C,compareFuncs:T,blendFuncs:t,blendEquations:da,stencilOps:h,glTypes:M,orientationType:d};b.optional(function(){Oa.isArrayLike=k});y&&(Ia.backBuffer=[1029],Ia.drawBuffer=A(r.maxDrawbuffers,function(a){return 0===a?[0]:A(a,function(a){return 36064+
a})}));var Qa=0;return{next:qa,current:w,procs:function(){var a=Ca(),b=a.proc("poll"),d=a.proc("refresh"),g=a.block();b(g);d(g);var c=a.shared,e=c.gl,h=c.next,f=c.current;g(f,".dirty=false;");ga(a,b);ga(a,d,null,!0);var y=q.getExtension("angle_instanced_arrays"),l;y&&(l=a.link(y));for(var t=0;t<r.maxAttributes;++t){var p=d.def(c.attributes,"[",t,"]"),B=a.cond(p,".buffer");B.then(e,".enableVertexAttribArray(",t,");",e,".bindBuffer(",34962,",",p,".buffer.buffer);",e,".vertexAttribPointer(",t,",",p,
".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);")["else"](e,".disableVertexAttribArray(",t,");",e,".vertexAttrib4f(",t,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;");d(B);y&&d(l,".vertexAttribDivisorANGLE(",t,",",p,".divisor);")}Object.keys(Aa).forEach(function(c){var w=Aa[c],y=g.def(h,".",c),k=a.block();k("if(",y,"){",e,".enable(",w,")}else{",e,".disable(",w,")}",f,".",c,"=",y,";");d(k);b("if(",y,"!==",f,".",c,"){",k,"}")});Object.keys(Ba).forEach(function(c){var y=Ba[c],
l=w[c],t,p,q=a.block();q(e,".",y,"(");k(l)?(y=l.length,t=a.global.def(h,".",c),p=a.global.def(f,".",c),q(A(y,function(a){return t+"["+a+"]"}),");",A(y,function(a){return p+"["+a+"]="+t+"["+a+"];"}).join("")),b("if(",A(y,function(a){return t+"["+a+"]!=="+p+"["+a+"]"}).join("||"),"){",q,"}")):(t=g.def(h,".",c),p=g.def(f,".",c),q(t,");",f,".",c,"=",t,";"),b("if(",t,"!==",p,"){",q,"}"));d(q)});return a.compile()}(),compile:function(a,b,d,g,c){var e=Ca();e.stats=e.link(c);Object.keys(b["static"]).forEach(function(a){va(e,
b,a)});z.forEach(function(b){va(e,a,b)});d=V(a,b,d,g,e);Ja(e,d);Ma(e,d);La(e,d);return e.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/check":21,"./util/codegen":23,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/loop":29}],9:[function(m,r,x){function c(c,f){this.id=p++;this.type=c;this.data=f}function n(c){if(0===c.length)return[];var f=c.charAt(0),b=c.charAt(c.length-1);if(1<c.length&&f===b&&('"'===f||"'"===f))return['"'+
c.substr(1,c.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(f=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(c))return n(c.substr(0,f.index)).concat(n(f[1])).concat(n(c.substr(f.index+f[0].length)));f=c.split(".");if(1===f.length)return['"'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];c=[];for(b=0;b<f.length;++b)c=c.concat(n(f[b]));return c}function l(c){return"["+n(c).join("][")+"]"}var p=0;r.exports={DynamicVariable:c,define:function(e,f){return new c(e,l(f+""))},isDynamic:function(e){return"function"===
typeof e&&!e._reglType||e instanceof c},unbox:function(e,f){return"function"===typeof e?new c(0,e):e},accessor:l}},{}],10:[function(m,r,x){var c=m("./util/check"),n=m("./util/is-typed-array"),l=m("./util/is-ndarray"),p=m("./util/values"),e=m("./constants/primitives.json"),f=m("./constants/usage.json");r.exports=function(b,v,m,K){function q(b){this.id=M++;C[this.id]=this;this.buffer=b;this.primType=4;this.type=this.vertCount=0}function k(e,f,k,h,a,d,q){e.buffer.bind();if(f){var p=q;q||n(f)&&(!l(f)||
n(f.data))||(p=v.oes_element_index_uint?5125:5123);m._initBuffer(e.buffer,f,k,p,3)}else b.bufferData(34963,d,k),e.buffer.dtype=p||5121,e.buffer.usage=k,e.buffer.dimension=3,e.buffer.byteLength=d;p=q;if(!q){switch(e.buffer.dtype){case 5121:case 5120:p=5121;break;case 5123:case 5122:p=5123;break;case 5125:case 5124:p=5125;break;default:c.raise("unsupported type for element array")}e.buffer.dtype=p}e.type=p;c(5125!==p||!!v.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");
f=a;0>f&&(f=e.buffer.byteLength,5123===p?f>>=1:5125===p&&(f>>=2));e.vertCount=f;f=h;0>h&&(f=4,h=e.buffer.dimension,1===h&&(f=0),2===h&&(f=1),3===h&&(f=4));e.primType=f}function E(b){K.elementsCount--;c(null!==b.buffer,"must not double destroy elements");delete C[b.id];b.buffer.destroy();b.buffer=null}var C={},M=0,r={uint8:5121,uint16:5123};v.oes_element_index_uint&&(r.uint32=5125);q.prototype.bind=function(){this.buffer.bind()};var z=[];return{create:function(b,p){function v(b){if(b)if("number"===
typeof b)h(b),a.primType=4,a.vertCount=b|0,a.type=5121;else{var p=null,q=35044,t=-1,m=-1,z=0,A=0;if(Array.isArray(b)||n(b)||l(b))p=b;else if(c.type(b,"object","invalid arguments for elements"),"data"in b&&(p=b.data,c(Array.isArray(p)||n(p)||l(p),"invalid data for element buffer")),"usage"in b&&(c.parameter(b.usage,f,"invalid element buffer usage"),q=f[b.usage]),"primitive"in b&&(c.parameter(b.primitive,e,"invalid element buffer primitive"),t=e[b.primitive]),"count"in b&&(c("number"===typeof b.count&&
0<=b.count,"invalid vertex count for elements"),m=b.count|0),"type"in b&&(c.parameter(b.type,r,"invalid buffer type"),A=r[b.type]),"length"in b)z=b.length|0;else if(z=m,5123===A||5122===A)z*=2;else if(5125===A||5124===A)z*=4;k(a,p,q,t,m,z,A)}else h(),a.primType=4,a.vertCount=0,a.type=5121;return v}var h=m.create(null,34963,!0),a=new q(h._buffer);K.elementsCount++;v(b);v._reglType="elements";v._elements=a;v.subdata=function(a,b){h.subdata(a,b);return v};v.destroy=function(){E(a)};return v},createStream:function(b){var c=
z.pop();c||(c=new q(m.create(null,34963,!0,!1)._buffer));k(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){z.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof q?b._elements:null},clear:function(){p(C).forEach(E)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/check":21,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/values":33}],11:[function(m,r,x){var c=m("./util/check");r.exports=function(n,l){function p(b){c.type(b,"string",
"extension name must be string");b=b.toLowerCase();var f;try{f=e[b]=n.getExtension(b)}catch(l){}return!!f}for(var e={},f=0;f<l.extensions.length;++f){var b=l.extensions[f];if(!p(b))return l.onDestroy(),l.onDone('"'+b+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}l.optionalExtensions.forEach(p);return{extensions:e,restore:function(){Object.keys(e).forEach(function(b){if(!p(b))throw Error("(regl): error restoring extension "+b);})}}}},
{"./util/check":21}],12:[function(m,r,x){var c=m("./util/check"),n=m("./util/values"),l=m("./util/extend"),p=[6408],e=[];e[6408]=4;var f=[];f[5121]=1;f[5126]=4;f[36193]=2;var b=[32854,32855,36194,35907,34842,34843,34836],v={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"};r.exports=function(m,K,q,k,E,r){function M(a,b,d){this.target=a;this.texture=b;this.renderbuffer=d;var c=a=0;b?(a=b.width,c=b.height):d&&(a=
d.width,c=d.height);this.width=a;this.height=c}function J(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function z(a,b,d){if(a){if(a.texture){a=a.texture._texture;var e=Math.max(1,a.height);c(Math.max(1,a.width)===b&&e===d,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,c(a.width===b&&a.height===d,"inconsistent width/height for renderbuffer");a.refCount+=1}}function t(a,b){b&&(b.texture?m.framebufferTexture2D(36160,
a,b.target,b.texture._texture.texture,0):m.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer))}function L(a){var b=3553,d=null,e=null,h=a;"object"===typeof a&&(h=a.data,"target"in a&&(b=a.target|0));c.type(h,"function","invalid attachment data");a=h._reglType;"texture2d"===a?(d=h,c(3553===b)):"textureCube"===a?(d=h,c(34069<=b&&34075>b,"invalid cube map target")):"renderbuffer"===a?(e=h,b=36161):c.raise("invalid regl object for attachment");return new M(b,d,e)}function T(a,
b,d,c,e){if(d)return a=k.create2D({width:a,height:b,format:c,type:e}),a._texture.refCount=0,new M(3553,a,null);a=E.create({width:a,height:b,format:c});a._renderbuffer.refCount=0;return new M(36161,null,a)}function h(a){return a&&(a.texture||a.renderbuffer)}function a(a,b,d){a&&(a.texture?a.texture.resize(b,d):a.renderbuffer&&a.renderbuffer.resize(b,d))}function d(){this.id=x++;W[this.id]=this;this.framebuffer=m.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=
this.stencilAttachment=this.depthAttachment=null}function G(a){a.colorAttachments.forEach(J);J(a.depthAttachment);J(a.stencilAttachment);J(a.depthStencilAttachment)}function ba(a){var b=a.framebuffer;c(b,"must not double destroy framebuffer");m.deleteFramebuffer(b);a.framebuffer=null;r.framebufferCount--;delete W[a.id]}function Na(a){var b;m.bindFramebuffer(36160,a.framebuffer);var d=a.colorAttachments;for(b=0;b<d.length;++b)t(36064+b,d[b]);for(b=d.length;b<q.maxColorAttachments;++b)m.framebufferTexture2D(36160,
36064+b,3553,null,0);m.framebufferTexture2D(36160,33306,3553,null,0);m.framebufferTexture2D(36160,36096,3553,null,0);m.framebufferTexture2D(36160,36128,3553,null,0);t(36096,a.depthAttachment);t(36128,a.stencilAttachment);t(33306,a.depthStencilAttachment);a=m.checkFramebufferStatus(36160);36053!==a&&c.raise("framebuffer configuration not supported, status = "+v[a]);m.bindFramebuffer(36160,ja.next);ja.cur=ja.next;m.getError()}function fa(k,t){function v(a,d){var k;c(ja.next!==n,"can not update framebuffer which is currently in use");
var l=K.webgl_draw_buffers,t=0,m=0,A=!0,ba=!0;k=null;var E=!0,r="rgba",B="uint8",M=1,C=null,fa=null,J=null,I=!1;if("number"===typeof a)t=a|0,m=d|0||t;else if(a){c.type(a,"object","invalid arguments for framebuffer");"shape"in a?(m=a.shape,c(Array.isArray(m)&&2<=m.length,"invalid shape for framebuffer"),t=m[0],m=m[1]):("radius"in a&&(t=m=a.radius),"width"in a&&(t=a.width),"height"in a&&(m=a.height));if("color"in a||"colors"in a)k=a.color||a.colors,Array.isArray(k)&&c(1===k.length||l,"multiple render targets not supported");
if(!k){"colorCount"in a&&(M=a.colorCount|0,c(0<M,"invalid color buffer count"));"colorTexture"in a&&(E=!!a.colorTexture,r="rgba4");if("colorType"in a){B=a.colorType;if(E)c(K.oes_texture_float||!("float"===B||"float32"===B),"you must enable OES_texture_float in order to use floating point framebuffer objects"),c(K.oes_texture_half_float||!("half float"===B||"float16"===B),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===B||"float16"===
B)c(K.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),r="rgba16f";else if("float"===B||"float32"===B)c(K.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),r="rgba32f";c.oneOf(B,H,"invalid color type")}if("colorFormat"in a)if(r=a.colorFormat,0<=N.indexOf(r))E=!0;else if(0<=U.indexOf(r))E=!1;else if(E)c.oneOf(a.colorFormat,N,"invalid color format for texture");else c.oneOf(a.colorFormat,
U,"invalid color format for renderbuffer")}if("depthTexture"in a||"depthStencilTexture"in a)I=!(!a.depthTexture&&!a.depthStencilTexture),c(!I||K.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in a&&("boolean"===typeof a.depth?A=a.depth:(C=a.depth,ba=!1));"stencil"in a&&("boolean"===typeof a.stencil?ba=a.stencil:(fa=a.stencil,A=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?A=ba=a.depthStencil:(J=a.depthStencil,ba=A=!1))}else t=m=1;var x=l=null,W=null,ca=null;
if(Array.isArray(k))l=k.map(L);else if(k)l=[L(k)];else for(l=Array(M),k=0;k<M;++k)l[k]=T(t,m,E,r,B);c(K.webgl_draw_buffers||1>=l.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");c(l.length<=q.maxColorAttachments,"too many color attachments, not supported");t=t||l[0].width;m=m||l[0].height;C?x=L(C):A&&!ba&&(x=T(t,m,I,"depth","uint32"));fa?W=L(fa):ba&&!A&&(W=T(t,m,!1,"stencil","uint8"));J?ca=L(J):!C&&!fa&&ba&&A&&(ca=T(t,m,I,"depth stencil","depth stencil"));
c(1>=!!C+!!fa+!!J,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");A=null;for(k=0;k<l.length;++k)z(l[k],t,m),c(!l[k]||l[k].texture&&0<=p.indexOf(l[k].texture._texture.format)||l[k].renderbuffer&&0<=b.indexOf(l[k].renderbuffer._renderbuffer.format),"framebuffer color attachment "+k+" is invalid"),l[k]&&l[k].texture&&(ba=e[l[k].texture._texture.format]*f[l[k].texture._texture.type],null===A?A=ba:c(A===ba,"all color attachments much have the same number of bits per pixel."));
z(x,t,m);c(!x||x.texture&&6402===x.texture._texture.format||x.renderbuffer&&33189===x.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");z(W,t,m);c(!W||W.renderbuffer&&36168===W.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");z(ca,t,m);c(!ca||ca.texture&&34041===ca.texture._texture.format||ca.renderbuffer&&34041===ca.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");G(n);n.width=t;n.height=
m;n.colorAttachments=l;n.depthAttachment=x;n.stencilAttachment=W;n.depthStencilAttachment=ca;v.color=l.map(h);v.depth=h(x);v.stencil=h(W);v.depthStencil=h(ca);v.width=n.width;v.height=n.height;Na(n);return v}var n=new d;r.framebufferCount++;v(k,t);return l(v,{resize:function(b,d){c(ja.next!==n,"can not resize a framebuffer which is currently in use");var e=b|0,h=d|0||e;if(e===n.width&&h===n.height)return v;for(var f=n.colorAttachments,k=0;k<f.length;++k)a(f[k],e,h);a(n.depthAttachment,e,h);a(n.stencilAttachment,
e,h);a(n.depthStencilAttachment,e,h);n.width=v.width=e;n.height=v.height=h;Na(n);return v},_reglType:"framebuffer",_framebuffer:n,destroy:function(){ba(n);G(n)},bind:function(a){ja.setFBO({framebuffer:v},a)}})}var ja={cur:null,next:null,dirty:!1,setFBO:null},N=["rgba"],U=["rgba4","rgb565","rgb5 a1"];K.ext_srgb&&U.push("srgba");K.ext_color_buffer_half_float&&U.push("rgba16f","rgb16f");K.webgl_color_buffer_float&&U.push("rgba32f");var H=["uint8"];K.oes_texture_half_float&&H.push("half float","float16");
K.oes_texture_float&&H.push("float","float32");var x=0,W={};return l(ja,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof d)?a:null},create:fa,createCube:function(a){function b(a){var e;c(0>d.indexOf(ja.next),"can not update framebuffer which is currently in use");var h=K.webgl_draw_buffers,f={color:null},p=0,q=null;e="rgba";var t="uint8",n=1;if("number"===typeof a)p=a|0;else if(a){c.type(a,"object","invalid arguments for framebuffer");
"shape"in a?(p=a.shape,c(Array.isArray(p)&&2<=p.length,"invalid shape for framebuffer"),c(p[0]===p[1],"cube framebuffer must be square"),p=p[0]):("radius"in a&&(p=a.radius|0),"width"in a?(p=a.width|0,"height"in a&&c(a.height===p,"must be square")):"height"in a&&(p=a.height|0));if("color"in a||"colors"in a)q=a.color||a.colors,Array.isArray(q)&&c(1===q.length||h,"multiple render targets not supported");q||("colorCount"in a&&(n=a.colorCount|0,c(0<n,"invalid color buffer count")),"colorType"in a&&(c.oneOf(a.colorType,
H,"invalid color type"),t=a.colorType),"colorFormat"in a&&(e=a.colorFormat,c.oneOf(a.colorFormat,N,"invalid color format for texture")));"depth"in a&&(f.depth=a.depth);"stencil"in a&&(f.stencil=a.stencil);"depthStencil"in a&&(f.depthStencil=a.depthStencil)}else p=1;if(q)if(Array.isArray(q))for(a=[],e=0;e<q.length;++e)a[e]=q[e];else a=[q];else for(a=Array(n),q={radius:p,format:e,type:t},e=0;e<n;++e)a[e]=k.createCube(q);f.color=Array(a.length);for(e=0;e<a.length;++e)n=a[e],c("function"===typeof n&&
"textureCube"===n._reglType,"invalid cube map"),p=p||n.width,c(n.width===p&&n.height===p,"invalid cube map shape"),f.color[e]={target:34069,data:a[e]};for(e=0;6>e;++e){for(n=0;n<a.length;++n)f.color[n].target=34069+e;0<e&&(f.depth=d[0].depth,f.stencil=d[0].stencil,f.depthStencil=d[0].depthStencil);if(d[e])d[e](f);else d[e]=fa(f)}return l(b,{width:p,height:p,color:a})}var d=Array(6);b(a);return l(b,{faces:d,resize:function(a){var e=a|0;c(0<e&&e<=q.maxCubeMapSize,"invalid radius for cube fbo");if(e===
b.width)return b;var h=b.color;for(a=0;a<h.length;++a)h[a].resize(e);for(a=0;6>a;++a)d[a].resize(e);b.width=b.height=e;return b},_reglType:"framebufferCube",destroy:function(){d.forEach(function(a){a.destroy()})}})},clear:function(){n(W).forEach(ba)},restore:function(){n(W).forEach(function(a){a.framebuffer=m.createFramebuffer();Na(a)})}})}},{"./util/check":21,"./util/extend":24,"./util/values":33}],13:[function(m,r,x){r.exports=function(c,n){var l=1;n.ext_texture_filter_anisotropic&&(l=c.getParameter(34047));
var p=1,e=1;n.webgl_draw_buffers&&(p=c.getParameter(34852),e=c.getParameter(36063));return{colorBits:[c.getParameter(3410),c.getParameter(3411),c.getParameter(3412),c.getParameter(3413)],depthBits:c.getParameter(3414),stencilBits:c.getParameter(3415),subpixelBits:c.getParameter(3408),extensions:Object.keys(n).filter(function(c){return!!n[c]}),maxAnisotropic:l,maxDrawbuffers:p,maxColorAttachments:e,pointSizeDims:c.getParameter(33901),lineWidthDims:c.getParameter(33902),maxViewportDims:c.getParameter(3386),
maxCombinedTextureUnits:c.getParameter(35661),maxCubeMapSize:c.getParameter(34076),maxRenderbufferSize:c.getParameter(34024),maxTextureUnits:c.getParameter(34930),maxTextureSize:c.getParameter(3379),maxAttributes:c.getParameter(34921),maxVertexUniforms:c.getParameter(36347),maxVertexTextureUnits:c.getParameter(35660),maxVaryingVectors:c.getParameter(36348),maxFragmentUniforms:c.getParameter(36349),glsl:c.getParameter(35724),renderer:c.getParameter(7937),vendor:c.getParameter(7936),version:c.getParameter(7938)}}},
{}],14:[function(m,r,x){var c=m("./util/check"),n=m("./util/is-typed-array");r.exports=function(l,p,e,f,b,m){function A(q){var k;null===p.next?(c(b.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),k=5121):(c(null!==p.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),k=p.next.colorAttachments[0].texture._texture.type,m.oes_texture_float?c(5121===k||5126===k,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):
c(5121===k,"Reading from a framebuffer is only allowed for the type 'uint8'"));var A=0,r=0,K=f.framebufferWidth,J=f.framebufferHeight,z=null;n(q)?z=q:q&&(c.type(q,"object","invalid arguments to regl.read()"),A=q.x|0,r=q.y|0,c(0<=A&&A<f.framebufferWidth,"invalid x offset for regl.read"),c(0<=r&&r<f.framebufferHeight,"invalid y offset for regl.read"),K=(q.width||f.framebufferWidth-A)|0,J=(q.height||f.framebufferHeight-r)|0,z=q.data||null);z&&(5121===k?c(z instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):
5126===k&&c(z instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));c(0<K&&K+A<=f.framebufferWidth,"invalid width for read pixels");c(0<J&&J+r<=f.framebufferHeight,"invalid height for read pixels");e();q=K*J*4;z||(5121===k?z=new Uint8Array(q):5126===k&&(z=z||new Float32Array(q)));c.isTypedArray(z,"data buffer for regl.read() must be a typedarray");c(z.byteLength>=q,"data buffer for regl.read() too small");l.pixelStorei(3333,4);l.readPixels(A,r,K,
J,6408,k,z);return z}function r(b){var c;p.setFBO({framebuffer:b.framebuffer},function(){c=A(b)});return c}return function(b){return b&&"framebuffer"in b?r(b):A(b)}}},{"./util/check":21,"./util/is-typed-array":28}],15:[function(m,r,x){var c=m("./util/check"),n=m("./util/values"),l=[];l[32854]=2;l[32855]=2;l[36194]=2;l[33189]=2;l[36168]=1;l[34041]=4;l[35907]=4;l[34836]=16;l[34842]=8;l[34843]=6;r.exports=function(p,e,f,b,m){function A(b){this.id=E++;this.refCount=1;this.renderbuffer=b;this.format=32854;
this.height=this.width=0;m.profile&&(this.stats={size:0})}function r(e){var f=e.renderbuffer;c(f,"must not double destroy renderbuffer");p.bindRenderbuffer(36161,null);p.deleteRenderbuffer(f);e.renderbuffer=null;e.refCount=0;delete C[e.id];b.renderbufferCount--}var q={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(q.srgba=35907);e.ext_color_buffer_half_float&&(q.rgba16f=34842,q.rgb16f=34843);e.webgl_color_buffer_float&&(q.rgba32f=34836);var k=
[];Object.keys(q).forEach(function(b){k[q[b]]=b});var E=0,C={};A.prototype.decRef=function(){0>=--this.refCount&&r(this)};m.profile&&(b.getTotalRenderbufferSize=function(){var b=0;Object.keys(C).forEach(function(c){b+=C[c].stats.size});return b});return{create:function(e,n){function z(b,e){var h=0,a=0,d=32854;"object"===typeof b&&b?("shape"in b?(a=b.shape,c(Array.isArray(a)&&2<=a.length,"invalid renderbuffer shape"),h=a[0]|0,a=a[1]|0):("radius"in b&&(h=a=b.radius|0),"width"in b&&(h=b.width|0),"height"in
b&&(a=b.height|0)),"format"in b&&(c.parameter(b.format,q,"invalid renderbuffer format"),d=q[b.format])):"number"===typeof b?(h=b|0,a="number"===typeof e?e|0:h):b?c.raise("invalid arguments to renderbuffer constructor"):h=a=1;c(0<h&&0<a&&h<=f.maxRenderbufferSize&&a<=f.maxRenderbufferSize,"invalid renderbuffer size");if(h!==t.width||a!==t.height||d!==t.format)return z.width=t.width=h,z.height=t.height=a,t.format=d,p.bindRenderbuffer(36161,t.renderbuffer),p.renderbufferStorage(36161,d,h,a),m.profile&&
(t.stats.size=l[t.format]*t.width*t.height),z.format=k[t.format],z}var t=new A(p.createRenderbuffer());C[t.id]=t;b.renderbufferCount++;z(e,n);z.resize=function(b,e){var h=b|0,a=e|0||h;if(h===t.width&&a===t.height)return z;c(0<h&&0<a&&h<=f.maxRenderbufferSize&&a<=f.maxRenderbufferSize,"invalid renderbuffer size");z.width=t.width=h;z.height=t.height=a;p.bindRenderbuffer(36161,t.renderbuffer);p.renderbufferStorage(36161,t.format,h,a);m.profile&&(t.stats.size=l[t.format]*t.width*t.height);return z};z._reglType=
"renderbuffer";z._renderbuffer=t;m.profile&&(z.stats=t.stats);z.destroy=function(){t.decRef()};return z},clear:function(){n(C).forEach(r)},restore:function(){n(C).forEach(function(b){b.renderbuffer=p.createRenderbuffer();p.bindRenderbuffer(36161,b.renderbuffer);p.renderbufferStorage(36161,b.format,b.width,b.height)});p.bindRenderbuffer(36161,null)}}}},{"./util/check":21,"./util/values":33}],16:[function(m,r,x){var c=m("./util/check"),n=m("./util/values");r.exports=function(l,p,e,f){function b(b,c,
e,f){this.name=b;this.id=c;this.location=e;this.info=f}function m(b,c){for(var e=0;e<b.length;++e)if(b[e].id===c.id){b[e].location=c.location;return}b.push(c)}function A(b,e,f){var q=35632===b?k:E,h=q[e];if(!h){var a=p.str(e),h=l.createShader(b);l.shaderSource(h,a);l.compileShader(h);c.shaderError(l,h,a,b,f);q[e]=h}return h}function r(b,c){this.id=J++;this.fragId=b;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];f.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function q(e,
k){var q,n;q=A(35632,e.fragId);n=A(35633,e.vertId);var h=e.program=l.createProgram();l.attachShader(h,q);l.attachShader(h,n);l.linkProgram(h);c.linkError(l,h,p.str(e.fragId),p.str(e.vertId),k);var a=l.getProgramParameter(h,35718);f.profile&&(e.stats.uniformsCount=a);var d=e.uniforms;for(q=0;q<a;++q)if(n=l.getActiveUniform(h,q))if(1<n.size)for(var G=0;G<n.size;++G){var r=n.name.replace("[0]","["+G+"]");m(d,new b(r,p.id(r),l.getUniformLocation(h,r),n))}else m(d,new b(n.name,p.id(n.name),l.getUniformLocation(h,
n.name),n));a=l.getProgramParameter(h,35721);f.profile&&(e.stats.attributesCount=a);d=e.attributes;for(q=0;q<a;++q)(n=l.getActiveAttrib(h,q))&&m(d,new b(n.name,p.id(n.name),l.getAttribLocation(h,n.name),n))}var k={},E={},C={},M=[],J=0;f.profile&&(e.getMaxUniformsCount=function(){var b=0;M.forEach(function(c){c.stats.uniformsCount>b&&(b=c.stats.uniformsCount)});return b},e.getMaxAttributesCount=function(){var b=0;M.forEach(function(c){c.stats.attributesCount>b&&(b=c.stats.attributesCount)});return b});
return{clear:function(){var b=l.deleteShader.bind(l);n(k).forEach(b);k={};n(E).forEach(b);E={};M.forEach(function(b){l.deleteProgram(b.program)});M.length=0;C={};e.shaderCount=0},program:function(b,f,k){c.command(0<=b,"missing vertex shader",k);c.command(0<=f,"missing fragment shader",k);var l=C[f];l||(l=C[f]={});var h=l[b];h||(h=new r(f,b),e.shaderCount++,q(h,k),l[b]=h,M.push(h));return h},restore:function(){k={};E={};for(var b=0;b<M.length;++b)q(M[b])},shader:A,frag:-1,vert:-1}}},{"./util/check":21,
"./util/values":33}],17:[function(m,r,x){r.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(m,r,x){r.exports=function(){var c={"":0},n=[""];return{id:function(l){var p=c[l];if(p)return p;p=c[l]=n.length;n.push(l);return p},str:function(c){return n[c]}}}},{}],19:[function(m,r,x){function c(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function n(a){return Array.isArray(a)&&
0!==a.length&&C(a[0])?!0:!1}function l(a){return Object.prototype.toString.call(a)}function p(a){if(!a)return!1;var b=l(a);return 0<=T.indexOf(b)?!0:c(a)||n(a)||q(a)}function e(a,b){36193===a.type?(a.data=E(b),k.freeType(b)):a.data=b}function f(b,c,e,f,k,l){b="undefined"!==typeof a[b]?a[b]:L[b]*h[c];l&&(b*=6);if(k){for(f=0;1<=e;)f+=b*e*e,e/=2;return f}return b*e*f}var b=m("./util/check"),v=m("./util/extend"),A=m("./util/values"),K=m("./util/is-typed-array"),q=m("./util/is-ndarray"),k=m("./util/pool"),
E=m("./util/to-half-float"),C=m("./util/is-array-like"),M=m("./util/flatten");x=m("./constants/arraytypes.json");var J=m("./constants/arraytypes.json"),z=[9984,9986,9985,9987],t=[0,6409,6410,6407,6408],L={};L[6409]=L[6406]=L[6402]=1;L[34041]=L[6410]=2;L[6407]=L[35904]=3;L[6408]=L[35906]=4;var T=Object.keys(x).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),h=[];h[5121]=1;h[5126]=4;h[36193]=2;h[5123]=2;h[5125]=4;var a=
[];a[32854]=2;a[32855]=2;a[36194]=2;a[34041]=4;a[33776]=.5;a[33777]=.5;a[33778]=1;a[33779]=1;a[35986]=.5;a[35987]=1;a[34798]=1;a[35840]=.5;a[35841]=.25;a[35842]=.5;a[35843]=.25;a[36196]=.5;r.exports=function(a,h,m,r,fa,x,N){function U(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function H(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;
a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function ca(a,d){if("object"===typeof d&&d){"premultiplyAlpha"in d&&(b.type(d.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=d.premultiplyAlpha);"flipY"in d&&(b.type(d.flipY,"boolean","invalid texture flip"),a.flipY=d.flipY);"alignment"in d&&(b.oneOf(d.alignment,[1,2,4,8],"invalid texture unpack alignment"),
a.unpackAlignment=d.alignment);"colorSpace"in d&&(b.parameter(d.colorSpace,oa,"invalid colorSpace"),a.colorSpace=oa[d.colorSpace]);if("type"in d){var c=d.type;b(h.oes_texture_float||!("float"===c||"float32"===c),"you must enable the OES_texture_float extension in order to use floating point textures.");b(h.oes_texture_half_float||!("half float"===c||"float16"===c),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");b(h.webgl_depth_texture||!("uint16"===
c||"uint32"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");b.parameter(c,Q,"invalid texture type");a.type=Q[c]}var e=a.width,f=a.height,k=a.channels,c=!1;"shape"in d?(b(Array.isArray(d.shape)&&2<=d.shape.length,"shape must be an array"),e=d.shape[0],f=d.shape[1],3===d.shape.length&&(k=d.shape[2],b(0<k&&4>=k,"invalid number of channels"),c=!0),b(0<=e&&e<=m.maxTextureSize,"invalid width"),b(0<=f&&f<=m.maxTextureSize,"invalid height")):
("radius"in d&&(e=f=d.radius,b(0<=e&&e<=m.maxTextureSize,"invalid radius")),"width"in d&&(e=d.width,b(0<=e&&e<=m.maxTextureSize,"invalid width")),"height"in d&&(f=d.height,b(0<=f&&f<=m.maxTextureSize,"invalid height")),"channels"in d&&(k=d.channels,b(0<k&&4>=k,"invalid number of channels"),c=!0));a.width=e|0;a.height=f|0;a.channels=k|0;e=!1;"format"in d&&(e=d.format,b(h.webgl_depth_texture||!("depth"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),
b.parameter(e,Y,"invalid texture format"),f=a.internalformat=Y[e],a.format=Ka[f],e in Q&&!("type"in d)&&(a.type=Q[e]),e in ea&&(a.compressed=!0),e=!0);!c&&e?a.channels=L[a.format]:c&&!e?a.channels!==t[a.format]&&(a.format=a.internalformat=t[a.channels]):e&&c&&b(a.channels===L[a.format],"number of channels inconsistent with specified format")}}function W(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function B(){U.call(this);
this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function I(a,d){var f=null;p(d)?f=d:d&&(b.type(d,"object","invalid pixel data type"),ca(a,d),"x"in d&&(a.xOffset=d.x|0),"y"in d&&(a.yOffset=d.y|0),p(d.data)&&(f=d.data));b(!a.compressed||f instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(d.copy){b(!f,"can not specify copy and data field for the same texture");var h=fa.viewportWidth,v=fa.viewportHeight;a.width=a.width||
h-a.xOffset;a.height=a.height||v-a.yOffset;a.needsCopy=!0;b(0<=a.xOffset&&a.xOffset<h&&0<=a.yOffset&&a.yOffset<v&&0<a.width&&a.width<=h&&0<a.height&&a.height<=v,"copy texture read out of bounds")}else if(!f)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(K(f))a.channels=a.channels||4,a.data=f,"type"in d||5121!==a.type||(a.type=J[Object.prototype.toString.call(f)]|0);else if(c(f)){a.channels=a.channels||4;h=f;v=h.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:v=
k.allocType(a.type,v);v.set(h);a.data=v;break;case 36193:a.data=E(h);break;default:b.raise("unsupported texture type, must specify a typed array")}a.alignment=1;a.needsFree=!0}else if(q(f)){h=f.data;Array.isArray(h)||5121!==a.type||(a.type=J[Object.prototype.toString.call(h)]|0);var v=f.shape,A=f.stride,r,G,z,B;3===v.length?(z=v[2],B=A[2]):(b(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),B=z=1);r=v[0];G=v[1];v=A[0];A=A[1];a.alignment=1;a.width=r;a.height=G;a.channels=z;a.format=a.internalformat=
t[z];a.needsFree=!0;r=B;f=f.offset;z=a.width;B=a.height;G=a.channels;for(var u=k.allocType(36193===a.type?5126:a.type,z*B*G),N=0,H=0;H<B;++H)for(var x=0;x<z;++x)for(var U=0;U<G;++U)u[N++]=h[v*x+A*H+r*U+f];e(a,u)}else if("[object HTMLCanvasElement]"===l(f)||"[object CanvasRenderingContext2D]"===l(f))"[object HTMLCanvasElement]"===l(f)?a.element=f:a.element=f.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if("[object HTMLImageElement]"===l(f))a.element=f,a.width=f.naturalWidth,
a.height=f.naturalHeight,a.channels=4;else if("[object HTMLVideoElement]"===l(f))a.element=f,a.width=f.videoWidth,a.height=f.videoHeight,a.channels=4;else if(n(f)){h=a.width||f[0].length;v=a.height||f.length;A=a.channels;A=C(f[0][0])?A||f[0][0].length:A||1;r=M.shape(f);z=1;for(B=0;B<r.length;++B)z*=r[B];z=k.allocType(36193===a.type?5126:a.type,z);M.flatten(f,r,"",z);e(a,z);a.alignment=1;a.width=h;a.height=v;a.channels=A;a.format=a.internalformat=t[A];a.needsFree=!0}5126===a.type?b(0<=m.extensions.indexOf("oes_texture_float"),
"oes_texture_float extension not enabled"):36193===a.type&&b(0<=m.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}function T(b,c,e,f,h){var k=b.element,l=b.data,p=b.internalformat,q=b.format,n=b.type,m=b.width,v=b.height;W(b);k?a.texSubImage2D(c,h,e,f,q,n,k):b.compressed?a.compressedTexSubImage2D(c,h,e,f,p,m,v,l):b.needsCopy?(r(),a.copyTexSubImage2D(c,h,e,f,b.xOffset,b.yOffset,m,v)):a.texSubImage2D(c,h,e,f,m,v,q,n,l)}function ka(){return La.pop()||new B}
function pa(a){a.needsFree&&k.freeType(a.data);B.call(a);La.push(a)}function wa(){U.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function Z(a,b,d){var c=a.images[0]=ka();a.mipmask=1;c.width=a.width=b;c.height=a.height=d;c.channels=a.channels=4}function R(a,d){var c=null;if(p(d))c=a.images[0]=ka(),H(c,a),I(c,d),a.mipmask=1;else if(ca(a,d),Array.isArray(d.mipmap))for(var e=d.mipmap,f=0;f<e.length;++f)c=a.images[f]=ka(),H(c,a),c.width>>=f,c.height>>=f,I(c,e[f]),
a.mipmask|=1<<f;else c=a.images[0]=ka(),H(c,a),I(c,d),a.mipmask=1;H(a,a.images[0]);(a.compressed&&33776===a.internalformat||33777===a.internalformat||33778===a.internalformat||33779===a.internalformat)&&b(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function O(b,c){for(var e=b.images,f=0;f<e.length&&e[f];++f){var h=e[f],k=c,l=f,p=h.element,q=h.data,n=h.internalformat,m=h.format,v=h.type,t=h.width,A=h.height;W(h);
p?a.texImage2D(k,l,m,m,v,p):h.compressed?a.compressedTexImage2D(k,l,n,t,A,0,q):h.needsCopy?(r(),a.copyTexImage2D(k,l,m,h.xOffset,h.yOffset,t,A,0)):a.texImage2D(k,l,m,t,A,0,m,v,q)}}function Ca(){var a=Ma.pop()||new wa;U.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ta(a){for(var b=a.images,d=0;d<b.length;++d)b[d]&&pa(b[d]),b[d]=null;Ma.push(a)}function xa(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=
4352}function aa(a,d){if("min"in d){var c=d.min;b.parameter(c,ga);a.minFilter=ga[c];0<=z.indexOf(a.minFilter)&&(a.genMipmaps=!0)}"mag"in d&&(c=d.mag,b.parameter(c,X),a.magFilter=X[c]);var c=a.wrapS,e=a.wrapT;if("wrap"in d){var f=d.wrap;"string"===typeof f?(b.parameter(f,V),c=e=V[f]):Array.isArray(f)&&(b.parameter(f[0],V),b.parameter(f[1],V),c=V[f[0]],e=V[f[1]])}else"wrapS"in d&&(c=d.wrapS,b.parameter(c,V),c=V[c]),"wrapT"in d&&(e=d.wrapT,b.parameter(e,V),e=V[e]);a.wrapS=c;a.wrapT=e;"anisotropic"in
d&&(c=d.anisotropic,b("number"===typeof c&&1<=c&&c<=m.maxAnisotropic,"aniso samples must be between 1 and "),a.anisotropic=d.anisotropic);if("mipmap"in d){c=!1;switch(typeof d.mipmap){case "string":b.parameter(d.mipmap,ya,"invalid mipmap hint");a.mipmapHint=ya[d.mipmap];c=a.genMipmaps=!0;break;case "boolean":c=a.genMipmaps=d.mipmap;break;case "object":b(Array.isArray(d.mipmap),"invalid mipmap type");a.genMipmaps=!1;c=!0;break;default:b.raise("invalid mipmap type")}!c||"min"in d||(a.minFilter=9984)}}
function ia(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);h.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function la(b){U.call(this);this.mipmask=0;this.internalformat=6408;this.id=Pa++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new xa;N.profile&&(this.stats=
{size:0})}function ma(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function na(){var b=da[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function ra(c){var e=c.texture;b(e,"must not double destroy texture");var f=c.unit,h=c.target;0<=f&&(a.activeTexture(33984+f),a.bindTexture(h,null),da[f]=null);a.deleteTexture(e);c.texture=null;c.params=null;c.pixels=null;c.refCount=0;delete va[c.id];x.textureCount--}var ya={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
V={repeat:10497,clamp:33071,mirror:33648},X={nearest:9728,linear:9729},ga=v({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},X),oa={none:0,browser:37444},Q={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Y={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ea={};h.ext_srgb&&(Y.srgb=35904,Y.srgba=35906);h.oes_texture_float&&(Q.float32=Q["float"]=5126);h.oes_texture_half_float&&
(Q.float16=Q["half float"]=36193);h.webgl_depth_texture&&(v(Y,{depth:6402,"depth stencil":34041}),v(Q,{uint16:5123,uint32:5125,"depth stencil":34042}));h.webgl_compressed_texture_s3tc&&v(ea,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});h.webgl_compressed_texture_atc&&v(ea,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});h.webgl_compressed_texture_pvrtc&&v(ea,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});h.webgl_compressed_texture_etc1&&(ea["rgb etc1"]=36196);var za=Array.prototype.slice.call(a.getParameter(34467));Object.keys(ea).forEach(function(a){var b=ea[a];0<=za.indexOf(b)&&(Y[a]=b)});var ha=Object.keys(Y);m.textureFormats=ha;var ua=[];Object.keys(Y).forEach(function(a){ua[Y[a]]=a});var Ea=[];Object.keys(Q).forEach(function(a){Ea[Q[a]]=a});var Ga=[];Object.keys(X).forEach(function(a){Ga[X[a]]=a});var Ja=[];Object.keys(ga).forEach(function(a){Ja[ga[a]]=a});var Fa=
[];Object.keys(V).forEach(function(a){Fa[V[a]]=a});var Ka=ha.reduce(function(a,b){var d=Y[b];6409===d||6406===d||6409===d||6410===d||6402===d||34041===d?a[d]=d:32855===d||0<=b.indexOf("rgba")?a[d]=6408:a[d]=6407;return a},{}),La=[],Ma=[],Pa=0,va={},sa=m.maxTextureUnits,da=Array(sa).map(function(){return null});v(la.prototype,{bind:function(){this.bindCount+=1;var c=this.unit;if(0>c){for(var e=0;e<sa;++e){var f=da[e];if(f){if(0<f.bindCount)continue;f.unit=-1}da[e]=this;c=e;break}c>=sa&&b.raise("insufficient number of texture units");
N.profile&&x.maxTextureUnits<c+1&&(x.maxTextureUnits=c+1);this.unit=c;a.activeTexture(33984+c);a.bindTexture(this.target,this.texture)}return c},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&ra(this)}});N.profile&&(x.getTotalTextureSize=function(){var a=0;Object.keys(va).forEach(function(b){a+=va[b].stats.size});return a});return{create2D:function(c,e){function h(a,d){var c=k.texInfo;xa.call(c);var e=Ca();"number"===typeof a?"number"===typeof d?Z(e,a|0,d|0):Z(e,a|0,a|0):
a?(b.type(a,"object","invalid arguments to regl.texture"),aa(c,a),R(e,a)):Z(e,1,1);c.genMipmaps&&(e.mipmask=(e.width<<1)-1);k.mipmask=e.mipmask;H(k,e);b.texture2D(c,e,m);k.internalformat=e.internalformat;h.width=e.width;h.height=e.height;ma(k);O(e,3553);ia(c,3553);na();ta(e);N.profile&&(k.stats.size=f(k.internalformat,k.type,e.width,e.height,c.genMipmaps,!1));h.format=ua[k.internalformat];h.type=Ea[k.type];h.mag=Ga[c.magFilter];h.min=Ja[c.minFilter];h.wrapS=Fa[c.wrapS];h.wrapT=Fa[c.wrapT];return h}
var k=new la(3553);va[k.id]=k;x.textureCount++;h(c,e);h.subimage=function(a,d,c,e){b(!!a,"must specify image data");d|=0;c|=0;e|=0;var f=ka();H(f,k);f.width=0;f.height=0;I(f,a);f.width=f.width||(k.width>>e)-d;f.height=f.height||(k.height>>e)-c;b(k.type===f.type&&k.format===f.format&&k.internalformat===f.internalformat,"incompatible format for texture.subimage");b(0<=d&&0<=c&&d+f.width<=k.width&&c+f.height<=k.height,"texture.subimage write out of bounds");b(k.mipmask&1<<e,"missing mipmap data");b(f.data||
f.element||f.needsCopy,"missing image data");ma(k);T(f,3553,d,c,e);na();pa(f);return h};h.resize=function(b,c){var e=b|0,g=c|0||e;if(e===k.width&&g===k.height)return h;h.width=k.width=e;h.height=k.height=g;ma(k);for(var l=0;k.mipmask>>l;++l)a.texImage2D(3553,l,k.format,e>>l,g>>l,0,k.format,k.type,null);na();N.profile&&(k.stats.size=f(k.internalformat,k.type,e,g,!1,!1));return h};h._reglType="texture2d";h._texture=k;N.profile&&(h.stats=k.stats);h.destroy=function(){k.decRef()};return h},createCube:function(c,
e,h,k,l,p){function q(a,d,c,e,g,h){var k,l=n.texInfo;xa.call(l);for(k=0;6>k;++k)v[k]=Ca();if("number"!==typeof a&&a)if("object"===typeof a)if(d)R(v[0],a),R(v[1],d),R(v[2],c),R(v[3],e),R(v[4],g),R(v[5],h);else if(aa(l,a),ca(n,a),"faces"in a)for(a=a.faces,b(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),k=0;6>k;++k)b("object"===typeof a[k]&&!!a[k],"invalid input for cube map face"),H(v[k],n),R(v[k],a[k]);else for(k=0;6>k;++k)R(v[k],a);else b.raise("invalid arguments to cube map");
else for(a=a|0||1,k=0;6>k;++k)Z(v[k],a,a);H(n,v[0]);n.mipmask=l.genMipmaps?(v[0].width<<1)-1:v[0].mipmask;b.textureCube(n,l,v,m);n.internalformat=v[0].internalformat;q.width=v[0].width;q.height=v[0].height;ma(n);for(k=0;6>k;++k)O(v[k],34069+k);ia(l,34067);na();N.profile&&(n.stats.size=f(n.internalformat,n.type,q.width,q.height,l.genMipmaps,!0));q.format=ua[n.internalformat];q.type=Ea[n.type];q.mag=Ga[l.magFilter];q.min=Ja[l.minFilter];q.wrapS=Fa[l.wrapS];q.wrapT=Fa[l.wrapT];for(k=0;6>k;++k)ta(v[k]);
return q}var n=new la(34067);va[n.id]=n;x.cubeCount++;var v=Array(6);q(c,e,h,k,l,p);q.subimage=function(a,d,c,e,f){b(!!d,"must specify image data");b("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");c|=0;e|=0;f|=0;var g=ka();H(g,n);g.width=0;g.height=0;I(g,d);g.width=g.width||(n.width>>f)-c;g.height=g.height||(n.height>>f)-e;b(n.type===g.type&&n.format===g.format&&n.internalformat===g.internalformat,"incompatible format for texture.subimage");b(0<=c&&0<=e&&c+g.width<=n.width&&e+g.height<=
n.height,"texture.subimage write out of bounds");b(n.mipmask&1<<f,"missing mipmap data");b(g.data||g.element||g.needsCopy,"missing image data");ma(n);T(g,34069+a,c,e,f);na();pa(g);return q};q.resize=function(b){b|=0;if(b!==n.width){q.width=n.width=b;q.height=n.height=b;ma(n);for(var c=0;6>c;++c)for(var e=0;n.mipmask>>e;++e)a.texImage2D(34069+c,e,n.format,b>>e,b>>e,0,n.format,n.type,null);na();N.profile&&(n.stats.size=f(n.internalformat,n.type,q.width,q.height,!1,!0));return q}};q._reglType="textureCube";
q._texture=n;N.profile&&(q.stats=n.stats);q.destroy=function(){n.decRef()};return q},clear:function(){for(var b=0;b<sa;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),da[b]=null;A(va).forEach(ra);x.cubeCount=0;x.textureCount=0},getTexture:function(a){return null},restore:function(){A(va).forEach(function(b){b.texture=a.createTexture();a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!==(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,
0,b.internalformat,b.type,null);else for(var e=0;6>e;++e)a.texImage2D(34069+e,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);ia(b.texInfo,b.target)})}}}},{"./constants/arraytypes.json":4,"./util/check":21,"./util/extend":24,"./util/flatten":25,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/to-half-float":32,"./util/values":33}],20:[function(m,r,x){r.exports=function(c,n){function l(){this.endQueryIndex=this.startQueryIndex=
-1;this.sum=0;this.stats=null}function p(b,c,e){var f=m.pop()||new l;f.startQueryIndex=b;f.endQueryIndex=c;f.sum=0;f.stats=e;A.push(f)}var e=n.ext_disjoint_timer_query;if(!e)return null;var f=[],b=[],m=[],A=[],r=[],q=[];return{beginQuery:function(c){var l=f.pop()||e.createQueryEXT();e.beginQueryEXT(35007,l);b.push(l);p(b.length-1,b.length,c)},endQuery:function(){e.endQueryEXT(35007)},pushScopeStats:p,update:function(){var c,l;c=b.length;if(0!==c){q.length=Math.max(q.length,c+1);r.length=Math.max(r.length,
c+1);r[0]=0;var n=q[0]=0;for(l=c=0;l<b.length;++l){var p=b[l];e.getQueryObjectEXT(p,34919)?(n+=e.getQueryObjectEXT(p,34918),f.push(p)):b[c++]=p;r[l+1]=n;q[l+1]=c}b.length=c;for(l=c=0;l<A.length;++l){var n=A[l],x=n.startQueryIndex,p=n.endQueryIndex;n.sum+=r[p]-r[x];x=q[x];p=q[p];p===x?(n.stats.gpuTime+=n.sum/1E6,m.push(n)):(n.startQueryIndex=x,n.endQueryIndex=p,A[c++]=n)}A.length=c}},getNumPendingQueries:function(){return b.length},clear:function(){f.push.apply(f,b);for(var c=0;c<f.length;c++)e.deleteQueryEXT(f[c]);
b.length=0;f.length=0},restore:function(){b.length=0;f.length=0}}}},{}],21:[function(m,r,x){function c(a){return"undefined"!==typeof btoa?btoa(a):"base64:"+a}function n(a){a=Error("(regl) "+a);console.error(a);throw a;}function l(a,b){a||n(b)}function p(a){return a?": "+a:""}function e(a,b,c){0>b.indexOf(a)&&n("invalid value"+p(c)+". must be one of: "+b)}function f(a,b){for(a+="";a.length<b;)a=" "+a;return a}function b(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function v(a,
b){this.number=a;this.line=b;this.errors=[]}function A(a,b,c){this.file=a;this.line=b;this.message=c}function K(){var a=Error(),a=(a.stack||a).toString(),b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function q(){var a=Error(),a=(a.stack||a).toString(),b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function k(a,d){var e=a.split("\n"),f=1,h=
0,k={unknown:new b,0:new b};k.unknown.name=k[0].name=d||K();k.unknown.lines.push(new v(0,""));for(var l=0;l<e.length;++l){var n=e[l],p=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(n);if(p)switch(p[1]){case "line":if(p=/(\d+)(\s+\d+)?/.exec(p[2]))f=p[1]|0,p[2]&&(h=p[2]|0,h in k||(k[h]=new b));break;case "define":if(p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(p[2]))k[h].name=p[1]?c(p[2]):p[2]}k[h].lines.push(new v(f++,n))}Object.keys(k).forEach(function(a){var b=k[a];b.lines.forEach(function(a){b.index[a.number]=a})});
return k}function E(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var c=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(a);c?b.push(new A(c[1]|0,c[2]|0,c[3].trim())):0<a.length&&b.push(new A("unknown",0,a))}});return b}function C(a,b){b.forEach(function(b){var d=a[b.file];if(d){var c=d.index[b.line];if(c){c.errors.push(b);d.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(b)})}function M(a){a._commandRef=K()}function J(a,b){var c=q();n(a+" in command "+(b||K())+
("unknown"===c?"":" called from "+c))}function z(a,b,c,e){typeof a!==b&&J("invalid parameter type"+p(c)+". expected "+b+", got "+typeof a,e||K())}function t(a,b){return 32820===a||32819===a||33635===a?2:34042===a?4:h[a]*b}var L=m("./is-typed-array");m=m("./extend");var T="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),h={};h[5120]=h[5121]=1;h[5122]=h[5123]=h[36193]=h[33635]=h[32819]=h[32820]=2;h[5124]=h[5125]=h[5126]=h[34042]=4;r.exports=m(l,{optional:function(a){a()},
raise:n,commandRaise:J,command:function(a,b,c){a||J(b,c||K())},parameter:function(a,b,c){a in b||n("unknown parameter ("+a+")"+p(c)+". possible values: "+Object.keys(b).join())},commandParameter:function(a,b,c,e){a in b||J("unknown parameter ("+a+")"+p(c)+". possible values: "+Object.keys(b).join(),e||K())},constructor:function(a){Object.keys(a).forEach(function(a){0>T.indexOf(a)&&n('invalid regl constructor argument "'+a+'". must be one of '+T)})},type:function(a,b,c){typeof a!==b&&n("invalid parameter type"+
p(c)+". expected "+b+", got "+typeof a)},commandType:z,isTypedArray:function(a,b){L(a)||n("invalid parameter type"+p(b)+". must be a typed array")},nni:function(a,b){0<=a&&(a|0)===a||n("invalid parameter type, ("+a+")"+p(b)+". must be a nonnegative integer")},oneOf:e,shaderError:function(a,b,c,e,h){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);a=e===a.FRAGMENT_SHADER?"fragment":"vertex";z(c,"string",a+" shader source must be a string",h);var n=k(c,h);c=E(b);C(n,c);Object.keys(n).forEach(function(a){function b(a,
d){c.push(a);e.push(d||"")}var d=n[a];if(d.hasErrors){var c=[""],e=[""];b("file number "+a+": "+d.name+"\n","color:red;text-decoration:underline;font-weight:bold");d.lines.forEach(function(a){if(0<a.errors.length){b(f(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var d=0;a.errors.forEach(function(c){c=c.message;var e=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(c);if(e){var h=e[1];c=e[2];switch(h){case "assign":h="="}d=Math.max(a.line.indexOf(h,
d),0)}else d=0;b(f("| ",6));b(f("^^^",d+3)+"\n","font-weight:bold");b(f("| ",6));b(c+"\n","font-weight:bold")});b(f("| ",6)+"\n")}else b(f(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"!==typeof document?(e[0]=c.join("%c"),console.log.apply(console,e)):console.log(c.join(""))}});l.raise("Error compiling "+a+" shader, "+n[0].name)}},linkError:function(a,b,c,e,f){a.getProgramParameter(b,a.LINK_STATUS)||(a=a.getProgramInfoLog(b),c=k(c,f),e='Error linking program with vertex shader, "'+k(e,
f)[0].name+'", and fragment shader "'+c[0].name+'"',"undefined"!==typeof document?console.log("%c"+e+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(e+"\n"+a),l.raise(e))},callSite:q,saveCommandRef:M,saveDrawInfo:function(a,b,c,e){function f(a){return a?e.id(a):0}function h(a,b){Object.keys(b).forEach(function(b){a[e.id(b)]=!0})}M(a);a._fragId=f(a["static"].frag);a._vertId=f(a["static"].vert);var k=a._uniformSet={};h(k,b["static"]);h(k,b.dynamic);b=a._attributeSet=
{};h(b,c["static"]);h(b,c.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,b,c){a.texture?e(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):e(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")},guessCommand:K,texture2D:function(a,b,c){var e=b.width,f=b.height,h=b.channels;l(0<e&&e<=c.maxTextureSize&&0<f&&f<=c.maxTextureSize,"invalid texture shape");
33071===a.wrapS&&33071===a.wrapT||l(!(e&e-1)&&!!e&&!(f&f-1)&&!!f,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==e&&1!==f&&l(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(l(!(e&e-1)&&!!e&&!(f&f-1)&&!!f,"texture must be a square power of 2 to support mipmapping"),l(b.mipmask===(e<<1)-1,"missing or incomplete mipmap data"));5126===b.type&&(0>c.extensions.indexOf("oes_texture_float_linear")&&
l(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),l(!a.genMipmaps,"mipmap generation not supported with float textures"));var k=b.images;for(c=0;16>c;++c)if(k[c]){var n=e>>c,p=f>>c;l(b.mipmask&1<<c,"missing mipmap data");var q=k[c];l(q.width===n&&q.height===p,"invalid shape for mip images");l(q.format===b.format&&q.internalformat===b.internalformat&&q.type===b.type,"incompatible type for mip image");q.compressed||q.data&&l(q.data.byteLength===n*
p*Math.max(t(q.type,h),q.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}else a.genMipmaps||l(0===(b.mipmask&1<<c),"extra mipmap data");b.compressed&&l(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,c,e){var f=a.width,h=a.height,k=a.channels;l(0<f&&f<=e.maxTextureSize&&0<h&&h<=e.maxTextureSize,"invalid texture shape");l(f===h,"cube map must be square");l(33071===b.wrapS&&33071===b.wrapT,"wrap mode not supported by cube map");
for(e=0;e<c.length;++e){var n=c[e];l(n.width===f&&n.height===h,"inconsistent cube map face shape");b.genMipmaps&&(l(!n.compressed,"can not generate mipmap for compressed textures"),l(1===n.mipmask,"can not specify mipmaps and generate mipmaps"));for(var p=n.images,q=0;16>q;++q){var m=p[q];if(m){var v=f>>q,A=h>>q;l(n.mipmask&1<<q,"missing mipmap data");l(m.width===v&&m.height===A,"invalid shape for mip images");l(m.format===a.format&&m.internalformat===a.internalformat&&m.type===a.type,"incompatible type for mip image");
m.compressed||m.data&&l(m.data.byteLength===v*A*Math.max(t(m.type,k),m.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}})},{"./extend":24,"./is-typed-array":28}],22:[function(m,r,x){r.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],23:[function(m,r,x){function c(c){return Array.prototype.slice.call(c)}function n(l){return c(l).join("")}var l=m("./extend");r.exports=function(){function p(){var b=
[],e=[];return l(function(){b.push.apply(b,c(arguments))},{def:function(){var l="v"+f++;e.push(l);0<arguments.length&&(b.push(l,"="),b.push.apply(b,c(arguments)),b.push(";"));return l},toString:function(){return n([0<e.length?"var "+e+";":"",n(b)])}})}function e(){function b(c,l){f(c,l,"=",e.def(c,l),";")}var e=p(),f=p(),n=e.toString,m=f.toString;return l(function(){e.apply(e,c(arguments))},{def:e.def,entry:e,exit:f,save:b,set:function(c,f,l){b(c,f);e(c,f,"=",l,";")},toString:function(){return n()+
m()}})}var f=0,b=[],m=[],A=p(),r={};return{global:A,link:function(c){for(var e=0;e<m.length;++e)if(m[e]===c)return b[e];e="g"+f++;b.push(e);m.push(c);return e},block:p,proc:function(b,c){function f(){var b="a"+p.length;p.push(b);return b}var p=[];c=c||0;for(var m=0;m<c;++m)f();var m=e(),v=m.toString;return r[b]=l(m,{arg:f,toString:function(){return n(["function(",p.join(),"){",v(),"}"])}})},scope:e,cond:function(){var b=n(arguments),f=e(),p=e(),m=f.toString,v=p.toString;return l(f,{then:function(){f.apply(f,
c(arguments));return this},"else":function(){p.apply(p,c(arguments));return this},toString:function(){var c=v();c&&(c="else{"+c+"}");return n(["if(",b,"){",m(),"}",c])}})},compile:function(){var c=['"use strict";',A,"return {"];Object.keys(r).forEach(function(b){c.push('"',b,'":',r[b].toString(),",")});c.push("}");var e=n(c).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,b.concat(e)).apply(null,m)}}}},{"./extend":24}],24:[function(m,r,x){r.exports=function(c,
n){for(var l=Object.keys(n),p=0;p<l.length;++p)c[l[p]]=n[l[p]];return c}},{}],25:[function(m,r,x){function c(c,e,f,b,l,n){for(var m=0;m<e;++m)for(var q=c[m],k=0;k<f;++k)for(var r=q[k],x=0;x<b;++x)l[n++]=r[x]}function n(l,e,f,b,m){for(var r=1,x=f+1;x<e.length;++x)r*=e[x];var q=e[f];if(4===e.length-f){var k=e[f+1],E=e[f+2];e=e[f+3];for(x=0;x<q;++x)c(l[x],k,E,e,b,m),m+=r}else for(x=0;x<q;++x)n(l[x],e,f+1,b,m),m+=r}var l=m("./pool");r.exports={shape:function(c){for(var e=[];c.length;c=c[0])e.push(c.length);
return e},flatten:function(p,e,f,b){var m=1;if(e.length)for(var r=0;r<e.length;++r)m*=e[r];else m=0;f=b||l.allocType(f,m);switch(e.length){case 0:break;case 1:b=e[0];for(e=0;e<b;++e)f[e]=p[e];break;case 2:b=e[0];e=e[1];for(r=m=0;r<b;++r)for(var x=p[r],q=0;q<e;++q)f[m++]=x[q];break;case 3:c(p,e[0],e[1],e[2],f,0);break;default:n(p,e,0,f,0)}return f}}},{"./pool":30}],26:[function(m,r,x){var c=m("./is-typed-array");r.exports=function(n){return Array.isArray(n)||c(n)}},{"./is-typed-array":28}],27:[function(m,
r,x){var c=m("./is-typed-array");r.exports=function(n){return!!n&&"object"===typeof n&&Array.isArray(n.shape)&&Array.isArray(n.stride)&&"number"===typeof n.offset&&n.shape.length===n.stride.length&&(Array.isArray(n.data)||c(n.data))}},{"./is-typed-array":28}],28:[function(m,r,x){var c=m("../constants/arraytypes.json");r.exports=function(n){return Object.prototype.toString.call(n)in c}},{"../constants/arraytypes.json":4}],29:[function(m,r,x){r.exports=function(c,n){for(var l=Array(c),p=0;p<c;++p)l[p]=
n(p);return l}},{}],30:[function(m,r,x){function c(c){var f,b;f=(65535<c)<<4;c>>>=f;b=(255<c)<<3;c>>>=b;f|=b;b=(15<c)<<2;c>>>=b;f|=b;b=(3<c)<<1;return f|b|c>>>b>>1}function n(e){a:{for(var f=16;268435456>=f;f*=16)if(e<=f){e=f;break a}e=0}f=p[c(e)>>2];return 0<f.length?f.pop():new ArrayBuffer(e)}function l(e){p[c(e.byteLength)>>2].push(e)}var p=m("./loop")(8,function(){return[]});r.exports={alloc:n,free:l,allocType:function(c,f){var b=null;switch(c){case 5120:b=new Int8Array(n(f),0,f);break;case 5121:b=
new Uint8Array(n(f),0,f);break;case 5122:b=new Int16Array(n(2*f),0,f);break;case 5123:b=new Uint16Array(n(2*f),0,f);break;case 5124:b=new Int32Array(n(4*f),0,f);break;case 5125:b=new Uint32Array(n(4*f),0,f);break;case 5126:b=new Float32Array(n(4*f),0,f);break;default:return null}return b.length!==f?b.subarray(0,f):b},freeType:function(c){l(c.buffer)}}},{"./loop":29}],31:[function(m,r,x){r.exports={next:"function"===typeof requestAnimationFrame?function(c){return requestAnimationFrame(c)}:function(c){return setTimeout(c,
16)},cancel:"function"===typeof cancelAnimationFrame?function(c){return cancelAnimationFrame(c)}:clearTimeout}},{}],32:[function(m,r,x){var c=m("./pool"),n=new Float32Array(1),l=new Uint32Array(n.buffer);r.exports=function(p){for(var e=c.allocType(5123,p.length),f=0;f<p.length;++f)if(isNaN(p[f]))e[f]=65535;else if(Infinity===p[f])e[f]=31744;else if(-Infinity===p[f])e[f]=64512;else{n[0]=p[f];var b=l[0],m=b>>>31<<15,r=(b<<1>>>24)-127,b=b>>13&1023;e[f]=-24>r?m:-14>r?m+(b+1024>>-14-r):15<r?m+31744:m+
(r+15<<10)+b}return e}},{"./pool":30}],33:[function(m,r,x){r.exports=function(c){return Object.keys(c).map(function(n){return c[n]})}},{}],34:[function(m,r,x){function c(b,c,e){function l(){var c=window.innerWidth,m=window.innerHeight;b!==document.body&&(m=b.getBoundingClientRect(),c=m.right-m.left,m=m.bottom-m.top);n.width=e*c;n.height=e*m;f(n.style,{width:c+"px",height:m+"px"})}var n=document.createElement("canvas");f(n.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(n);b===document.body&&
(n.style.position="absolute",f(b.style,{margin:0,padding:0}));window.addEventListener("resize",l,!1);l();return{canvas:n,onDestroy:function(){window.removeEventListener("resize",l);b.removeChild(n)}}}function n(b,c){function e(f){try{return b.getContext(f,c)}catch(l){return null}}return e("webgl")||e("experimental-webgl")||e("webgl-experimental")}function l(b){if("string"===typeof b)return b.split();e(Array.isArray(b),"invalid extension array");return b}function p(b){return"string"===typeof b?(e("undefined"!==
typeof document,"not supported outside of DOM"),document.querySelector(b)):b}var e=m("./util/check"),f=m("./util/extend");r.exports=function(b){var f=b||{},m,r,q,k;b={};var x=[],C=[],M="undefined"===typeof window?1:window.devicePixelRatio,J=!1,z=function(b){b&&e.raise(b)},t=function(){};"string"===typeof f?(e("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),m=document.querySelector(f),e(m,"invalid query string for element")):"object"===typeof f?"string"===typeof f.nodeName&&
"function"===typeof f.appendChild&&"function"===typeof f.getBoundingClientRect?m=f:"function"===typeof f.drawArrays||"function"===typeof f.drawElements?(k=f,q=k.canvas):(e.constructor(f),"gl"in f?k=f.gl:"canvas"in f?q=p(f.canvas):"container"in f&&(r=p(f.container)),"attributes"in f&&(b=f.attributes,e.type(b,"object","invalid context attributes")),"extensions"in f&&(x=l(f.extensions)),"optionalExtensions"in f&&(C=l(f.optionalExtensions)),"onDone"in f&&(e.type(f.onDone,"function","invalid or missing onDone callback"),
z=f.onDone),"profile"in f&&(J=!!f.profile),"pixelRatio"in f&&(M=+f.pixelRatio,e(0<M,"invalid pixel ratio"))):e.raise("invalid arguments to regl");m&&("canvas"===m.nodeName.toLowerCase()?q=m:r=m);if(!k){if(!q){e("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");m=c(r||document.body,z,M);if(!m)return null;q=m.canvas;t=m.onDestroy}k=n(q,b)}return k?{gl:k,canvas:q,container:r,extensions:x,optionalExtensions:C,pixelRatio:M,profile:J,onDone:z,onDestroy:t}:
(t(),z("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/check":21,"./util/extend":24}],35:[function(m,r,x){function c(c){return c.charCodeAt(0)+(c.charCodeAt(1)<<8)+(c.charCodeAt(2)<<16)+(c.charCodeAt(3)<<24)}var n=c("DXT1"),l=c("DXT3"),p=c("DXT5"),e=c("DX10");r.exports=function(c){var b=new Int32Array(c,0,31);if(542327876!==b[0])throw Error("Invalid magic number in DDS header");if(!b[20]&4)throw Error("Unsupported format, must contain a FourCC code");
var m,r=b[21];switch(r){case n:m=8;c="dxt1";break;case l:m=16;c="dxt3";break;case p:m=16;c="dxt5";break;case 116:c="rgba32f";break;case e:var x=new Uint32Array(c.slice(128,148));c=x[0];if(3===x[1]&&2===c)c="rgba32f";else throw Error("Unsupported DX10 texture format "+c);break;default:throw Error("Unsupported FourCC code: "+String.fromCharCode(r&255,r>>8&255,r>>16&255,r>>24&255));}var x=b[2],q=1;x&131072&&(q=Math.max(1,b[7]));var k=!1;b[28]&512&&(k=!0);var E=b[4],C=b[3],b=b[1]+4,M=E,J=C,z=[];r===e&&
(b+=20);if(k)for(m=0;6>m;m++){if("rgba32f"!==c)throw Error("Only RGBA32f cubemaps are supported");for(var E=M,C=J,t=Math.log(E)/Math.log(2)+1,L=0;L<t;L++)r=E*C*16,z.push({offset:b,length:r,shape:[E,C]}),L<q&&(b+=r),E=Math.floor(E/2),C=Math.floor(C/2)}else for(L=0;L<q;L++)r=Math.max(4,E)/4*Math.max(4,C)/4*m,z.push({offset:b,length:r,shape:[E,C]}),b+=r,E=Math.floor(E/2),C=Math.floor(C/2);return{shape:[M,J],images:z,format:c,flags:x,cubemap:k}}},{}],36:[function(m,r,x){function c(b){throw Error("resl: "+
b);}function n(b,e,f){Object.keys(b).forEach(function(b){0>e.indexOf(b)&&c('invalid parameter "'+b+'" in '+f)})}function l(b,c){this.state=0;this.ready=!1;this.progress=0;this.name=b;this.cancel=c}var p=["manifest","onDone","onProgress","onError"],e=["type","src","stream","credentials","parser"],f=["onData","onDone"];r.exports=function(b){function m(e,a){if(e in b){var d=b[e];"function"!==typeof d&&c('invalid callback "'+e+'"');return d}return null}function r(b){function a(){if(!(2>m.readyState||
1===t.state||-1===t.state)){if(200!==m.status)return q('error loading resource "'+b.name+'"');if(2<m.readyState&&0===t.state){var a;a="binary"===b.type?m.response:m.responseText;if(n.data)try{p=n.data(a)}catch(e){return q(e)}else p=a}if(3<m.readyState&&0===t.state){if(n.done)try{p=n.done()}catch(e){return q(e)}t.state=1}z[c]=p;t.progress=.75*t.progress+.25;t.ready=b.stream&&!!p||1===t.state;k()}}var c=b.name,e=b.stream,f="binary"===b.type,n=b.parser,m=new XMLHttpRequest,p=null,t=new l(c,function(){1!==
t.state&&-1!==t.state&&(m.onreadystatechange=null,m.abort(),t.state=-1)});m.onreadystatechange=e?a:function(){4===m.readyState&&a()};f&&(m.responseType="arraybuffer");b.credentials&&(m.withCredentials=!0);m.open("GET",b.src,!0);m.send();return t}function x(b,a){function c(){if(0===t.state)if(r.data)try{v=r.data(a)}catch(b){return q(b)}else v=a}function e(a){c();z[p]=v;t.progress=a.lengthComputable?Math.max(t.progress,a.loaded/a.total):.75*t.progress+.25;k(p)}function f(){c();if(0===t.state){if(r.done)try{v=
r.done()}catch(a){return q(a)}t.state=1}t.progress=1;t.ready=!0;z[p]=v;n();k("finish "+p)}function m(){q('error loading asset "'+p+'"')}function n(){b.stream&&a.removeEventListener("progress",e);"image"===b.type?a.addEventListener("load",f):a.addEventListener("canplay",f);a.removeEventListener("error",m)}var p=b.name,r=b.parser,t=new l(p,function(){1!==t.state&&-1!==t.state&&(t.state=-1,n(),a.src="")}),v=a;b.stream&&a.addEventListener("progress",e);if("image"===b.type)a.addEventListener("load",f);
else{var A=!1,C=!1;a.addEventListener("loadedmetadata",function(){C=!0;A&&f()});a.addEventListener("canplay",function(){A=!0;C&&f()})}a.addEventListener("error",m);a.crossOrigin=b.credentials?"use-credentials":"anonymous";a.src=b.src;return t}function q(b){-1!==t&&1!==t&&(t=-1,T.forEach(function(a){a.cancel()}),J?"string"===typeof b?J(Error("resl: "+b)):J(b):console.error("resl error:",b))}function k(b){if(-1!==t&&1!==t){var a=0,c=0;T.forEach(function(b){b.ready&&(c+=1);a+=b.progress});c===T.length?
(t=1,C(z)):M&&M(a/T.length,b)}}"object"===typeof b&&b||c("invalid or missing configuration");n(b,p,"config");var E=b.manifest;"object"===typeof E&&E||c("missing manifest");var C=m("onDone");C||c("missing onDone() callback");var M=m("onProgress"),J=m("onError"),z={},t=0,L={text:r,binary:function(b){return r(b)},image:function(b){return x(b,document.createElement("img"))},video:function(b){return x(b,document.createElement("video"))},audio:function(b){return x(b,document.createElement("audio"))}},T=
Object.keys(E).map(function(b){function a(a,b){if(a in d.parser){var e=d.parser[a];"function"!==typeof e&&c("invalid parser callback "+a+' for asset "'+a+'"');return e}return b}var d=E[b];"string"===typeof d?d={src:d}:"object"===typeof d&&d||c('invalid asset definition "'+b+'"');n(d,e,'asset "'+b+'"');var k={};"parser"in d&&("function"===typeof d.parser?k={data:d.parser}:"object"===typeof d.parser&&d.parser?(n(k,f,'parser for asset "'+b+'"'),"onData"in k||c('missing onData callback for parser in asset "'+
b+'"'),k={data:a("onData"),done:a("onDone")}):c('invalid parser for asset "'+b+'"'));return{name:b,type:function(a,e,f){a in d&&(f=d[a]);0>e.indexOf(f)&&c("invalid "+a+' "'+f+'" for asset "'+b+'", possible values: '+e);return f}("type",Object.keys(L),"text"),stream:!!d.stream,credentials:!!d.credentials,src:function(a,e,f){a in d?f=d[a]:e&&c("missing "+a+' for asset "'+b+'"');"string"!==typeof f&&c("invalid "+a+' for asset "'+b+'", must be a string');return f}("src",!0,""),parser:k}}).map(function(b){return L[b.type](b)});
0===T.length&&setTimeout(function(){k("done")},1)}},{}],37:[function(m,r,x){function c(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var n=m("./lib/util/check"),l=m("./lib/util/extend"),p=m("./lib/dynamic"),e=m("./lib/util/raf"),f=m("./lib/util/clock"),b=m("./lib/strings"),v=m("./lib/webgl"),A=m("./lib/extension"),K=m("./lib/limits"),q=m("./lib/buffer"),k=m("./lib/elements"),E=m("./lib/texture"),C=m("./lib/renderbuffer"),M=m("./lib/framebuffer"),J=m("./lib/attribute"),z=m("./lib/shader"),
t=m("./lib/read"),L=m("./lib/core"),T=m("./lib/stats"),h=m("./lib/timer");r.exports=function(a){function d(){if(0===Q.length)O&&O.update(),ha=null;else{ha=e.next(d);ca();for(var a=Q.length-1;0<=a;--a){var b=Q[a];b&&b(aa,null,0)}I.flush();O&&O.update()}}function m(){!ha&&0<Q.length&&(ha=e.next(d))}function r(){ha&&(e.cancel(d),ha=null)}function x(a){a.preventDefault();ka=!0;r();Y.forEach(function(a){a()})}function fa(a){I.getError();ka=!1;pa.restore();na.restore();la.restore();ra.restore();ya.restore();
V.restore();O&&O.restore();X.procs.refresh();m();ea.forEach(function(a){a()})}function ja(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];p.isDynamic(e)?d[b]=p.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;r.length<a;)r.push(null);return r}n(!!a,"invalid args to regl({...})");n.type(a,"object","invalid args to regl({...})");var d=b(a.context||{}),e=b(a.uniforms||{}),f=b(a.attributes||{}),h=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];
Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=l({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var d=X.compile(h,f,e,d,a),k=d.draw,m=d.batch,q=d.scope,r=[];return l(function(a,b){var d;ka&&n.raise("context lost");if("function"===typeof a)return q.call(this,
null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)q.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)q.call(this,a[d],b,d);else return q.call(this,a,b,0);else if("number"===typeof a){if(0<a)return m.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return m.call(this,a,a.length)}else return k.call(this,a)},{stats:a})}function N(a,b){var c=0;X.procs.poll();var d=b.color;d&&(I.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in b&&
(I.clearDepth(+b.depth),c|=256);"stencil"in b&&(I.clearStencil(b.stencil|0),c|=1024);n(!!c,"called regl.clear with no buffer specified");I.clear(c)}function U(a){n.type(a,"function","regl.frame() callback must be a function");Q.push(a);m();return{cancel:function(){function b(){var a=c(Q,b);Q[a]=Q[Q.length-1];--Q.length;0>=Q.length&&r()}var d=c(Q,a);n(0<=d,"cannot cancel a frame twice");Q[d]=b}}}function H(){var a=ga.viewport,b=ga.scissor_box;a[0]=a[1]=b[0]=b[1]=0;aa.viewportWidth=aa.framebufferWidth=
aa.drawingBufferWidth=a[2]=b[2]=I.drawingBufferWidth;aa.viewportHeight=aa.framebufferHeight=aa.drawingBufferHeight=a[3]=b[3]=I.drawingBufferHeight}function ca(){aa.tick+=1;aa.time=B();H();X.procs.poll()}function W(){H();X.procs.refresh();O&&O.update()}function B(){return(f()-Ca)/1E3}a=v(a);if(!a)return null;var I=a.gl,Da=I.getContextAttributes(),ka=I.isContextLost(),pa=A(I,a);if(!pa)return null;var wa=b(),Z=T(),R=pa.extensions,O=h(I,R),Ca=f(),ta=I.drawingBufferWidth,xa=I.drawingBufferHeight,aa={tick:0,
time:0,viewportWidth:ta,viewportHeight:xa,framebufferWidth:ta,framebufferHeight:xa,drawingBufferWidth:ta,drawingBufferHeight:xa,pixelRatio:a.pixelRatio},ia=K(I,R),la=q(I,Z,a),ma=k(I,R,la,Z),ta=J(I,R,ia,la,wa),na=z(I,wa,Z,a),ra=E(I,R,ia,function(){X.procs.poll()},aa,Z,a),ya=C(I,R,ia,Z,a),V=M(I,R,ia,ra,ya,Z),X=L(I,wa,R,ia,la,ma,ra,V,{},ta,na,{elements:null,primitive:4,count:-1,offset:0,instances:-1},aa,O,a),wa=t(I,V,X.procs.poll,aa,Da,R),ga=X.next,oa=I.canvas,Q=[],Y=[],ea=[],za=[a.onDestroy],ha=null;
oa&&(oa.addEventListener("webglcontextlost",x,!1),oa.addEventListener("webglcontextrestored",fa,!1));var ua=V.setFBO=ja({framebuffer:p.define.call(null,1,"framebuffer")});W();Da=l(ja,{clear:function(a){n("object"===typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)ua(l({framebuffer:a.framebuffer.faces[b]},a),N);else ua(a,N);else N(null,a)},prop:p.define.bind(null,1),context:p.define.bind(null,
2),"this":p.define.bind(null,3),draw:ja({}),buffer:function(a){return la.create(a,34962,!1,!1)},elements:function(a){return ma.create(a,!1)},texture:ra.create2D,cube:ra.createCube,renderbuffer:ya.create,framebuffer:V.create,framebufferCube:V.createCube,attributes:Da,frame:U,on:function(a,b){n.type(b,"function","listener callback must be a function");var c;switch(a){case "frame":return U(b);case "lost":c=Y;break;case "restore":c=ea;break;case "destroy":c=za;break;default:n.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);
return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:ia,hasExtension:function(a){return 0<=ia.extensions.indexOf(a.toLowerCase())},read:wa,destroy:function(){Q.length=0;r();oa&&(oa.removeEventListener("webglcontextlost",x),oa.removeEventListener("webglcontextrestored",fa));na.clear();V.clear();ya.clear();ra.clear();ma.clear();la.clear();O&&O.clear();za.forEach(function(a){a()})},_gl:I,_refresh:W,poll:function(){ca();O&&O.update()},now:B,stats:Z});
a.onDone(null,Da);return Da}},{"./lib/attribute":2,"./lib/buffer":3,"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/check":21,"./lib/util/clock":22,"./lib/util/extend":24,"./lib/util/raf":31,"./lib/webgl":34}]},{},[1]);

        </script>
        </body>
      </html>