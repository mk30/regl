<!DOCTYPE html>
      <html>
        <head>
          <title>example/graph.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(q,z,e){function g(b,l){if(!z[b]){if(!q[b]){var a="function"==typeof require&&require;if(!l&&a)return a(b,!0);if(k)return k(b,!0);a=Error("Cannot find module '"+b+"'");throw a.code="MODULE_NOT_FOUND",a;}a=z[b]={exports:{}};q[b][0].call(a.exports,function(a){var k=q[b][1][a];return g(k?k:a)},a,a.exports,e$$0,q,z,e)}return z[b].exports}for(var k="function"==typeof require&&require,v=0;v<e.length;v++)g(e[v]);return g})({1:[function(f,q,z){function e(a){return[a%64,a/64|0]}function g(b){var e=
b.tick;B({framebuffer:A[0]},function(){k.clear({color:[0,0,0,1]});p();u({vertexState:a[(e+1)%2]})});for(b=0;4>b;++b)r({dest:A[(b+1)%2],src:A[b%2],axis:b%2});M({dest:A[1],src:A[0]});y({dest:a[(e+1)%2],src:a[e%2]});F({dest:a[e%2],src:a[(e+1)%2],field:A[1]})}var k=f("../regl")({extensions:["webgl_draw_buffers","oes_texture_float"]}),v=f("mouse-change")();f=.5/64;var b=new Float32Array(16384),l=new Float32Array(8192);(function(){for(var a=0;64>a;++a)for(var e=0;64>e;++e){var k=64*a+e;l[2*k]=a/64;l[2*
k+1]=e/64;b[4*k]=Math.random();b[4*k+1]=Math.random()}})();q=k.buffer(l);var a=[k.framebuffer({color:k.texture({radius:64,data:b,type:"float"}),depthStencil:!1}),k.framebuffer({radius:64,colorType:"float",depthStencil:!1})],n=[];(function(){for(var a=0;64>a;++a)for(var b=0;64>b;++b){if(63>a){var e=a+64*b,c=a+1+64*b;n.push([e,c],[c,e])}63>b&&(e=a+64*b,c=a+64*(b+1),n.push([e,c],[c,e]))}})();var A=[k.framebuffer({color:k.texture({type:"float",wrap:"repeat",radius:1024}),depthStencil:!1}),k.framebuffer({color:k.texture({type:"float",
wrap:"repeat",radius:1024}),depthStencil:!1})],B=k({framebuffer:k.prop("framebuffer")}),u=k({vert:"\n  precision highp float;\n  attribute vec2 id;\n  uniform sampler2D vertexState;\n  void main () {\n    vec4 state = texture2D(vertexState, id);\n    gl_Position = vec4(2.0 * fract(state.xy) - 1.0, 0, 1);\n  }",frag:"\n  precision highp float;\n  void main () {\n    gl_FragColor = vec4(1, 0, 0, 0);\n  }",attributes:{id:q},uniforms:{vertexState:k.prop("vertexState")},blend:{enable:!0,func:{src:1,dst:1},
equation:"add"},depth:{enable:!1,mask:!1},primitive:"points",count:4096,elements:null}),r=k({framebuffer:k.prop("dest"),vert:"\n  precision highp float;\n  attribute vec2 p;\n  varying vec2 uv;\n  void main () {\n    uv = 0.5 * (p + 1.0);\n    gl_Position = vec4(p, 0, 1);\n  }",frag:"\n  precision highp float;\n  uniform sampler2D src;\n  uniform vec2 axis;\n  varying vec2 uv;\n  void main () {\n    float f = 0.0;\n    for (int i = -16; i <= 16; ++i) {\n      f += (17.0 - abs(float(i))) / 33.0 *\n          texture2D(src, axis * float(i) + uv).r;\n    }\n    gl_FragColor = vec4(f, 0, 0, 1);\n  }",
attributes:{p:[-4,0,4,4,4,-4]},uniforms:{src:function(a,b){return b.src},axis:function(a,b){var e=[0,0];e[b.axis]=1/1024;return e}},depth:{enable:!1,mask:!1},count:3}),M=k({framebuffer:k.prop("dest"),vert:"\n  precision highp float;\n  attribute vec2 p;\n  varying vec2 uv;\n  void main () {\n    uv = 0.5 * (p + 1.0);\n    gl_Position = vec4(p, 0, 1);\n  }",frag:"\n  precision highp float;\n  uniform sampler2D src;\n  uniform vec2 deriv;\n  varying vec2 uv;\n  void main () {\n    float f01 = texture2D(src, uv - vec2(deriv.x, 0)).x;\n    float f21 = texture2D(src, uv + vec2(deriv.x, 0)).x;\n    float f10 = texture2D(src, uv - vec2(0, deriv.y)).x;\n    float f12 = texture2D(src, uv + vec2(0, deriv.y)).x;\n    gl_FragColor = vec4(f21 - f01, f12 - f10, 0, 1);\n  }",
attributes:{p:[-4,0,4,4,4,-4]},uniforms:{src:k.prop("src"),deriv:function(a,b){return[1/b.src.width,1/b.src.height]}},depth:{enable:!1,mask:!1},count:3}),y=k({framebuffer:k.prop("dest"),vert:"\n  precision highp float;\n  attribute vec4 edge;\n  varying vec2 force;\n  uniform sampler2D vertexState;\n  uniform float restLength, stiffness;\n  void main () {\n    vec4 s0 = texture2D(vertexState, edge.rg);\n    vec4 s1 = texture2D(vertexState, edge.ba);\n    vec2 d = s1.xy - s0.xy;\n    float l = max(length(d), 0.001);\n    force = stiffness * log(l / restLength) * d / l;\n    gl_Position = vec4(2.0 * edge.xy - 1.0 + 1.0 / 64.0, 0, 1);\n  }",
frag:"\n  precision highp float;\n  varying vec2 force;\n  void main () {\n    gl_FragColor = vec4(0, 0, force);\n  }",attributes:{edge:n.map(function(a){var b=e(a[0]);a=e(a[1]);return[b[0]/64,b[1]/64,a[0]/64,a[1]/64]})},uniforms:{vertexState:k.prop("src"),restLength:f,stiffness:.08},blend:{enable:!0,func:{src:1,dst:1},equation:"add"},depth:{enable:!1,mask:!1},count:n.length,primitive:"points"}),F=k({framebuffer:k.prop("dest"),vert:"\n  precision highp float;\n  attribute vec2 p;\n  varying vec2 id;\n  void main () {\n    id = 0.5 * (p + 1.0);\n    gl_Position = vec4(p, 0, 1);\n  }",
frag:"\n  precision highp float;\n  uniform sampler2D vertexState, field;\n  uniform float temperature, t;\n  varying vec2 id;\n\n  float rnd (vec2 co) {\n  \treturn fract(sin(t*0.1+dot(co.xy, vec2(12.9898,78.233))) * 43758.5453);\n  }\n\n  void main () {\n    vec4 state = texture2D(vertexState, id);\n    vec2 p = state.rg;\n    vec2 v = state.ba;\n    vec2 force = texture2D(field, p).xy;\n    p += 1.0E-4 * v;\n    v = float(0.98) * (v - float(0.05) * force);\n    vec2 jitter = vec2(rnd(id), rnd(id + 1000.0)) - 0.5;\n    gl_FragColor = vec4(p + temperature * jitter, v);\n  }",
attributes:{p:[-4,0,4,-4,4,4]},uniforms:{vertexState:k.prop("src"),field:k.prop("field"),temperature:function(a){return 1/(.5*a.tick+20)},t:k.context("tick")},count:3}),K=k({vert:"\n  precision highp float;\n  attribute vec2 id;\n  uniform sampler2D vertexState;\n  void main () {\n    vec4 state = texture2D(vertexState, id);\n    gl_PointSize = 2.0;\n    gl_Position = vec4(2.0 * fract(state.xy) - 1.0, 0, 1);\n  }",frag:"\n  precision highp float;\n  void main () {\n    gl_FragColor = vec4(0, 0, 0, 1);\n  }",
attributes:{id:q},uniforms:{vertexState:function(b){return a[b.tick%2]}},depth:{enable:!1,mask:!1},primitive:"points",count:4096,elements:null});f=2;f>k.limits.lineWidthDims[1]&&(f=k.limits.lineWidthDims[1]);var m=k({vert:"\n  precision highp float;\n  attribute vec4 id;\n  attribute float arcDir;\n  uniform float dir;\n  uniform sampler2D vertexState;\n  void main () {\n    float side = arcDir + dir - 2.0 * dir * arcDir;\n    vec2 s0 = texture2D(vertexState, id.rg).xy;\n    vec2 s1 = texture2D(vertexState, id.ba).xy;\n    vec2 shift = mix(fract(s0) - s0, fract(s1) - s1, side);\n    gl_Position = vec4(2.0 * (s0.xy + shift) - 1.0, 0, 1);\n  }",
frag:"\n  void main () {\n    gl_FragColor = vec4(0.1, 0, 1, 1);\n  }",attributes:{id:n.map(function(a){var b=e(a[0]);a=e(a[1]);return[b[0]/64,b[1]/64,a[0]/64,a[1]/64]}),arcDir:n.map(function(a,b){return b%2})},uniforms:{vertexState:function(b){return a[b.tick%2]},dir:k.prop("dir")},depth:{enable:!1,mask:!1},count:n.length,primitive:"lines",lineWidth:f}),p=k({vert:"\n  uniform vec2 mouse;\n  attribute float p;\n  void main () {\n    gl_PointSize = 32.0;\n    gl_Position = vec4(mouse, p, 1);\n  }",
frag:"\n  precision highp float;\n  uniform float strength;\n  void main () {\n    float s = strength * exp(-16.0 * dot(gl_PointCoord.xy, gl_PointCoord.xy));\n    gl_FragColor = vec4(s, 0, 0, 1);\n  }",attributes:{p:[0]},uniforms:{mouse:function(a){var b=a.pixelRatio;return[2*b*v.x/a.drawingBufferWidth-1,1-2*b*v.y/a.drawingBufferHeight]},strength:function(){return v.buttons?5:1}},count:1,primitive:"points"});k.frame(function(a){g(a);k.clear({color:[1,1,1,1]});m([{dir:0},{dir:1}]);K()})},{"../regl":37,
"mouse-change":35}],2:[function(f,q,z){function e(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}q.exports=function(g,k,v,b,l){g=v.maxAttributes;k=Array(g);for(v=0;v<g;++v)k[v]=new e;return{Record:e,scope:{},state:k}}},{}],3:[function(f,q,z){function e(a){return u[Object.prototype.toString.call(a)]|0}function g(a,b){for(var e=0;e<b.length;++e)a[e]=b[e]}function k(a,b,e,k,g,l,v){for(var c=0,h=0;h<e;++h)for(var r=
0;r<k;++r)a[c++]=b[g*h+l*r+v]}var v=f("./util/check"),b=f("./util/is-typed-array"),l=f("./util/is-ndarray"),a=f("./util/values"),n=f("./util/pool");z=f("./util/flatten");var A=z.flatten,B=z.shape,u=f("./constants/arraytypes.json"),r=f("./constants/dtypes.json"),M=f("./constants/usage.json"),y=[];y[5120]=1;y[5122]=2;y[5124]=4;y[5121]=1;y[5123]=2;y[5125]=4;y[5126]=4;q.exports=function(f,u,m){function p(a){this.id=c++;this.buffer=f.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=
1;this.dtype=5121;this.persistentData=null;m.profile&&(this.stats={size:0})}function L(a,b,c){a.byteLength=b.byteLength;f.bufferData(a.type,b,c)}function N(a,c,h,r,f,p){a.usage=h;if(Array.isArray(c)){if(a.dtype=r||5126,0<c.length)if(Array.isArray(c[0])){f=B(c);for(var m=r=1;m<f.length;++m)r*=f[m];a.dimension=r;c=A(c,f,a.dtype);L(a,c,h);p?a.persistentData=c:n.freeType(c)}else"number"===typeof c[0]?(a.dimension=f,f=n.allocType(a.dtype,c.length),g(f,c),L(a,f,h),p?a.persistentData=f:n.freeType(f)):b(c[0])?
(a.dimension=c[0].length,a.dtype=r||e(c[0])||5126,c=A(c,[c.length,c[0].length],a.dtype),L(a,c,h),p?a.persistentData=c:n.freeType(c)):v.raise("invalid buffer data")}else if(b(c))a.dtype=r||e(c),a.dimension=f,L(a,c,h),p&&(a.persistentData=new Uint8Array(new Uint8Array(c.buffer)));else if(l(c)){f=c.shape;var u=c.stride,m=c.offset,H=0,U=0,I=0,C=0;1===f.length?(H=f[0],U=1,I=u[0],C=0):2===f.length?(H=f[0],U=f[1],I=u[0],C=u[1]):v.raise("invalid shape");a.dtype=r||e(c.data)||5126;a.dimension=U;f=n.allocType(a.dtype,
H*U);k(f,c.data,H,U,I,C,m);L(a,f,h);p?a.persistentData=f:n.freeType(f)}else v.raise("invalid buffer data")}function C(a){u.bufferCount--;var c=a.buffer;v(c,"buffer must not be deleted already");f.deleteBuffer(c);a.buffer=null;delete h[a.id]}var c=0,h={};p.prototype.bind=function(){f.bindBuffer(this.type,this.buffer)};p.prototype.destroy=function(){C(this)};var H=[];m.profile&&(u.getTotalBufferSize=function(){var a=0;Object.keys(h).forEach(function(c){a+=h[c].stats.size});return a});return{create:function(a,
c,H,L){function q(a){var c=35044,h=null,e=0,k=0,g=1;Array.isArray(a)||b(a)||l(a)?h=a:"number"===typeof a?e=a|0:a&&(v.type(a,"object","buffer arguments must be an object, a number or an array"),"data"in a&&(v(null===h||Array.isArray(h)||b(h)||l(h),"invalid data for buffer"),h=a.data),"usage"in a&&(v.parameter(a.usage,M,"invalid buffer usage"),c=M[a.usage]),"type"in a&&(v.parameter(a.type,r,"invalid buffer type"),k=r[a.type]),"dimension"in a&&(v.type(a.dimension,"number","invalid dimension"),g=a.dimension|
0),"length"in a&&(v.nni(e,"buffer length must be a nonnegative integer"),e=a.length|0));J.bind();h?N(J,h,c,k,g,L):(f.bufferData(J.type,e,c),J.dtype=k||5121,J.usage=c,J.dimension=g,J.byteLength=e);m.profile&&(J.stats.size=J.byteLength*y[J.dtype]);return q}function z(a,c){v(c+a.byteLength<=J.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+a.byteLength+" starting from offset "+c+" to a buffer of size "+J.byteLength);f.bufferSubData(J.type,c,a)}u.bufferCount++;
var J=new p(c);h[J.id]=J;H||q(a);q._reglType="buffer";q._buffer=J;q.subdata=function(a,c){var h=(c||0)|0,f;J.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var r=n.allocType(J.dtype,a.length);g(r,a);z(r,h);n.freeType(r)}else Array.isArray(a[0])||b(a[0])?(f=B(a),r=A(a,f,J.dtype),z(r,h),n.freeType(r)):v.raise("invalid buffer data")}else if(b(a))z(a,h);else if(l(a)){f=a.shape;var p=a.stride,m=r=0,W=0,H=0;1===f.length?(r=f[0],m=1,W=p[0],H=0):2===f.length?(r=f[0],m=f[1],W=p[0],H=
p[1]):v.raise("invalid shape");f=Array.isArray(a.data)?J.dtype:e(a.data);f=n.allocType(f,r*m);k(f,a.data,r,m,W,H,a.offset);z(f,h);n.freeType(f)}else v.raise("invalid data for buffer subdata");return q};m.profile&&(q.stats=J.stats);q.destroy=function(){C(J)};return q},createStream:function(a,c){var b=H.pop();b||(b=new p(a));b.bind();N(b,c,35040,0,1,!1);return b},destroyStream:function(a){H.push(a)},clear:function(){a(h).forEach(C);H.forEach(C)},getBuffer:function(a){return a&&a._buffer instanceof p?
a._buffer:null},restore:function(){a(h).forEach(function(a){a.buffer=f.createBuffer();f.bindBuffer(a.type,a.buffer);f.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},_initBuffer:N}}},{"./constants/arraytypes.json":4,"./constants/dtypes.json":5,"./constants/usage.json":7,"./util/check":21,"./util/flatten":25,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/values":33}],4:[function(f,q,z){q.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,
"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],5:[function(f,q,z){q.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],6:[function(f,q,z){q.exports={points:0,point:0,lines:1,line:1,"line loop":2,"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],7:[function(f,
q,z){q.exports={"static":35044,dynamic:35048,stream:35040}},{}],8:[function(f,q,z){function e(a){return Array.isArray(a)||B(a)||u(a)}function g(a){return a.sort(function(a,c){return"viewport"===a?-1:"viewport"===c?1:a<c?-1:1})}function k(a,c,b,h){this.thisDep=a;this.contextDep=c;this.propDep=b;this.append=h}function v(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function b(a){return new k(!1,!1,!1,a)}function l(a,c){var b=a.type;return 0===b?(b=a.data.length,new k(!0,1<=b,2<=b,c)):4===b?(b=
a.data,new k(b.thisDep,b.contextDep,b.propDep,c)):new k(3===b,2===b,1===b,c)}var a=f("./util/check"),n=f("./util/codegen"),A=f("./util/loop"),B=f("./util/is-typed-array"),u=f("./util/is-ndarray"),r=f("./util/is-array-like"),M=f("./dynamic"),y=f("./constants/primitives.json"),F=f("./constants/dtypes.json"),K=["x","y","z","w"],m="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),p={0:0,1:1,zero:0,one:1,"src color":768,
"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},L="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
N={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},C={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},c={frag:35632,vert:35633},h={cw:2304,ccw:2305},H=new k(!1,!1,!1,function(){});q.exports=function(f,u,q,B,S,z,J,ea,Y,U,I,sa,la,pa,xa){function aa(a){return a.replace(".","_")}function T(a,d,c){var b=aa(a);
Ha.push(a);G[b]=w[b]=!!c;Ba[b]=d}function O(a,d,c){var b=aa(a);Ha.push(a);Array.isArray(c)?(w[b]=c.slice(),G[b]=c.slice()):w[b]=G[b]=c;Ca[b]=d}function Da(){var d=n(),c=d.link,b=d.global;d.id=Qa++;d.batchId="0";var h=c(Na),e=d.shared={props:"a0"};Object.keys(Na).forEach(function(a){e[a]=b.def(h,".",a)});a.optional(function(){d.CHECK=c(a);d.commandStr=a.guessCommand();d.command=c(d.commandStr);d.assert=function(a,d,D){a("if(!(",d,"))",this.CHECK,".commandRaise(",c(D),",",this.command,");")};Ia.invalidBlendCombinations=
L});var P=d.next={},k=d.current={};Object.keys(Ca).forEach(function(a){Array.isArray(w[a])&&(P[a]=b.def(e.next,".",a),k[a]=b.def(e.current,".",a))});var Ra=d.constants={};Object.keys(Ia).forEach(function(a){Ra[a]=b.def(JSON.stringify(Ia[a]))});d.invoke=function(a,D){switch(D.type){case 0:var b=["this",e.context,e.props,d.batchId];return a.def(c(D.data),".call(",b.slice(0,Math.max(D.data.length+1,4)),")");case 1:return a.def(e.props,D.data);case 2:return a.def(e.context,D.data);case 3:return a.def("this",
D.data);case 4:return D.data.append(d,a),D.data.ref}};d.attribCache={};var D={};d.scopeAttrib=function(a){a=u.id(a);if(a in D)return D[a];var d=U.scope[a];d||(d=U.scope[a]=new ta);return D[a]=c(d)};return d}function ua(a){var d=a["static"];a=a.dynamic;var c;if("profile"in d){var h=!!d.profile;c=b(function(a,d){return h});c.enable=h}else if("profile"in a){var e=a.profile;c=l(e,function(a,d){return a.invoke(d,e)})}return c}function ya(d,c){var h=d["static"],e=d.dynamic;if("framebuffer"in h){var k=h.framebuffer;
return k?(k=ea.getFramebuffer(k),a.command(k,"invalid framebuffer object"),b(function(a,d){var D=a.link(k),c=a.shared;d.set(c.framebuffer,".next",D);c=c.context;d.set(c,".framebufferWidth",D+".width");d.set(c,".framebufferHeight",D+".height");return D})):b(function(a,d){var c=a.shared;d.set(c.framebuffer,".next","null");c=c.context;d.set(c,".framebufferWidth",c+".drawingBufferWidth");d.set(c,".framebufferHeight",c+".drawingBufferHeight");return"null"})}if("framebuffer"in e){var P=e.framebuffer;return l(P,
function(d,c){var D=d.invoke(c,P),b=d.shared,ca=b.framebuffer,E=c.def(ca,".getFramebuffer(",D,")");a.optional(function(){d.assert(c,"!"+D+"||"+E,"invalid framebuffer object")});c.set(ca,".next",E);b=b.context;c.set(b,".framebufferWidth",E+"?"+E+".width:"+b+".drawingBufferWidth");c.set(b,".framebufferHeight",E+"?"+E+".height:"+b+".drawingBufferHeight");return E})}return null}function ba(d,c,b){function h(d){if(d in e){var D=e[d];a.commandType(D,"object","invalid "+d,b.commandStr);var t=!0,ca=D.x|0,
w=D.y|0,g,f;"width"in D?(g=D.width|0,a.command(0<=g,"invalid "+d,b.commandStr)):t=!1;"height"in D?(f=D.height|0,a.command(0<=f,"invalid "+d,b.commandStr)):t=!1;return new k(!t&&c&&c.thisDep,!t&&c&&c.contextDep,!t&&c&&c.propDep,function(a,d){var c=a.shared.context,b=g;"width"in D||(b=d.def(c,".","framebufferWidth","-",ca));var t=f;"height"in D||(t=d.def(c,".","framebufferHeight","-",w));return[ca,w,b,t]})}if(d in P){var x=P[d],t=l(x,function(c,D){var b=c.invoke(D,x);a.optional(function(){c.assert(D,
b+"&&typeof "+b+'==="object"',"invalid "+d)});var ca=c.shared.context,t=D.def(b,".x|0"),E=D.def(b,".y|0"),h=D.def('"width" in ',b,"?",b,".width|0:","(",ca,".","framebufferWidth","-",t,")"),e=D.def('"height" in ',b,"?",b,".height|0:","(",ca,".","framebufferHeight","-",E,")");a.optional(function(){c.assert(D,h+">=0&&"+e+">=0","invalid "+d)});return[t,E,h,e]});c&&(t.thisDep=t.thisDep||c.thisDep,t.contextDep=t.contextDep||c.contextDep,t.propDep=t.propDep||c.propDep);return t}return c?new k(c.thisDep,
c.contextDep,c.propDep,function(a,d){var c=a.shared.context;return[0,0,d.def(c,".","framebufferWidth"),d.def(c,".","framebufferHeight")]}):null}var e=d["static"],P=d.dynamic;if(d=h("viewport")){var w=d;d=new k(d.thisDep,d.contextDep,d.propDep,function(a,d){var c=w.append(a,d),b=a.shared.context;d.set(b,".viewportWidth",c[2]);d.set(b,".viewportHeight",c[3]);return c})}return{viewport:d,scissor_box:h("scissor.box")}}function ja(d){function E(d){if(d in h){var D=u.id(h[d]);a.optional(function(){I.shader(c[d],
D,a.guessCommand())});var E=b(function(){return D});E.id=D;return E}if(d in e){var ca=e[d];return l(ca,function(D,b){var E=D.invoke(b,ca),t=b.def(D.shared.strings,".id(",E,")");a.optional(function(){b(D.shared.shader,".shader(",c[d],",",t,",",D.command,");")});return t})}return null}var h=d["static"],e=d.dynamic,w=E("frag"),P=E("vert"),g=null;v(w)&&v(P)?(g=I.program(P.id,w.id),d=b(function(a,d){return a.link(g)})):d=new k(w&&w.thisDep||P&&P.thisDep,w&&w.contextDep||P&&P.contextDep,w&&w.propDep||P&&
P.propDep,function(d,c){var b=d.shared.shader,ca;ca=w?w.append(d,c):c.def(b,".","frag");var E;E=P?P.append(d,c):c.def(b,".","vert");var t=b+".program("+E+","+ca;a.optional(function(){t+=","+d.command});return c.def(t+")")});return{frag:w,vert:P,progVar:d,program:g}}function ma(d,c){function h(d,D){if(d in w){var t=w[d]|0;a.command(!D||0<=t,"invalid "+d,c.commandStr);return b(function(a,d){D&&(a.OFFSET=t);return t})}if(d in g){var ca=g[d];return l(ca,function(c,b){var t=c.invoke(b,ca);D&&(c.OFFSET=
t,a.optional(function(){c.assert(b,t+">=0","invalid "+d)}));return t})}return D&&P?b(function(a,d){a.OFFSET="0";return 0}):null}var w=d["static"],g=d.dynamic,P=function(){if("elements"in w){var d=w.elements;e(d)?d=z.getElements(z.create(d,!0)):d&&(d=z.getElements(d),a.command(d,"invalid elements",c.commandStr));var D=b(function(a,c){if(d){var b=a.link(d);return a.ELEMENTS=b}return a.ELEMENTS=null});D.value=d;return D}if("elements"in g){var t=g.elements;return l(t,function(d,c){var b=d.shared,D=b.isBufferArgs,
b=b.elements,E=d.invoke(c,t),h=c.def("null"),D=c.def(D,"(",E,")"),e=d.cond(D).then(h,"=",b,".createStream(",E,");")["else"](h,"=",b,".getElements(",E,");");a.optional(function(){d.assert(e["else"],"!"+E+"||"+h,"invalid elements")});c.entry(e);c.exit(d.cond(D).then(b,".destroyStream(",h,");"));return d.ELEMENTS=h})}return null}(),f=h("offset",!0);return{elements:P,primitive:function(){if("primitive"in w){var d=w.primitive;a.commandParameter(d,y,"invalid primitve",c.commandStr);return b(function(a,
c){return y[d]})}if("primitive"in g){var D=g.primitive;return l(D,function(d,c){var b=d.constants.primTypes,t=d.invoke(c,D);a.optional(function(){d.assert(c,t+" in "+b,"invalid primitive, must be one of "+Object.keys(y))});return c.def(b,"[",t,"]")})}return P?v(P)?P.value?b(function(a,d){return d.def(a.ELEMENTS,".primType")}):b(function(){return 4}):new k(P.thisDep,P.contextDep,P.propDep,function(a,d){var c=a.ELEMENTS;return d.def(c,"?",c,".primType:",4)}):null}(),count:function(){if("count"in w){var d=
w.count|0;a.command("number"===typeof d&&0<=d,"invalid vertex count",c.commandStr);return b(function(){return d})}if("count"in g){var D=g.count;return l(D,function(d,c){var b=d.invoke(c,D);a.optional(function(){d.assert(c,"typeof "+b+'==="number"&&'+b+">=0&&"+b+"===("+b+"|0)","invalid vertex count")});return b})}if(P){if(v(P)){if(P)return f?new k(f.thisDep,f.contextDep,f.propDep,function(d,c){var b=c.def(d.ELEMENTS,".vertCount-",d.OFFSET);a.optional(function(){d.assert(c,b+">=0","invalid vertex offset/element buffer too small")});
return b}):b(function(a,d){return d.def(a.ELEMENTS,".vertCount")});var t=b(function(){return-1});a.optional(function(){t.MISSING=!0});return t}var h=new k(P.thisDep||f.thisDep,P.contextDep||f.contextDep,P.propDep||f.propDep,function(a,d){var c=a.ELEMENTS;return a.OFFSET?d.def(c,"?",c,".vertCount-",a.OFFSET,":-1"):d.def(c,"?",c,".vertCount:-1")});a.optional(function(){h.DYNAMIC=!0});return h}return null}(),instances:h("instances",!1),offset:f}}function na(d,c){var e=d["static"],w=d.dynamic,k={};Ha.forEach(function(d){function t(a,
c){if(d in e){var h=a(e[d]);k[g]=b(function(){return h})}else if(d in w){var E=w[d];k[g]=l(E,function(a,d){return c(a,d,a.invoke(d,E))})}}var g=aa(d);switch(d){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return t(function(b){a.commandType(b,"boolean",d,c.commandStr);return b},function(c,b,t){a.optional(function(){c.assert(b,"typeof "+t+'==="boolean"',
"invalid flag "+d,c.commandStr)});return t});case "depth.func":return t(function(b){a.commandParameter(b,N,"invalid "+d,c.commandStr);return N[b]},function(c,b,t){var h=c.constants.compareFuncs;a.optional(function(){c.assert(b,t+" in "+h,"invalid "+d+", must be one of "+Object.keys(N))});return b.def(h,"[",t,"]")});case "depth.range":return t(function(d){a.command(r(d)&&2===d.length&&"number"===typeof d[0]&&"number"===typeof d[1]&&d[0]<=d[1],"depth range is 2d array",c.commandStr);return d},function(d,
c,b){a.optional(function(){d.assert(c,d.shared.isArrayLike+"("+b+")&&"+b+".length===2&&typeof "+b+'[0]==="number"&&typeof '+b+'[1]==="number"&&'+b+"[0]<="+b+"[1]","depth range must be a 2d array")});var t=c.def("+",b,"[0]"),h=c.def("+",b,"[1]");return[t,h]});case "blend.func":return t(function(d){a.commandType(d,"object","blend.func",c.commandStr);var b="srcRGB"in d?d.srcRGB:d.src,t="srcAlpha"in d?d.srcAlpha:d.src,h="dstRGB"in d?d.dstRGB:d.dst;d="dstAlpha"in d?d.dstAlpha:d.dst;a.commandParameter(b,
p,g+".srcRGB",c.commandStr);a.commandParameter(t,p,g+".srcAlpha",c.commandStr);a.commandParameter(h,p,g+".dstRGB",c.commandStr);a.commandParameter(d,p,g+".dstAlpha",c.commandStr);a.command(-1===L.indexOf(b+", "+h),"unallowed blending combination (srcRGB, dstRGB) = ("+b+", "+h+")",c.commandStr);return[p[b],p[h],p[t],p[d]]},function(c,b,t){function h(E,k){var w=b.def('"',E,k,'" in ',t,"?",t,".",E,k,":",t,".",E);a.optional(function(){c.assert(b,w+" in "+e,"invalid "+d+"."+E+k+", must be one of "+Object.keys(p))});
return w}var e=c.constants.blendFuncs;a.optional(function(){c.assert(b,t+"&&typeof "+t+'==="object"',"invalid blend func, must be an object")});var E=h("src","RGB"),k=h("dst","RGB");a.optional(function(){c.assert(b,c.constants.invalidBlendCombinations+".indexOf("+E+'+", "+'+k+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var w=b.def(e,"[",E,"]"),g=b.def(e,"[",h("src","Alpha"),"]"),f=b.def(e,"[",k,"]"),l=b.def(e,"[",h("dst","Alpha"),"]");return[w,f,g,l]});case "blend.equation":return t(function(b){if("string"===
typeof b)return a.commandParameter(b,da,"invalid "+d,c.commandStr),[da[b],da[b]];if("object"===typeof b)return a.commandParameter(b.rgb,da,d+".rgb",c.commandStr),a.commandParameter(b.alpha,da,d+".alpha",c.commandStr),[da[b.rgb],da[b.alpha]];a.commandRaise("invalid blend.equation",c.commandStr)},function(c,b,t){var h=c.constants.blendEquations,e=b.def(),E=b.def(),k=c.cond("typeof ",t,'==="string"');a.optional(function(){function a(d,b,t){c.assert(d,t+" in "+h,"invalid "+b+", must be one of "+Object.keys(da))}
a(k.then,d,t);c.assert(k["else"],t+"&&typeof "+t+'==="object"',"invalid "+d);a(k["else"],d+".rgb",t+".rgb");a(k["else"],d+".alpha",t+".alpha")});k.then(e,"=",E,"=",h,"[",t,"];");k["else"](e,"=",h,"[",t,".rgb];",E,"=",h,"[",t,".alpha];");b(k);return[e,E]});case "blend.color":return t(function(d){a.command(r(d)&&4===d.length,"blend.color must be a 4d array",c.commandStr);return A(4,function(a){return+d[a]})},function(d,c,b){a.optional(function(){d.assert(c,d.shared.isArrayLike+"("+b+")&&"+b+".length===4",
"blend.color must be a 4d array")});return A(4,function(a){return c.def("+",b,"[",a,"]")})});case "stencil.mask":return t(function(d){a.commandType(d,"number",g,c.commandStr);return d|0},function(d,c,b){a.optional(function(){d.assert(c,"typeof "+b+'==="number"',"invalid stencil.mask")});return c.def(b,"|0")});case "stencil.func":return t(function(b){a.commandType(b,"object",g,c.commandStr);var t=b.cmp||"keep",h=b.ref||0;b="mask"in b?b.mask:-1;a.commandParameter(t,N,d+".cmp",c.commandStr);a.commandType(h,
"number",d+".ref",c.commandStr);a.commandType(b,"number",d+".mask",c.commandStr);return[N[t],h,b]},function(d,c,b){var t=d.constants.compareFuncs;a.optional(function(){function a(){d.assert(c,Array.prototype.join.call(arguments,""),"invalid stencil.func")}a(b+"&&typeof ",b,'==="object"');a('!("cmp" in ',b,")||(",b,".cmp in ",t,")")});var h=c.def('"cmp" in ',b,"?",t,"[",b,".cmp]",":",7680),e=c.def(b,".ref|0"),E=c.def('"mask" in ',b,"?",b,".mask|0:-1");return[h,e,E]});case "stencil.opFront":case "stencil.opBack":return t(function(b){a.commandType(b,
"object",g,c.commandStr);var t=b.fail||"keep",h=b.zfail||"keep";b=b.zpass||"keep";a.commandParameter(t,C,d+".fail",c.commandStr);a.commandParameter(h,C,d+".zfail",c.commandStr);a.commandParameter(b,C,d+".zpass",c.commandStr);return["stencil.opBack"===d?1029:1028,C[t],C[h],C[b]]},function(c,b,t){function h(E){a.optional(function(){c.assert(b,'!("'+E+'" in '+t+")||("+t+"."+E+" in "+e+")","invalid "+d+"."+E+", must be one of "+Object.keys(C))});return b.def('"',E,'" in ',t,"?",e,"[",t,".",E,"]:",7680)}
var e=c.constants.stencilOps;a.optional(function(){c.assert(b,t+"&&typeof "+t+'==="object"',"invalid "+d)});return["stencil.opBack"===d?1029:1028,h("fail"),h("zfail"),h("zpass")]});case "polygonOffset.offset":return t(function(d){a.commandType(d,"object",g,c.commandStr);var b=d.factor|0;d=d.units|0;a.commandType(b,"number",g+".factor",c.commandStr);a.commandType(d,"number",g+".units",c.commandStr);return[b,d]},function(c,b,t){a.optional(function(){c.assert(b,t+"&&typeof "+t+'==="object"',"invalid "+
d)});var h=b.def(t,".factor|0"),e=b.def(t,".units|0");return[h,e]});case "cull.face":return t(function(d){var b=0;"front"===d?b=1028:"back"===d&&(b=1029);a.command(!!b,g,c.commandStr);return b},function(d,c,b){a.optional(function(){d.assert(c,b+'==="front"||'+b+'==="back"',"invalid cull.face")});return c.def(b,'==="front"?',1028,":",1029)});case "lineWidth":return t(function(d){a.command("number"===typeof d&&d>=B.lineWidthDims[0]&&d<=B.lineWidthDims[1],"invalid line width, must positive number between "+
B.lineWidthDims[0]+" and "+B.lineWidthDims[1],c.commandStr);return d},function(d,c,b){a.optional(function(){d.assert(c,"typeof "+b+'==="number"&&'+b+">="+B.lineWidthDims[0]+"&&"+b+"<="+B.lineWidthDims[1],"invalid line width")});return b});case "frontFace":return t(function(d){a.commandParameter(d,h,g,c.commandStr);return h[d]},function(d,c,b){a.optional(function(){d.assert(c,b+'==="cw"||'+b+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return c.def(b+'==="cw"?2304:2305')});case "colorMask":return t(function(d){a.command(r(d)&&
4===d.length,"color.mask must be length 4 array",c.commandStr);return d.map(function(d){return!!d})},function(d,c,b){a.optional(function(){d.assert(c,d.shared.isArrayLike+"("+b+")&&"+b+".length===4","invalid color.mask")});return A(4,function(d){return"!!"+b+"["+d+"]"})});case "sample.coverage":return t(function(d){a.command("object"===typeof d&&d,g,c.commandStr);var b="value"in d?d.value:1;d=!!d.invert;a.command("number"===typeof b&&0<=b&&1>=b,"sample.coverage.value must be a number between 0 and 1",
c.commandStr);return[b,d]},function(d,c,b){a.optional(function(){d.assert(c,b+"&&typeof "+b+'==="object"',"invalid sample.coverage")});var t=c.def('"value" in ',b,"?+",b,".value:1"),h=c.def("!!",b,".invert");return[t,h]})}});return k}function oa(d,c){var h=d["static"],e=d.dynamic,k={};Object.keys(h).forEach(function(d){var t=h[d],e;if("number"===typeof t||"boolean"===typeof t)e=b(function(){return t});else if("function"===typeof t){var w=t._reglType;"texture2d"===w||"textureCube"===w?e=b(function(d){return d.link(t)}):
"framebuffer"===w||"framebufferCube"===w?(a.command(0<t.color.length,'missing color attachment for framebuffer sent to uniform "'+d+'"',c.commandStr),e=b(function(d){return d.link(t.color[0])})):a.commandRaise('invalid data for uniform "'+d+'"',c.commandStr)}else r(t)?e=b(function(c){return c.global.def("[",A(t.length,function(b){a.command("number"===typeof t[b]||"boolean"===typeof t[b],"invalid uniform "+d,c.commandStr);return t[b]}),"]")}):a.commandRaise('invalid or missing data for uniform "'+
d+'"',c.commandStr);e.value=t;k[d]=e});Object.keys(e).forEach(function(d){var a=e[d];k[d]=l(a,function(d,c){return d.invoke(c,a)})});return k}function qa(c,h){var k=c["static"],w=c.dynamic,g={};Object.keys(k).forEach(function(c){var t=k[c],w=u.id(c),f=new ta;if(e(t))f.state=1,f.buffer=S.getBuffer(S.create(t,34962,!1,!0)),f.type=0;else{var l=S.getBuffer(t);if(l)f.state=1,f.buffer=l,f.type=0;else if(a.command("object"===typeof t&&t,"invalid data for attribute "+c,h.commandStr),t.constant){var x=t.constant;
f.buffer="null";f.state=2;"number"===typeof x?f.x=x:(a.command(r(x)&&0<x.length&&4>=x.length,"invalid constant for attribute "+c,h.commandStr),K.forEach(function(d,a){a<x.length&&(f[d]=x[a])}))}else{l=e(t.buffer)?S.getBuffer(S.create(t.buffer,34962,!1,!0)):S.getBuffer(t.buffer);a.command(!!l,'missing buffer for attribute "'+c+'"',h.commandStr);var v=t.offset|0;a.command(0<=v,'invalid offset for attribute "'+c+'"',h.commandStr);var m=t.stride|0;a.command(0<=m&&256>m,'invalid stride for attribute "'+
c+'", must be integer betweeen [0, 255]',h.commandStr);var p=t.size|0;a.command(!("size"in t)||0<p&&4>=p,'invalid size for attribute "'+c+'", must be 1,2,3,4',h.commandStr);var n=!!t.normalized,H=0;"type"in t&&(a.commandParameter(t.type,F,"invalid type for attribute "+c,h.commandStr),H=F[t.type]);var G=t.divisor|0;"divisor"in t&&(a.command(0===G||d,'cannot specify divisor for attribute "'+c+'", instancing not supported',h.commandStr),a.command(0<=G,'invalid divisor for attribute "'+c+'"',h.commandStr));
a.optional(function(){var d=h.commandStr,b="buffer offset divisor normalized type size stride".split(" ");Object.keys(t).forEach(function(t){a.command(0<=b.indexOf(t),'unknown parameter "'+t+'" for attribute pointer "'+c+'" (valid parameters are '+b+")",d)})});f.buffer=l;f.state=1;f.size=p;f.normalized=n;f.type=H||l.dtype;f.offset=v;f.stride=m;f.divisor=G}}g[c]=b(function(d,a){var c=d.attribCache;if(w in c)return c[w];var b={isStream:!1};Object.keys(f).forEach(function(d){b[d]=f[d]});f.buffer&&(b.buffer=
d.link(f.buffer),b.type=b.type||b.buffer+".dtype");return c[w]=b})});Object.keys(w).forEach(function(d){var c=w[d];g[d]=l(c,function(b,t){function h(d){t(g[d],"=",e,".",d,"|0;")}var e=b.invoke(t,c),E=b.shared,k=E.isBufferArgs,w=E.buffer;a.optional(function(){b.assert(t,e+"&&(typeof "+e+'==="object"||typeof '+e+'==="function")&&('+k+"("+e+")||"+w+".getBuffer("+e+")||"+w+".getBuffer("+e+".buffer)||"+k+"("+e+'.buffer)||("constant" in '+e+"&&(typeof "+e+'.constant==="number"||'+E.isArrayLike+"("+e+".constant))))",
'invalid dynamic attribute "'+d+'"')});var g={isStream:t.def(!1)},f=new ta;f.state=1;Object.keys(f).forEach(function(d){g[d]=t.def(""+f[d])});var l=g.buffer,x=g.type;t("if(",k,"(",e,")){",g.isStream,"=true;",l,"=",w,".createStream(",34962,",",e,");",x,"=",l,".dtype;","}else{",l,"=",w,".getBuffer(",e,");","if(",l,"){",x,"=",l,".dtype;",'}else if("constant" in ',e,"){",g.state,"=",2,";","if(typeof "+e+'.constant === "number"){',g[K[0]],"=",e,".constant;",K.slice(1).map(function(d){return g[d]}).join("="),
"=0;","}else{",K.map(function(d,a){return g[d]+"="+e+".constant.length>="+a+"?"+e+".constant["+a+"]:0;"}).join(""),"}}else{","if(",k,"(",e,".buffer)){",l,"=",w,".createStream(",34962,",",e,".buffer);","}else{",l,"=",w,".getBuffer(",e,".buffer);","}",x,'="type" in ',e,"?",E.glTypes,"[",e,".type]:",l,".dtype;",g.normalized,"=!!",e,".normalized;");h("size");h("offset");h("stride");h("divisor");t("}}");t.exit("if(",g.isStream,"){",w,".destroyStream(",l,");","}");return g})});return g}function za(d){var a=
d["static"],c=d.dynamic,h={};Object.keys(a).forEach(function(d){var c=a[d];h[d]=b(function(d,a){return"number"===typeof c||"boolean"===typeof c?""+c:d.link(c)})});Object.keys(c).forEach(function(d){var a=c[d];h[d]=l(a,function(d,c){return d.invoke(c,a)})});return h}function X(d,c,b,h,e){function k(d){var a=l[d];a&&(r[d]=a)}var w=d["static"],g=d.dynamic;a.optional(function(){function d(b){Object.keys(b).forEach(function(d){a.command(0<=c.indexOf(d),'unknown parameter "'+d+'"',e.commandStr)})}var c=
"framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(Ha);d(w);d(g)});var f=ya(d,e),l=ba(d,f,e),x=ma(d,e),r=na(d,e),v=ja(d,e);k("viewport");k(aa("scissor.box"));var m=0<Object.keys(r).length,f={framebuffer:f,draw:x,shader:v,state:r,dirty:m};f.profile=ua(d,e);f.uniforms=oa(b,e);f.attributes=qa(c,e);f.context=za(h,e);return f}function Q(d,a,c){var b=d.shared.context,h=d.scope();Object.keys(c).forEach(function(e){a.save(b,"."+e);h(b,".",e,"=",c[e].append(d,a),";")});
a(h)}function ga(d,a,c,b){var h=d.shared,e=h.gl,k=h.framebuffer,w;x&&(w=a.def(h.extensions,".webgl_draw_buffers"));var g=d.constants,h=g.drawBuffer,g=g.backBuffer;d=c?c.append(d,a):a.def(k,".next");b||a("if(",d,"!==",k,".cur){");a("if(",d,"){",e,".bindFramebuffer(",36160,",",d,".framebuffer);");x&&a(w,".drawBuffersWEBGL(",h,"[",d,".colorAttachments.length]);");a("}else{",e,".bindFramebuffer(",36160,",null);");x&&a(w,".drawBuffersWEBGL(",g,");");a("}",k,".cur=",d,";");b||a("}")}function V(d,a,c){var b=
d.shared,h=b.gl,e=d.current,k=d.next,g=b.current,f=b.next,l=d.cond(g,".dirty");Ha.forEach(function(a){a=aa(a);if(!(a in c.state)){var b,E;if(a in k){b=k[a];E=e[a];var x=A(w[a].length,function(d){return l.def(b,"[",d,"]")});l(d.cond(x.map(function(d,a){return d+"!=="+E+"["+a+"]"}).join("||")).then(h,".",Ca[a],"(",x,");",x.map(function(d,a){return E+"["+a+"]="+d}).join(";"),";"))}else b=l.def(f,".",a),x=d.cond(b,"!==",g,".",a),l(x),a in Ba?x(d.cond(b).then(h,".enable(",Ba[a],");")["else"](h,".disable(",
Ba[a],");"),g,".",a,"=",b,";"):x(h,".",Ca[a],"(",b,");",g,".",a,"=",b,";")}});0===Object.keys(c.state).length&&l(g,".dirty=false;");a(l)}function R(d,a,c,b){var h=d.shared,e=d.current,k=h.current,w=h.gl;g(Object.keys(c)).forEach(function(h){var g=c[h];if(!b||b(g)){var f=g.append(d,a);if(Ba[h]){var l=Ba[h];v(g)?f?a(w,".enable(",l,");"):a(w,".disable(",l,");"):a(d.cond(f).then(w,".enable(",l,");")["else"](w,".disable(",l,");"));a(k,".",h,"=",f,";")}else if(r(f)){var x=e[h];a(w,".",Ca[h],"(",f,");",
f.map(function(d,a){return x+"["+a+"]="+d}).join(";"),";")}else a(w,".",Ca[h],"(",f,");",k,".",h,"=",f,";")}})}function Z(a,c){d&&(a.instancing=c.def(a.shared.extensions,".angle_instanced_arrays"))}function fa(d,a,c,b,h){function e(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function k(d){m=a.def();d(m,"=",e(),";");"string"===typeof h?d(l,".count+=",h,";"):d(l,".count++;");pa&&(b?(p=a.def(),d(p,"=",r,".getNumPendingQueries();")):d(r,".beginQuery(",l,");"))}function w(d){d(l,
".cpuTime+=",e(),"-",m,";");pa&&(b?d(r,".pushScopeStats(",p,",",r,".getNumPendingQueries(),",l,");"):d(r,".endQuery();"))}function g(d){var c=a.def(x,".profile");a(x,".profile=",d,";");a.exit(x,".profile=",c,";")}var f=d.shared,l=d.stats,x=f.current,r=f.timer;c=c.profile;var m,p;if(c){if(v(c)){c.enable?(k(a),w(a.exit),g("true")):g("false");return}c=c.append(d,a);g(c)}else c=a.def(x,".profile");f=d.block();k(f);a("if(",c,"){",f,"}");d=d.block();w(d);a.exit("if(",c,"){",d,"}")}function Aa(c,b,h,e,k){function w(d){switch(d){case 35664:case 35667:case 35671:return 2;
case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function g(a,h,e){function k(){b("if(!",r,".buffer){",l,".enableVertexAttribArray(",x,");}");var a=e.type,w;w=e.size?b.def(e.size,"||",h):h;b("if(",r,".type!==",a,"||",r,".size!==",w,"||",p.map(function(d){return r+"."+d+"!=="+e[d]}).join("||"),"){",l,".bindBuffer(",34962,",",v,".buffer);",l,".vertexAttribPointer(",[x,w,a,e.normalized,e.stride,e.offset],");",r,".type=",a,";",r,".size=",w,";",p.map(function(d){return r+
"."+d+"="+e[d]+";"}).join(""),"}");d&&(a=e.divisor,b("if(",r,".divisor!==",a,"){",c.instancing,".vertexAttribDivisorANGLE(",[x,a],");",r,".divisor=",a,";}"))}function w(){b("if(",r,".buffer){",l,".disableVertexAttribArray(",x,");","}if(",K.map(function(d,a){return r+"."+d+"!=="+m[a]}).join("||"),"){",l,".vertexAttrib4f(",x,",",m,");",K.map(function(d,a){return r+"."+d+"="+m[a]+";"}).join(""),"}")}var l=f.gl,x=b.def(a,".location"),r=b.def(f.attributes,"[",x,"]");a=e.state;var v=e.buffer,m=[e.x,e.y,
e.z,e.w],p=["buffer","normalized","offset","stride"];1===a?k():2===a?w():(b("if(",a,"===",1,"){"),k(),b("}else{"),w(),b("}"))}var f=c.shared;e.forEach(function(d){var e=d.name,f=h.attributes[e],l;if(f){if(!k(f))return;l=f.append(c,b)}else{if(!k(H))return;var x=c.scopeAttrib(e);a.optional(function(){c.assert(b,x+".state","missing attribute "+e)});l={};Object.keys(new ta).forEach(function(d){l[d]=b.def(x,".",d)})}g(c.link(d),w(d.info.type),l)})}function ha(d,c,b,h,e){for(var w=d.shared,k=w.gl,g,f=0;f<
h.length;++f){var l=h[f],x=l.name,m=l.info.type,p=b.uniforms[x],l=d.link(l)+".location",n;if(p){if(!e(p))continue;if(v(p)){var G=p.value;a.command(null!==G&&"undefined"!==typeof G,'missing uniform "'+x+'"',d.commandStr);if(35678===m||35680===m)a.command("function"===typeof G&&(35678===m&&("texture2d"===G._reglType||"framebuffer"===G._reglType)||35680===m&&("textureCube"===G._reglType||"framebufferCube"===G._reglType)),"invalid texture for uniform "+x,d.commandStr),p=d.link(G._texture||G.color[0]._texture),
c(k,".uniform1i(",l,",",p+".bind());"),c.exit(p,".unbind();");else if(35674===m||35675===m||35676===m){a.optional(function(){a.command(r(G),"invalid matrix for uniform "+x,d.commandStr);a.command(35674===m&&4===G.length||35675===m&&9===G.length||35676===m&&16===G.length,"invalid length for matrix uniform "+x,d.commandStr)});var p=d.global.def("new Float32Array(["+Array.prototype.slice.call(G)+"])"),C=2;35675===m?C=3:35676===m&&(C=4);c(k,".uniformMatrix",C,"fv(",l,",false,",p,");")}else{switch(m){case 5126:a.commandType(G,
"number","uniform "+x,d.commandStr);g="1f";break;case 35664:a.command(r(G)&&2===G.length,"uniform "+x,d.commandStr);g="2f";break;case 35665:a.command(r(G)&&3===G.length,"uniform "+x,d.commandStr);g="3f";break;case 35666:a.command(r(G)&&4===G.length,"uniform "+x,d.commandStr);g="4f";break;case 35670:a.commandType(G,"boolean","uniform "+x,d.commandStr);g="1i";break;case 5124:a.commandType(G,"number","uniform "+x,d.commandStr);g="1i";break;case 35671:a.command(r(G)&&2===G.length,"uniform "+x,d.commandStr);
g="2i";break;case 35667:a.command(r(G)&&2===G.length,"uniform "+x,d.commandStr);g="2i";break;case 35672:a.command(r(G)&&3===G.length,"uniform "+x,d.commandStr);g="3i";break;case 35668:a.command(r(G)&&3===G.length,"uniform "+x,d.commandStr);g="3i";break;case 35673:a.command(r(G)&&4===G.length,"uniform "+x,d.commandStr);g="4i";break;case 35669:a.command(r(G)&&4===G.length,"uniform "+x,d.commandStr),g="4i"}c(k,".uniform",g,"(",l,",",r(G)?Array.prototype.slice.call(G):G,");")}continue}else n=p.append(d,
c)}else{if(!e(H))continue;n=c.def(w.uniforms,"[",u.id(x),"]")}35678===m?c("if(",n,"&&",n,'._reglType==="framebuffer"){',n,"=",n,".color[0];","}"):35680===m&&c("if(",n,"&&",n,'._reglType==="framebufferCube"){',n,"=",n,".color[0];","}");a.optional(function(){function a(b,h){d.assert(c,b,'bad data or missing for uniform "'+x+'".  '+h)}function b(d){a("typeof "+n+'==="'+d+'"',"invalid type, expected "+d)}function h(c,b){a(w.isArrayLike+"("+n+")&&"+n+".length==="+c,"invalid vector, should have length "+
c,d.commandStr)}function e(c){a("typeof "+n+'==="function"&&'+n+'._reglType==="texture'+(3553===c?"2d":"Cube")+'"',"invalid texture type",d.commandStr)}switch(m){case 5124:b("number");break;case 35667:h(2,"number");break;case 35668:h(3,"number");break;case 35669:h(4,"number");break;case 5126:b("number");break;case 35664:h(2,"number");break;case 35665:h(3,"number");break;case 35666:h(4,"number");break;case 35670:b("boolean");break;case 35671:h(2,"boolean");break;case 35672:h(3,"boolean");break;case 35673:h(4,
"boolean");break;case 35674:h(4,"number");break;case 35675:h(9,"number");break;case 35676:h(16,"number");break;case 35678:e(3553);break;case 35680:e(34067)}});p=1;switch(m){case 35678:case 35680:p=c.def(n,"._texture");c(k,".uniform1i(",l,",",p,".bind());");c.exit(p,".unbind();");continue;case 5124:case 35670:g="1i";break;case 35667:case 35671:g="2i";p=2;break;case 35668:case 35672:g="3i";p=3;break;case 35669:case 35673:g="4i";p=4;break;case 5126:g="1f";break;case 35664:g="2f";p=2;break;case 35665:g=
"3f";p=3;break;case 35666:g="4f";p=4;break;case 35674:g="Matrix2fv";break;case 35675:g="Matrix3fv";break;case 35676:g="Matrix4fv"}c(k,".uniform",g,"(",l,",");if("M"===g.charAt(0)){var l=Math.pow(m-35674+2,2),U=d.global.def("new Float32Array(",l,")");c("false,(Array.isArray(",n,")||",n," instanceof Float32Array)?",n,":(",A(l,function(d){return U+"["+d+"]="+n+"["+d+"]"}),",",U,")")}else 1<p?c(A(p,function(d){return n+"["+d+"]"})):c(n);c(");")}}function va(c,b,h,e){function g(d){var a=r[d];return a?
a.contextDep&&e.contextDynamic||a.propDep?a.append(c,h):a.append(c,b):b.def(x,".",d)}function k(){function d(){h(u,".drawElementsInstancedANGLE(",[m,n,C,G+"<<(("+C+"-5121)>>1)",H],");")}function a(){h(u,".drawArraysInstancedANGLE(",[m,G,n,H],");")}p?U?d():(h("if(",p,"){"),d(),h("}else{"),a(),h("}")):a()}function w(){function d(){h(l+".drawElements("+[m,n,C,G+"<<(("+C+"-5121)>>1)"]+");")}function a(){h(l+".drawArrays("+[m,G,n]+");")}p?U?d():(h("if(",p,"){"),d(),h("}else{"),a(),h("}")):a()}var f=c.shared,
l=f.gl,x=f.draw,r=e.draw,p=function(){var d=r.elements,a=b;if(d){if(d.contextDep&&e.contextDynamic||d.propDep)a=h;d=d.append(c,a)}else d=a.def(x,".","elements");d&&a("if("+d+")"+l+".bindBuffer(34963,"+d+".buffer.buffer);");return d}(),m=g("primitive"),G=g("offset"),n=function(){var d=r.count,g,k=b;if(d){if(d.contextDep&&e.contextDynamic||d.propDep)k=h;g=d.append(c,k);a.optional(function(){d.MISSING&&c.assert(b,"false","missing vertex count");d.DYNAMIC&&c.assert(k,g+">=0","missing vertex count")})}else g=
k.def(x,".","count"),a.optional(function(){c.assert(k,g+">=0","missing vertex count")});return g}();if("number"===typeof n){if(0===n)return}else h("if(",n,"){"),h.exit("}");var H,u;d&&(H=g("instances"),u=c.instancing);var C=p+".type",U=r.elements&&v(r.elements);d&&("number"!==typeof H||0<=H)?"string"===typeof H?(h("if(",H,">0){"),k(),h("}else if(",H,"<0){"),w(),h("}")):k():w()}function Ea(c,b,h,e,g){var k=Da();g=k.proc("body",g);a.optional(function(){k.commandStr=b.commandStr;k.command=k.link(b.commandStr)});
d&&(k.instancing=g.def(k.shared.extensions,".angle_instanced_arrays"));c(k,g,h,e);return k.compile().body}function Ga(d,a,c,b){Z(d,a);Aa(d,a,c,b.attributes,function(){return!0});ha(d,a,c,b.uniforms,function(){return!0});va(d,a,a,c)}function Ja(d,a){var c=d.proc("draw",1);Z(d,c);Q(d,c,a.context);ga(d,c,a.framebuffer);V(d,c,a);R(d,c,a.state);fa(d,c,a,!1,!0);var b=a.shader.progVar.append(d,c);c(d.shared.gl,".useProgram(",b,".program);");if(a.shader.program)Ga(d,c,a,a.shader.program);else{var h=d.global.def("{}"),
e=c.def(b,".id"),g=c.def(h,"[",e,"]");c(d.cond(g).then(g,".call(this,a0);")["else"](g,"=",h,"[",e,"]=",d.link(function(c){return Ea(Ga,d,a,c,1)}),"(",b,");",g,".call(this,a0);"))}0<Object.keys(a.state).length&&c(d.shared.current,".dirty=true;")}function Fa(d,a,c,b){function h(){return!0}d.batchId="a1";Z(d,a);Aa(d,a,c,b.attributes,h);ha(d,a,c,b.uniforms,h);va(d,a,a,c)}function Ka(d,a,c,b){function h(d){return d.contextDep&&g||d.propDep}function e(d){return!h(d)}Z(d,a);var g=c.contextDep,k=a.def(),
w=a.def();d.shared.props=w;d.batchId=k;var f=d.scope(),l=d.scope();a(f.entry,"for(",k,"=0;",k,"<","a1",";++",k,"){",w,"=","a0","[",k,"];",l,"}",f.exit);c.needsContext&&Q(d,l,c.context);c.needsFramebuffer&&ga(d,l,c.framebuffer);R(d,l,c.state,h);c.profile&&h(c.profile)&&fa(d,l,c,!1,!0);b?(Aa(d,f,c,b.attributes,e),Aa(d,l,c,b.attributes,h),ha(d,f,c,b.uniforms,e),ha(d,l,c,b.uniforms,h),va(d,f,l,c)):(a=d.global.def("{}"),b=c.shader.progVar.append(d,l),w=l.def(b,".id"),f=l.def(a,"[",w,"]"),l(d.shared.gl,
".useProgram(",b,".program);","if(!",f,"){",f,"=",a,"[",w,"]=",d.link(function(a){return Ea(Fa,d,c,a,2)}),"(",b,");}",f,".call(this,a0[",k,"],",k,");"))}function La(d,a){function c(d){return d.contextDep&&h||d.propDep}var b=d.proc("batch",2);d.batchId="0";Z(d,b);var h=!1,e=!0;Object.keys(a.context).forEach(function(d){h=h||a.context[d].propDep});h||(Q(d,b,a.context),e=!1);var g=a.framebuffer,k=!1;g?(g.propDep?h=k=!0:g.contextDep&&h&&(k=!0),k||ga(d,b,g)):ga(d,b,null);a.state.viewport&&a.state.viewport.propDep&&
(h=!0);V(d,b,a);R(d,b,a.state,function(d){return!c(d)});a.profile&&c(a.profile)||fa(d,b,a,!1,"a1");a.contextDep=h;a.needsContext=e;a.needsFramebuffer=k;e=a.shader.progVar;if(e.contextDep&&h||e.propDep)Ka(d,b,a,null);else if(e=e.append(d,b),b(d.shared.gl,".useProgram(",e,".program);"),a.shader.program)Ka(d,b,a,a.shader.program);else{var g=d.global.def("{}"),k=b.def(e,".id"),w=b.def(g,"[",k,"]");b(d.cond(w).then(w,".call(this,a0,a1);")["else"](w,"=",g,"[",k,"]=",d.link(function(c){return Ea(Ka,d,a,
c,2)}),"(",e,");",w,".call(this,a0,a1);"))}0<Object.keys(a.state).length&&b(d.shared.current,".dirty=true;")}function Ma(d,a){function c(e){var g=a.shader[e];g&&b.set(h.shader,"."+e,g.append(d,b))}var b=d.proc("scope",3);d.batchId="a2";var h=d.shared,e=h.current;Q(d,b,a.context);a.framebuffer&&a.framebuffer.append(d,b);g(Object.keys(a.state)).forEach(function(c){var e=a.state[c].append(d,b);r(e)?e.forEach(function(a,h){b.set(d.next[c],"["+h+"]",a)}):b.set(h.next,"."+c,e)});fa(d,b,a,!0,!0);["elements",
"offset","count","instances","primitive"].forEach(function(c){var e=a.draw[c];e&&b.set(h.draw,"."+c,""+e.append(d,b))});Object.keys(a.uniforms).forEach(function(c){b.set(h.uniforms,"["+u.id(c)+"]",a.uniforms[c].append(d,b))});Object.keys(a.attributes).forEach(function(c){var h=a.attributes[c].append(d,b),e=d.scopeAttrib(c);Object.keys(new ta).forEach(function(d){b.set(e,"."+d,h[d])})});c("vert");c("frag");0<Object.keys(a.state).length&&(b(e,".dirty=true;"),b.exit(e,".dirty=true;"));b("a1(",d.shared.context,
",a0,",d.batchId,");")}function Oa(d){if("object"===typeof d&&!r(d)){for(var a=Object.keys(d),c=0;c<a.length;++c)if(M.isDynamic(d[a[c]]))return!0;return!1}}function wa(d,a,c){function b(d,a){g.forEach(function(c){var b=h[c];M.isDynamic(b)&&(b=d.invoke(a,b),a(x,".",c,"=",b,";"))})}var h=a["static"][c];if(h&&Oa(h)){var e=d.global,g=Object.keys(h),k=!1,w=!1,f=!1,x=d.global.def("{}");g.forEach(function(a){var c=h[a];if(M.isDynamic(c))"function"===typeof c&&(c=h[a]=M.unbox(c)),a=l(c,null),k=k||a.thisDep,
f=f||a.propDep,w=w||a.contextDep;else{e(x,".",a,"=");switch(typeof c){case "number":e(c);break;case "string":e('"',c,'"');break;case "object":Array.isArray(c)&&e("[",c.join(),"]");break;default:e(d.link(c))}e(";")}});a.dynamic[c]=new M.DynamicVariable(4,{thisDep:k,contextDep:w,propDep:f,ref:x,append:b});delete a["static"][c]}}var ta=U.Record,da={add:32774,subtract:32778,"reverse subtract":32779};q.ext_blend_minmax&&(da.min=32775,da.max=32776);var d=q.angle_instanced_arrays,x=q.webgl_draw_buffers,
w={dirty:!0,profile:xa.profile},G={},Ha=[],Ba={},Ca={};T("dither",3024);T("blend.enable",3042);O("blend.color","blendColor",[0,0,0,0]);O("blend.equation","blendEquationSeparate",[32774,32774]);O("blend.func","blendFuncSeparate",[1,0,1,0]);T("depth.enable",2929,!0);O("depth.func","depthFunc",513);O("depth.range","depthRange",[0,1]);O("depth.mask","depthMask",!0);O("colorMask","colorMask",[!0,!0,!0,!0]);T("cull.enable",2884);O("cull.face","cullFace",1029);O("frontFace","frontFace",2305);O("lineWidth",
"lineWidth",1);T("polygonOffset.enable",32823);O("polygonOffset.offset","polygonOffset",[0,0]);T("sample.alpha",32926);T("sample.enable",32928);O("sample.coverage","sampleCoverage",[1,!1]);T("stencil.enable",2960);O("stencil.mask","stencilMask",-1);O("stencil.func","stencilFunc",[519,0,-1]);O("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);O("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);T("scissor.enable",3089);O("scissor.box","scissor",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);
O("viewport","viewport",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);var Na={gl:f,context:la,strings:u,next:G,current:w,draw:sa,elements:z,buffer:S,shader:I,attributes:U.state,uniforms:Y,framebuffer:ea,extensions:q,timer:pa,isBufferArgs:e},Ia={primTypes:y,compareFuncs:N,blendFuncs:p,blendEquations:da,stencilOps:C,glTypes:F,orientationType:h};a.optional(function(){Na.isArrayLike=r});x&&(Ia.backBuffer=[1029],Ia.drawBuffer=A(B.maxDrawbuffers,function(d){return 0===d?[0]:A(d,function(d){return 36064+
d})}));var Qa=0;return{next:G,current:w,procs:function(){var d=Da(),a=d.proc("poll"),c=d.proc("refresh"),b=d.block();a(b);c(b);var h=d.shared,e=h.gl,g=h.next,k=h.current;b(k,".dirty=false;");ga(d,a);ga(d,c,null,!0);var l=f.getExtension("angle_instanced_arrays"),x;l&&(x=d.link(l));for(var p=0;p<B.maxAttributes;++p){var m=c.def(h.attributes,"[",p,"]"),n=d.cond(m,".buffer");n.then(e,".enableVertexAttribArray(",p,");",e,".bindBuffer(",34962,",",m,".buffer.buffer);",e,".vertexAttribPointer(",p,",",m,".size,",
m,".type,",m,".normalized,",m,".stride,",m,".offset);")["else"](e,".disableVertexAttribArray(",p,");",e,".vertexAttrib4f(",p,",",m,".x,",m,".y,",m,".z,",m,".w);",m,".buffer=null;");c(n);l&&c(x,".vertexAttribDivisorANGLE(",p,",",m,".divisor);")}Object.keys(Ba).forEach(function(h){var w=Ba[h],f=b.def(g,".",h),l=d.block();l("if(",f,"){",e,".enable(",w,")}else{",e,".disable(",w,")}",k,".",h,"=",f,";");c(l);a("if(",f,"!==",k,".",h,"){",l,"}")});Object.keys(Ca).forEach(function(h){var f=Ca[h],l=w[h],x,
m,p=d.block();p(e,".",f,"(");r(l)?(f=l.length,x=d.global.def(g,".",h),m=d.global.def(k,".",h),p(A(f,function(d){return x+"["+d+"]"}),");",A(f,function(d){return m+"["+d+"]="+x+"["+d+"];"}).join("")),a("if(",A(f,function(d){return x+"["+d+"]!=="+m+"["+d+"]"}).join("||"),"){",p,"}")):(x=b.def(g,".",h),m=b.def(k,".",h),p(x,");",k,".",h,"=",x,";"),a("if(",x,"!==",m,"){",p,"}"));c(p)});return d.compile()}(),compile:function(d,a,c,b,h){var e=Da();e.stats=e.link(h);Object.keys(a["static"]).forEach(function(d){wa(e,
a,d)});m.forEach(function(a){wa(e,d,a)});c=X(d,a,c,b,e);Ja(e,c);Ma(e,c);La(e,c);return e.compile()}}}},{"./constants/dtypes.json":5,"./constants/primitives.json":6,"./dynamic":9,"./util/check":21,"./util/codegen":23,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/loop":29}],9:[function(f,q,z){function e(b,e){this.id=v++;this.type=b;this.data=e}function g(b){if(0===b.length)return[];var e=b.charAt(0),a=b.charAt(b.length-1);if(1<b.length&&e===a&&('"'===e||"'"===e))return['"'+
b.substr(1,b.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(e=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(b))return g(b.substr(0,e.index)).concat(g(e[1])).concat(g(b.substr(e.index+e[0].length)));e=b.split(".");if(1===e.length)return['"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];b=[];for(a=0;a<e.length;++a)b=b.concat(g(e[a]));return b}function k(b){return"["+g(b).join("][")+"]"}var v=0;q.exports={DynamicVariable:e,define:function(b,g){return new e(b,k(g+""))},isDynamic:function(b){return"function"===
typeof b&&!b._reglType||b instanceof e},unbox:function(b,g){return"function"===typeof b?new e(0,b):b},accessor:k}},{}],10:[function(f,q,z){var e=f("./util/check"),g=f("./util/is-typed-array"),k=f("./util/is-ndarray"),v=f("./util/values"),b=f("./constants/primitives.json"),l=f("./constants/usage.json");q.exports=function(a,f,A,B){function u(a){this.id=F++;y[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function r(b,l,m,r,c,h,v){b.buffer.bind();if(l){var u=v;v||g(l)&&(!k(l)||
g(l.data))||(u=f.oes_element_index_uint?5125:5123);A._initBuffer(b.buffer,l,m,u,3)}else a.bufferData(34963,h,m),b.buffer.dtype=u||5121,b.buffer.usage=m,b.buffer.dimension=3,b.buffer.byteLength=h;u=v;if(!v){switch(b.buffer.dtype){case 5121:case 5120:u=5121;break;case 5123:case 5122:u=5123;break;case 5125:case 5124:u=5125;break;default:e.raise("unsupported type for element array")}b.buffer.dtype=u}b.type=u;e(5125!==u||!!f.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");
l=c;0>l&&(l=b.buffer.byteLength,5123===u?l>>=1:5125===u&&(l>>=2));b.vertCount=l;l=r;0>r&&(l=4,r=b.buffer.dimension,1===r&&(l=0),2===r&&(l=1),3===r&&(l=4));b.primType=l}function q(a){B.elementsCount--;e(null!==a.buffer,"must not double destroy elements");delete y[a.id];a.buffer.destroy();a.buffer=null}var y={},F=0,K={uint8:5121,uint16:5123};f.oes_element_index_uint&&(K.uint32=5125);u.prototype.bind=function(){this.buffer.bind()};var m=[];return{create:function(a,f){function m(a){if(a)if("number"===
typeof a)n(a),c.primType=4,c.vertCount=a|0,c.type=5121;else{var f=null,p=35044,v=-1,u=-1,A=0,q=0;if(Array.isArray(a)||g(a)||k(a))f=a;else if(e.type(a,"object","invalid arguments for elements"),"data"in a&&(f=a.data,e(Array.isArray(f)||g(f)||k(f),"invalid data for element buffer")),"usage"in a&&(e.parameter(a.usage,l,"invalid element buffer usage"),p=l[a.usage]),"primitive"in a&&(e.parameter(a.primitive,b,"invalid element buffer primitive"),v=b[a.primitive]),"count"in a&&(e("number"===typeof a.count&&
0<=a.count,"invalid vertex count for elements"),u=a.count|0),"type"in a&&(e.parameter(a.type,K,"invalid buffer type"),q=K[a.type]),"length"in a)A=a.length|0;else if(A=u,5123===q||5122===q)A*=2;else if(5125===q||5124===q)A*=4;r(c,f,p,v,u,A,q)}else n(),c.primType=4,c.vertCount=0,c.type=5121;return m}var n=A.create(null,34963,!0),c=new u(n._buffer);B.elementsCount++;m(a);m._reglType="elements";m._elements=c;m.subdata=function(a,c){n.subdata(a,c);return m};m.destroy=function(){q(c)};return m},createStream:function(a){var b=
m.pop();b||(b=new u(A.create(null,34963,!0,!1)._buffer));r(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){m.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof u?a._elements:null},clear:function(){v(y).forEach(q)}}}},{"./constants/primitives.json":6,"./constants/usage.json":7,"./util/check":21,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/values":33}],11:[function(f,q,z){var e=f("./util/check");q.exports=function(g,k){function f(a){e.type(a,"string",
"extension name must be string");a=a.toLowerCase();var k;try{k=b[a]=g.getExtension(a)}catch(l){}return!!k}for(var b={},l=0;l<k.extensions.length;++l){var a=k.extensions[l];if(!f(a))return k.onDestroy(),k.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}k.optionalExtensions.forEach(f);return{extensions:b,restore:function(){Object.keys(b).forEach(function(a){if(!f(a))throw Error("(regl): error restoring extension "+a);})}}}},
{"./util/check":21}],12:[function(f,q,z){var e=f("./util/check"),g=f("./util/values"),k=f("./util/extend"),v=[6408],b=[];b[6408]=4;var l=[];l[5121]=1;l[5126]=4;l[36193]=2;var a=[32854,32855,36194,35907,34842,34843,34836],n={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"};q.exports=function(f,q,u,r,M,y){function F(a,c,b){this.target=a;this.texture=c;this.renderbuffer=b;var e=a=0;c?(a=c.width,e=c.height):b&&(a=
b.width,e=b.height);this.width=a;this.height=e}function K(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function m(a,c,b){if(a){if(a.texture){a=a.texture._texture;var h=Math.max(1,a.height);e(Math.max(1,a.width)===c&&h===b,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,e(a.width===c&&a.height===b,"inconsistent width/height for renderbuffer");a.refCount+=1}}function p(a,c){c&&(c.texture?f.framebufferTexture2D(36160,
a,c.target,c.texture._texture.texture,0):f.framebufferRenderbuffer(36160,a,36161,c.renderbuffer._renderbuffer.renderbuffer))}function L(a){var c=3553,b=null,h=null,g=a;"object"===typeof a&&(g=a.data,"target"in a&&(c=a.target|0));e.type(g,"function","invalid attachment data");a=g._reglType;"texture2d"===a?(b=g,e(3553===c)):"textureCube"===a?(b=g,e(34069<=c&&34075>c,"invalid cube map target")):"renderbuffer"===a?(h=g,c=36161):e.raise("invalid regl object for attachment");return new F(c,b,h)}function N(a,
c,b,e,h){if(b)return a=r.create2D({width:a,height:c,format:e,type:h}),a._texture.refCount=0,new F(3553,a,null);a=M.create({width:a,height:c,format:e});a._renderbuffer.refCount=0;return new F(36161,null,a)}function C(a){return a&&(a.texture||a.renderbuffer)}function c(a,c,b){a&&(a.texture?a.texture.resize(c,b):a.renderbuffer&&a.renderbuffer.resize(c,b))}function h(){this.id=ea++;Y[this.id]=this;this.framebuffer=f.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=
this.stencilAttachment=this.depthAttachment=null}function H(a){a.colorAttachments.forEach(K);K(a.depthAttachment);K(a.stencilAttachment);K(a.depthStencilAttachment)}function W(a){var c=a.framebuffer;e(c,"must not double destroy framebuffer");f.deleteFramebuffer(c);a.framebuffer=null;y.framebufferCount--;delete Y[a.id]}function z(a){var c;f.bindFramebuffer(36160,a.framebuffer);var b=a.colorAttachments;for(c=0;c<b.length;++c)p(36064+c,b[c]);for(c=b.length;c<u.maxColorAttachments;++c)f.framebufferTexture2D(36160,
36064+c,3553,null,0);f.framebufferTexture2D(36160,33306,3553,null,0);f.framebufferTexture2D(36160,36096,3553,null,0);f.framebufferTexture2D(36160,36128,3553,null,0);p(36096,a.depthAttachment);p(36128,a.stencilAttachment);p(33306,a.depthStencilAttachment);a=f.checkFramebufferStatus(36160);36053!==a&&e.raise("framebuffer configuration not supported, status = "+n[a]);f.bindFramebuffer(36160,ka.next);ka.cur=ka.next;f.getError()}function ra(g,f){function r(c,h){var g;e(ka.next!==p,"can not update framebuffer which is currently in use");
var k=q.webgl_draw_buffers,f=0,n=0,A=!0,F=!0;g=null;var y=!0,M="rgba",W="uint8",K=1,I=null,U=null,ra=null,ea=!1;if("number"===typeof c)f=c|0,n=h|0||f;else if(c){e.type(c,"object","invalid arguments for framebuffer");"shape"in c?(n=c.shape,e(Array.isArray(n)&&2<=n.length,"invalid shape for framebuffer"),f=n[0],n=n[1]):("radius"in c&&(f=n=c.radius),"width"in c&&(f=c.width),"height"in c&&(n=c.height));if("color"in c||"colors"in c)g=c.color||c.colors,Array.isArray(g)&&e(1===g.length||k,"multiple render targets not supported");
if(!g){"colorCount"in c&&(K=c.colorCount|0,e(0<K,"invalid color buffer count"));"colorTexture"in c&&(y=!!c.colorTexture,M="rgba4");if("colorType"in c){W=c.colorType;if(y)e(q.oes_texture_float||!("float"===W||"float32"===W),"you must enable OES_texture_float in order to use floating point framebuffer objects"),e(q.oes_texture_half_float||!("half float"===W||"float16"===W),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===W||"float16"===
W)e(q.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),M="rgba16f";else if("float"===W||"float32"===W)e(q.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),M="rgba32f";e.oneOf(W,J,"invalid color type")}if("colorFormat"in c)if(M=c.colorFormat,0<=S.indexOf(M))y=!0;else if(0<=ia.indexOf(M))y=!1;else if(y)e.oneOf(c.colorFormat,S,"invalid color format for texture");else e.oneOf(c.colorFormat,
ia,"invalid color format for renderbuffer")}if("depthTexture"in c||"depthStencilTexture"in c)ea=!(!c.depthTexture&&!c.depthStencilTexture),e(!ea||q.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in c&&("boolean"===typeof c.depth?A=c.depth:(I=c.depth,F=!1));"stencil"in c&&("boolean"===typeof c.stencil?F=c.stencil:(U=c.stencil,A=!1));"depthStencil"in c&&("boolean"===typeof c.depthStencil?A=F=c.depthStencil:(ra=c.depthStencil,F=A=!1))}else f=n=1;var Q=k=null,Y=null,V=null;
if(Array.isArray(g))k=g.map(L);else if(g)k=[L(g)];else for(k=Array(K),g=0;g<K;++g)k[g]=N(f,n,y,M,W);e(q.webgl_draw_buffers||1>=k.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");e(k.length<=u.maxColorAttachments,"too many color attachments, not supported");f=f||k[0].width;n=n||k[0].height;I?Q=L(I):A&&!F&&(Q=N(f,n,ea,"depth","uint32"));U?Y=L(U):F&&!A&&(Y=N(f,n,!1,"stencil","uint8"));ra?V=L(ra):!I&&!U&&F&&A&&(V=N(f,n,ea,"depth stencil","depth stencil"));
e(1>=!!I+!!U+!!ra,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");A=null;for(g=0;g<k.length;++g)m(k[g],f,n),e(!k[g]||k[g].texture&&0<=v.indexOf(k[g].texture._texture.format)||k[g].renderbuffer&&0<=a.indexOf(k[g].renderbuffer._renderbuffer.format),"framebuffer color attachment "+g+" is invalid"),k[g]&&k[g].texture&&(F=b[k[g].texture._texture.format]*l[k[g].texture._texture.type],null===A?A=F:e(A===F,"all color attachments much have the same number of bits per pixel."));
m(Q,f,n);e(!Q||Q.texture&&6402===Q.texture._texture.format||Q.renderbuffer&&33189===Q.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");m(Y,f,n);e(!Y||Y.renderbuffer&&36168===Y.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");m(V,f,n);e(!V||V.texture&&34041===V.texture._texture.format||V.renderbuffer&&34041===V.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");H(p);p.width=f;p.height=
n;p.colorAttachments=k;p.depthAttachment=Q;p.stencilAttachment=Y;p.depthStencilAttachment=V;r.color=k.map(C);r.depth=C(Q);r.stencil=C(Y);r.depthStencil=C(V);r.width=p.width;r.height=p.height;z(p);return r}var p=new h;y.framebufferCount++;r(g,f);return k(r,{resize:function(a,b){e(ka.next!==p,"can not resize a framebuffer which is currently in use");var h=a|0,g=b|0||h;if(h===p.width&&g===p.height)return r;for(var k=p.colorAttachments,f=0;f<k.length;++f)c(k[f],h,g);c(p.depthAttachment,h,g);c(p.stencilAttachment,
h,g);c(p.depthStencilAttachment,h,g);p.width=r.width=h;p.height=r.height=g;z(p);return r},_reglType:"framebuffer",_framebuffer:p,destroy:function(){W(p);H(p)},bind:function(a){ka.setFBO({framebuffer:r},a)}})}var ka={cur:null,next:null,dirty:!1,setFBO:null},S=["rgba"],ia=["rgba4","rgb565","rgb5 a1"];q.ext_srgb&&ia.push("srgba");q.ext_color_buffer_half_float&&ia.push("rgba16f","rgb16f");q.webgl_color_buffer_float&&ia.push("rgba32f");var J=["uint8"];q.oes_texture_half_float&&J.push("half float","float16");
q.oes_texture_float&&J.push("float","float32");var ea=0,Y={};return k(ka,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof h)?a:null},create:ra,createCube:function(a){function c(a){var h;e(0>b.indexOf(ka.next),"can not update framebuffer which is currently in use");var g=q.webgl_draw_buffers,f={color:null},l=0,m=null;h="rgba";var p="uint8",n=1;if("number"===typeof a)l=a|0;else if(a){e.type(a,"object","invalid arguments for framebuffer");
"shape"in a?(l=a.shape,e(Array.isArray(l)&&2<=l.length,"invalid shape for framebuffer"),e(l[0]===l[1],"cube framebuffer must be square"),l=l[0]):("radius"in a&&(l=a.radius|0),"width"in a?(l=a.width|0,"height"in a&&e(a.height===l,"must be square")):"height"in a&&(l=a.height|0));if("color"in a||"colors"in a)m=a.color||a.colors,Array.isArray(m)&&e(1===m.length||g,"multiple render targets not supported");m||("colorCount"in a&&(n=a.colorCount|0,e(0<n,"invalid color buffer count")),"colorType"in a&&(e.oneOf(a.colorType,
J,"invalid color type"),p=a.colorType),"colorFormat"in a&&(h=a.colorFormat,e.oneOf(a.colorFormat,S,"invalid color format for texture")));"depth"in a&&(f.depth=a.depth);"stencil"in a&&(f.stencil=a.stencil);"depthStencil"in a&&(f.depthStencil=a.depthStencil)}else l=1;if(m)if(Array.isArray(m))for(a=[],h=0;h<m.length;++h)a[h]=m[h];else a=[m];else for(a=Array(n),m={radius:l,format:h,type:p},h=0;h<n;++h)a[h]=r.createCube(m);f.color=Array(a.length);for(h=0;h<a.length;++h)n=a[h],e("function"===typeof n&&
"textureCube"===n._reglType,"invalid cube map"),l=l||n.width,e(n.width===l&&n.height===l,"invalid cube map shape"),f.color[h]={target:34069,data:a[h]};for(h=0;6>h;++h){for(n=0;n<a.length;++n)f.color[n].target=34069+h;0<h&&(f.depth=b[0].depth,f.stencil=b[0].stencil,f.depthStencil=b[0].depthStencil);if(b[h])b[h](f);else b[h]=ra(f)}return k(c,{width:l,height:l,color:a})}var b=Array(6);c(a);return k(c,{faces:b,resize:function(a){var h=a|0;e(0<h&&h<=u.maxCubeMapSize,"invalid radius for cube fbo");if(h===
c.width)return c;var g=c.color;for(a=0;a<g.length;++a)g[a].resize(h);for(a=0;6>a;++a)b[a].resize(h);c.width=c.height=h;return c},_reglType:"framebufferCube",destroy:function(){b.forEach(function(a){a.destroy()})}})},clear:function(){g(Y).forEach(W)},restore:function(){g(Y).forEach(function(a){a.framebuffer=f.createFramebuffer();z(a)})}})}},{"./util/check":21,"./util/extend":24,"./util/values":33}],13:[function(f,q,z){q.exports=function(e,g){var k=1;g.ext_texture_filter_anisotropic&&(k=e.getParameter(34047));
var f=1,b=1;g.webgl_draw_buffers&&(f=e.getParameter(34852),b=e.getParameter(36063));return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(g).filter(function(b){return!!g[b]}),maxAnisotropic:k,maxDrawbuffers:f,maxColorAttachments:b,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),
maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938)}}},
{}],14:[function(f,q,z){var e=f("./util/check"),g=f("./util/is-typed-array");q.exports=function(f,v,b,l,a,n){function q(u){var r;null===v.next?(e(a.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),r=5121):(e(null!==v.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),r=v.next.colorAttachments[0].texture._texture.type,n.oes_texture_float?e(5121===r||5126===r,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):
e(5121===r,"Reading from a framebuffer is only allowed for the type 'uint8'"));var A=0,y=0,F=l.framebufferWidth,B=l.framebufferHeight,m=null;g(u)?m=u:u&&(e.type(u,"object","invalid arguments to regl.read()"),A=u.x|0,y=u.y|0,e(0<=A&&A<l.framebufferWidth,"invalid x offset for regl.read"),e(0<=y&&y<l.framebufferHeight,"invalid y offset for regl.read"),F=(u.width||l.framebufferWidth-A)|0,B=(u.height||l.framebufferHeight-y)|0,m=u.data||null);m&&(5121===r?e(m instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):
5126===r&&e(m instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));e(0<F&&F+A<=l.framebufferWidth,"invalid width for read pixels");e(0<B&&B+y<=l.framebufferHeight,"invalid height for read pixels");b();u=F*B*4;m||(5121===r?m=new Uint8Array(u):5126===r&&(m=m||new Float32Array(u)));e.isTypedArray(m,"data buffer for regl.read() must be a typedarray");e(m.byteLength>=u,"data buffer for regl.read() too small");f.pixelStorei(3333,4);f.readPixels(A,y,F,
B,6408,r,m);return m}function B(a){var b;v.setFBO({framebuffer:a.framebuffer},function(){b=q(a)});return b}return function(a){return a&&"framebuffer"in a?B(a):q(a)}}},{"./util/check":21,"./util/is-typed-array":28}],15:[function(f,q,z){var e=f("./util/check"),g=f("./util/values"),k=[];k[32854]=2;k[32855]=2;k[36194]=2;k[33189]=2;k[36168]=1;k[34041]=4;k[35907]=4;k[34836]=16;k[34842]=8;k[34843]=6;q.exports=function(f,b,l,a,n){function q(a){this.id=M++;this.refCount=1;this.renderbuffer=a;this.format=32854;
this.height=this.width=0;n.profile&&(this.stats={size:0})}function B(b){var g=b.renderbuffer;e(g,"must not double destroy renderbuffer");f.bindRenderbuffer(36161,null);f.deleteRenderbuffer(g);b.renderbuffer=null;b.refCount=0;delete y[b.id];a.renderbufferCount--}var u={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(u.srgba=35907);b.ext_color_buffer_half_float&&(u.rgba16f=34842,u.rgb16f=34843);b.webgl_color_buffer_float&&(u.rgba32f=34836);var r=
[];Object.keys(u).forEach(function(a){r[u[a]]=a});var M=0,y={};q.prototype.decRef=function(){0>=--this.refCount&&B(this)};n.profile&&(a.getTotalRenderbufferSize=function(){var a=0;Object.keys(y).forEach(function(b){a+=y[b].stats.size});return a});return{create:function(b,g){function m(a,b){var g=0,c=0,h=32854;"object"===typeof a&&a?("shape"in a?(c=a.shape,e(Array.isArray(c)&&2<=c.length,"invalid renderbuffer shape"),g=c[0]|0,c=c[1]|0):("radius"in a&&(g=c=a.radius|0),"width"in a&&(g=a.width|0),"height"in
a&&(c=a.height|0)),"format"in a&&(e.parameter(a.format,u,"invalid renderbuffer format"),h=u[a.format])):"number"===typeof a?(g=a|0,c="number"===typeof b?b|0:g):a?e.raise("invalid arguments to renderbuffer constructor"):g=c=1;e(0<g&&0<c&&g<=l.maxRenderbufferSize&&c<=l.maxRenderbufferSize,"invalid renderbuffer size");if(g!==p.width||c!==p.height||h!==p.format)return m.width=p.width=g,m.height=p.height=c,p.format=h,f.bindRenderbuffer(36161,p.renderbuffer),f.renderbufferStorage(36161,h,g,c),n.profile&&
(p.stats.size=k[p.format]*p.width*p.height),m.format=r[p.format],m}var p=new q(f.createRenderbuffer());y[p.id]=p;a.renderbufferCount++;m(b,g);m.resize=function(a,b){var g=a|0,c=b|0||g;if(g===p.width&&c===p.height)return m;e(0<g&&0<c&&g<=l.maxRenderbufferSize&&c<=l.maxRenderbufferSize,"invalid renderbuffer size");m.width=p.width=g;m.height=p.height=c;f.bindRenderbuffer(36161,p.renderbuffer);f.renderbufferStorage(36161,p.format,g,c);n.profile&&(p.stats.size=k[p.format]*p.width*p.height);return m};m._reglType=
"renderbuffer";m._renderbuffer=p;n.profile&&(m.stats=p.stats);m.destroy=function(){p.decRef()};return m},clear:function(){g(y).forEach(B)},restore:function(){g(y).forEach(function(a){a.renderbuffer=f.createRenderbuffer();f.bindRenderbuffer(36161,a.renderbuffer);f.renderbufferStorage(36161,a.format,a.width,a.height)});f.bindRenderbuffer(36161,null)}}}},{"./util/check":21,"./util/values":33}],16:[function(f,q,z){var e=f("./util/check"),g=f("./util/values");q.exports=function(f,v,b,l){function a(a,b,
e,g){this.name=a;this.id=b;this.location=e;this.info=g}function n(a,b){for(var e=0;e<a.length;++e)if(a[e].id===b.id){a[e].location=b.location;return}a.push(b)}function q(a,b,g){var l=35632===a?r:M,n=l[b];if(!n){var c=v.str(b),n=f.createShader(a);f.shaderSource(n,c);f.compileShader(n);e.shaderError(f,n,c,a,g);l[b]=n}return n}function B(a,b){this.id=z++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];l.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function u(b,
g){var r,u;r=q(35632,b.fragId);u=q(35633,b.vertId);var y=b.program=f.createProgram();f.attachShader(y,r);f.attachShader(y,u);f.linkProgram(y);e.linkError(f,y,v.str(b.fragId),v.str(b.vertId),g);var c=f.getProgramParameter(y,35718);l.profile&&(b.stats.uniformsCount=c);var h=b.uniforms;for(r=0;r<c;++r)if(u=f.getActiveUniform(y,r))if(1<u.size)for(var H=0;H<u.size;++H){var W=u.name.replace("[0]","["+H+"]");n(h,new a(W,v.id(W),f.getUniformLocation(y,W),u))}else n(h,new a(u.name,v.id(u.name),f.getUniformLocation(y,
u.name),u));c=f.getProgramParameter(y,35721);l.profile&&(b.stats.attributesCount=c);h=b.attributes;for(r=0;r<c;++r)(u=f.getActiveAttrib(y,r))&&n(h,new a(u.name,v.id(u.name),f.getAttribLocation(y,u.name),u))}var r={},M={},y={},F=[],z=0;l.profile&&(b.getMaxUniformsCount=function(){var a=0;F.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)});return a},b.getMaxAttributesCount=function(){var a=0;F.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});
return{clear:function(){var a=f.deleteShader.bind(f);g(r).forEach(a);r={};g(M).forEach(a);M={};F.forEach(function(a){f.deleteProgram(a.program)});F.length=0;y={};b.shaderCount=0},program:function(a,g,f){e.command(0<=a,"missing vertex shader",f);e.command(0<=g,"missing fragment shader",f);var k=y[g];k||(k=y[g]={});var l=k[a];l||(l=new B(g,a),b.shaderCount++,u(l,f),k[a]=l,F.push(l));return l},restore:function(){r={};M={};for(var a=0;a<F.length;++a)u(F[a])},shader:q,frag:-1,vert:-1}}},{"./util/check":21,
"./util/values":33}],17:[function(f,q,z){q.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],18:[function(f,q,z){q.exports=function(){var e={"":0},g=[""];return{id:function(f){var v=e[f];if(v)return v;v=e[f]=g.length;g.push(f);return v},str:function(e){return g[e]}}}},{}],19:[function(f,q,z){function e(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function g(a){return Array.isArray(a)&&
0!==a.length&&y(a[0])?!0:!1}function k(a){return Object.prototype.toString.call(a)}function v(a){if(!a)return!1;var c=k(a);return 0<=N.indexOf(c)?!0:e(a)||g(a)||u(a)}function b(a,c){36193===a.type?(a.data=M(c),r.freeType(c)):a.data=c}function l(a,b,e,g,f,k){a="undefined"!==typeof c[a]?c[a]:L[a]*C[b];k&&(a*=6);if(f){for(g=0;1<=e;)g+=a*e*e,e/=2;return g}return a*e*g}var a=f("./util/check"),n=f("./util/extend"),A=f("./util/values"),B=f("./util/is-typed-array"),u=f("./util/is-ndarray"),r=f("./util/pool"),
M=f("./util/to-half-float"),y=f("./util/is-array-like"),F=f("./util/flatten");z=f("./constants/arraytypes.json");var K=f("./constants/arraytypes.json"),m=[9984,9986,9985,9987],p=[0,6409,6410,6407,6408],L={};L[6409]=L[6406]=L[6402]=1;L[34041]=L[6410]=2;L[6407]=L[35904]=3;L[6408]=L[35906]=4;var N=Object.keys(z).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),C=[];C[5121]=1;C[5126]=4;C[36193]=2;C[5123]=2;C[5125]=4;var c=
[];c[32854]=2;c[32855]=2;c[36194]=2;c[34041]=4;c[33776]=.5;c[33777]=.5;c[33778]=1;c[33779]=1;c[35986]=.5;c[35987]=1;c[34798]=1;c[35840]=.5;c[35841]=.25;c[35842]=.5;c[35843]=.25;c[36196]=.5;q.exports=function(c,f,q,C,z,N,S){function ia(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function J(a,c){a.internalformat=c.internalformat;a.format=c.format;a.type=c.type;
a.compressed=c.compressed;a.premultiplyAlpha=c.premultiplyAlpha;a.flipY=c.flipY;a.unpackAlignment=c.unpackAlignment;a.colorSpace=c.colorSpace;a.width=c.width;a.height=c.height;a.channels=c.channels}function ea(d,c){if("object"===typeof c&&c){"premultiplyAlpha"in c&&(a.type(c.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),d.premultiplyAlpha=c.premultiplyAlpha);"flipY"in c&&(a.type(c.flipY,"boolean","invalid texture flip"),d.flipY=c.flipY);"alignment"in c&&(a.oneOf(c.alignment,[1,2,4,8],"invalid texture unpack alignment"),
d.unpackAlignment=c.alignment);"colorSpace"in c&&(a.parameter(c.colorSpace,V,"invalid colorSpace"),d.colorSpace=V[c.colorSpace]);if("type"in c){var b=c.type;a(f.oes_texture_float||!("float"===b||"float32"===b),"you must enable the OES_texture_float extension in order to use floating point textures.");a(f.oes_texture_half_float||!("half float"===b||"float16"===b),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");a(f.webgl_depth_texture||!("uint16"===
b||"uint32"===b||"depth stencil"===b),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");a.parameter(b,R,"invalid texture type");d.type=R[b]}var e=d.width,g=d.height,h=d.channels,b=!1;"shape"in c?(a(Array.isArray(c.shape)&&2<=c.shape.length,"shape must be an array"),e=c.shape[0],g=c.shape[1],3===c.shape.length&&(h=c.shape[2],a(0<h&&4>=h,"invalid number of channels"),b=!0),a(0<=e&&e<=q.maxTextureSize,"invalid width"),a(0<=g&&g<=q.maxTextureSize,"invalid height")):
("radius"in c&&(e=g=c.radius,a(0<=e&&e<=q.maxTextureSize,"invalid radius")),"width"in c&&(e=c.width,a(0<=e&&e<=q.maxTextureSize,"invalid width")),"height"in c&&(g=c.height,a(0<=g&&g<=q.maxTextureSize,"invalid height")),"channels"in c&&(h=c.channels,a(0<h&&4>=h,"invalid number of channels"),b=!0));d.width=e|0;d.height=g|0;d.channels=h|0;e=!1;"format"in c&&(e=c.format,a(f.webgl_depth_texture||!("depth"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),
a.parameter(e,Z,"invalid texture format"),g=d.internalformat=Z[e],d.format=Ka[g],e in R&&!("type"in c)&&(d.type=R[e]),e in fa&&(d.compressed=!0),e=!0);!b&&e?d.channels=L[d.format]:b&&!e?d.channels!==p[d.format]&&(d.format=d.internalformat=p[d.channels]):e&&b&&a(d.channels===L[d.format],"number of channels inconsistent with specified format")}}function Y(a){c.pixelStorei(37440,a.flipY);c.pixelStorei(37441,a.premultiplyAlpha);c.pixelStorei(37443,a.colorSpace);c.pixelStorei(3317,a.unpackAlignment)}function U(){ia.call(this);
this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function I(d,c){var h=null;v(c)?h=c:c&&(a.type(c,"object","invalid pixel data type"),ea(d,c),"x"in c&&(d.xOffset=c.x|0),"y"in c&&(d.yOffset=c.y|0),v(c.data)&&(h=c.data));a(!d.compressed||h instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(c.copy){a(!h,"can not specify copy and data field for the same texture");var f=z.viewportWidth,l=z.viewportHeight;d.width=d.width||f-
d.xOffset;d.height=d.height||l-d.yOffset;d.needsCopy=!0;a(0<=d.xOffset&&d.xOffset<f&&0<=d.yOffset&&d.yOffset<l&&0<d.width&&d.width<=f&&0<d.height&&d.height<=l,"copy texture read out of bounds")}else if(!h)d.width=d.width||1,d.height=d.height||1,d.channels=d.channels||4;else if(B(h))d.channels=d.channels||4,d.data=h,"type"in c||5121!==d.type||(d.type=K[Object.prototype.toString.call(h)]|0);else if(e(h)){d.channels=d.channels||4;f=h;l=f.length;switch(d.type){case 5121:case 5123:case 5125:case 5126:l=
r.allocType(d.type,l);l.set(f);d.data=l;break;case 36193:d.data=M(f);break;default:a.raise("unsupported texture type, must specify a typed array")}d.alignment=1;d.needsFree=!0}else if(u(h)){f=h.data;Array.isArray(f)||5121!==d.type||(d.type=K[Object.prototype.toString.call(f)]|0);var l=h.shape,n=h.stride,m,A,H,C;3===l.length?(H=l[2],C=n[2]):(a(2===l.length,"invalid ndarray pixel data, must be 2 or 3D"),C=H=1);m=l[0];A=l[1];l=n[0];n=n[1];d.alignment=1;d.width=m;d.height=A;d.channels=H;d.format=d.internalformat=
p[H];d.needsFree=!0;m=C;h=h.offset;H=d.width;C=d.height;A=d.channels;for(var t=r.allocType(36193===d.type?5126:d.type,H*C*A),E=0,J=0;J<C;++J)for(var N=0;N<H;++N)for(var S=0;S<A;++S)t[E++]=f[l*N+n*J+m*S+h];b(d,t)}else if("[object HTMLCanvasElement]"===k(h)||"[object CanvasRenderingContext2D]"===k(h))"[object HTMLCanvasElement]"===k(h)?d.element=h:d.element=h.canvas,d.width=d.element.width,d.height=d.element.height,d.channels=4;else if("[object HTMLImageElement]"===k(h))d.element=h,d.width=h.naturalWidth,
d.height=h.naturalHeight,d.channels=4;else if("[object HTMLVideoElement]"===k(h))d.element=h,d.width=h.videoWidth,d.height=h.videoHeight,d.channels=4;else if(g(h)){f=d.width||h[0].length;l=d.height||h.length;n=d.channels;n=y(h[0][0])?n||h[0][0].length:n||1;m=F.shape(h);H=1;for(C=0;C<m.length;++C)H*=m[C];H=r.allocType(36193===d.type?5126:d.type,H);F.flatten(h,m,"",H);b(d,H);d.alignment=1;d.width=f;d.height=l;d.channels=n;d.format=d.internalformat=p[n];d.needsFree=!0}5126===d.type?a(0<=q.extensions.indexOf("oes_texture_float"),
"oes_texture_float extension not enabled"):36193===d.type&&a(0<=q.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}function sa(a,b,e,g,f){var k=a.element,l=a.data,n=a.internalformat,r=a.format,m=a.type,t=a.width,p=a.height;Y(a);k?c.texSubImage2D(b,f,e,g,r,m,k):a.compressed?c.compressedTexSubImage2D(b,f,e,g,n,t,p,l):a.needsCopy?(C(),c.copyTexSubImage2D(b,f,e,g,a.xOffset,a.yOffset,t,p)):c.texSubImage2D(b,f,e,g,t,p,r,m,l)}function la(){return La.pop()||new U}
function pa(a){a.needsFree&&r.freeType(a.data);U.call(a);La.push(a)}function xa(){ia.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function aa(a,c,b){var e=a.images[0]=la();a.mipmask=1;e.width=a.width=c;e.height=a.height=b;e.channels=a.channels=4}function T(c,b){var e=null;if(v(b))e=c.images[0]=la(),J(e,c),I(e,b),c.mipmask=1;else if(ea(c,b),Array.isArray(b.mipmap))for(var h=b.mipmap,g=0;g<h.length;++g)e=c.images[g]=la(),J(e,c),e.width>>=g,e.height>>=g,I(e,
h[g]),c.mipmask|=1<<g;else e=c.images[0]=la(),J(e,c),I(e,b),c.mipmask=1;J(c,c.images[0]);(c.compressed&&33776===c.internalformat||33777===c.internalformat||33778===c.internalformat||33779===c.internalformat)&&a(0===c.width%4&&0===c.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function O(a,b){for(var e=a.images,g=0;g<e.length&&e[g];++g){var f=e[g],k=b,l=g,r=f.element,n=f.data,m=f.internalformat,t=f.format,p=f.type,u=f.width,v=f.height;
Y(f);r?c.texImage2D(k,l,t,t,p,r):f.compressed?c.compressedTexImage2D(k,l,m,u,v,0,n):f.needsCopy?(C(),c.copyTexImage2D(k,l,t,f.xOffset,f.yOffset,u,v,0)):c.texImage2D(k,l,t,u,v,0,t,p,n)}}function Da(){var a=Ma.pop()||new xa;ia.call(a);for(var c=a.mipmask=0;16>c;++c)a.images[c]=null;return a}function ua(a){for(var c=a.images,b=0;b<c.length;++b)c[b]&&pa(c[b]),c[b]=null;Ma.push(a)}function ya(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=
4352}function ba(c,b){if("min"in b){var e=b.min;a.parameter(e,ga);c.minFilter=ga[e];0<=m.indexOf(c.minFilter)&&(c.genMipmaps=!0)}"mag"in b&&(e=b.mag,a.parameter(e,Q),c.magFilter=Q[e]);var e=c.wrapS,h=c.wrapT;if("wrap"in b){var g=b.wrap;"string"===typeof g?(a.parameter(g,X),e=h=X[g]):Array.isArray(g)&&(a.parameter(g[0],X),a.parameter(g[1],X),e=X[g[0]],h=X[g[1]])}else"wrapS"in b&&(e=b.wrapS,a.parameter(e,X),e=X[e]),"wrapT"in b&&(h=b.wrapT,a.parameter(h,X),h=X[h]);c.wrapS=e;c.wrapT=h;"anisotropic"in
b&&(e=b.anisotropic,a("number"===typeof e&&1<=e&&e<=q.maxAnisotropic,"aniso samples must be between 1 and "),c.anisotropic=b.anisotropic);if("mipmap"in b){e=!1;switch(typeof b.mipmap){case "string":a.parameter(b.mipmap,za,"invalid mipmap hint");c.mipmapHint=za[b.mipmap];e=c.genMipmaps=!0;break;case "boolean":e=c.genMipmaps=b.mipmap;break;case "object":a(Array.isArray(b.mipmap),"invalid mipmap type");c.genMipmaps=!1;e=!0;break;default:a.raise("invalid mipmap type")}!e||"min"in b||(c.minFilter=9984)}}
function ja(a,b){c.texParameteri(b,10241,a.minFilter);c.texParameteri(b,10240,a.magFilter);c.texParameteri(b,10242,a.wrapS);c.texParameteri(b,10243,a.wrapT);f.ext_texture_filter_anisotropic&&c.texParameteri(b,34046,a.anisotropic);a.genMipmaps&&(c.hint(33170,a.mipmapHint),c.generateMipmap(b))}function ma(a){ia.call(this);this.mipmask=0;this.internalformat=6408;this.id=Oa++;this.refCount=1;this.target=a;this.texture=c.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new ya;S.profile&&(this.stats=
{size:0})}function na(a){c.activeTexture(33984);c.bindTexture(a.target,a.texture)}function oa(){var a=da[0];a?c.bindTexture(a.target,a.texture):c.bindTexture(3553,null)}function qa(d){var b=d.texture;a(b,"must not double destroy texture");var e=d.unit,g=d.target;0<=e&&(c.activeTexture(33984+e),c.bindTexture(g,null),da[e]=null);c.deleteTexture(b);d.texture=null;d.params=null;d.pixels=null;d.refCount=0;delete wa[d.id];N.textureCount--}var za={"don't care":4352,"dont care":4352,nice:4354,fast:4353},
X={repeat:10497,clamp:33071,mirror:33648},Q={nearest:9728,linear:9729},ga=n({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},Q),V={none:0,browser:37444},R={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Z={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},fa={};f.ext_srgb&&(Z.srgb=35904,Z.srgba=35906);f.oes_texture_float&&(R.float32=R["float"]=5126);f.oes_texture_half_float&&
(R.float16=R["half float"]=36193);f.webgl_depth_texture&&(n(Z,{depth:6402,"depth stencil":34041}),n(R,{uint16:5123,uint32:5125,"depth stencil":34042}));f.webgl_compressed_texture_s3tc&&n(fa,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});f.webgl_compressed_texture_atc&&n(fa,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});f.webgl_compressed_texture_pvrtc&&n(fa,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,
"rgba pvrtc 2bppv1":35843});f.webgl_compressed_texture_etc1&&(fa["rgb etc1"]=36196);var Aa=Array.prototype.slice.call(c.getParameter(34467));Object.keys(fa).forEach(function(a){var c=fa[a];0<=Aa.indexOf(c)&&(Z[a]=c)});var ha=Object.keys(Z);q.textureFormats=ha;var va=[];Object.keys(Z).forEach(function(a){va[Z[a]]=a});var Ea=[];Object.keys(R).forEach(function(a){Ea[R[a]]=a});var Ga=[];Object.keys(Q).forEach(function(a){Ga[Q[a]]=a});var Ja=[];Object.keys(ga).forEach(function(a){Ja[ga[a]]=a});var Fa=
[];Object.keys(X).forEach(function(a){Fa[X[a]]=a});var Ka=ha.reduce(function(a,c){var b=Z[c];6409===b||6406===b||6409===b||6410===b||6402===b||34041===b?a[b]=b:32855===b||0<=c.indexOf("rgba")?a[b]=6408:a[b]=6407;return a},{}),La=[],Ma=[],Oa=0,wa={},ta=q.maxTextureUnits,da=Array(ta).map(function(){return null});n(ma.prototype,{bind:function(){this.bindCount+=1;var d=this.unit;if(0>d){for(var b=0;b<ta;++b){var e=da[b];if(e){if(0<e.bindCount)continue;e.unit=-1}da[b]=this;d=b;break}d>=ta&&a.raise("insufficient number of texture units");
S.profile&&N.maxTextureUnits<d+1&&(N.maxTextureUnits=d+1);this.unit=d;c.activeTexture(33984+d);c.bindTexture(this.target,this.texture)}return d},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&qa(this)}});S.profile&&(N.getTotalTextureSize=function(){var a=0;Object.keys(wa).forEach(function(c){a+=wa[c].stats.size});return a});return{create2D:function(d,b){function e(c,d){var b=g.texInfo;ya.call(b);var h=Da();"number"===typeof c?"number"===typeof d?aa(h,c|0,d|0):aa(h,c|0,c|
0):c?(a.type(c,"object","invalid arguments to regl.texture"),ba(b,c),T(h,c)):aa(h,1,1);b.genMipmaps&&(h.mipmask=(h.width<<1)-1);g.mipmask=h.mipmask;J(g,h);a.texture2D(b,h,q);g.internalformat=h.internalformat;e.width=h.width;e.height=h.height;na(g);O(h,3553);ja(b,3553);oa();ua(h);S.profile&&(g.stats.size=l(g.internalformat,g.type,h.width,h.height,b.genMipmaps,!1));e.format=va[g.internalformat];e.type=Ea[g.type];e.mag=Ga[b.magFilter];e.min=Ja[b.minFilter];e.wrapS=Fa[b.wrapS];e.wrapT=Fa[b.wrapT];return e}
var g=new ma(3553);wa[g.id]=g;N.textureCount++;e(d,b);e.subimage=function(c,b,d,h){a(!!c,"must specify image data");b|=0;d|=0;h|=0;var f=la();J(f,g);f.width=0;f.height=0;I(f,c);f.width=f.width||(g.width>>h)-b;f.height=f.height||(g.height>>h)-d;a(g.type===f.type&&g.format===f.format&&g.internalformat===f.internalformat,"incompatible format for texture.subimage");a(0<=b&&0<=d&&b+f.width<=g.width&&d+f.height<=g.height,"texture.subimage write out of bounds");a(g.mipmask&1<<h,"missing mipmap data");a(f.data||
f.element||f.needsCopy,"missing image data");na(g);sa(f,3553,b,d,h);oa();pa(f);return e};e.resize=function(a,b){var d=a|0,f=b|0||d;if(d===g.width&&f===g.height)return e;e.width=g.width=d;e.height=g.height=f;na(g);for(var k=0;g.mipmask>>k;++k)c.texImage2D(3553,k,g.format,d>>k,f>>k,0,g.format,g.type,null);oa();S.profile&&(g.stats.size=l(g.internalformat,g.type,d,f,!1,!1));return e};e._reglType="texture2d";e._texture=g;S.profile&&(e.stats=g.stats);e.destroy=function(){g.decRef()};return e},createCube:function(b,
e,g,f,k,r){function n(c,b,d,e,g,h){var f,k=m.texInfo;ya.call(k);for(f=0;6>f;++f)p[f]=Da();if("number"!==typeof c&&c)if("object"===typeof c)if(b)T(p[0],c),T(p[1],b),T(p[2],d),T(p[3],e),T(p[4],g),T(p[5],h);else if(ba(k,c),ea(m,c),"faces"in c)for(c=c.faces,a(Array.isArray(c)&&6===c.length,"cube faces must be a length 6 array"),f=0;6>f;++f)a("object"===typeof c[f]&&!!c[f],"invalid input for cube map face"),J(p[f],m),T(p[f],c[f]);else for(f=0;6>f;++f)T(p[f],c);else a.raise("invalid arguments to cube map");
else for(c=c|0||1,f=0;6>f;++f)aa(p[f],c,c);J(m,p[0]);m.mipmask=k.genMipmaps?(p[0].width<<1)-1:p[0].mipmask;a.textureCube(m,k,p,q);m.internalformat=p[0].internalformat;n.width=p[0].width;n.height=p[0].height;na(m);for(f=0;6>f;++f)O(p[f],34069+f);ja(k,34067);oa();S.profile&&(m.stats.size=l(m.internalformat,m.type,n.width,n.height,k.genMipmaps,!0));n.format=va[m.internalformat];n.type=Ea[m.type];n.mag=Ga[k.magFilter];n.min=Ja[k.minFilter];n.wrapS=Fa[k.wrapS];n.wrapT=Fa[k.wrapT];for(f=0;6>f;++f)ua(p[f]);
return n}var m=new ma(34067);wa[m.id]=m;N.cubeCount++;var p=Array(6);n(b,e,g,f,k,r);n.subimage=function(c,b,d,e,g){a(!!b,"must specify image data");a("number"===typeof c&&c===(c|0)&&0<=c&&6>c,"invalid face");d|=0;e|=0;g|=0;var h=la();J(h,m);h.width=0;h.height=0;I(h,b);h.width=h.width||(m.width>>g)-d;h.height=h.height||(m.height>>g)-e;a(m.type===h.type&&m.format===h.format&&m.internalformat===h.internalformat,"incompatible format for texture.subimage");a(0<=d&&0<=e&&d+h.width<=m.width&&e+h.height<=
m.height,"texture.subimage write out of bounds");a(m.mipmask&1<<g,"missing mipmap data");a(h.data||h.element||h.needsCopy,"missing image data");na(m);sa(h,34069+c,d,e,g);oa();pa(h);return n};n.resize=function(a){a|=0;if(a!==m.width){n.width=m.width=a;n.height=m.height=a;na(m);for(var b=0;6>b;++b)for(var d=0;m.mipmask>>d;++d)c.texImage2D(34069+b,d,m.format,a>>d,a>>d,0,m.format,m.type,null);oa();S.profile&&(m.stats.size=l(m.internalformat,m.type,n.width,n.height,!1,!0));return n}};n._reglType="textureCube";
n._texture=m;S.profile&&(n.stats=m.stats);n.destroy=function(){m.decRef()};return n},clear:function(){for(var a=0;a<ta;++a)c.activeTexture(33984+a),c.bindTexture(3553,null),da[a]=null;A(wa).forEach(qa);N.cubeCount=0;N.textureCount=0},getTexture:function(a){return null},restore:function(){A(wa).forEach(function(a){a.texture=c.createTexture();c.bindTexture(a.target,a.texture);for(var b=0;32>b;++b)if(0!==(a.mipmask&1<<b))if(3553===a.target)c.texImage2D(3553,b,a.internalformat,a.width>>b,a.height>>b,
0,a.internalformat,a.type,null);else for(var e=0;6>e;++e)c.texImage2D(34069+e,b,a.internalformat,a.width>>b,a.height>>b,0,a.internalformat,a.type,null);ja(a.texInfo,a.target)})}}}},{"./constants/arraytypes.json":4,"./util/check":21,"./util/extend":24,"./util/flatten":25,"./util/is-array-like":26,"./util/is-ndarray":27,"./util/is-typed-array":28,"./util/pool":30,"./util/to-half-float":32,"./util/values":33}],20:[function(f,q,z){q.exports=function(e,g){function f(){this.endQueryIndex=this.startQueryIndex=
-1;this.sum=0;this.stats=null}function v(a,b,e){var g=n.pop()||new f;g.startQueryIndex=a;g.endQueryIndex=b;g.sum=0;g.stats=e;q.push(g)}var b=g.ext_disjoint_timer_query;if(!b)return null;var l=[],a=[],n=[],q=[],B=[],u=[];return{beginQuery:function(e){var g=l.pop()||b.createQueryEXT();b.beginQueryEXT(35007,g);a.push(g);v(a.length-1,a.length,e)},endQuery:function(){b.endQueryEXT(35007)},pushScopeStats:v,update:function(){var e,g;e=a.length;if(0!==e){u.length=Math.max(u.length,e+1);B.length=Math.max(B.length,
e+1);B[0]=0;var f=u[0]=0;for(g=e=0;g<a.length;++g){var k=a[g];b.getQueryObjectEXT(k,34919)?(f+=b.getQueryObjectEXT(k,34918),l.push(k)):a[e++]=k;B[g+1]=f;u[g+1]=e}a.length=e;for(g=e=0;g<q.length;++g){var f=q[g],v=f.startQueryIndex,k=f.endQueryIndex;f.sum+=B[k]-B[v];v=u[v];k=u[k];k===v?(f.stats.gpuTime+=f.sum/1E6,n.push(f)):(f.startQueryIndex=v,f.endQueryIndex=k,q[e++]=f)}q.length=e}},getNumPendingQueries:function(){return a.length},clear:function(){l.push.apply(l,a);for(var e=0;e<l.length;e++)b.deleteQueryEXT(l[e]);
a.length=0;l.length=0},restore:function(){a.length=0;l.length=0}}}},{}],21:[function(f,q,z){function e(a){return"undefined"!==typeof btoa?btoa(a):"base64:"+a}function g(a){a=Error("(regl) "+a);console.error(a);throw a;}function k(a,b){a||g(b)}function v(a){return a?": "+a:""}function b(a,b,e){0>b.indexOf(a)&&g("invalid value"+v(e)+". must be one of: "+b)}function l(a,b){for(a+="";a.length<b;)a=" "+a;return a}function a(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function n(a,
b){this.number=a;this.line=b;this.errors=[]}function A(a,b,e){this.file=a;this.line=b;this.message=e}function B(){var a=Error(),a=(a.stack||a).toString(),b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function u(){var a=Error(),a=(a.stack||a).toString(),b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function r(c,b){var g=c.split("\n"),f=1,k=
0,l={unknown:new a,0:new a};l.unknown.name=l[0].name=b||B();l.unknown.lines.push(new n(0,""));for(var m=0;m<g.length;++m){var r=g[m],p=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(r);if(p)switch(p[1]){case "line":if(p=/(\d+)(\s+\d+)?/.exec(p[2]))f=p[1]|0,p[2]&&(k=p[2]|0,k in l||(l[k]=new a));break;case "define":if(p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(p[2]))l[k].name=p[1]?e(p[2]):p[2]}l[k].lines.push(new n(f++,r))}Object.keys(l).forEach(function(a){var c=l[a];c.lines.forEach(function(a){c.index[a.number]=a})});
return l}function M(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var c=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(a);c?b.push(new A(c[1]|0,c[2]|0,c[3].trim())):0<a.length&&b.push(new A("unknown",0,a))}});return b}function y(a,b){b.forEach(function(b){var e=a[b.file];if(e){var g=e.index[b.line];if(g){g.errors.push(b);e.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(b)})}function F(a){a._commandRef=B()}function K(a,b){var e=u();g(a+" in command "+(b||B())+
("unknown"===e?"":" called from "+e))}function m(a,b,e,g){typeof a!==b&&K("invalid parameter type"+v(e)+". expected "+b+", got "+typeof a,g||B())}function p(a,b){return 32820===a||32819===a||33635===a?2:34042===a?4:C[a]*b}var L=f("./is-typed-array");f=f("./extend");var N="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),C={};C[5120]=C[5121]=1;C[5122]=C[5123]=C[36193]=C[33635]=C[32819]=C[32820]=2;C[5124]=C[5125]=C[5126]=C[34042]=4;q.exports=f(k,{optional:function(a){a()},
raise:g,commandRaise:K,command:function(a,b,e){a||K(b,e||B())},parameter:function(a,b,e){a in b||g("unknown parameter ("+a+")"+v(e)+". possible values: "+Object.keys(b).join())},commandParameter:function(a,b,e,g){a in b||K("unknown parameter ("+a+")"+v(e)+". possible values: "+Object.keys(b).join(),g||B())},constructor:function(a){Object.keys(a).forEach(function(a){0>N.indexOf(a)&&g('invalid regl constructor argument "'+a+'". must be one of '+N)})},type:function(a,b,e){typeof a!==b&&g("invalid parameter type"+
v(e)+". expected "+b+", got "+typeof a)},commandType:m,isTypedArray:function(a,b){L(a)||g("invalid parameter type"+v(b)+". must be a typed array")},nni:function(a,b){0<=a&&(a|0)===a||g("invalid parameter type, ("+a+")"+v(b)+". must be a nonnegative integer")},oneOf:b,shaderError:function(a,b,e,g,f){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);a=g===a.FRAGMENT_SHADER?"fragment":"vertex";m(e,"string",a+" shader source must be a string",f);var n=r(e,f);e=M(b);y(n,e);Object.keys(n).forEach(function(a){function c(a,
b){e.push(a);g.push(b||"")}var b=n[a];if(b.hasErrors){var e=[""],g=[""];c("file number "+a+": "+b.name+"\n","color:red;text-decoration:underline;font-weight:bold");b.lines.forEach(function(a){if(0<a.errors.length){c(l(a.number,4)+"|  ","background-color:yellow; font-weight:bold");c(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var b=0;a.errors.forEach(function(e){e=e.message;var g=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(e);if(g){var f=g[1];e=g[2];switch(f){case "assign":f="="}b=Math.max(a.line.indexOf(f,
b),0)}else b=0;c(l("| ",6));c(l("^^^",b+3)+"\n","font-weight:bold");c(l("| ",6));c(e+"\n","font-weight:bold")});c(l("| ",6)+"\n")}else c(l(a.number,4)+"|  "),c(a.line+"\n","color:red")});"undefined"!==typeof document?(g[0]=e.join("%c"),console.log.apply(console,g)):console.log(e.join(""))}});k.raise("Error compiling "+a+" shader, "+n[0].name)}},linkError:function(a,b,e,g,f){a.getProgramParameter(b,a.LINK_STATUS)||(a=a.getProgramInfoLog(b),e=r(e,f),g='Error linking program with vertex shader, "'+r(g,
f)[0].name+'", and fragment shader "'+e[0].name+'"',"undefined"!==typeof document?console.log("%c"+g+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(g+"\n"+a),k.raise(g))},callSite:u,saveCommandRef:F,saveDrawInfo:function(a,b,e,g){function f(a){return a?g.id(a):0}function k(a,b){Object.keys(b).forEach(function(b){a[g.id(b)]=!0})}F(a);a._fragId=f(a["static"].frag);a._vertId=f(a["static"].vert);var l=a._uniformSet={};k(l,b["static"]);k(l,b.dynamic);b=a._attributeSet=
{};k(b,e["static"]);k(b,e.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,e,g){a.texture?b(a.texture._texture.internalformat,e,"unsupported texture format for attachment"):b(a.renderbuffer._renderbuffer.format,g,"unsupported renderbuffer format for attachment")},guessCommand:B,texture2D:function(a,b,e){var g=b.width,f=b.height,l=b.channels;k(0<g&&g<=e.maxTextureSize&&0<f&&f<=e.maxTextureSize,"invalid texture shape");
33071===a.wrapS&&33071===a.wrapT||k(!(g&g-1)&&!!g&&!(f&f-1)&&!!f,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==g&&1!==f&&k(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(k(!(g&g-1)&&!!g&&!(f&f-1)&&!!f,"texture must be a square power of 2 to support mipmapping"),k(b.mipmask===(g<<1)-1,"missing or incomplete mipmap data"));5126===b.type&&(0>e.extensions.indexOf("oes_texture_float_linear")&&
k(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),k(!a.genMipmaps,"mipmap generation not supported with float textures"));var n=b.images;for(e=0;16>e;++e)if(n[e]){var m=g>>e,r=f>>e;k(b.mipmask&1<<e,"missing mipmap data");var u=n[e];k(u.width===m&&u.height===r,"invalid shape for mip images");k(u.format===b.format&&u.internalformat===b.internalformat&&u.type===b.type,"incompatible type for mip image");u.compressed||u.data&&k(u.data.byteLength===m*
r*Math.max(p(u.type,l),u.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}else a.genMipmaps||k(0===(b.mipmask&1<<e),"extra mipmap data");b.compressed&&k(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,e,g){var f=a.width,l=a.height,n=a.channels;k(0<f&&f<=g.maxTextureSize&&0<l&&l<=g.maxTextureSize,"invalid texture shape");k(f===l,"cube map must be square");k(33071===b.wrapS&&33071===b.wrapT,"wrap mode not supported by cube map");
for(g=0;g<e.length;++g){var m=e[g];k(m.width===f&&m.height===l,"inconsistent cube map face shape");b.genMipmaps&&(k(!m.compressed,"can not generate mipmap for compressed textures"),k(1===m.mipmask,"can not specify mipmaps and generate mipmaps"));for(var r=m.images,u=0;16>u;++u){var v=r[u];if(v){var q=f>>u,A=l>>u;k(m.mipmask&1<<u,"missing mipmap data");k(v.width===q&&v.height===A,"invalid shape for mip images");k(v.format===a.format&&v.internalformat===a.internalformat&&v.type===a.type,"incompatible type for mip image");
v.compressed||v.data&&k(v.data.byteLength===q*A*Math.max(p(v.type,n),v.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}})},{"./extend":24,"./is-typed-array":28}],22:[function(f,q,z){q.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},{}],23:[function(f,q,z){function e(e){return Array.prototype.slice.call(e)}function g(g){return e(g).join("")}var k=f("./extend");q.exports=function(){function f(){var a=
[],b=[];return k(function(){a.push.apply(a,e(arguments))},{def:function(){var g="v"+l++;b.push(g);0<arguments.length&&(a.push(g,"="),a.push.apply(a,e(arguments)),a.push(";"));return g},toString:function(){return g([0<b.length?"var "+b+";":"",g(a)])}})}function b(){function a(e,f){g(e,f,"=",b.def(e,f),";")}var b=f(),g=f(),l=b.toString,n=g.toString;return k(function(){b.apply(b,e(arguments))},{def:b.def,entry:b,exit:g,save:a,set:function(e,g,f){a(e,g);b(e,g,"=",f,";")},toString:function(){return l()+
n()}})}var l=0,a=[],n=[],q=f(),B={};return{global:q,link:function(b){for(var e=0;e<n.length;++e)if(n[e]===b)return a[e];e="g"+l++;a.push(e);n.push(b);return e},block:f,proc:function(a,e){function f(){var a="a"+l.length;l.push(a);return a}var l=[];e=e||0;for(var n=0;n<e;++n)f();var n=b(),v=n.toString;return B[a]=k(n,{arg:f,toString:function(){return g(["function(",l.join(),"){",v(),"}"])}})},scope:b,cond:function(){var a=g(arguments),f=b(),l=b(),n=f.toString,v=l.toString;return k(f,{then:function(){f.apply(f,
e(arguments));return this},"else":function(){l.apply(l,e(arguments));return this},toString:function(){var b=v();b&&(b="else{"+b+"}");return g(["if(",a,"){",n(),"}",b])}})},compile:function(){var b=['"use strict";',q,"return {"];Object.keys(B).forEach(function(a){b.push('"',a,'":',B[a].toString(),",")});b.push("}");var e=g(b).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,a.concat(e)).apply(null,n)}}}},{"./extend":24}],24:[function(f,q,z){q.exports=function(e,
g){for(var f=Object.keys(g),v=0;v<f.length;++v)e[f[v]]=g[f[v]];return e}},{}],25:[function(f,q,z){function e(e,b,g,a,f,k){for(var q=0;q<b;++q)for(var u=e[q],r=0;r<g;++r)for(var z=u[r],y=0;y<a;++y)f[k++]=z[y]}function g(f,b,k,a,n){for(var q=1,B=k+1;B<b.length;++B)q*=b[B];var u=b[k];if(4===b.length-k){var r=b[k+1],z=b[k+2];b=b[k+3];for(B=0;B<u;++B)e(f[B],r,z,b,a,n),n+=q}else for(B=0;B<u;++B)g(f[B],b,k+1,a,n),n+=q}var k=f("./pool");q.exports={shape:function(e){for(var b=[];e.length;e=e[0])b.push(e.length);
return b},flatten:function(f,b,l,a){var n=1;if(b.length)for(var q=0;q<b.length;++q)n*=b[q];else n=0;l=a||k.allocType(l,n);switch(b.length){case 0:break;case 1:a=b[0];for(b=0;b<a;++b)l[b]=f[b];break;case 2:a=b[0];b=b[1];for(q=n=0;q<a;++q)for(var B=f[q],u=0;u<b;++u)l[n++]=B[u];break;case 3:e(f,b[0],b[1],b[2],l,0);break;default:g(f,b,0,l,0)}return l}}},{"./pool":30}],26:[function(f,q,z){var e=f("./is-typed-array");q.exports=function(g){return Array.isArray(g)||e(g)}},{"./is-typed-array":28}],27:[function(f,
q,z){var e=f("./is-typed-array");q.exports=function(g){return!!g&&"object"===typeof g&&Array.isArray(g.shape)&&Array.isArray(g.stride)&&"number"===typeof g.offset&&g.shape.length===g.stride.length&&(Array.isArray(g.data)||e(g.data))}},{"./is-typed-array":28}],28:[function(f,q,z){var e=f("../constants/arraytypes.json");q.exports=function(g){return Object.prototype.toString.call(g)in e}},{"../constants/arraytypes.json":4}],29:[function(f,q,z){q.exports=function(e,g){for(var f=Array(e),q=0;q<e;++q)f[q]=
g(q);return f}},{}],30:[function(f,q,z){function e(b){var e,a;e=(65535<b)<<4;b>>>=e;a=(255<b)<<3;b>>>=a;e|=a;a=(15<b)<<2;b>>>=a;e|=a;a=(3<b)<<1;return e|a|b>>>a>>1}function g(b){a:{for(var g=16;268435456>=g;g*=16)if(b<=g){b=g;break a}b=0}g=v[e(b)>>2];return 0<g.length?g.pop():new ArrayBuffer(b)}function k(b){v[e(b.byteLength)>>2].push(b)}var v=f("./loop")(8,function(){return[]});q.exports={alloc:g,free:k,allocType:function(b,e){var a=null;switch(b){case 5120:a=new Int8Array(g(e),0,e);break;case 5121:a=
new Uint8Array(g(e),0,e);break;case 5122:a=new Int16Array(g(2*e),0,e);break;case 5123:a=new Uint16Array(g(2*e),0,e);break;case 5124:a=new Int32Array(g(4*e),0,e);break;case 5125:a=new Uint32Array(g(4*e),0,e);break;case 5126:a=new Float32Array(g(4*e),0,e);break;default:return null}return a.length!==e?a.subarray(0,e):a},freeType:function(b){k(b.buffer)}}},{"./loop":29}],31:[function(f,q,z){q.exports={next:"function"===typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,
16)},cancel:"function"===typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout}},{}],32:[function(f,q,z){var e=f("./pool"),g=new Float32Array(1),k=new Uint32Array(g.buffer);q.exports=function(f){for(var b=e.allocType(5123,f.length),l=0;l<f.length;++l)if(isNaN(f[l]))b[l]=65535;else if(Infinity===f[l])b[l]=31744;else if(-Infinity===f[l])b[l]=64512;else{g[0]=f[l];var a=k[0],n=a>>>31<<15,q=(a<<1>>>24)-127,a=a>>13&1023;b[l]=-24>q?n:-14>q?n+(a+1024>>-14-q):15<q?n+31744:n+
(q+15<<10)+a}return b}},{"./pool":30}],33:[function(f,q,z){q.exports=function(e){return Object.keys(e).map(function(g){return e[g]})}},{}],34:[function(f,q,z){function e(a,b,e){function g(){var b=window.innerWidth,k=window.innerHeight;a!==document.body&&(k=a.getBoundingClientRect(),b=k.right-k.left,k=k.bottom-k.top);f.width=e*b;f.height=e*k;l(f.style,{width:b+"px",height:k+"px"})}var f=document.createElement("canvas");l(f.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(f);a===document.body&&
(f.style.position="absolute",l(a.style,{margin:0,padding:0}));window.addEventListener("resize",g,!1);g();return{canvas:f,onDestroy:function(){window.removeEventListener("resize",g);a.removeChild(f)}}}function g(a,b){function e(g){try{return a.getContext(g,b)}catch(f){return null}}return e("webgl")||e("experimental-webgl")||e("webgl-experimental")}function k(a){if("string"===typeof a)return a.split();b(Array.isArray(a),"invalid extension array");return a}function v(a){return"string"===typeof a?(b("undefined"!==
typeof document,"not supported outside of DOM"),document.querySelector(a)):a}var b=f("./util/check"),l=f("./util/extend");q.exports=function(a){var f=a||{},l,q,u,r;a={};var z=[],y=[],F="undefined"===typeof window?1:window.devicePixelRatio,K=!1,m=function(a){a&&b.raise(a)},p=function(){};"string"===typeof f?(b("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),l=document.querySelector(f),b(l,"invalid query string for element")):"object"===typeof f?"string"===typeof f.nodeName&&
"function"===typeof f.appendChild&&"function"===typeof f.getBoundingClientRect?l=f:"function"===typeof f.drawArrays||"function"===typeof f.drawElements?(r=f,u=r.canvas):(b.constructor(f),"gl"in f?r=f.gl:"canvas"in f?u=v(f.canvas):"container"in f&&(q=v(f.container)),"attributes"in f&&(a=f.attributes,b.type(a,"object","invalid context attributes")),"extensions"in f&&(z=k(f.extensions)),"optionalExtensions"in f&&(y=k(f.optionalExtensions)),"onDone"in f&&(b.type(f.onDone,"function","invalid or missing onDone callback"),
m=f.onDone),"profile"in f&&(K=!!f.profile),"pixelRatio"in f&&(F=+f.pixelRatio,b(0<F,"invalid pixel ratio"))):b.raise("invalid arguments to regl");l&&("canvas"===l.nodeName.toLowerCase()?u=l:q=l);if(!r){if(!u){b("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");l=e(q||document.body,m,F);if(!l)return null;u=l.canvas;p=l.onDestroy}r=g(u,a)}return r?{gl:r,canvas:u,container:q,extensions:z,optionalExtensions:y,pixelRatio:F,profile:K,onDone:m,onDestroy:p}:
(p(),m("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/check":21,"./util/extend":24}],35:[function(f,q,z){q.exports=function(f,k){function q(a){var b=!1;"altKey"in a&&(b=b||a.altKey!==m.alt,m.alt=!!a.altKey);"shiftKey"in a&&(b=b||a.shiftKey!==m.shift,m.shift=!!a.shiftKey);"ctrlKey"in a&&(b=b||a.ctrlKey!==m.control,m.control=!!a.ctrlKey);"metaKey"in a&&(b=b||a.metaKey!==m.meta,m.meta=!!a.metaKey);return b}function b(a,b){var c=e.x(b),f=e.y(b);
"buttons"in b&&(a=b.buttons|0);if(a!==y||c!==F||f!==K||q(b))y=a|0,F=c||0,K=f||0,k&&k(y,F,K,m)}function l(a){b(0,a)}function a(){if(y||F||K||m.shift||m.alt||m.meta||m.control)y=F=K=0,m.shift=m.alt=m.control=m.meta=!1,k&&k(0,0,0,m)}function n(a){q(a)&&k&&k(y,F,K,m)}function z(a){0===e.buttons(a)?b(0,a):b(y,a)}function B(a){b(y|e.buttons(a),a)}function u(a){b(y&~e.buttons(a),a)}function r(){p||(p=!0,f.addEventListener("mousemove",z),f.addEventListener("mousedown",B),f.addEventListener("mouseup",u),f.addEventListener("mouseleave",
l),f.addEventListener("mouseenter",l),f.addEventListener("mouseout",l),f.addEventListener("mouseover",l),f.addEventListener("blur",a),f.addEventListener("keyup",n),f.addEventListener("keydown",n),f.addEventListener("keypress",n),f!==window&&(window.addEventListener("blur",a),window.addEventListener("keyup",n),window.addEventListener("keydown",n),window.addEventListener("keypress",n)))}function M(){p&&(p=!1,f.removeEventListener("mousemove",z),f.removeEventListener("mousedown",B),f.removeEventListener("mouseup",
u),f.removeEventListener("mouseleave",l),f.removeEventListener("mouseenter",l),f.removeEventListener("mouseout",l),f.removeEventListener("mouseover",l),f.removeEventListener("blur",a),f.removeEventListener("keyup",n),f.removeEventListener("keydown",n),f.removeEventListener("keypress",n),f!==window&&(window.removeEventListener("blur",a),window.removeEventListener("keyup",n),window.removeEventListener("keydown",n),window.removeEventListener("keypress",n)))}k||(k=f,f=window);var y=0,F=0,K=0,m={shift:!1,
alt:!1,control:!1,meta:!1},p=!1;r();var L={element:f};Object.defineProperties(L,{enabled:{get:function(){return p},set:function(a){a?r():M},enumerable:!0},buttons:{get:function(){return y},enumerable:!0},x:{get:function(){return F},enumerable:!0},y:{get:function(){return K},enumerable:!0},mods:{get:function(){return m},enumerable:!0}});return L};var e=f("mouse-event")},{"mouse-event":36}],36:[function(f,q,z){function e(e){return e.target||e.srcElement||window}z.buttons=function(e){if("object"===typeof e){if("buttons"in
e)return e.buttons;if("which"in e){e=e.which;if(2===e)return 4;if(3===e)return 2;if(0<e)return 1<<e-1}else if("button"in e){e=e.button;if(1===e)return 4;if(2===e)return 2;if(0<=e)return 1<<e}}return 0};z.element=e;z.x=function(f){if("object"===typeof f){if("offsetX"in f)return f.offsetX;var k=e(f).getBoundingClientRect();return f.clientX-k.left}return 0};z.y=function(f){if("object"===typeof f){if("offsetY"in f)return f.offsetY;var k=e(f).getBoundingClientRect();return f.clientY-k.top}return 0}},{}],
37:[function(f,q,z){function e(a,b){for(var e=0;e<a.length;++e)if(a[e]===b)return e;return-1}var g=f("./lib/util/check"),k=f("./lib/util/extend"),v=f("./lib/dynamic"),b=f("./lib/util/raf"),l=f("./lib/util/clock"),a=f("./lib/strings"),n=f("./lib/webgl"),A=f("./lib/extension"),B=f("./lib/limits"),u=f("./lib/buffer"),r=f("./lib/elements"),M=f("./lib/texture"),y=f("./lib/renderbuffer"),F=f("./lib/framebuffer"),K=f("./lib/attribute"),m=f("./lib/shader"),p=f("./lib/read"),L=f("./lib/core"),N=f("./lib/stats"),
C=f("./lib/timer");q.exports=function(c){function f(){if(0===R.length)O&&O.update(),ha=null;else{ha=b.next(f);ea();for(var a=R.length-1;0<=a;--a){var c=R[a];c&&c(ba,null,0)}I.flush();O&&O.update()}}function q(){!ha&&0<R.length&&(ha=b.next(f))}function z(){ha&&(b.cancel(f),ha=null)}function Pa(a){a.preventDefault();la=!0;z();Z.forEach(function(a){a()})}function ra(a){I.getError();la=!1;pa.restore();oa.restore();ma.restore();qa.restore();za.restore();X.restore();O&&O.restore();Q.procs.refresh();q();
fa.forEach(function(a){a()})}function ka(a){function b(a){var c={},e={};Object.keys(a).forEach(function(b){var f=a[b];v.isDynamic(f)?e[b]=v.unbox(f,b):c[b]=f});return{dynamic:e,"static":c}}function c(a){for(;q.length<a;)q.push(null);return q}g(!!a,"invalid args to regl({...})");g.type(a,"object","invalid args to regl({...})");var e=b(a.context||{}),f=b(a.uniforms||{}),h=b(a.attributes||{}),l=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=
d[b]})}}var c=k({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var e=Q.compile(l,h,f,e,a),m=e.draw,n=e.batch,p=e.scope,q=[];return k(function(a,b){var e;la&&g.raise("context lost");if("function"===typeof a)return p.call(this,null,a,0);if("function"===typeof b)if("number"===
typeof a)for(e=0;e<a;++e)p.call(this,null,b,e);else if(Array.isArray(a))for(e=0;e<a.length;++e)p.call(this,a[e],b,e);else return p.call(this,a,b,0);else if("number"===typeof a){if(0<a)return n.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return n.call(this,a,a.length)}else return m.call(this,a)},{stats:a})}function S(a,b){var c=0;Q.procs.poll();var e=b.color;e&&(I.clearColor(+e[0]||0,+e[1]||0,+e[2]||0,+e[3]||0),c|=16384);"depth"in b&&(I.clearDepth(+b.depth),c|=256);"stencil"in b&&(I.clearStencil(b.stencil|
0),c|=1024);g(!!c,"called regl.clear with no buffer specified");I.clear(c)}function ia(a){g.type(a,"function","regl.frame() callback must be a function");R.push(a);q();return{cancel:function(){function b(){var a=e(R,b);R[a]=R[R.length-1];--R.length;0>=R.length&&z()}var c=e(R,a);g(0<=c,"cannot cancel a frame twice");R[c]=b}}}function J(){var a=ga.viewport,b=ga.scissor_box;a[0]=a[1]=b[0]=b[1]=0;ba.viewportWidth=ba.framebufferWidth=ba.drawingBufferWidth=a[2]=b[2]=I.drawingBufferWidth;ba.viewportHeight=
ba.framebufferHeight=ba.drawingBufferHeight=a[3]=b[3]=I.drawingBufferHeight}function ea(){ba.tick+=1;ba.time=U();J();Q.procs.poll()}function Y(){J();Q.procs.refresh();O&&O.update()}function U(){return(l()-Da)/1E3}c=n(c);if(!c)return null;var I=c.gl,sa=I.getContextAttributes(),la=I.isContextLost(),pa=A(I,c);if(!pa)return null;var xa=a(),aa=N(),T=pa.extensions,O=C(I,T),Da=l(),ua=I.drawingBufferWidth,ya=I.drawingBufferHeight,ba={tick:0,time:0,viewportWidth:ua,viewportHeight:ya,framebufferWidth:ua,framebufferHeight:ya,
drawingBufferWidth:ua,drawingBufferHeight:ya,pixelRatio:c.pixelRatio},ja=B(I,T),ma=u(I,aa,c),na=r(I,T,ma,aa),ua=K(I,T,ja,ma,xa),oa=m(I,xa,aa,c),qa=M(I,T,ja,function(){Q.procs.poll()},ba,aa,c),za=y(I,T,ja,aa,c),X=F(I,T,ja,qa,za,aa),Q=L(I,xa,T,ja,ma,na,qa,X,{},ua,oa,{elements:null,primitive:4,count:-1,offset:0,instances:-1},ba,O,c),xa=p(I,X,Q.procs.poll,ba,sa,T),ga=Q.next,V=I.canvas,R=[],Z=[],fa=[],Aa=[c.onDestroy],ha=null;V&&(V.addEventListener("webglcontextlost",Pa,!1),V.addEventListener("webglcontextrestored",
ra,!1));var va=X.setFBO=ka({framebuffer:v.define.call(null,1,"framebuffer")});Y();sa=k(ka,{clear:function(a){g("object"===typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)va(k({framebuffer:a.framebuffer.faces[b]},a),S);else va(a,S);else S(null,a)},prop:v.define.bind(null,1),context:v.define.bind(null,2),"this":v.define.bind(null,3),draw:ka({}),buffer:function(a){return ma.create(a,34962,!1,!1)},
elements:function(a){return na.create(a,!1)},texture:qa.create2D,cube:qa.createCube,renderbuffer:za.create,framebuffer:X.create,framebufferCube:X.createCube,attributes:sa,frame:ia,on:function(a,b){g.type(b,"function","listener callback must be a function");var c;switch(a){case "frame":return ia(b);case "lost":c=Z;break;case "restore":c=fa;break;case "destroy":c=Aa;break;default:g.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===
b){c[a]=c[c.length-1];c.pop();break}}}},limits:ja,hasExtension:function(a){return 0<=ja.extensions.indexOf(a.toLowerCase())},read:xa,destroy:function(){R.length=0;z();V&&(V.removeEventListener("webglcontextlost",Pa),V.removeEventListener("webglcontextrestored",ra));oa.clear();X.clear();za.clear();qa.clear();na.clear();ma.clear();O&&O.clear();Aa.forEach(function(a){a()})},_gl:I,_refresh:Y,poll:function(){ea();O&&O.update()},now:U,stats:aa});c.onDone(null,sa);return sa}},{"./lib/attribute":2,"./lib/buffer":3,
"./lib/core":8,"./lib/dynamic":9,"./lib/elements":10,"./lib/extension":11,"./lib/framebuffer":12,"./lib/limits":13,"./lib/read":14,"./lib/renderbuffer":15,"./lib/shader":16,"./lib/stats":17,"./lib/strings":18,"./lib/texture":19,"./lib/timer":20,"./lib/util/check":21,"./lib/util/clock":22,"./lib/util/extend":24,"./lib/util/raf":31,"./lib/webgl":34}]},{},[1]);

        </script>
        </body>
      </html>